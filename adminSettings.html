<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BioFoodLab - ê¸°íƒ€ ì„¤ì •</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Pretendard',-apple-system,BlinkMacSystemFont,sans-serif;height:100vh;background:#f8f9fb;font-size:13px;overflow:hidden;display:flex}
.main{flex:1;display:flex;flex-direction:column;overflow:hidden;margin-left:250px;height:100vh}
.topbar{background:#fff;padding:16px 32px;display:flex;align-items:center;border-bottom:1px solid #e5e7eb;position:sticky;top:0;z-index:50}
.topbar .crumb{font-size:13px;color:#6b7280}.crumb b{color:#111;font-weight:700}
.content{flex:1;padding:28px 32px;overflow-y:auto}
.page-title{font-size:22px;font-weight:800;color:#111;margin-bottom:4px}
.page-desc{font-size:13px;color:#6b7280;margin-bottom:24px}

/* íƒ­ */
.settings-tabs{display:flex;gap:0;border-bottom:2px solid #e5e7eb;margin-bottom:24px}
.settings-tab{padding:12px 24px;font-size:14px;font-weight:500;color:#6b7280;cursor:pointer;border-bottom:2px solid transparent;margin-bottom:-2px;transition:all .2s}
.settings-tab:hover{color:#111;background:#f3f4f6}
.settings-tab.active{color:#2563eb;border-bottom-color:#2563eb;font-weight:700}
.tab-panel{display:none}
.tab-panel.active{display:block}

/* ì¹´ë“œ */
.card{background:#fff;border-radius:12px;border:1px solid #e5e7eb;padding:24px;margin-bottom:20px}
.card-title{font-size:16px;font-weight:700;color:#111;margin-bottom:16px;display:flex;align-items:center;gap:8px}

/* í…Œì´ë¸” */
.tbl{width:100%;border-collapse:collapse}
.tbl th,.tbl td{padding:10px 14px;text-align:left;border-bottom:1px solid #f0f0f0;font-size:13px}
.tbl th{background:#f9fafb;font-weight:600;color:#374151}
.tbl tr:hover td{background:#f9fafb}
.tbl input{padding:6px 10px;border:1px solid #d1d5db;border-radius:6px;font-size:13px;width:100%}

/* ë²„íŠ¼ */
.btn{padding:8px 16px;border:none;border-radius:8px;font-size:13px;font-weight:600;cursor:pointer;transition:all .2s}
.btn-primary{background:#2563eb;color:#fff}.btn-primary:hover{background:#1d4ed8}
.btn-danger{background:#ef4444;color:#fff}.btn-danger:hover{background:#dc2626}
.btn-outline{background:#fff;color:#374151;border:1px solid #d1d5db}.btn-outline:hover{background:#f3f4f6}
.btn-sm{padding:5px 10px;font-size:12px}
.btn-group{display:flex;gap:8px;margin-top:16px}

/* ì‹ í˜¸ë“±/ë“±ê¸‰ ê·œì¹™ */
.rule-row{display:flex;align-items:center;gap:12px;padding:10px 0;border-bottom:1px solid #f0f0f0}
.rule-row:last-child{border-bottom:none}
.color-dot{width:16px;height:16px;border-radius:50%;flex-shrink:0}
.rule-label{font-weight:600;min-width:60px}
.rule-desc{flex:1;color:#6b7280;font-size:13px}
.rule-input{width:80px;padding:5px 8px;border:1px solid #d1d5db;border-radius:6px;text-align:center;font-size:13px}

/* ë“±ê¸‰ ë°°ì§€ */
.grade-badge{display:inline-flex;align-items:center;justify-content:center;width:28px;height:28px;border-radius:6px;font-weight:700;font-size:12px;color:#fff}

/* íœ´ì¼ ìº˜ë¦°ë” */
.holiday-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:12px}
.holiday-item{display:flex;align-items:center;justify-content:space-between;padding:10px 14px;background:#fef3c7;border-radius:8px;border:1px solid #fbbf24}
.holiday-item .date{font-weight:600;color:#92400e}
.holiday-item .name{font-size:12px;color:#78350f}
.holiday-item .del{background:none;border:none;color:#dc2626;cursor:pointer;font-size:16px;padding:0 4px}
.add-holiday{display:flex;gap:8px;margin-bottom:16px;align-items:flex-end;flex-wrap:wrap}
.add-holiday label{font-size:12px;font-weight:600;color:#374151;display:block;margin-bottom:4px}
.add-holiday input{padding:8px 12px;border:1px solid #d1d5db;border-radius:6px;font-size:13px}

/* í† ìŠ¤íŠ¸ */
.toast{position:fixed;bottom:30px;right:30px;background:#1e293b;color:#fff;padding:14px 24px;border-radius:10px;font-size:14px;z-index:9999;opacity:0;transition:opacity .3s}
.toast.show{opacity:1}
</style>
</head>
<body>

<!-- Unified Sidebar -->
<aside class="sidebar" id="sidebar"></aside>
<script src="js/sidebar.js?v=3"></script>

<div class="main">
  <div class="topbar"><span class="crumb">ê´€ë¦¬ì â€º <b>ê¸°íƒ€ ì„¤ì •</b></span></div>

  <div class="content">
    <div class="page-title">ê¸°íƒ€ ì„¤ì •</div>
    <div class="page-desc">ì‹ í˜¸ë“± ê·œì¹™, ë“±ê¸‰ ê·œì¹™, íœ´ì¼ ê´€ë¦¬ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤</div>

    <!-- íƒ­ -->
    <div class="settings-tabs">
      <div class="settings-tab active" onclick="showSettingsTab(0)">ğŸš¦ ì‹ í˜¸ë“± ê·œì¹™</div>
      <div class="settings-tab" onclick="showSettingsTab(1)">ğŸ… ë“±ê¸‰ ê·œì¹™</div>
      <div class="settings-tab" onclick="showSettingsTab(2)">ğŸ“… íœ´ì¼ ê´€ë¦¬</div>
    </div>

    <!-- ======================== íƒ­ 0: ì‹ í˜¸ë“± ê·œì¹™ ======================== -->
    <div class="tab-panel active" id="panel-signal">
      <div class="card">
        <div class="card-title">ğŸš¦ ê³ ê°ì‚¬ ì‹ í˜¸ë“± ê·œì¹™</div>
        <p style="font-size:13px;color:#6b7280;margin-bottom:16px">ë¯¸ìˆ˜ê¸ˆ ê¸°ê°„ì— ë”°ë¼ ê³ ê°ì‚¬ ìƒíƒœë¥¼ ìë™ ë¶„ë¥˜í•©ë‹ˆë‹¤.</p>
        <div id="signal-rules">
          <div class="rule-row">
            <div class="color-dot" style="background:#22c55e"></div>
            <span class="rule-label">ğŸŸ¢ ì •ìƒ</span>
            <span class="rule-desc">ë¯¸ìˆ˜ê¸ˆ ì—†ìŒ ë˜ëŠ”</span>
            <input type="number" class="rule-input" id="signal-green-max" value="30" min="0"> <span>ì¼ ì´ë‚´</span>
          </div>
          <div class="rule-row">
            <div class="color-dot" style="background:#3b82f6"></div>
            <span class="rule-label">ğŸ”µ ì–‘í˜¸</span>
            <span class="rule-desc">ë¯¸ìˆ˜ê¸ˆ ê²½ê³¼ì¼</span>
            <input type="number" class="rule-input" id="signal-blue-min" value="31" min="0"> ~
            <input type="number" class="rule-input" id="signal-blue-max" value="60" min="0"> <span>ì¼</span>
          </div>
          <div class="rule-row">
            <div class="color-dot" style="background:#eab308"></div>
            <span class="rule-label">ğŸŸ¡ ì£¼ì˜</span>
            <span class="rule-desc">ë¯¸ìˆ˜ê¸ˆ ê²½ê³¼ì¼</span>
            <input type="number" class="rule-input" id="signal-yellow-min" value="61" min="0"> ~
            <input type="number" class="rule-input" id="signal-yellow-max" value="90" min="0"> <span>ì¼</span>
          </div>
          <div class="rule-row">
            <div class="color-dot" style="background:#f97316"></div>
            <span class="rule-label">ğŸŸ  ê²½ê³ </span>
            <span class="rule-desc">ë¯¸ìˆ˜ê¸ˆ ê²½ê³¼ì¼</span>
            <input type="number" class="rule-input" id="signal-orange-min" value="91" min="0"> ~
            <input type="number" class="rule-input" id="signal-orange-max" value="120" min="0"> <span>ì¼</span>
          </div>
          <div class="rule-row">
            <div class="color-dot" style="background:#ef4444"></div>
            <span class="rule-label">ğŸ”´ ìœ„í—˜</span>
            <span class="rule-desc">ë¯¸ìˆ˜ê¸ˆ ê²½ê³¼ì¼</span>
            <input type="number" class="rule-input" id="signal-red-min" value="121" min="0"> <span>ì¼ ì´ìƒ</span>
          </div>
        </div>
        <div class="btn-group">
          <button class="btn btn-primary" onclick="saveSignalRules()">ğŸ’¾ ì €ì¥</button>
          <button class="btn btn-outline" onclick="resetSignalRules()">â†©ï¸ ê¸°ë³¸ê°’ ë³µì›</button>
        </div>
      </div>
    </div>

    <!-- ======================== íƒ­ 1: ë“±ê¸‰ ê·œì¹™ ======================== -->
    <div class="tab-panel" id="panel-grade">
      <div class="card">
        <div class="card-title">ğŸ… ê³ ê°ì‚¬ ë“±ê¸‰ ê·œì¹™</div>
        <p style="font-size:13px;color:#6b7280;margin-bottom:16px">ê±°ë˜ ì‹¤ì ì— ë”°ë¼ ê³ ê°ì‚¬ ë“±ê¸‰ì„ ìë™ ë¶„ë¥˜í•©ë‹ˆë‹¤.</p>
        <table class="tbl">
          <thead>
            <tr>
              <th style="width:80px">ë“±ê¸‰</th>
              <th>ì¡°ê±´</th>
              <th style="width:140px">ìµœì†Œ ê±°ë˜ ê±´ìˆ˜</th>
              <th style="width:160px">ìµœì†Œ ê±°ë˜ ê¸ˆì•¡(ë§Œì›)</th>
            </tr>
          </thead>
          <tbody id="grade-rules-body">
            <tr>
              <td><span class="grade-badge" style="background:#ef4444">VIP</span></td>
              <td>ìµœìš°ìˆ˜ ê³ ê°</td>
              <td><input type="number" class="grade-input" data-grade="VIP" data-field="minCount" value="50" min="0"></td>
              <td><input type="number" class="grade-input" data-grade="VIP" data-field="minAmount" value="5000" min="0"></td>
            </tr>
            <tr>
              <td><span class="grade-badge" style="background:#22c55e">A</span></td>
              <td>ìš°ìˆ˜ ê³ ê°</td>
              <td><input type="number" class="grade-input" data-grade="A" data-field="minCount" value="30" min="0"></td>
              <td><input type="number" class="grade-input" data-grade="A" data-field="minAmount" value="3000" min="0"></td>
            </tr>
            <tr>
              <td><span class="grade-badge" style="background:#3b82f6">B</span></td>
              <td>ì¼ë°˜ ê³ ê°</td>
              <td><input type="number" class="grade-input" data-grade="B" data-field="minCount" value="10" min="0"></td>
              <td><input type="number" class="grade-input" data-grade="B" data-field="minAmount" value="1000" min="0"></td>
            </tr>
            <tr>
              <td><span class="grade-badge" style="background:#f97316">C</span></td>
              <td>ì‹ ê·œ/ì†ŒëŸ‰ ê³ ê°</td>
              <td><input type="number" class="grade-input" data-grade="C" data-field="minCount" value="0" min="0"></td>
              <td><input type="number" class="grade-input" data-grade="C" data-field="minAmount" value="0" min="0"></td>
            </tr>
          </tbody>
        </table>
        <div class="btn-group">
          <button class="btn btn-primary" onclick="saveGradeRules()">ğŸ’¾ ì €ì¥</button>
          <button class="btn btn-outline" onclick="resetGradeRules()">â†©ï¸ ê¸°ë³¸ê°’ ë³µì›</button>
        </div>
      </div>
    </div>

    <!-- ======================== íƒ­ 2: íœ´ì¼ ê´€ë¦¬ ======================== -->
    <div class="tab-panel" id="panel-holiday">
      <div class="card">
        <div class="card-title">ğŸ“… íœ´ì¼ ê´€ë¦¬</div>
        <p style="font-size:13px;color:#6b7280;margin-bottom:16px">ë“±ë¡ëœ íœ´ì¼ì€ ì²˜ë¦¬ê¸°í•œ ê³„ì‚°(ì›Œí‚¹ë°ì´) ì‹œ ì œì™¸ë©ë‹ˆë‹¤. ì£¼ë§(í† /ì¼)ì€ ìë™ ì œì™¸ë©ë‹ˆë‹¤.</p>

        <div class="add-holiday">
          <div>
            <label>ë‚ ì§œ</label>
            <input type="date" id="holiday-date">
          </div>
          <div>
            <label>ëª…ì¹­</label>
            <input type="text" id="holiday-name" placeholder="ì˜ˆ: ì„¤ë‚ , ì¶”ì„">
          </div>
          <button class="btn btn-primary" onclick="addHoliday()">+ ì¶”ê°€</button>
          <button class="btn btn-outline" onclick="addDefaultHolidays()">ğŸ“‹ 2026ë…„ ê³µíœ´ì¼ ì¼ê´„ ë“±ë¡</button>
        </div>

        <div class="holiday-grid" id="holiday-list"></div>
      </div>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
// ============================================================================
// íƒ­ ì „í™˜
// ============================================================================
const panels = ['panel-signal', 'panel-grade', 'panel-holiday'];
function showSettingsTab(idx) {
    document.querySelectorAll('.settings-tab').forEach((t,i) => t.classList.toggle('active', i===idx));
    panels.forEach((p,i) => document.getElementById(p).classList.toggle('active', i===idx));
}

// ============================================================================
// í† ìŠ¤íŠ¸
// ============================================================================
function toast(msg) {
    const t = document.getElementById('toast');
    t.textContent = msg;
    t.classList.add('show');
    setTimeout(() => t.classList.remove('show'), 2500);
}

// ============================================================================
// ì‹ í˜¸ë“± ê·œì¹™
// ============================================================================
const SIGNAL_DEFAULTS = {green:30, blueMin:31, blueMax:60, yellowMin:61, yellowMax:90, orangeMin:91, orangeMax:120, redMin:121};

function loadSignalRules() {
    const saved = JSON.parse(localStorage.getItem('bfl_signal_rules') || 'null') || SIGNAL_DEFAULTS;
    document.getElementById('signal-green-max').value = saved.green;
    document.getElementById('signal-blue-min').value = saved.blueMin;
    document.getElementById('signal-blue-max').value = saved.blueMax;
    document.getElementById('signal-yellow-min').value = saved.yellowMin;
    document.getElementById('signal-yellow-max').value = saved.yellowMax;
    document.getElementById('signal-orange-min').value = saved.orangeMin;
    document.getElementById('signal-orange-max').value = saved.orangeMax;
    document.getElementById('signal-red-min').value = saved.redMin;
}

function saveSignalRules() {
    const rules = {
        green: +document.getElementById('signal-green-max').value,
        blueMin: +document.getElementById('signal-blue-min').value,
        blueMax: +document.getElementById('signal-blue-max').value,
        yellowMin: +document.getElementById('signal-yellow-min').value,
        yellowMax: +document.getElementById('signal-yellow-max').value,
        orangeMin: +document.getElementById('signal-orange-min').value,
        orangeMax: +document.getElementById('signal-orange-max').value,
        redMin: +document.getElementById('signal-red-min').value
    };
    localStorage.setItem('bfl_signal_rules', JSON.stringify(rules));
    toast('âœ… ì‹ í˜¸ë“± ê·œì¹™ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤');
}

function resetSignalRules() {
    localStorage.removeItem('bfl_signal_rules');
    loadSignalRules();
    toast('â†©ï¸ ê¸°ë³¸ê°’ìœ¼ë¡œ ë³µì›ë˜ì—ˆìŠµë‹ˆë‹¤');
}

// ============================================================================
// ë“±ê¸‰ ê·œì¹™
// ============================================================================
const GRADE_DEFAULTS = {VIP:{minCount:50,minAmount:5000},A:{minCount:30,minAmount:3000},B:{minCount:10,minAmount:1000},C:{minCount:0,minAmount:0}};

function loadGradeRules() {
    const saved = JSON.parse(localStorage.getItem('bfl_grade_rules') || 'null') || GRADE_DEFAULTS;
    document.querySelectorAll('.grade-input').forEach(el => {
        const grade = el.dataset.grade;
        const field = el.dataset.field;
        if (saved[grade]) el.value = saved[grade][field];
    });
}

function saveGradeRules() {
    const rules = {};
    document.querySelectorAll('.grade-input').forEach(el => {
        const grade = el.dataset.grade;
        const field = el.dataset.field;
        if (!rules[grade]) rules[grade] = {};
        rules[grade][field] = +el.value;
    });
    localStorage.setItem('bfl_grade_rules', JSON.stringify(rules));
    toast('âœ… ë“±ê¸‰ ê·œì¹™ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤');
}

function resetGradeRules() {
    localStorage.removeItem('bfl_grade_rules');
    loadGradeRules();
    toast('â†©ï¸ ê¸°ë³¸ê°’ìœ¼ë¡œ ë³µì›ë˜ì—ˆìŠµë‹ˆë‹¤');
}

// ============================================================================
// íœ´ì¼ ê´€ë¦¬
// ============================================================================
function getHolidayData() {
    return JSON.parse(localStorage.getItem('bfl_holiday_data') || '[]');
}

function saveHolidayData(data) {
    localStorage.setItem('bfl_holiday_data', JSON.stringify(data));
    // bfl_holidays: ë‚ ì§œ ë°°ì—´ (sampleReceipt.htmlì—ì„œ ì‚¬ìš©)
    localStorage.setItem('bfl_holidays', JSON.stringify(data.map(h => h.date)));
}

function renderHolidays() {
    const data = getHolidayData().sort((a,b) => a.date.localeCompare(b.date));
    const el = document.getElementById('holiday-list');
    if (!data.length) {
        el.innerHTML = '<p style="color:#9ca3af;font-size:13px">ë“±ë¡ëœ íœ´ì¼ì´ ì—†ìŠµë‹ˆë‹¤. ê³µíœ´ì¼ì„ ì¼ê´„ ë“±ë¡í•˜ê±°ë‚˜ ê°œë³„ ì¶”ê°€í•˜ì„¸ìš”.</p>';
        return;
    }
    el.innerHTML = data.map((h,i) => `
        <div class="holiday-item">
            <div><div class="date">${h.date}</div><div class="name">${h.name}</div></div>
            <button class="del" onclick="deleteHoliday(${i})" title="ì‚­ì œ">âœ•</button>
        </div>
    `).join('');
}

function addHoliday() {
    const date = document.getElementById('holiday-date').value;
    const name = document.getElementById('holiday-name').value.trim();
    if (!date) { toast('âš ï¸ ë‚ ì§œë¥¼ ì„ íƒí•˜ì„¸ìš”'); return; }
    if (!name) { toast('âš ï¸ ëª…ì¹­ì„ ì…ë ¥í•˜ì„¸ìš”'); return; }
    const data = getHolidayData();
    if (data.some(h => h.date === date)) { toast('âš ï¸ ì´ë¯¸ ë“±ë¡ëœ ë‚ ì§œì…ë‹ˆë‹¤'); return; }
    data.push({ date, name });
    saveHolidayData(data);
    renderHolidays();
    document.getElementById('holiday-date').value = '';
    document.getElementById('holiday-name').value = '';
    toast('âœ… íœ´ì¼ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤');
}

function deleteHoliday(idx) {
    const data = getHolidayData();
    data.splice(idx, 1);
    saveHolidayData(data);
    renderHolidays();
    toast('ğŸ—‘ï¸ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤');
}

function addDefaultHolidays() {
    const defaults = [
        {date:'2026-01-01', name:'ì‹ ì •'},
        {date:'2026-01-26', name:'ì„¤ë‚  ì „ë‚ '}, {date:'2026-01-27', name:'ì„¤ë‚ '}, {date:'2026-01-28', name:'ì„¤ë‚  ë‹¤ìŒë‚ '},
        {date:'2026-03-01', name:'ì‚¼ì¼ì ˆ'},
        {date:'2026-05-05', name:'ì–´ë¦°ì´ë‚ '},
        {date:'2026-05-24', name:'ë¶€ì²˜ë‹˜ì˜¤ì‹ ë‚ '},
        {date:'2026-06-06', name:'í˜„ì¶©ì¼'},
        {date:'2026-08-15', name:'ê´‘ë³µì ˆ'},
        {date:'2026-09-24', name:'ì¶”ì„ ì „ë‚ '}, {date:'2026-09-25', name:'ì¶”ì„'}, {date:'2026-09-26', name:'ì¶”ì„ ë‹¤ìŒë‚ '},
        {date:'2026-10-03', name:'ê°œì²œì ˆ'},
        {date:'2026-10-09', name:'í•œê¸€ë‚ '},
        {date:'2026-12-25', name:'í¬ë¦¬ìŠ¤ë§ˆìŠ¤'}
    ];
    const data = getHolidayData();
    let added = 0;
    defaults.forEach(d => {
        if (!data.some(h => h.date === d.date)) { data.push(d); added++; }
    });
    saveHolidayData(data);
    renderHolidays();
    toast(`âœ… 2026ë…„ ê³µíœ´ì¼ ${added}ê±´ ì¶”ê°€ (ì¤‘ë³µ ì œì™¸)`);
}

// ============================================================================
// ì´ˆê¸°í™”
// ============================================================================
window.onload = function() {
    loadSignalRules();
    loadGradeRules();
    renderHolidays();
};
</script>
</body>
</html>
