<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BioFoodLab LIMS - ì—…ì²´ë“±ë¡Â·ìˆ˜ì •</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Pretendard',-apple-system,BlinkMacSystemFont,sans-serif;height:100vh;background:#f8f9fb;font-size:13px;overflow:hidden;display:flex}

/* Main */
.main{flex:1;display:flex;flex-direction:column;overflow:hidden;margin-left:250px;height:100vh}
.topbar{background:#fff;border-bottom:1px solid #e2e6ed;padding:0 24px;height:52px;display:flex;align-items:center;gap:10px;flex-shrink:0}
.topbar-title{font-size:15px;font-weight:700;color:#1a2332}
.topbar-sep{color:#c8d6e5}
.topbar-sub{font-size:13px;color:#5f6b7a}
.content{flex:1;padding:24px;overflow-y:auto}

/* Buttons */
.btn{padding:8px 16px;border-radius:8px;font-size:12px;font-weight:600;cursor:pointer;border:none;transition:all .15s;display:inline-flex;align-items:center;gap:6px}
.btn-primary{background:#1a73e8;color:#fff}.btn-primary:hover{background:#1557b0}
.btn-secondary{background:#fff;color:#5f6b7a;border:1px solid #e2e6ed}.btn-secondary:hover{background:#f0f2f5}
.btn-success{background:#2e7d32;color:#fff}.btn-success:hover{background:#1b5e20}
.btn-danger{background:#e53935;color:#fff}.btn-danger:hover{background:#c62828}
.btn-sm{padding:6px 12px;font-size:11px}
.btn-check{background:#e3f2fd;color:#1565c0;border:1px solid #bbdefb}.btn-check:hover{background:#bbdefb}
.btn-warning{background:#ff9800;color:#fff}.btn-warning:hover{background:#f57c00}

/* Card */
.card{background:#fff;border-radius:12px;border:1px solid #e2e6ed;margin-bottom:16px}
.card-hd{padding:16px 20px;border-bottom:1px solid #eef0f4;display:flex;align-items:center;gap:10px}
.card-hd h3{font-size:15px;font-weight:700;color:#1a2332}
.card-hd .right{margin-left:auto;display:flex;gap:8px}
.card-bd{padding:20px}

/* Tables */
.tbl{width:100%;border-collapse:collapse}
.tbl th{background:#f8f9fb;padding:10px 14px;font-size:11px;font-weight:700;color:#5f6b7a;text-align:left;border-bottom:2px solid #e2e6ed;white-space:nowrap}
.tbl td{padding:10px 14px;border-bottom:1px solid #eef0f4;font-size:12px;color:#333}
.tbl tr:hover{background:#fafbfc;cursor:pointer}
.tbl .center{text-align:center}

/* Tags */
.tag{display:inline-block;padding:2px 8px;border-radius:4px;font-size:10px;font-weight:600}
.tag-active{background:#e8f5e9;color:#2e7d32}.tag-dormant{background:#fff3e0;color:#e65100}.tag-terminated{background:#f5f5f5;color:#9e9e9e}
.tag-vip{background:#fce4ec;color:#c62828}.tag-a{background:#e3f2fd;color:#1565c0}.tag-b{background:#e8f5e9;color:#2e7d32}.tag-c{background:#f3e5f5;color:#7b1fa2}
.tl{display:inline-block;width:12px;height:12px;border-radius:50%;vertical-align:middle}
.tl-blue{background:#2196f3}.tl-green{background:#4caf50}.tl-yellow{background:#ffeb3b}.tl-orange{background:#ff9800}.tl-red{background:#f44336}

/* Form */
.fg{display:flex;flex-direction:column;gap:4px;margin-bottom:12px}
.fg label{font-size:11px;color:#5f6b7a;font-weight:600}
.fg label .req{color:#e53935}
.fg input,.fg select,.fg textarea{padding:9px 12px;border:1px solid #e2e6ed;border-radius:8px;font-size:13px;outline:none;font-family:inherit;transition:border .15s}
.fg input:focus,.fg select:focus,.fg textarea:focus{border-color:#4fc3f7;box-shadow:0 0 0 3px rgba(79,195,247,.1)}
.fg textarea{resize:vertical;min-height:60px}
.fg select{cursor:pointer;background:#fff}
.fg-row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.fg-row3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px}

/* Sub-card */
.sub-card{background:#f8f9fb;border:1px solid #eef0f4;border-radius:10px;padding:14px;margin-bottom:10px;position:relative}
.sub-card-hd{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
.sub-card-title{font-size:12px;font-weight:700;display:flex;align-items:center;gap:6px}
.sub-card-num{background:#e3f2fd;color:#1565c0;width:20px;height:20px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:10px;font-weight:700}
.btn-add{display:flex;align-items:center;gap:6px;padding:10px;border:2px dashed #c8d6e5;border-radius:10px;background:transparent;color:#5f6b7a;font-size:12px;font-weight:600;cursor:pointer;width:100%;justify-content:center}
.btn-add:hover{border-color:#1a73e8;color:#1a73e8;background:#f0f7ff}
.combo{display:flex;gap:6px}.combo select,.combo input{flex:1}
.check-result{margin-top:4px;font-size:11px;padding:6px 10px;border-radius:6px;display:none}
.check-ok{background:#e8f5e9;color:#2e7d32}

/* Section title */
.sec-title{font-size:14px;font-weight:700;color:#1a2332;margin:20px 0 12px;padding-bottom:8px;border-bottom:1px solid #eef0f4;display:flex;align-items:center;gap:8px}
.sec-num{background:#1a73e8;color:#fff;width:22px;height:22px;border-radius:6px;display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:700;flex-shrink:0}

/* File area */
.file-area{border:2px dashed #e2e6ed;border-radius:10px;padding:16px;text-align:center;color:#8892a4;font-size:12px;cursor:pointer}
.file-area:hover{border-color:#1a73e8;color:#1a73e8;background:#f0f7ff}
.addr-row{display:flex;gap:8px}.addr-row input{flex:1}
.radio-group{display:flex;gap:12px;padding:6px 0}

/* Toast */
.toast{display:none;position:fixed;bottom:30px;left:50%;transform:translateX(-50%);background:#1a2332;color:#fff;padding:14px 28px;border-radius:10px;font-size:14px;font-weight:600;box-shadow:0 4px 20px rgba(0,0,0,.2);z-index:200}
.toast.show{display:block;animation:fadeUp .3s ease}
@keyframes fadeUp{from{opacity:0;transform:translateX(-50%) translateY(10px)}to{opacity:1;transform:translateX(-50%) translateY(0)}}
@keyframes fadeIn{from{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}

/* Search bar */
.search-bar{display:flex;gap:8px;align-items:center}
.search-bar input{flex:1;max-width:300px}
.search-bar select{max-width:130px}

/* Stats row */
.stats-row{display:grid;grid-template-columns:repeat(5,1fr);gap:10px;margin-bottom:16px}
.stat-box{background:#fff;border:1px solid #e2e6ed;border-radius:10px;padding:12px;text-align:center}
.stat-box .val{font-size:20px;font-weight:800;color:#1a2332}
.stat-box .lbl{font-size:10px;color:#8892a4;margin-top:2px}

/* Page */
.page{display:none}
</style>
<!-- Daum Postcode API -->
<script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
</head>
<body>

<!-- ===== SIDEBAR (js/sidebar.js) ===== -->
<nav class="sidebar" id="sidebar"></nav>

<!-- ===== MAIN ===== -->
<div class="main">
  <div class="topbar">
    <span class="topbar-title">ì ‘ìˆ˜ ê´€ë¦¬</span>
    <span class="topbar-sep">â€º</span>
    <span class="topbar-sub" id="topSub">ì—…ì²´ë“±ë¡Â·ìˆ˜ì •</span>
  </div>
  <div class="content" id="contentArea">

    <!-- ========== ëª©ë¡ í˜ì´ì§€ ========== -->
    <div class="page" id="page-list" style="display:block">
      <!-- í†µê³„ -->
      <div class="stats-row">
        <div class="stat-box"><div class="val" id="statTotal">0</div><div class="lbl">ì „ì²´ ì—…ì²´</div></div>
        <div class="stat-box"><div class="val" id="statActive" style="color:#2e7d32">0</div><div class="lbl">í™œë™</div></div>
        <div class="stat-box"><div class="val" id="statDormant" style="color:#e65100">0</div><div class="lbl">íœ´ë©´</div></div>
        <div class="stat-box"><div class="val" id="statTerminated" style="color:#9e9e9e">0</div><div class="lbl">í•´ì§€</div></div>
        <div class="stat-box"><div class="val" id="statNew" style="color:#1565c0">0</div><div class="lbl">ìµœê·¼ 30ì¼ ë“±ë¡</div></div>
      </div>

      <div class="card">
        <div class="card-hd">
          <h3>ì—…ì²´ ëª©ë¡</h3>
          <div class="right">
            <div class="search-bar">
              <select id="searchFilter" style="padding:8px 10px;border:1px solid #e2e6ed;border-radius:8px;font-size:12px">
                <option value="all">ì „ì²´</option>
                <option value="company">íšŒì‚¬ëª…</option>
                <option value="bizNo">ì‚¬ì—…ìë²ˆí˜¸</option>
                <option value="repName">ëŒ€í‘œì</option>
                <option value="contactName">ë‹´ë‹¹ì</option>
              </select>
              <input id="searchInput" placeholder="ê²€ìƒ‰ì–´ ì…ë ¥..." style="padding:8px 12px;border:1px solid #e2e6ed;border-radius:8px;font-size:12px" oninput="loadList()">
            </div>
            <button class="btn btn-primary" onclick="showPage('reg')">+ ì‹ ê·œ ë“±ë¡</button>
          </div>
        </div>
        <div class="card-bd" style="padding:0">
          <table class="tbl">
            <thead>
              <tr>
                <th>No</th>
                <th>íšŒì‚¬ëª…</th>
                <th>ëŒ€í‘œì</th>
                <th>ì‚¬ì—…ìë²ˆí˜¸</th>
                <th>ë‹´ë‹¹ì</th>
                <th>ë‹´ë‹¹ë¶€ì„œ</th>
                <th>ì ‘ìˆ˜í˜•íƒœ</th>
                <th>ê³„ì•½ìƒíƒœ</th>
                <th>ë“±ë¡ì¼</th>
              </tr>
            </thead>
            <tbody id="listBody"></tbody>
          </table>
          <div id="emptyMsg" style="text-align:center;padding:40px;color:#8892a4;display:none">
            <div style="font-size:36px;margin-bottom:8px">ğŸ“‹</div>
            <div>ë“±ë¡ëœ ì—…ì²´ê°€ ì—†ìŠµë‹ˆë‹¤. <a href="#" onclick="showPage('reg');return false" style="color:#1a73e8">ì‹ ê·œ ë“±ë¡</a>ì„ í•´ì£¼ì„¸ìš”.</div>
          </div>
        </div>
      </div>
    </div>

    <!-- ========== ë“±ë¡ í˜ì´ì§€ ========== -->
    <div class="page" id="page-reg">
      <div style="margin-bottom:16px"><button class="btn btn-secondary btn-sm" onclick="showPage('list')">â† ëª©ë¡ìœ¼ë¡œ</button></div>
      <div class="card"><div class="card-bd" style="max-width:860px">

        <!-- ì‚¬ì—…ìë“±ë¡ì¦ OCR -->
        <div style="background:linear-gradient(135deg,#e8f5e9 0%,#f1f8e9 100%);border:2px solid #c8e6c9;border-radius:12px;padding:20px;margin-bottom:20px">
          <div style="display:flex;align-items:center;gap:10px;margin-bottom:12px">
            <span style="font-size:20px">ğŸ“„</span>
            <div>
              <div style="font-size:14px;font-weight:700;color:#2e7d32">ì‚¬ì—…ìë“±ë¡ì¦ OCR ìë™ì…ë ¥</div>
              <div style="font-size:11px;color:#558b2f">ì‚¬ì—…ìë“±ë¡ì¦ì„ ì—…ë¡œë“œí•˜ë©´ ê¸°ë³¸ì •ë³´ + ì£¼ì†Œê°€ ìë™ìœ¼ë¡œ ì…ë ¥ë©ë‹ˆë‹¤</div>
            </div>
          </div>
          <div style="display:flex;gap:10px;align-items:center">
            <div class="file-area" id="bizLicFileArea" style="flex:1;padding:14px;position:relative" onclick="document.getElementById('bizLicFileInput').click()" ondragover="event.preventDefault();this.style.borderColor='#43a047';this.style.background='#e8f5e9'" ondragleave="this.style.borderColor='#c8e6c9';this.style.background='transparent'" ondrop="event.preventDefault();this.style.borderColor='#c8e6c9';this.style.background='transparent';handleBizLicFile(event.dataTransfer.files[0])">
              <input type="file" id="bizLicFileInput" accept="image/*,.pdf" style="display:none" onchange="handleBizLicFile(this.files[0])">
              <span id="bizLicFileName">ğŸ“ ì‚¬ì—…ìë“±ë¡ì¦ íŒŒì¼ ì„ íƒ ë˜ëŠ” ë“œë˜ê·¸ (JPG, PNG, PDF)</span>
            </div>
            <button class="btn btn-success btn-sm" id="bizLicOcrBtn" onclick="runBizLicOCR()" disabled style="white-space:nowrap;padding:12px 16px">ğŸ¤– OCR ì¸ì‹</button>
          </div>
          <div id="bizLicOcrStatus" style="margin-top:8px;font-size:11px;color:#558b2f;display:none"></div>
          <div id="bizLicPreview" style="margin-top:10px;display:none"><img id="bizLicPreviewImg" style="max-width:100%;max-height:200px;border-radius:8px;border:1px solid #c8e6c9"></div>
        </div>

        <div class="sec-title"><span class="sec-num">1</span> ê¸°ë³¸ ì •ë³´</div>
        <div class="fg-row">
          <div class="fg"><label>ë²•ì¸ ì—¬ë¶€ <span class="req">*</span></label><div class="radio-group"><label class="radio-item"><input type="radio" name="corp" id="regCorpYes" value="ë²•ì¸" checked> ë²•ì¸</label><label class="radio-item"><input type="radio" name="corp" id="regCorpIndiv" value="ê°œì¸"> ê°œì¸</label></div></div>
          <div class="fg"><label>ê±°ë˜ì²˜ ë“±ê¸‰</label><select id="regGrade"><option>ë“±ê¸‰ ì„ íƒ</option><option>VIP</option><option>A</option><option>B</option><option>C</option></select></div>
        </div>
        <div class="fg-row">
          <div class="fg"><label>íšŒì‚¬ëª… <span class="req">*</span></label><div class="combo"><input id="regCompany" placeholder="ì˜ˆ: (ì£¼)ë°”ì´ì˜¤í‘¸ë“œë©"><button class="btn btn-check btn-sm" onclick="checkCompanyDup()">ì¤‘ë³µ í™•ì¸</button></div><div class="check-result" id="compChk"></div></div>
          <div class="fg"><label>ëŒ€í‘œìëª… <span class="req">*</span></label><input id="regRepName" placeholder="ëŒ€í‘œì ì´ë¦„"></div>
        </div>
        <div class="fg-row">
          <div class="fg"><label>ì‚¬ì—…ìë²ˆí˜¸ <span class="req">*</span></label><div class="combo"><input id="regBizNo" placeholder="000-00-00000" maxlength="12" oninput="fmtBiz(this)"><button class="btn btn-check btn-sm" onclick="checkBizNoDup()">ì¤‘ë³µ í™•ì¸</button></div><div class="check-result" id="bizChk"></div></div>
          <div class="fg"><label>ë²•ì¸ë²ˆí˜¸</label><input id="regCorpNo" placeholder="000000-0000000" maxlength="14"></div>
        </div>
        <div class="fg-row">
          <div class="fg"><label>ì—…íƒœ</label><input id="regBizType" placeholder="ì˜ˆ: ì œì¡°ì—…"></div>
          <div class="fg"><label>ì¢…ëª©</label><input id="regBizItem" placeholder="ì˜ˆ: ì‹í’ˆ"></div>
        </div>
        <div class="fg-row">
          <div class="fg"><label>ê³„ì•½ ìƒíƒœ</label><select id="regStatus"><option selected>í™œë™</option><option>íœ´ë©´</option><option>í•´ì§€</option></select></div>
          <div class="fg"><label>ì‹ í˜¸ë“±</label><div style="display:flex;align-items:center;gap:6px;padding:8px 0"><span class="tl tl-blue"></span><span style="font-size:11px;color:#5f6b7a">íŒŒë‘ (ì‹ ê·œ ë“±ë¡ ì‹œ ê¸°ë³¸ê°’)</span></div></div>
        </div>
        <div class="fg-row">
          <div class="fg"><label>ë‹´ë‹¹ë¶€ì„œ</label><select id="regDepartment"><option value="">ì„ íƒ</option><option>ê³ ê°ì§€ì›íŒ€</option><option>ë§ˆì¼€íŒ…ì‚¬ì—…ë¶€</option><option>ê³ ê°ê´€ë¦¬</option><option>ì§€ì‚¬</option></select></div>
          <div class="fg"><label>ì ‘ìˆ˜í˜•íƒœ</label><select id="regReceiptType"><option value="">ì„ íƒ</option><option>í™ˆí˜ì´ì§€ì ‘ìˆ˜</option><option>ë°©ë¬¸ì ‘ìˆ˜</option><option>íƒë°°ì ‘ìˆ˜</option></select></div>
        </div>

        <div class="sec-title"><span class="sec-num">2</span> ì£¼ì†Œ</div>
        <div class="fg"><label>ì£¼ì†Œ</label><div class="addr-row"><input id="regZipcode" placeholder="ìš°í¸ë²ˆí˜¸" style="max-width:120px" readonly><button class="btn btn-secondary btn-sm" onclick="openPostcodeSearch()">ìš°í¸ë²ˆí˜¸ ì°¾ê¸°</button></div></div>
        <div class="fg"><input id="regAddr1" placeholder="ê¸°ë³¸ì£¼ì†Œ (ìë™ì…ë ¥)" readonly></div>
        <div class="fg"><input id="regAddr2" placeholder="ìƒì„¸ì£¼ì†Œ ì…ë ¥"></div>

        <div class="eng-toggle" onclick="toggleEngSection('bizEngSection')" style="margin-top:12px;cursor:pointer;display:flex;align-items:center;gap:6px;padding:6px 0;color:#1565c0;font-size:13px;font-weight:500">
          <span id="bizEngArrow" style="transition:transform .2s;display:inline-block">â–¶</span> ì‚¬ì—…ìë“±ë¡ì¦ (ì˜ë¬¸ ì •ë³´)
        </div>
        <div id="bizEngSection" style="display:none;padding:8px 0 4px 0;border-top:1px dashed #e2e6ed;margin-bottom:8px">
          <div class="fg"><label>Company Name (EN)</label><input id="regCompanyNameEn" placeholder="Company name in English"></div>
          <div class="fg"><label>Representative (EN)</label><input id="regRepNameEn" placeholder="Representative name in English"></div>
          <div class="fg"><label>Address (EN)</label><input id="regAddrEn" placeholder="Address in English"></div>
        </div>

        <div class="sec-title"><span class="sec-num">3</span> ì¸í—ˆê°€ ì •ë³´ <span style="margin-left:auto;font-size:11px;color:#8892a4;font-weight:400">ì—¬ëŸ¬ ê°œ ë“±ë¡ ê°€ëŠ¥</span></div>
        <div id="licenseArea">
          <div class="sub-card" id="licCard_1">
            <div class="sub-card-hd"><div class="sub-card-title"><span class="sub-card-num">1</span> ì¸í—ˆê°€</div></div>
            <div class="fg-row">
              <div class="fg"><label>ë¶„ì•¼</label><select id="licField_1"><option>ì„ íƒ</option><option>ì‹í’ˆ</option><option>ì¶•ì‚°</option></select></div>
              <div class="fg"><label>ì˜ì—…ì˜ í˜•íƒœ</label><div class="combo"><select id="licBizForm_1"><option>ì„ íƒ</option><option>ì‹í’ˆì œì¡°ê°€ê³µì—…</option><option>ì¦‰ì„íŒë§¤ì œì¡°ê°€ê³µì—…</option><option>ì‹í’ˆì†Œë¶„ì—…</option><option>ìœ í†µì „ë¬¸íŒë§¤ì—…</option><option>ì¶•ì‚°ë¬¼ê°€ê³µì—…</option><option>ì‹ìœ¡í¬ì¥ì²˜ë¦¬ì—…</option><option value="etc">ì§ì ‘ ì…ë ¥</option></select></div></div>
            </div>
            <div class="fg-row">
              <div class="fg"><label>ëŒ€í‘œì</label><input id="licRepName_1" placeholder="ì¸í—ˆê°€ ëŒ€í‘œì"></div>
              <div class="fg"><label>ì¸í—ˆê°€ë²ˆí˜¸</label><input id="licNo_1" placeholder="ì¸í—ˆê°€ë²ˆí˜¸"></div>
            </div>
            <div class="fg-row">
              <div class="fg"><label>ì˜ì—…ì†Œëª…ì¹­</label><input id="licBizName_1" placeholder="ì˜ì—…ì†Œ ëª…ì¹­"></div>
            </div>
            <div class="fg"><label>ì†Œì¬ì§€</label>
              <div class="addr-row"><input id="licZipcode_1" placeholder="ìš°í¸ë²ˆí˜¸" style="max-width:120px" readonly><button class="btn btn-secondary btn-sm" onclick="openLicPostcodeSearch(1)">ìš°í¸ë²ˆí˜¸ ì°¾ê¸°</button></div>
            </div>
            <div class="fg"><input id="licAddr_1" placeholder="ê¸°ë³¸ì£¼ì†Œ (ìë™ì…ë ¥)" readonly></div>
            <div class="fg"><input id="licAddr2_1" placeholder="ìƒì„¸ì£¼ì†Œ ì…ë ¥"></div>
            <div class="eng-toggle" onclick="toggleEngSection('licEngSection_1')" style="margin-top:8px;cursor:pointer;display:flex;align-items:center;gap:6px;padding:6px 0;color:#1565c0;font-size:13px;font-weight:500">
              <span style="transition:transform .2s;display:inline-block">â–¶</span> ì¸í—ˆê°€ ì •ë³´ (ì˜ë¬¸)
            </div>
            <div id="licEngSection_1" style="display:none;padding:8px 0 4px 0;border-top:1px dashed #e2e6ed">
              <div class="fg"><label>Business Name (EN)</label><input id="licBizNameEn_1" placeholder="Business name in English"></div>
              <div class="fg"><label>Representative (EN)</label><input id="licRepNameEn_1" placeholder="Representative name in English"></div>
              <div class="fg"><label>Address (EN)</label><input id="licAddrEn_1" placeholder="Address in English"></div>
            </div>
          </div>
        </div>
        <button class="btn-add" onclick="addLicenseCard()">+ ì¸í—ˆê°€ ì •ë³´ ì¶”ê°€</button>

        <div class="sec-title"><span class="sec-num">4</span> ê³ ê°ì‚¬ ë‹´ë‹¹ì</div>
        <div id="contactArea">
          <div class="sub-card">
            <div class="sub-card-hd"><div class="sub-card-title"><span class="sub-card-num">1</span> ë‹´ë‹¹ì</div></div>
            <div class="fg-row3">
              <div class="fg"><label>ì´ë¦„</label><input id="regCName" placeholder="ë‹´ë‹¹ì ì´ë¦„"></div>
              <div class="fg"><label>ì „í™”ë²ˆí˜¸</label><input id="regCPhone" placeholder="010-0000-0000" oninput="fmtPhone(this)"></div>
              <div class="fg"><label>ì´ë©”ì¼</label><input id="regCEmail" type="email" placeholder="email@example.com"></div>
            </div>
            <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin-top:6px">
              <button class="btn btn-check btn-sm" onclick="checkContactDup()">ì¤‘ë³µ í™•ì¸</button>
              <div class="check-result" id="cntChk"></div>
              <div style="margin-left:auto;display:flex;align-items:center;gap:6px;font-size:11px;color:#8892a4">
                ìì‚¬ ë‹´ë‹¹: <select id="regSalesRep" style="padding:5px 8px;border:1px solid #e2e6ed;border-radius:6px;font-size:11px"><option>ì„ íƒ</option><option>ë°•ì£¼ì„</option><option selected>ì´ì£¼ì„</option><option>ê¹€ì‚¬ì›</option></select>
              </div>
            </div>
          </div>
        </div>

        <div class="sec-title"><span class="sec-num">5</span> ì„¸ê¸ˆê³„ì‚°ì„œ ë‹´ë‹¹ì <button class="btn btn-check btn-sm" style="margin-left:auto" onclick="copyContactToTax()">ğŸ“‹ 1ë²ˆ ë‹´ë‹¹ì ë³µì‚¬</button></div>
        <div class="fg-row3">
          <div class="fg"><label>ì´ë¦„</label><input id="regTaxName" placeholder="ë‹´ë‹¹ì ì´ë¦„"></div>
          <div class="fg"><label>ì „í™”ë²ˆí˜¸</label><input id="regTaxPhone" placeholder="010-0000-0000" oninput="fmtPhone(this)"></div>
          <div class="fg"><label>ì´ë©”ì¼</label><input id="regTaxEmail" type="email" placeholder="ì„¸ê¸ˆê³„ì‚°ì„œ ìˆ˜ì‹  ì´ë©”ì¼"></div>
        </div>

        <div class="sec-title"><span class="sec-num">6</span> ë©”ëª¨ / ë¹„ê³ </div>
        <div class="fg"><textarea id="regMemo" placeholder="íŠ¹ì´ì‚¬í•­, ê³„ì•½ ì¡°ê±´, ì°¸ê³ ì‚¬í•­ ë“±..."></textarea></div>

        <div style="display:flex;justify-content:flex-end;gap:10px;margin-top:16px">
          <button class="btn btn-secondary" onclick="showPage('list')">ì·¨ì†Œ</button>
          <button class="btn btn-primary" id="btnSave" onclick="saveCompany()">âœ… ì—…ì²´ ë“±ë¡</button>
        </div>
      </div></div>
    </div>

    <!-- ========== ìƒì„¸/ìˆ˜ì • í˜ì´ì§€ ========== -->
    <div class="page" id="page-detail">
      <div style="margin-bottom:16px;display:flex;gap:8px">
        <button class="btn btn-secondary btn-sm" onclick="showPage('list')">â† ëª©ë¡ìœ¼ë¡œ</button>
        <div style="margin-left:auto;display:flex;gap:8px">
          <button class="btn btn-warning btn-sm" id="btnEdit" onclick="toggleEdit()">âœï¸ ìˆ˜ì •</button>
          <button class="btn btn-danger btn-sm" onclick="deleteCompany()">ğŸ—‘ï¸ ì‚­ì œ</button>
        </div>
      </div>
      <div class="card"><div class="card-bd" style="max-width:860px" id="detailArea">
        <!-- JSë¡œ ë™ì  ìƒì„± -->
      </div></div>
    </div>

  </div>
</div>

<!-- Toast -->
<div class="toast" id="toastEl"></div>

<script src="js/sidebar.js"></script>
<script>
// ============================================================
// ì „ì—­ ë³€ìˆ˜
// ============================================================
var _licenseCardCount = 1;
var _bizLicFile = null;
var _editMode = false;
var _currentId = null;

// ============================================================
// í† ìŠ¤íŠ¸
// ============================================================
function toast(msg) {
  var el = document.getElementById('toastEl');
  el.textContent = msg;
  el.classList.add('show');
  setTimeout(function() { el.classList.remove('show'); }, 2000);
}

// ============================================================
// í˜ì´ì§€ ì „í™˜
// ============================================================
function showPage(id) {
  document.querySelectorAll('.page').forEach(function(p) { p.style.display = 'none'; });
  var page = document.getElementById('page-' + id);
  if (page) page.style.display = 'block';
  document.getElementById('contentArea').scrollTop = 0;

  if (id === 'list') {
    document.getElementById('topSub').textContent = 'ì—…ì²´ë“±ë¡Â·ìˆ˜ì •';
    loadList();
  } else if (id === 'reg') {
    document.getElementById('topSub').textContent = 'ì‹ ê·œ ë“±ë¡';
    _currentId = null;
    _editMode = false;
    resetRegForm();
  }
}

// ============================================================
// ì—…ì²´ ëª©ë¡ ë¡œë“œ
// ============================================================
function getCustomers() {
  return JSON.parse(localStorage.getItem('bfl_customers') || '[]');
}

function loadList() {
  var customers = getCustomers();
  var query = (document.getElementById('searchInput').value || '').trim().toLowerCase();
  var filter = document.getElementById('searchFilter').value;

  // í•„í„°ë§
  var filtered = customers;
  if (query) {
    filtered = customers.filter(function(c) {
      if (filter === 'company') return (c.company || '').toLowerCase().includes(query);
      if (filter === 'bizNo') return (c.bizNo || '').includes(query);
      if (filter === 'repName') return (c.repName || '').toLowerCase().includes(query);
      if (filter === 'contactName') return (c.contactName || '').toLowerCase().includes(query);
      // all
      return (c.company || '').toLowerCase().includes(query) ||
             (c.bizNo || '').includes(query) ||
             (c.repName || '').toLowerCase().includes(query) ||
             (c.contactName || '').toLowerCase().includes(query);
    });
  }

  // í†µê³„
  document.getElementById('statTotal').textContent = customers.length;
  document.getElementById('statActive').textContent = customers.filter(function(c) { return c.status === 'í™œë™'; }).length;
  document.getElementById('statDormant').textContent = customers.filter(function(c) { return c.status === 'íœ´ë©´'; }).length;
  document.getElementById('statTerminated').textContent = customers.filter(function(c) { return c.status === 'í•´ì§€'; }).length;
  var thirtyDaysAgo = new Date(); thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
  document.getElementById('statNew').textContent = customers.filter(function(c) { return c.regDate && new Date(c.regDate) >= thirtyDaysAgo; }).length;

  // í…Œì´ë¸” ë Œë”
  var tbody = document.getElementById('listBody');
  var emptyMsg = document.getElementById('emptyMsg');

  if (filtered.length === 0) {
    tbody.innerHTML = '';
    emptyMsg.style.display = 'block';
    return;
  }
  emptyMsg.style.display = 'none';

  tbody.innerHTML = filtered.map(function(c, i) {
    var statusTag = c.status === 'í™œë™' ? 'tag-active' : c.status === 'íœ´ë©´' ? 'tag-dormant' : 'tag-terminated';
    return '<tr onclick="openDetail(\'' + c.id + '\')">' +
      '<td class="center">' + (i + 1) + '</td>' +
      '<td><strong>' + (c.company || '') + '</strong></td>' +
      '<td>' + (c.repName || '') + '</td>' +
      '<td>' + (c.bizNo || '') + '</td>' +
      '<td>' + (c.contactName || '-') + '</td>' +
      '<td>' + (c.department || '-') + '</td>' +
      '<td>' + (c.receiptType || '-') + '</td>' +
      '<td><span class="tag ' + statusTag + '">' + (c.status || 'í™œë™') + '</span></td>' +
      '<td>' + (c.regDate || '-') + '</td>' +
      '</tr>';
  }).join('');
}

// ============================================================
// ìƒì„¸ ë³´ê¸°
// ============================================================
function openDetail(id) {
  var customers = getCustomers();
  var cust = customers.find(function(c) { return c.id === id; });
  if (!cust) { toast('ì—…ì²´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤'); return; }

  _currentId = id;
  _editMode = false;
  document.getElementById('topSub').textContent = cust.company + ' ìƒì„¸';

  var html = buildDetailHTML(cust);
  document.getElementById('detailArea').innerHTML = html;
  document.getElementById('btnEdit').textContent = 'âœï¸ ìˆ˜ì •';

  document.querySelectorAll('.page').forEach(function(p) { p.style.display = 'none'; });
  document.getElementById('page-detail').style.display = 'block';
  document.getElementById('contentArea').scrollTop = 0;
}

function buildDetailHTML(c) {
  var fields = [
    { label: 'íšŒì‚¬ëª…', val: c.company },
    { label: 'ëŒ€í‘œìëª…', val: c.repName },
    { label: 'ì‚¬ì—…ìë²ˆí˜¸', val: c.bizNo },
    { label: 'ë²•ì¸ë²ˆí˜¸', val: c.corpNo },
    { label: 'ì—…íƒœ', val: c.bizType },
    { label: 'ì¢…ëª©', val: c.bizItem },
    { label: 'ê³„ì•½ ìƒíƒœ', val: c.status },
    { label: 'ë“±ê¸‰', val: c.grade },
    { label: 'ë‹´ë‹¹ë¶€ì„œ', val: c.department },
    { label: 'ì ‘ìˆ˜í˜•íƒœ', val: c.receiptType }
  ];

  var h = '<div class="sec-title"><span class="sec-num">1</span> ê¸°ë³¸ ì •ë³´</div>';
  h += '<div style="display:grid;grid-template-columns:1fr 1fr;gap:8px 20px">';
  fields.forEach(function(f) {
    h += '<div class="fg"><label>' + f.label + '</label><input value="' + (f.val || '') + '" readonly style="background:#f8f9fb"></div>';
  });
  h += '</div>';

  h += '<div class="sec-title"><span class="sec-num">2</span> ì£¼ì†Œ</div>';
  h += '<div class="fg"><label>ìš°í¸ë²ˆí˜¸</label><input value="' + (c.zipcode || '') + '" readonly style="background:#f8f9fb"></div>';
  h += '<div class="fg"><label>ì£¼ì†Œ</label><input value="' + (c.addr1 || '') + ' ' + (c.addr2 || '') + '" readonly style="background:#f8f9fb"></div>';

  if (c.companyEn || c.repNameEn || c.addrEn) {
    h += '<div class="sec-title" style="font-size:12px;color:#1565c0">ì˜ë¬¸ ì •ë³´</div>';
    h += '<div class="fg"><label>Company Name (EN)</label><input value="' + (c.companyEn || '') + '" readonly style="background:#f8f9fb"></div>';
    h += '<div class="fg"><label>Representative (EN)</label><input value="' + (c.repNameEn || '') + '" readonly style="background:#f8f9fb"></div>';
    h += '<div class="fg"><label>Address (EN)</label><input value="' + (c.addrEn || '') + '" readonly style="background:#f8f9fb"></div>';
  }

  // ì¸í—ˆê°€ ì •ë³´
  var lics = c.licenses || [];
  if (lics.length === 0 && c.licField && c.licField !== 'ì„ íƒ') {
    lics = [{ licField: c.licField, licBizForm: c.licBizForm, licRepName: c.licRepName, licNo: c.licNo, licBizName: c.licBizName, licZipcode: c.licZipcode, licAddr: c.licAddr, licAddr2: c.licAddr2 }];
  }
  if (lics.length > 0) {
    h += '<div class="sec-title"><span class="sec-num">3</span> ì¸í—ˆê°€ ì •ë³´</div>';
    lics.forEach(function(lic, i) {
      h += '<div class="sub-card"><div class="sub-card-hd"><div class="sub-card-title"><span class="sub-card-num">' + (i+1) + '</span> ì¸í—ˆê°€</div></div>';
      h += '<div style="display:grid;grid-template-columns:1fr 1fr;gap:8px 20px">';
      h += '<div class="fg"><label>ë¶„ì•¼</label><input value="' + (lic.licField || '') + '" readonly style="background:#f8f9fb"></div>';
      h += '<div class="fg"><label>ì˜ì—…ì˜ í˜•íƒœ</label><input value="' + (lic.licBizForm || '') + '" readonly style="background:#f8f9fb"></div>';
      h += '<div class="fg"><label>ëŒ€í‘œì</label><input value="' + (lic.licRepName || '') + '" readonly style="background:#f8f9fb"></div>';
      h += '<div class="fg"><label>ì¸í—ˆê°€ë²ˆí˜¸</label><input value="' + (lic.licNo || '') + '" readonly style="background:#f8f9fb"></div>';
      h += '<div class="fg"><label>ì˜ì—…ì†Œëª…ì¹­</label><input value="' + (lic.licBizName || '') + '" readonly style="background:#f8f9fb"></div>';
      h += '</div>';
      if (lic.licZipcode || lic.licAddr) {
        h += '<div class="fg"><label>ì†Œì¬ì§€</label><input value="' + (lic.licZipcode || '') + ' ' + (lic.licAddr || '') + ' ' + (lic.licAddr2 || '') + '" readonly style="background:#f8f9fb"></div>';
      }
      h += '</div>';
    });
  }

  h += '<div class="sec-title"><span class="sec-num">4</span> ë‹´ë‹¹ì ì •ë³´</div>';
  h += '<div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px 20px">';
  h += '<div class="fg"><label>ë‹´ë‹¹ìëª…</label><input value="' + (c.contactName || '') + '" readonly style="background:#f8f9fb"></div>';
  h += '<div class="fg"><label>ì „í™”ë²ˆí˜¸</label><input value="' + (c.contactPhone || '') + '" readonly style="background:#f8f9fb"></div>';
  h += '<div class="fg"><label>ì´ë©”ì¼</label><input value="' + (c.contactEmail || '') + '" readonly style="background:#f8f9fb"></div>';
  h += '</div>';
  h += '<div class="fg"><label>ìì‚¬ ë‹´ë‹¹</label><input value="' + (c.salesRep || '') + '" readonly style="background:#f8f9fb"></div>';

  h += '<div class="sec-title"><span class="sec-num">5</span> ì„¸ê¸ˆê³„ì‚°ì„œ ë‹´ë‹¹ì</div>';
  h += '<div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px 20px">';
  h += '<div class="fg"><label>ì´ë¦„</label><input value="' + (c.taxName || '') + '" readonly style="background:#f8f9fb"></div>';
  h += '<div class="fg"><label>ì „í™”ë²ˆí˜¸</label><input value="' + (c.taxPhone || '') + '" readonly style="background:#f8f9fb"></div>';
  h += '<div class="fg"><label>ì´ë©”ì¼</label><input value="' + (c.taxEmail || '') + '" readonly style="background:#f8f9fb"></div>';
  h += '</div>';

  h += '<div class="sec-title"><span class="sec-num">6</span> ë©”ëª¨</div>';
  h += '<div class="fg"><textarea readonly style="background:#f8f9fb">' + (c.memo || '') + '</textarea></div>';

  h += '<div style="font-size:11px;color:#8892a4;margin-top:16px;text-align:right">ë“±ë¡ì¼: ' + (c.regDate || '-') + ' | ID: ' + (c.id || '-') + '</div>';

  return h;
}

// ============================================================
// ìˆ˜ì • ëª¨ë“œ
// ============================================================
function toggleEdit() {
  if (!_currentId) return;
  var customers = getCustomers();
  var cust = customers.find(function(c) { return c.id === _currentId; });
  if (!cust) return;

  if (!_editMode) {
    // ìˆ˜ì • ëª¨ë“œ ì§„ì…: ë“±ë¡ í¼ì— ë°ì´í„° ì±„ìš°ê¸°
    _editMode = true;
    showPage('reg'); // í¼ ì´ˆê¸°í™”ë¨
    _currentId = cust.id; // showPageì—ì„œ ì´ˆê¸°í™”ë˜ë¯€ë¡œ ë‹¤ì‹œ ì„¤ì •
    _editMode = true;
    document.getElementById('topSub').textContent = cust.company + ' ìˆ˜ì •';
    document.getElementById('btnSave').textContent = 'ğŸ’¾ ìˆ˜ì • ì €ì¥';
    document.getElementById('btnSave').setAttribute('onclick', 'updateCompany()');
    fillRegForm(cust);
  }
}

function fillRegForm(c) {
  document.getElementById('regCompany').value = c.company || '';
  document.getElementById('regRepName').value = c.repName || '';
  document.getElementById('regBizNo').value = c.bizNo || '';
  document.getElementById('regCorpNo').value = c.corpNo || '';
  document.getElementById('regBizType').value = c.bizType || '';
  document.getElementById('regBizItem').value = c.bizItem || '';
  setSelectVal('regGrade', c.grade || 'B');
  setSelectVal('regStatus', c.status || 'í™œë™');
  setSelectVal('regDepartment', c.department || '');
  setSelectVal('regReceiptType', c.receiptType || '');
  document.getElementById('regZipcode').value = c.zipcode || '';
  document.getElementById('regAddr1').value = c.addr1 || '';
  document.getElementById('regAddr2').value = c.addr2 || '';
  document.getElementById('regCompanyNameEn').value = c.companyEn || '';
  document.getElementById('regRepNameEn').value = c.repNameEn || '';
  document.getElementById('regAddrEn').value = c.addrEn || '';
  document.getElementById('regCName').value = c.contactName || '';
  document.getElementById('regCPhone').value = c.contactPhone || '';
  document.getElementById('regCEmail').value = c.contactEmail || '';
  setSelectVal('regSalesRep', c.salesRep || 'ì´ì£¼ì„');
  document.getElementById('regTaxName').value = c.taxName || '';
  document.getElementById('regTaxPhone').value = c.taxPhone || '';
  document.getElementById('regTaxEmail').value = c.taxEmail || '';
  document.getElementById('regMemo').value = c.memo || '';

  // ì¸í—ˆê°€ ì •ë³´ ì²« ë²ˆì§¸ ì¹´ë“œ
  var lic = (c.licenses && c.licenses[0]) || c;
  setSelectVal('licField_1', lic.licField || 'ì„ íƒ');
  setSelectVal('licBizForm_1', lic.licBizForm || 'ì„ íƒ');
  document.getElementById('licRepName_1').value = lic.licRepName || '';
  document.getElementById('licNo_1').value = lic.licNo || '';
  document.getElementById('licBizName_1').value = lic.licBizName || '';
  document.getElementById('licZipcode_1').value = lic.licZipcode || '';
  document.getElementById('licAddr_1').value = lic.licAddr || '';
  document.getElementById('licAddr2_1').value = lic.licAddr2 || '';
  document.getElementById('licBizNameEn_1').value = lic.licBizNameEn || '';
  document.getElementById('licRepNameEn_1').value = lic.licRepNameEn || '';
  document.getElementById('licAddrEn_1').value = lic.licAddrEn || '';

  // ë²•ì¸ì—¬ë¶€
  if (c.corpType === 'ê°œì¸') {
    document.getElementById('regCorpIndiv').checked = true;
  } else {
    document.getElementById('regCorpYes').checked = true;
  }
}

function setSelectVal(id, val) {
  var sel = document.getElementById(id);
  if (!sel) return;
  for (var i = 0; i < sel.options.length; i++) {
    if (sel.options[i].value === val || sel.options[i].text === val) {
      sel.selectedIndex = i;
      return;
    }
  }
}

// ============================================================
// ì—…ì²´ ì €ì¥ (ì‹ ê·œ ë“±ë¡) â€” salesMgmt.htmlê³¼ ë™ì¼í•œ êµ¬ì¡°
// ============================================================
function saveCompany() {
  var cust = collectFormData();
  if (!cust) return;
  cust.id = 'C' + Date.now();
  cust.regDate = new Date().toISOString().slice(0, 10);
  cust.changeLog = [];

  var customers = getCustomers();
  customers.push(cust);
  localStorage.setItem('bfl_customers', JSON.stringify(customers));

  toast('âœ… ì—…ì²´ê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!');
  setTimeout(function() { showPage('list'); }, 1000);
}

// ============================================================
// ì—…ì²´ ìˆ˜ì •
// ============================================================
function updateCompany() {
  if (!_currentId) return;
  var updated = collectFormData();
  if (!updated) return;

  var customers = getCustomers();
  var idx = customers.findIndex(function(c) { return c.id === _currentId; });
  if (idx === -1) { toast('ì—…ì²´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤'); return; }

  // ê¸°ì¡´ ë°ì´í„° ìœ ì§€í•˜ë©´ì„œ ì—…ë°ì´íŠ¸
  updated.id = _currentId;
  updated.regDate = customers[idx].regDate || new Date().toISOString().slice(0, 10);
  updated.changeLog = customers[idx].changeLog || [];
  updated.changeLog.push({
    date: new Date().toISOString().slice(0, 10),
    action: 'ìˆ˜ì •',
    detail: 'ì—…ì²´ ì •ë³´ ìˆ˜ì •'
  });
  // ë“±ê¸‰ ê³„ì‚° ê´€ë ¨ ê¸°ì¡´ê°’ ìœ ì§€
  updated.annualRevenue = customers[idx].annualRevenue || 0;
  updated.monthlyFrequency = customers[idx].monthlyFrequency || 0;
  updated.tradeDuration = customers[idx].tradeDuration || 0;
  updated.trafficLight = customers[idx].trafficLight || 'blue';

  customers[idx] = updated;
  localStorage.setItem('bfl_customers', JSON.stringify(customers));

  toast('ğŸ’¾ ì—…ì²´ ì •ë³´ê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤!');
  _editMode = false;
  setTimeout(function() { openDetail(_currentId); }, 800);
}

// ============================================================
// í¼ ë°ì´í„° ìˆ˜ì§‘ (ë“±ë¡/ìˆ˜ì • ê³µí†µ)
// ============================================================
function collectFormData() {
  var company = (document.getElementById('regCompany').value || '').trim();
  var repName = (document.getElementById('regRepName').value || '').trim();
  var bizNo = (document.getElementById('regBizNo').value || '').trim();
  if (!company) { toast('âš ï¸ íšŒì‚¬ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”'); document.getElementById('regCompany').focus(); return null; }
  if (!repName) { toast('âš ï¸ ëŒ€í‘œìëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”'); document.getElementById('regRepName').focus(); return null; }
  if (!bizNo) { toast('âš ï¸ ì‚¬ì—…ìë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”'); document.getElementById('regBizNo').focus(); return null; }

  var gradeSel = document.getElementById('regGrade');
  var grade = gradeSel ? gradeSel.value : 'ë“±ê¸‰ ì„ íƒ';
  if (grade === 'ë“±ê¸‰ ì„ íƒ') grade = 'B';
  var statusSel = document.getElementById('regStatus');
  var status = statusSel ? statusSel.value : 'í™œë™';
  var salesRep = document.getElementById('regSalesRep');
  var salesRepVal = (salesRep && salesRep.value !== 'ì„ íƒ') ? salesRep.value : 'ì´ì£¼ì„';

  var cust = {
    company: company,
    repName: repName,
    bizNo: bizNo,
    corpNo: (document.getElementById('regCorpNo') || {}).value || '',
    bizType: (document.getElementById('regBizType') || {}).value || '',
    bizItem: (document.getElementById('regBizItem') || {}).value || '',
    grade: grade,
    status: status,
    zipcode: (document.getElementById('regZipcode') || {}).value || '',
    addr1: (document.getElementById('regAddr1') || {}).value || '',
    addr2: (document.getElementById('regAddr2') || {}).value || '',
    companyEn: (document.getElementById('regCompanyNameEn') || {}).value || '',
    repNameEn: (document.getElementById('regRepNameEn') || {}).value || '',
    addrEn: (document.getElementById('regAddrEn') || {}).value || '',
    contactName: (document.getElementById('regCName') || {}).value || '',
    contactPhone: (document.getElementById('regCPhone') || {}).value || '',
    contactEmail: (document.getElementById('regCEmail') || {}).value || '',
    salesRep: salesRepVal,
    department: (document.getElementById('regDepartment') || {}).value || '',
    receiptType: (document.getElementById('regReceiptType') || {}).value || '',
    annualRevenue: 0,
    monthlyFrequency: 0,
    tradeDuration: 0,
    // ì¸í—ˆê°€ ì •ë³´
    licenses: collectLicenses(),
    licField: (document.getElementById('licField_1') || {}).value || '',
    licBizForm: (document.getElementById('licBizForm_1') || {}).value || '',
    licRepName: (document.getElementById('licRepName_1') || {}).value || '',
    licNo: (document.getElementById('licNo_1') || {}).value || '',
    licBizName: (document.getElementById('licBizName_1') || {}).value || '',
    licZipcode: (document.getElementById('licZipcode_1') || {}).value || '',
    licAddr: (document.getElementById('licAddr_1') || {}).value || '',
    licAddr2: (document.getElementById('licAddr2_1') || {}).value || '',
    licBizNameEn: (document.getElementById('licBizNameEn_1') || {}).value || '',
    licRepNameEn: (document.getElementById('licRepNameEn_1') || {}).value || '',
    licAddrEn: (document.getElementById('licAddrEn_1') || {}).value || '',
    taxName: (document.getElementById('regTaxName') || {}).value || '',
    taxPhone: (document.getElementById('regTaxPhone') || {}).value || '',
    taxEmail: (document.getElementById('regTaxEmail') || {}).value || '',
    memo: (document.getElementById('regMemo') || {}).value || ''
  };
  return cust;
}

function collectLicenses() {
  var licArr = [];
  var indices = getLicenseCardIndices();
  for (var li = 0; li < indices.length; li++) {
    var ix = indices[li];
    var lic = {
      licField: (document.getElementById('licField_' + ix) || {}).value || '',
      licBizForm: (document.getElementById('licBizForm_' + ix) || {}).value || '',
      licRepName: (document.getElementById('licRepName_' + ix) || {}).value || '',
      licNo: (document.getElementById('licNo_' + ix) || {}).value || '',
      licBizName: (document.getElementById('licBizName_' + ix) || {}).value || '',
      licZipcode: (document.getElementById('licZipcode_' + ix) || {}).value || '',
      licAddr: (document.getElementById('licAddr_' + ix) || {}).value || '',
      licAddr2: (document.getElementById('licAddr2_' + ix) || {}).value || '',
      licBizNameEn: (document.getElementById('licBizNameEn_' + ix) || {}).value || '',
      licRepNameEn: (document.getElementById('licRepNameEn_' + ix) || {}).value || '',
      licAddrEn: (document.getElementById('licAddrEn_' + ix) || {}).value || ''
    };
    var hasData = lic.licField !== 'ì„ íƒ' || lic.licBizForm !== 'ì„ íƒ' || lic.licRepName || lic.licNo || lic.licBizName;
    if (hasData) licArr.push(lic);
  }
  return licArr;
}

// ============================================================
// ì‚­ì œ
// ============================================================
function deleteCompany() {
  if (!_currentId) return;
  if (!confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) return;
  var customers = getCustomers();
  customers = customers.filter(function(c) { return c.id !== _currentId; });
  localStorage.setItem('bfl_customers', JSON.stringify(customers));
  toast('ğŸ—‘ï¸ ì—…ì²´ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤');
  _currentId = null;
  setTimeout(function() { showPage('list'); }, 800);
}

// ============================================================
// í¼ ì´ˆê¸°í™”
// ============================================================
function resetRegForm() {
  var inputs = document.querySelectorAll('#page-reg input:not([type=radio]):not([type=file]), #page-reg textarea');
  inputs.forEach(function(el) { el.value = ''; });
  var selects = document.querySelectorAll('#page-reg select');
  selects.forEach(function(el) { el.selectedIndex = 0; });
  document.getElementById('regCorpYes').checked = true;
  var chk = document.getElementById('compChk'); if(chk) chk.style.display = 'none';
  var bchk = document.getElementById('bizChk'); if(bchk) bchk.style.display = 'none';
  var cchk = document.getElementById('cntChk'); if(cchk) cchk.style.display = 'none';
  // ë“±ë¡ ë²„íŠ¼ ë³µì›
  document.getElementById('btnSave').textContent = 'âœ… ì—…ì²´ ë“±ë¡';
  document.getElementById('btnSave').setAttribute('onclick', 'saveCompany()');
}

// ============================================================
// ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤ (salesMgmt.htmlê³¼ ë™ì¼)
// ============================================================
function fmtBiz(el) {
  var v = el.value.replace(/[^0-9]/g, '');
  if (v.length > 10) v = v.slice(0, 10);
  if (v.length > 5) v = v.slice(0, 3) + '-' + v.slice(3, 5) + '-' + v.slice(5);
  else if (v.length > 3) v = v.slice(0, 3) + '-' + v.slice(3);
  el.value = v;
}

function fmtPhone(el) {
  var v = el.value.replace(/[^0-9]/g, '');
  if (v.length > 11) v = v.slice(0, 11);
  if (v.length > 7) v = v.slice(0, 3) + '-' + v.slice(3, 7) + '-' + v.slice(7);
  else if (v.length > 3) v = v.slice(0, 3) + '-' + v.slice(3);
  el.value = v;
}

function openPostcodeSearch() {
  new daum.Postcode({
    oncomplete: function(data) {
      document.getElementById('regZipcode').value = data.zonecode;
      document.getElementById('regAddr1').value = data.roadAddress || data.jibunAddress;
      document.getElementById('regAddr2').value = '';
      document.getElementById('regAddr2').focus();
    }
  }).open();
}

function openLicPostcodeSearch(idx) {
  new daum.Postcode({
    oncomplete: function(data) {
      document.getElementById('licZipcode_' + idx).value = data.zonecode;
      document.getElementById('licAddr_' + idx).value = data.roadAddress || data.jibunAddress;
      document.getElementById('licAddr2_' + idx).value = '';
      document.getElementById('licAddr2_' + idx).focus();
    }
  }).open();
}

function toggleEngSection(sectionId) {
  var sec = document.getElementById(sectionId);
  if (!sec) return;
  var isHidden = sec.style.display === 'none';
  sec.style.display = isHidden ? 'block' : 'none';
  var arrow = sec.previousElementSibling.querySelector('span');
  if (arrow) arrow.style.transform = isHidden ? 'rotate(90deg)' : '';
}

function copyContactToTax() {
  var n = (document.getElementById('regCName') || {}).value || '';
  var p = (document.getElementById('regCPhone') || {}).value || '';
  var e = (document.getElementById('regCEmail') || {}).value || '';
  if (!n && !p && !e) { toast('âš ï¸ ë¨¼ì € 4ë²ˆ ë‹´ë‹¹ìë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”'); return; }
  document.getElementById('regTaxName').value = n;
  document.getElementById('regTaxPhone').value = p;
  document.getElementById('regTaxEmail').value = e;
  toast('ğŸ“‹ 1ë²ˆ ë‹´ë‹¹ì ì •ë³´ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤');
}

// ì¤‘ë³µ í™•ì¸ (ë°ëª¨)
function checkCompanyDup() {
  var name = (document.getElementById('regCompany').value || '').trim();
  if (!name) { toast('âš ï¸ íšŒì‚¬ëª…ì„ ì…ë ¥í•˜ì„¸ìš”'); return; }
  var customers = getCustomers();
  var dup = customers.find(function(c) { return c.company === name && c.id !== _currentId; });
  var el = document.getElementById('compChk');
  el.style.display = 'block';
  if (dup) { el.className = 'check-result check-dup'; el.textContent = 'âš ï¸ ì¤‘ë³µ ì—…ì²´ ì¡´ì¬: ' + dup.company; el.style.background = '#fff3e0'; el.style.color = '#e65100'; }
  else { el.className = 'check-result check-ok'; el.textContent = 'âœ… ì¤‘ë³µ ì—†ìŒ â€” ë“±ë¡ ê°€ëŠ¥'; }
}

function checkBizNoDup() {
  var bizNo = (document.getElementById('regBizNo').value || '').trim();
  if (!bizNo) { toast('âš ï¸ ì‚¬ì—…ìë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”'); return; }
  var customers = getCustomers();
  var dup = customers.find(function(c) { return c.bizNo === bizNo && c.id !== _currentId; });
  var el = document.getElementById('bizChk');
  el.style.display = 'block';
  if (dup) { el.className = 'check-result'; el.textContent = 'âš ï¸ ì¤‘ë³µ: ' + dup.company; el.style.background = '#fff3e0'; el.style.color = '#e65100'; }
  else { el.className = 'check-result check-ok'; el.textContent = 'âœ… ì¤‘ë³µ ì—†ìŒ'; }
}

function checkContactDup() {
  var name = (document.getElementById('regCName').value || '').trim();
  if (!name) { toast('âš ï¸ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”'); return; }
  var el = document.getElementById('cntChk');
  el.style.display = 'inline-block';
  el.className = 'check-result check-ok';
  el.textContent = 'âœ… ì¤‘ë³µ ì—†ìŒ';
}

// ============================================================
// ì¸í—ˆê°€ ì¹´ë“œ ì¶”ê°€/ì‚­ì œ
// ============================================================
function addLicenseCard() {
  _licenseCardCount++;
  var idx = _licenseCardCount;
  var area = document.getElementById('licenseArea');
  if (!area) return;

  var card = document.createElement('div');
  card.className = 'sub-card';
  card.id = 'licCard_' + idx;
  card.innerHTML =
    '<div class="sub-card-hd">' +
      '<div class="sub-card-title"><span class="sub-card-num">' + idx + '</span> ì¸í—ˆê°€</div>' +
      '<button type="button" class="btn btn-secondary btn-sm" onclick="removeLicenseCard(' + idx + ')" style="margin-left:auto;font-size:11px;padding:3px 10px;color:#c62828;border-color:#ef9a9a">ì‚­ì œ</button>' +
    '</div>' +
    '<div class="fg-row">' +
      '<div class="fg"><label>ë¶„ì•¼</label><select id="licField_' + idx + '"><option>ì„ íƒ</option><option>ì‹í’ˆ</option><option>ì¶•ì‚°</option></select></div>' +
      '<div class="fg"><label>ì˜ì—…ì˜ í˜•íƒœ</label><div class="combo"><select id="licBizForm_' + idx + '"><option>ì„ íƒ</option><option>ì‹í’ˆì œì¡°ê°€ê³µì—…</option><option>ì¦‰ì„íŒë§¤ì œì¡°ê°€ê³µì—…</option><option>ì‹í’ˆì†Œë¶„ì—…</option><option>ìœ í†µì „ë¬¸íŒë§¤ì—…</option><option>ì¶•ì‚°ë¬¼ê°€ê³µì—…</option><option>ì‹ìœ¡í¬ì¥ì²˜ë¦¬ì—…</option><option value="etc">ì§ì ‘ ì…ë ¥</option></select></div></div>' +
    '</div>' +
    '<div class="fg-row">' +
      '<div class="fg"><label>ëŒ€í‘œì</label><input id="licRepName_' + idx + '" placeholder="ì¸í—ˆê°€ ëŒ€í‘œì"></div>' +
      '<div class="fg"><label>ì¸í—ˆê°€ë²ˆí˜¸</label><input id="licNo_' + idx + '" placeholder="ì¸í—ˆê°€ë²ˆí˜¸"></div>' +
    '</div>' +
    '<div class="fg-row">' +
      '<div class="fg"><label>ì˜ì—…ì†Œëª…ì¹­</label><input id="licBizName_' + idx + '" placeholder="ì˜ì—…ì†Œ ëª…ì¹­"></div>' +
    '</div>' +
    '<div class="fg"><label>ì†Œì¬ì§€</label>' +
      '<div class="addr-row"><input id="licZipcode_' + idx + '" placeholder="ìš°í¸ë²ˆí˜¸" style="max-width:120px" readonly><button class="btn btn-secondary btn-sm" onclick="openLicPostcodeSearch(' + idx + ')">ìš°í¸ë²ˆí˜¸ ì°¾ê¸°</button></div>' +
    '</div>' +
    '<div class="fg"><input id="licAddr_' + idx + '" placeholder="ê¸°ë³¸ì£¼ì†Œ (ìë™ì…ë ¥)" readonly></div>' +
    '<div class="fg"><input id="licAddr2_' + idx + '" placeholder="ìƒì„¸ì£¼ì†Œ ì…ë ¥"></div>';

  area.appendChild(card);
  card.scrollIntoView({ behavior: 'smooth', block: 'center' });
  toast('âœ… ì¸í—ˆê°€ ' + idx + ' ì¹´ë“œê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤');
}

function removeLicenseCard(idx) {
  var card = document.getElementById('licCard_' + idx);
  if (card) card.remove();
  toast('ì¸í—ˆê°€ ì¹´ë“œê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤');
}

function getLicenseCardIndices() {
  var indices = [];
  for (var i = 1; i <= _licenseCardCount; i++) {
    if (document.getElementById('licCard_' + i)) indices.push(i);
  }
  return indices;
}

// ============================================================
// OCR (ì‚¬ì—…ìë“±ë¡ì¦) - ë°ëª¨
// ============================================================
function handleBizLicFile(file) {
  if (!file) return;
  _bizLicFile = file;
  document.getElementById('bizLicFileName').textContent = 'ğŸ“ ' + file.name;
  document.getElementById('bizLicOcrBtn').disabled = false;
  // ë¯¸ë¦¬ë³´ê¸°
  if (file.type.startsWith('image/')) {
    var reader = new FileReader();
    reader.onload = function(e) {
      document.getElementById('bizLicPreviewImg').src = e.target.result;
      document.getElementById('bizLicPreview').style.display = 'block';
    };
    reader.readAsDataURL(file);
  }
}

function runBizLicOCR() {
  toast('âš ï¸ OCR ì„œë²„ ë¯¸ì—°ê²° ìƒíƒœ (ë°ëª¨)');
}

// ============================================================
// ì´ˆê¸°í™”
// ============================================================
document.addEventListener('DOMContentLoaded', function() {
  loadList();
});
</script>
</body>
</html>
