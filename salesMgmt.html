<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BioFoodLab - ì˜ì—… ê´€ë¦¬</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Pretendard',-apple-system,BlinkMacSystemFont,sans-serif;height:100vh;background:#f8f9fb;font-size:13px;overflow:hidden;display:flex}

/* ====== UNIFIED SIDEBAR STYLES ====== */
.sidebar{width:250px;background:#1a2332;color:white;position:fixed;left:0;top:0;bottom:0;z-index:1000;overflow-y:auto;overflow-x:hidden;display:flex;flex-direction:column;font-family:'Pretendard',-apple-system,BlinkMacSystemFont,"Segoe UI","Noto Sans KR",sans-serif}
.logo{padding:20px;display:flex;align-items:center;gap:12px;border-bottom:1px solid rgba(255,255,255,0.08);flex-shrink:0}
.logo-icon{width:40px;height:40px;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:20px}
.logo-text{display:flex;flex-direction:column}
.logo-title{font-size:18px;font-weight:700;color:white}
.logo-subtitle{font-size:11px;color:#94a3b8}
.sidebar-nav{flex:1;padding:8px 0;overflow-y:auto}
.nav-group{margin-bottom:2px}
.nav-parent{padding:10px 20px;display:flex;align-items:center;gap:10px;color:#8ea4c0;font-size:13px;font-weight:500;cursor:pointer;text-decoration:none;transition:all 0.15s;border:none;background:none;width:100%}
.nav-parent:hover{background:rgba(255,255,255,0.05);color:#c8d6e5}
.nav-parent.active{color:#4fc3f7;background:rgba(79,195,247,0.1);font-weight:600}
.nav-parent.disabled{color:#4a6785;cursor:default}
.nav-parent.disabled:hover{background:transparent;color:#4a6785}
.nav-icon{font-size:16px;width:22px;text-align:center;flex-shrink:0}
.nav-label{flex:1;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.nav-arrow{font-size:10px;color:#5a6a7e;transition:transform 0.2s;margin-left:auto}
.nav-group.expanded .nav-arrow{transform:rotate(180deg)}
.nav-submenu{list-style:none;max-height:0;overflow:hidden;transition:max-height 0.25s ease;margin-left:32px;border-left:2px solid rgba(79,195,247,0.15);padding-left:10px}
.nav-group.expanded .nav-submenu{max-height:500px}
.nav-sub-item{display:block;padding:7px 12px;font-size:12px;color:#6b7d93;text-decoration:none;border-radius:6px;cursor:pointer;transition:all 0.15s;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.nav-sub-item:hover{color:#8ea4c0;background:rgba(255,255,255,0.03)}
.nav-sub-item.active{color:#4fc3f7;font-weight:600;background:rgba(79,195,247,0.08)}
.nav-sub-item.disabled{color:#3d5068;cursor:default}
.nav-sub-item.disabled:hover{background:transparent;color:#3d5068}
/* ====== END UNIFIED SIDEBAR STYLES ====== */


/* Main */
.main{flex:1;display:flex;flex-direction:column;overflow:hidden;margin-left:250px;height:100vh}
.topbar{background:#fff;border-bottom:1px solid #e2e6ed;padding:0 24px;height:52px;display:flex;align-items:center;gap:10px;flex-shrink:0}
.topbar-title{font-size:15px;font-weight:700;color:#1a2332}
.topbar-sep{color:#c8d6e5}
.topbar-sub{font-size:13px;color:#5f6b7a}
.topbar-right{margin-left:auto;display:flex;align-items:center;gap:12px}
.topbar-bell{position:relative;cursor:pointer;font-size:18px}
.topbar-bell .dot{position:absolute;top:-2px;right:-4px;width:8px;height:8px;background:#e53935;border-radius:50%}

.content{flex:1;padding:24px;overflow-y:auto}

/* Buttons */
.btn{padding:8px 16px;border-radius:8px;font-size:12px;font-weight:600;cursor:pointer;border:none;transition:all .15s;display:inline-flex;align-items:center;gap:6px}
.btn-primary{background:#1a73e8;color:#fff}.btn-primary:hover{background:#1557b0}
.btn-secondary{background:#fff;color:#5f6b7a;border:1px solid #e2e6ed}.btn-secondary:hover{background:#f0f2f5}
.btn-success{background:#2e7d32;color:#fff}.btn-success:hover{background:#1b5e20}
.btn-danger{background:#e53935;color:#fff}.btn-danger:hover{background:#c62828}
.btn-sm{padding:6px 12px;font-size:11px}
.btn-check{background:#e3f2fd;color:#1565c0;border:1px solid #bbdefb}.btn-check:hover{background:#bbdefb}

/* Cards */
.card{background:#fff;border-radius:12px;border:1px solid #e2e6ed;margin-bottom:16px}
.card-hd{padding:16px 20px;border-bottom:1px solid #eef0f4;display:flex;align-items:center;gap:10px}
.card-hd h3{font-size:15px;font-weight:700;color:#1a2332}
.card-hd .right{margin-left:auto;display:flex;gap:8px}
.card-bd{padding:20px}

/* Tables */
.tbl{width:100%;border-collapse:collapse}
.tbl th{background:#f8f9fb;padding:10px 14px;font-size:11px;font-weight:700;color:#5f6b7a;text-align:left;border-bottom:2px solid #e2e6ed;white-space:nowrap}
.tbl td{padding:10px 14px;border-bottom:1px solid #eef0f4;font-size:12px;color:#333}
.tbl tr:hover{background:#fafbfc}
.tbl .center{text-align:center}

/* Traffic dots */
.tl{display:inline-block;width:12px;height:12px;border-radius:50%;vertical-align:middle}
.tl-blue{background:#2196f3}.tl-green{background:#4caf50}.tl-yellow{background:#ffeb3b}.tl-orange{background:#ff9800}.tl-red{background:#f44336}

/* Tags */
.tag{display:inline-block;padding:2px 8px;border-radius:4px;font-size:10px;font-weight:600}
.tag-vip{background:#fce4ec;color:#c62828}.tag-a{background:#e3f2fd;color:#1565c0}.tag-b{background:#e8f5e9;color:#2e7d32}.tag-c{background:#f3e5f5;color:#7b1fa2}
.tag-active{background:#e8f5e9;color:#2e7d32}.tag-dormant{background:#fff3e0;color:#e65100}.tag-terminated{background:#f5f5f5;color:#9e9e9e}
.tag-pending{background:#fff3e0;color:#e65100}.tag-approved{background:#e8f5e9;color:#2e7d32}.tag-rejected{background:#fce4ec;color:#c62828}

/* Form */
.fg{display:flex;flex-direction:column;gap:4px;margin-bottom:12px}
.fg label{font-size:11px;color:#5f6b7a;font-weight:600}
.fg label .req{color:#e53935}
.fg input,.fg select,.fg textarea{padding:9px 12px;border:1px solid #e2e6ed;border-radius:8px;font-size:13px;outline:none;font-family:inherit;transition:border .15s}
.fg input:focus,.fg select:focus,.fg textarea:focus{border-color:#4fc3f7;box-shadow:0 0 0 3px rgba(79,195,247,.1)}
.fg textarea{resize:vertical;min-height:60px}
.fg select{cursor:pointer;background:#fff}
.fg-row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.fg-row3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px}

.sub-card{background:#f8f9fb;border:1px solid #eef0f4;border-radius:10px;padding:14px;margin-bottom:10px;position:relative}
.sub-card-hd{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
.sub-card-title{font-size:12px;font-weight:700;display:flex;align-items:center;gap:6px}
.sub-card-num{background:#e3f2fd;color:#1565c0;width:20px;height:20px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:10px;font-weight:700}
.btn-remove{background:none;border:none;color:#e53935;font-size:18px;cursor:pointer;padding:2px 6px;border-radius:4px}
.btn-remove:hover{background:#fce4ec}
.btn-add{display:flex;align-items:center;gap:6px;padding:10px;border:2px dashed #c8d6e5;border-radius:10px;background:transparent;color:#5f6b7a;font-size:12px;font-weight:600;cursor:pointer;width:100%;justify-content:center}
.btn-add:hover{border-color:#1a73e8;color:#1a73e8;background:#f0f7ff}
.combo{display:flex;gap:6px}.combo select,.combo input{flex:1}
.hint{font-size:10px;color:#8892a4;margin-top:2px}
.check-result{margin-top:4px;font-size:11px;padding:6px 10px;border-radius:6px;display:none}
.check-ok{background:#e8f5e9;color:#2e7d32}.check-dup{background:#fff3e0;color:#e65100}

/* Section title */
.sec-title{font-size:14px;font-weight:700;color:#1a2332;margin:20px 0 12px;padding-bottom:8px;border-bottom:1px solid #eef0f4;display:flex;align-items:center;gap:8px}
.sec-num{background:#1a73e8;color:#fff;width:22px;height:22px;border-radius:6px;display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:700;flex-shrink:0}

/* Timeline */
.timeline{position:relative;padding-left:24px}
.timeline::before{content:'';position:absolute;left:8px;top:0;bottom:0;width:2px;background:#e2e6ed}
.tl-item{position:relative;margin-bottom:16px;padding:14px;background:#fff;border:1px solid #e2e6ed;border-radius:10px}
.tl-item::before{content:'';position:absolute;left:-20px;top:18px;width:10px;height:10px;border-radius:50%;background:#1a73e8;border:2px solid #fff;box-shadow:0 0 0 2px #1a73e8}
.tl-item.sys::before{background:#ff9800}
.tl-date{font-size:10px;color:#8892a4;margin-bottom:4px}
.tl-content{font-size:12px;color:#333}
.tl-tags{display:flex;gap:4px;margin-top:6px;flex-wrap:wrap}
.tl-tag{padding:2px 8px;border-radius:4px;font-size:10px;font-weight:600}
.tl-tag-call{background:#e3f2fd;color:#1565c0}.tl-tag-sms{background:#f3e5f5;color:#7b1fa2}
.tl-tag-connected{background:#e8f5e9;color:#2e7d32}.tl-tag-missed{background:#fce4ec;color:#c62828}
.tl-tag-refused{background:#fff3e0;color:#e65100}

/* Route viz */
.route{display:flex;align-items:center;gap:6px;flex-wrap:wrap;padding:12px;background:#f8f9fb;border-radius:10px;margin:8px 0}
.route-stop{padding:6px 12px;background:#fff;border:1px solid #e2e6ed;border-radius:8px;font-size:11px;font-weight:600;text-align:center}
.route-stop.home{background:#1a2332;color:#fff;border-color:#1a2332}
.route-arrow{color:#1a73e8;font-weight:700;font-size:14px}

/* Overlay */
.overlay{display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.4);z-index:100;justify-content:center;align-items:center}
.overlay.show{display:flex}
.popup{background:#fff;border-radius:14px;padding:24px;max-width:500px;width:90%;box-shadow:0 10px 40px rgba(0,0,0,.15)}
.popup h3{font-size:16px;margin-bottom:12px;display:flex;align-items:center;gap:8px}
.popup-actions{display:flex;gap:8px;margin-top:16px;flex-wrap:wrap}

/* Login popup */
.login-popup{max-width:440px}
.login-popup .alert{background:#fff3e0;border:1px solid #ffcc80;border-radius:10px;padding:14px;margin:12px 0;font-size:12px;color:#e65100}
.login-miss{font-size:28px;font-weight:800;color:#e53935;text-align:center;margin:8px 0}

/* Stats */
.stats{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-bottom:16px}
.stat{background:#fff;border:1px solid #e2e6ed;border-radius:10px;padding:14px;text-align:center}
.stat-val{font-size:22px;font-weight:800;color:#1a2332}
.stat-label{font-size:10px;color:#8892a4;margin-top:2px}

/* Approval flow */
.approval-flow{display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin:12px 0}
.af-step{padding:8px 14px;border-radius:8px;font-size:12px;font-weight:600;text-align:center;min-width:80px}
.af-arr{font-size:16px;color:#8892a4}

/* Toast */
.toast{display:none;position:fixed;bottom:30px;left:50%;transform:translateX(-50%);background:#1a2332;color:#fff;padding:14px 28px;border-radius:10px;font-size:14px;font-weight:600;box-shadow:0 4px 20px rgba(0,0,0,.2);z-index:200}
.toast.show{display:block;animation:fadeUp .3s ease}
@keyframes fadeUp{from{opacity:0;transform:translateX(-50%) translateY(10px)}to{opacity:1;transform:translateX(-50%) translateY(0)}}

/* View toggle */
.view-mode{display:flex;gap:4px;margin-bottom:12px}
.vm-btn{padding:6px 14px;border:1px solid #e2e6ed;border-radius:6px;font-size:11px;font-weight:600;cursor:pointer;background:#fff;color:#5f6b7a}
.vm-btn.active{background:#1a73e8;color:#fff;border-color:#1a73e8}

/* File upload area */
.file-area{border:2px dashed #e2e6ed;border-radius:10px;padding:16px;text-align:center;color:#8892a4;font-size:12px;cursor:pointer}
.file-area:hover{border-color:#1a73e8;color:#1a73e8;background:#f0f7ff}

/* Address row */
.addr-row{display:flex;gap:8px}.addr-row input{flex:1}

.radio-group{display:flex;gap:12px;padding:6px 0}
.radio-item{display:flex;align-items:center;gap:6px;cursor:pointer;font-size:13px}
.radio-item input{accent-color:#1a73e8;width:16px;height:16px}

/* Responsive */
@media(max-width:768px){.sb{display:none}.stats{grid-template-columns:1fr 1fr}.fg-row,.fg-row3{grid-template-columns:1fr}}
#koreaMap,#sgMap{cursor:pointer}
.sg-btn{padding:10px 16px;background:#f8f9fb;border:1px solid #e2e6ed;border-radius:8px;font-size:13px;font-weight:600;color:#1a2332;cursor:pointer;transition:all .15s;min-width:80px;text-align:center}
.sg-btn:hover{background:#e3f2fd;border-color:#90caf9;color:#1565c0}
.dong-btn{padding:8px 12px;background:#f8f9fb;border:1px solid #e2e6ed;border-radius:6px;font-size:12px;color:#5f6b7a;cursor:pointer;transition:all .15s}
.dong-btn:hover{background:#e8f5e9;border-color:#81c784;color:#2e7d32}
/* API ìˆ˜ì§‘ ì„¤ì • */
.api-item{padding:14px 16px;border:1px solid #eef0f4;border-radius:10px;margin-bottom:10px;transition:all .15s;background:#fafbfc}
.api-item:hover{border-color:#c8d6e5;background:#fff}
.api-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:6px}
.api-check{display:flex;align-items:center;gap:8px;cursor:pointer;font-size:13px;color:#1a2332}
.api-check input[type="checkbox"]{width:18px;height:18px;accent-color:#1a73e8;cursor:pointer}
.api-check strong{color:#1a73e8;font-family:monospace;font-size:12px;background:#e8f0fe;padding:2px 6px;border-radius:4px}
.api-count{font-size:11px;color:#8892a4;font-weight:600;background:#f0f2f5;padding:3px 8px;border-radius:4px}
.api-fields{display:flex;flex-wrap:wrap;gap:4px;margin-top:4px}
.api-tag{font-size:10px;padding:2px 7px;background:#e8f5e9;color:#2e7d32;border-radius:3px;font-family:monospace;cursor:default;border:1px solid #c8e6c9}
.api-tag:hover{background:#c8e6c9}
.api-item:has(input:not(:checked)){opacity:.5;background:#f5f5f5}
.api-item:has(input:not(:checked)) .api-tag{background:#f0f0f0;color:#aaa;border-color:#e0e0e0}
.collect-row{display:flex;align-items:center;gap:12px;padding:8px 12px;border-bottom:1px solid #f0f2f5;font-size:12px}
.collect-row:last-child{border-bottom:none}
.collect-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0}
.collect-dot.ok{background:#4caf50}
.collect-dot.err{background:#f44336}
.collect-dot.run{background:#ff9800;animation:pulse 1s infinite}
.sido-label{background:rgba(255,255,255,.88)!important;border:none!important;box-shadow:0 1px 4px rgba(0,0,0,.18)!important;font-size:12px!important;font-weight:700!important;color:#1a2332!important;padding:3px 8px!important;border-radius:4px!important}
.sido-label::before{display:none!important}
.sg-label{background:rgba(255,255,255,.82)!important;border:none!important;box-shadow:0 1px 3px rgba(0,0,0,.12)!important;font-size:10px!important;font-weight:600!important;color:#37474f!important;padding:2px 6px!important;border-radius:3px!important}
.sg-label::before{display:none!important}
.leaflet-container{font-family:inherit!important}
</style>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=1d5b2febea0c84335256f6a15d9e7c05&libraries=services"></script>
</head>
<body>

<!-- Company Dup Popup -->
<div class="overlay" id="companyDup">
<div class="popup">
  <h3>ğŸ” ë™ì¼ ê³ ê°ì‚¬ê°€ ì´ë¯¸ ë“±ë¡ë˜ì–´ ìˆìŠµë‹ˆë‹¤</h3>
  <div style="background:#f8f9fb;border:1px solid #e2e6ed;border-radius:10px;padding:14px;margin:8px 0">
    <div style="display:flex;align-items:center;gap:8px;margin-bottom:8px">
      <span class="tl tl-orange"></span>
      <strong style="font-size:14px">í’€ë¬´ì›ì‹í’ˆ(ì£¼)</strong>
      <span class="tag tag-a">Aë“±ê¸‰</span>
    </div>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:4px;font-size:12px;color:#5f6b7a">
      <div>ì‚¬ì—…ìë²ˆí˜¸: 234-56-78901</div>
      <div>ëŒ€í‘œì: ì›í’€ë¬´</div>
      <div>ë‹´ë‹¹ ì˜ì—…: <strong>ë°•ì£¼ì„</strong></div>
      <div>ìµœê·¼ê±°ë˜: 2026-01-28</div>
    </div>
  </div>
  <div style="background:#fff3e0;border:1px solid #ffcc80;border-radius:8px;padding:10px;font-size:12px;color:#e65100">
    âš ï¸ ì´ë¯¸ <strong>ë°•ì£¼ì„</strong>ì´ ë‹´ë‹¹ ì¤‘ì…ë‹ˆë‹¤. ë‹´ë‹¹ìë¥¼ ì¶”ê°€í•˜ë©´ ë°•ì£¼ì„ì—ê²Œ ì•Œë¦¼ì´ ë°œì†¡ë©ë‹ˆë‹¤.
  </div>
  <div class="popup-actions">
    <button class="btn btn-secondary" onclick="closePopup('companyDup')">ì·¨ì†Œ</button>
    <button class="btn btn-primary" onclick="closePopup('companyDup');toast('ğŸ“© ë°•ì£¼ì„ì—ê²Œ ì•Œë¦¼ ë°œì†¡ ì™„ë£Œ. ë‹´ë‹¹ìë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.')">ê¸°ì¡´ ì—…ì²´ì— ë‹´ë‹¹ì ì¶”ê°€</button>
  </div>
</div>
</div>

<!-- Contact Dup Popup -->
<div class="overlay" id="contactDup">
<div class="popup">
  <h3>ğŸ” ë™ì¼ ë‹´ë‹¹ìê°€ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤</h3>
  <p style="font-size:12px;color:#5f6b7a;margin-bottom:10px">ì´ë¦„ê³¼ ì „í™”ë²ˆí˜¸ë¡œ ì¡°íšŒí•œ ê²°ê³¼ì…ë‹ˆë‹¤.</p>
  <div style="background:#f8f9fb;border:1px solid #e2e6ed;border-radius:10px;padding:14px">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
      <strong>ê¸°ì¡´ ë“±ë¡ ì •ë³´</strong>
      <span style="background:#fff3e0;color:#e65100;padding:2px 8px;border-radius:4px;font-size:10px;font-weight:600">ë‹´ë‹¹: ë°•ì£¼ì„</span>
    </div>
    <div style="font-size:12px;color:#333;line-height:1.8">
      ì´ë¦„: <strong>ì´ê·œì„±</strong><br>
      ì „í™”: <strong style="letter-spacing:1px">010-****-5678</strong><br>
      ì´ë©”ì¼: <strong style="letter-spacing:1px">lee***@pulmu.com</strong><br>
      ì†Œì†: í’€ë¬´ì›ì‹í’ˆ(ì£¼)
    </div>
  </div>
  <p style="font-size:12px;color:#5f6b7a;margin:10px 0">ì´ ì‚¬ëŒê³¼ <strong>ë™ì¼ ì¸ë¬¼</strong>ì…ë‹ˆê¹Œ?</p>
  <div class="popup-actions">
    <button class="btn btn-secondary" onclick="closePopup('contactDup')">ì·¨ì†Œ</button>
    <button class="btn btn-success" onclick="closePopup('contactDup');toast('âœ… ì‹ ê·œ ë‹´ë‹¹ìë¡œ ë“±ë¡í•©ë‹ˆë‹¤.')">ì•„ë‹ˆì˜¤, ì‹ ê·œ ë“±ë¡</button>
    <button class="btn btn-primary" onclick="closePopup('contactDup');toast('ğŸ“© ê¸°ì¡´ ë‹´ë‹¹ ë°•ì£¼ì„ì—ê²Œ ì•Œë¦¼ ë°œì†¡ ì™„ë£Œ')">ì˜ˆ, ë™ì¼ ì¸ë¬¼</button>
  </div>
</div>
</div>

<!-- Unified Sidebar -->
<aside class="sidebar" id="sidebar"></aside>
<script src="js/sidebar.js"></script>

<!-- Main -->
<div class="main">
  <div class="topbar">
    <span class="topbar-title">ì˜ì—… ê´€ë¦¬</span>
    <span class="topbar-sep">/</span>
    <span class="topbar-sub" id="topSub">ê³ ê°ì‚¬ ê´€ë¦¬</span>
    <div class="topbar-right">
      <div class="topbar-bell" onclick="toast('ğŸ”” ì•Œë¦¼ 3ê±´: ì…ê¸ˆ ì•½ì†ì¼ ë„ë˜ 1ê±´, ì‹ í˜¸ë“± ë³€ê²½ 1ê±´, ë¯¸ì‘ì„± ê²½ê³  1ê±´')">ğŸ””<span class="dot"></span></div>
    </div>
  </div>
  <div class="content" id="contentArea">

    <!-- ===== ê³ ê°ì‚¬ ê´€ë¦¬ - ëª©ë¡ ===== -->
    <div class="page" id="page-customerList">
      <div class="stats">
        <div class="stat"><div class="stat-val">47</div><div class="stat-label">ì „ì²´ ê±°ë˜ì²˜</div></div>
        <div class="stat"><div class="stat-val" style="color:#2e7d32">38</div><div class="stat-label">í™œë™ ì¤‘</div></div>
        <div class="stat"><div class="stat-val" style="color:#e65100">6</div><div class="stat-label">ë¯¸ìˆ˜ê¸ˆ ì—…ì²´</div></div>
        <div class="stat"><div class="stat-val" style="color:#e53935">2</div><div class="stat-label">ìœ„í—˜ (ì£¼í™©+ë¹¨ê°•)</div></div>
      </div>
      <div class="card">
        <div class="card-hd">
          <h3>ê³ ê°ì‚¬ ëª©ë¡</h3>
          <div class="right">
            <input type="text" placeholder="ğŸ” íšŒì‚¬ëª…, ì‚¬ì—…ìë²ˆí˜¸ ê²€ìƒ‰..." style="padding:7px 12px;border:1px solid #e2e6ed;border-radius:8px;font-size:12px;width:220px">
            <button class="btn btn-primary" onclick="showPage('customerReg')">+ ì‹ ê·œ ë“±ë¡</button>
          </div>
        </div>
        <div class="card-bd" style="padding:0;overflow-x:auto">
          <table class="tbl">
            <thead><tr><th>ì‹ í˜¸ë“±</th><th>ë“±ê¸‰</th><th>íšŒì‚¬ëª…</th><th>ëŒ€í‘œì</th><th>ì‚¬ì—…ìë²ˆí˜¸</th><th>ë‹´ë‹¹ì</th><th>ì˜ì—…ë‹´ë‹¹</th><th>ê³„ì•½ìƒíƒœ</th><th>ìµœê·¼ê±°ë˜</th></tr></thead>
            <tbody>
              <tr><td class="center"><span class="tl tl-blue"></span></td><td><span class="tag tag-vip">VIP</span></td><td><strong>CJì œì¼ì œë‹¹(ì£¼)</strong></td><td>ê¹€CJ</td><td>123-45-67890</td><td>ê¹€ë¶€ì¥</td><td>ì´ì£¼ì„</td><td><span class="tag tag-active">í™œë™</span></td><td>2026-02-10</td></tr>
              <tr><td class="center"><span class="tl tl-green"></span></td><td><span class="tag tag-a">A</span></td><td><strong>(ì£¼)ë†ì‹¬</strong></td><td>ì‹ ë†ì‹¬</td><td>345-67-89012</td><td>ì´ê³¼ì¥</td><td>ì´ì£¼ì„</td><td><span class="tag tag-active">í™œë™</span></td><td>2026-02-08</td></tr>
              <tr><td class="center"><span class="tl tl-yellow"></span></td><td><span class="tag tag-b">B</span></td><td><strong>(ì£¼)ì˜¤ëšœê¸°</strong></td><td>í•¨ì˜¤ëšœê¸°</td><td>456-78-90123</td><td>ë°•ëŒ€ë¦¬</td><td>ì´ì£¼ì„</td><td><span class="tag tag-active">í™œë™</span></td><td>2025-12-20</td></tr>
              <tr style="background:#fff8e1"><td class="center"><span class="tl tl-orange"></span></td><td><span class="tag tag-a">A</span></td><td><strong>í’€ë¬´ì›ì‹í’ˆ(ì£¼)</strong></td><td>ì›í’€ë¬´</td><td>234-56-78901</td><td>ì´ê·œì„±</td><td>ë°•ì£¼ì„</td><td><span class="tag tag-active">í™œë™</span></td><td>2025-12-05</td></tr>
              <tr style="background:#fce4ec"><td class="center"><span class="tl tl-red"></span></td><td><span class="tag tag-c">C</span></td><td><strong>(ì£¼)ì‚¼ì–‘ì‹í’ˆ</strong></td><td>ì „ì‚¼ì–‘</td><td>567-89-01234</td><td>ìµœíŒ€ì¥</td><td>ì´ì£¼ì„</td><td><span class="tag tag-active">í™œë™</span></td><td>2025-10-15</td></tr>
              <tr><td class="center"><span class="tl tl-blue"></span></td><td><span class="tag tag-b">B</span></td><td><strong>ë™ì›F&B(ì£¼)</strong></td><td>ê¹€ë™ì›</td><td>678-90-12345</td><td>ì •ê³¼ì¥</td><td>ì´ì£¼ì„</td><td><span class="tag tag-active">í™œë™</span></td><td>2026-02-12</td></tr>
              <tr><td class="center"><span class="tl tl-green"></span></td><td><span class="tag tag-a">A</span></td><td><strong>ëŒ€ìƒ(ì£¼)</strong></td><td>ì„ëŒ€ìƒ</td><td>789-01-23456</td><td>í•œëŒ€ë¦¬</td><td>ì´ì£¼ì„</td><td><span class="tag tag-dormant">íœ´ë©´</span></td><td>2025-08-20</td></tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- ===== ì—…ì²´ì¡°íšŒ (ì§€ë„ ë“œë¦´ë‹¤ìš´ + ì¹´ì¹´ì˜¤ + ì‹ì•½ì²˜) ===== -->
    <div class="page" id="page-bizSearch" style="display:none">

      <!-- ìƒë‹¨: í˜„ì¬ ì„ íƒ ê²½ë¡œ (ë¸Œë ˆë“œí¬ëŸ¼) -->
      <div class="card" style="margin-bottom:16px">
        <div class="card-bd" style="display:flex;align-items:center;gap:8px;padding:12px 20px;flex-wrap:wrap">
          <span style="font-size:15px">ğŸ—ºï¸</span>
          <b style="font-size:14px;color:#1a2332">ì—…ì²´ì¡°íšŒ</b>
          <span style="color:#c8d6e5">|</span>
          <div id="bizBreadcrumb" style="display:flex;align-items:center;gap:4px;font-size:13px">
            <span style="color:#1a73e8;font-weight:600;cursor:pointer" onclick="bizGoStep(0)">ì „êµ­</span>
          </div>
          <div style="margin-left:auto;display:flex;gap:8px;align-items:center">
            <input id="bizQuickSearch" placeholder="ì—…ì²´ëª… ë¹ ë¥¸ê²€ìƒ‰..." style="padding:6px 12px;border:1px solid #e2e6ed;border-radius:6px;font-size:12px;width:180px" onkeydown="if(event.key==='Enter')doBizQuickSearch()">
            <button class="btn btn-primary btn-sm" onclick="doBizQuickSearch()" style="padding:6px 12px">ğŸ”</button>
          </div>
        </div>
      </div>

      <!-- STEP 0: ì „êµ­ ì‹œë„ ì§€ë„ (Leaflet + VWORLD) -->
      <div id="bizStep0">
        <div style="display:flex;gap:16px;flex-wrap:wrap">
          <!-- ì§€ë„ ì˜ì—­ -->
          <div class="card" style="flex:1;min-width:480px">
            <div class="card-hd"><h3>ğŸ—ºï¸ ì‹œ/ë„ ì„ íƒ</h3><div class="right" style="font-size:11px;color:#8892a4">ì§€ë„ë¥¼ í´ë¦­í•˜ì—¬ ì„ íƒ</div></div>
            <div class="card-bd" style="padding:0">
              <div id="fssLoadStatus" style="display:none;padding:8px 16px;background:#fff3e0;border-bottom:1px solid #ffe0b2;font-size:12px;color:#e65100">
                <span id="fssLoadText">â³ ì‹ì•½ì²˜ ë°ì´í„° ë¡œë”© ì¤‘...</span>
                <div style="margin-top:4px;height:4px;background:#ffe0b2;border-radius:2px;overflow:hidden"><div id="fssLoadBar" style="height:100%;background:#fb8c00;width:0%;transition:width .3s"></div></div>
              </div>
              <div id="koreaMap" style="width:100%;height:480px;border-radius:0 0 12px 12px"></div>
            </div>
          </div>
          <!-- ìš°ì¸¡ íŒ¨ë„ -->
          <div style="width:280px;flex-shrink:0;display:flex;flex-direction:column;gap:12px">
            <div class="card">
              <div class="card-hd"><h3>ğŸ“‹ ì¡°íšŒ ë°©ë²•</h3></div>
              <div class="card-bd" style="font-size:12px;color:#5f6b7a;line-height:2">
                <b>1ë‹¨ê³„</b> ì‹œ/ë„ ì„ íƒ (ì§€ë„ í´ë¦­)<br>
                <b>2ë‹¨ê³„</b> ì‹œ/êµ°/êµ¬ ì„ íƒ<br>
                <b>3ë‹¨ê³„</b> ì/ë©´/ë™ ì„ íƒ<br>
                <b>ê²°ê³¼</b> ì¹´ì¹´ì˜¤ë§µ + ì‹ì•½ì²˜ ë™ì‹œ ì¡°íšŒ<br>
                <div style="margin-top:8px;padding:8px;background:#e3f2fd;border-radius:6px;font-size:11px;color:#1565c0">
                  ğŸ’¡ ìš°ì¸¡ ìƒë‹¨ ë¹ ë¥¸ê²€ìƒ‰ìœ¼ë¡œ ì—…ì²´ëª… ì§ì ‘ ê²€ìƒ‰ë„ ê°€ëŠ¥í•©ë‹ˆë‹¤
                </div>
              </div>
            </div>
            <div class="card">
              <div class="card-hd"><h3>ğŸ”‘ API í‚¤ ì„¤ì •</h3></div>
              <div class="card-bd" style="font-size:11px">
                <label style="font-weight:600;color:#5f6b7a;margin-bottom:4px;display:block">ì‹ì•½ì²˜ (ì‹í’ˆì•ˆì „ë‚˜ë¼)</label>
                <input id="fssApiKey" placeholder="ì‹í’ˆì•ˆì „ë‚˜ë¼ ì¸ì¦í‚¤" style="font-size:11px;font-family:monospace;padding:7px;margin-bottom:8px" value="e5a1d9f07d6c4424a757">
                <label style="font-weight:600;color:#5f6b7a;margin-bottom:4px;display:block">VWORLD (êµ­í† ì§€ë¦¬ì •ë³´)</label>
                <input id="vworldApiKey" placeholder="VWORLD API í‚¤ (ì„ íƒ)" style="font-size:11px;font-family:monospace;padding:7px;margin-bottom:4px" onchange="applyMapTile()">
                <div style="font-size:10px;color:#8892a4;margin-bottom:6px">ë¯¸ì…ë ¥ ì‹œ OpenStreetMap ì‚¬ìš©</div>
                <div style="display:flex;gap:6px">
                  <a href="https://www.foodsafetykorea.go.kr/api/mypage/myPageUser.do" target="_blank" class="btn btn-secondary btn-sm" style="flex:1;font-size:10px;text-decoration:none;text-align:center">ì‹ì•½ì²˜ í‚¤ê´€ë¦¬</a>
                  <a href="https://www.vworld.kr/dev/v4dv_apikey_s001.do" target="_blank" class="btn btn-secondary btn-sm" style="flex:1;font-size:10px;text-decoration:none;text-align:center">VWORLD ë°œê¸‰</a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- STEP 1: ì‹œêµ°êµ¬ ì„ íƒ (ì§€ë„ + ë²„íŠ¼) -->
      <div id="bizStep1" style="display:none">
        <div style="display:flex;gap:16px;flex-wrap:wrap">
          <div class="card" style="flex:1;min-width:400px">
            <div class="card-hd">
              <h3 id="step1Title">ğŸ™ï¸ ì‹œ/êµ°/êµ¬ ì„ íƒ</h3>
              <div class="right"><button class="btn btn-secondary btn-sm" onclick="bizGoStep(0)">â† ì‹œ/ë„ ë‹¤ì‹œ ì„ íƒ</button></div>
            </div>
            <div class="card-bd" style="padding:0">
              <div id="sgMap" style="width:100%;height:420px"></div>
            </div>
          </div>
          <div class="card" style="width:260px;flex-shrink:0">
            <div class="card-hd"><h3>ğŸ“‹ ëª©ë¡ì—ì„œ ì„ íƒ</h3></div>
            <div class="card-bd" style="max-height:420px;overflow-y:auto">
              <div id="sigunguGrid" style="display:flex;flex-wrap:wrap;gap:6px"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- STEP 2: ìë©´ë™ ì„ íƒ (ì§€ë„ + ë²„íŠ¼) -->
      <div id="bizStep2" style="display:none">
        <div style="display:flex;gap:16px;flex-wrap:wrap">
          <div class="card" style="flex:1;min-width:400px">
            <div class="card-hd">
              <h3 id="step2Title">ğŸ˜ï¸ ì/ë©´/ë™ ì„ íƒ</h3>
              <div class="right">
                <button class="btn btn-secondary btn-sm" onclick="bizGoStep(1)" style="margin-right:6px">â† ì‹œ/êµ°/êµ¬</button>
                <button class="btn btn-primary btn-sm" onclick="doRegionSearch()">ğŸ” ì‹œ/êµ°/êµ¬ ì „ì²´ ê²€ìƒ‰</button>
              </div>
            </div>
            <div class="card-bd" style="padding:0">
              <div id="dongMap" style="width:100%;height:420px"></div>
            </div>
          </div>
          <div class="card" style="width:240px;flex-shrink:0">
            <div class="card-hd"><h3>ğŸ“‹ ëª©ë¡ì—ì„œ ì„ íƒ</h3></div>
            <div class="card-bd" style="max-height:420px;overflow-y:auto">
              <div id="dongGrid" style="display:flex;flex-wrap:wrap;gap:6px"></div>
              <div id="dongLoading" style="text-align:center;padding:20px;color:#8892a4;display:none">â³ ì/ë©´/ë™ ë¡œë”© ì¤‘...</div>
            </div>
          </div>
        </div>
      </div>

      <!-- STEP 3: ì‹ì•½ì²˜ ê²°ê³¼ ëª©ë¡ -->
      <div id="bizStep3" style="display:none">
        <div class="card" style="margin-bottom:16px">
          <div class="card-hd">
            <h3 id="fssResultTitle">ğŸ­ ì‹ì•½ì²˜ ì¸í—ˆê°€ ì—…ì²´ ëª©ë¡</h3>
            <div class="right">
              <span id="bizFssCount" style="font-size:22px;font-weight:700;color:#2e7d32;margin-right:12px">0</span>
              <span style="font-size:12px;color:#8892a4;margin-right:16px">ê±´</span>
              <button class="btn btn-secondary btn-sm" onclick="bizGoStep(0)">ğŸ—ºï¸ ìƒˆë¡œ ê²€ìƒ‰</button>
            </div>
          </div>
          <div class="card-bd" style="padding:0;overflow-x:auto">
            <table class="tbl">
              <thead><tr><th>ì—…ì²´ëª…</th><th>ëŒ€í‘œì</th><th>ì—…ì¢…</th><th>ì¸í—ˆê°€ë²ˆí˜¸</th><th>ì†Œì¬ì§€</th><th>ê´€í• ê´€ì²­</th><th></th></tr></thead>
              <tbody id="fssTableBody"></tbody>
            </table>
          </div>
        </div>
      </div>

    </div>

    <!-- ===== ê³ ê°ì‚¬ ë“±ë¡ ===== -->
    <div class="page" id="page-customerReg" style="display:none">
      <div style="margin-bottom:16px"><button class="btn btn-secondary btn-sm" onclick="showPage('customerList')">â† ëª©ë¡ìœ¼ë¡œ</button></div>
      <div class="card"><div class="card-bd" style="max-width:860px">
        <div class="sec-title"><span class="sec-num">1</span> ê¸°ë³¸ ì •ë³´</div>
        <div class="fg-row">
          <div class="fg"><label>ë²•ì¸ ì—¬ë¶€ <span class="req">*</span></label><div class="radio-group"><label class="radio-item"><input type="radio" name="corp" checked> ë²•ì¸</label><label class="radio-item"><input type="radio" name="corp"> ê°œì¸</label></div></div>
          <div class="fg"><label>ê±°ë˜ì²˜ ë“±ê¸‰</label><select><option>ë“±ê¸‰ ì„ íƒ</option><option>VIP</option><option>A</option><option>B</option><option>C</option></select></div>
        </div>
        <div class="fg-row">
          <div class="fg"><label>íšŒì‚¬ëª… <span class="req">*</span></label><div class="combo"><input id="regCompany" placeholder="ì˜ˆ: (ì£¼)ë°”ì´ì˜¤í‘¸ë“œë©"><button class="btn btn-check btn-sm" onclick="demoCompanyDup()">ì¤‘ë³µ í™•ì¸</button></div><div class="check-result" id="compChk"></div></div>
          <div class="fg"><label>ëŒ€í‘œìëª… <span class="req">*</span></label><input placeholder="ëŒ€í‘œì ì´ë¦„"></div>
        </div>
        <div class="fg-row">
          <div class="fg"><label>ì‚¬ì—…ìë²ˆí˜¸ <span class="req">*</span></label><div class="combo"><input placeholder="000-00-00000" maxlength="12" oninput="fmtBiz(this)"><button class="btn btn-check btn-sm" onclick="toast('âœ… ì¤‘ë³µ ì—†ìŒ')">ì¤‘ë³µ í™•ì¸</button></div></div>
          <div class="fg"><label>ë²•ì¸ë²ˆí˜¸ <span class="req">*</span></label><input placeholder="000000-0000000" maxlength="14"></div>
        </div>
        <div class="fg-row">
          <div class="fg"><label>ì—…íƒœ <span class="req">*</span></label><input placeholder="ì˜ˆ: ì œì¡°ì—…"></div>
          <div class="fg"><label>ì¢…ëª© <span class="req">*</span></label><input placeholder="ì˜ˆ: ì‹í’ˆ"></div>
        </div>
        <div class="fg-row">
          <div class="fg"><label>ê³„ì•½ ìƒíƒœ</label><select><option selected>í™œë™</option><option>íœ´ë©´</option><option>í•´ì§€</option></select></div>
          <div class="fg"><label>ì‹ í˜¸ë“±</label><div style="display:flex;align-items:center;gap:6px;padding:8px 0"><span class="tl tl-blue"></span><span style="font-size:11px;color:#5f6b7a">íŒŒë‘ (ì‹ ê·œ ë“±ë¡ ì‹œ ê¸°ë³¸ê°’)</span></div></div>
        </div>

        <div class="sec-title"><span class="sec-num">2</span> ì£¼ì†Œ</div>
        <div class="fg"><label>ì£¼ì†Œ <span class="req">*</span></label><div class="addr-row"><input placeholder="ìš°í¸ë²ˆí˜¸" style="max-width:120px" readonly><button class="btn btn-secondary btn-sm" onclick="toast('ğŸ” ì¹´ì¹´ì˜¤ ìš°í¸ë²ˆí˜¸ API ì—°ë™ ì˜ˆì •')">ìš°í¸ë²ˆí˜¸ ì°¾ê¸°</button></div></div>
        <div class="fg"><input placeholder="ê¸°ë³¸ì£¼ì†Œ (ìë™ì…ë ¥)" readonly></div>
        <div class="fg"><input placeholder="ìƒì„¸ì£¼ì†Œ ì…ë ¥"></div>

        <div class="sec-title"><span class="sec-num">3</span> ì¸í—ˆê°€ ì •ë³´ <span style="margin-left:auto;font-size:11px;color:#8892a4;font-weight:400">ì—¬ëŸ¬ ê°œ ë“±ë¡ ê°€ëŠ¥</span></div>
        <div id="licenseArea">
          <div class="sub-card">
            <div class="sub-card-hd"><div class="sub-card-title"><span class="sub-card-num">1</span> ì¸í—ˆê°€</div></div>
            <div class="fg-row">
              <div class="fg"><label>ë¶„ì•¼ <span class="req">*</span></label><select><option>ì„ íƒ</option><option>ì‹í’ˆ</option><option>ì¶•ì‚°</option></select></div>
              <div class="fg"><label>ì˜ì—…ì˜ í˜•íƒœ <span class="req">*</span></label><div class="combo"><select><option>ì„ íƒ</option><option>ì‹í’ˆì œì¡°ê°€ê³µì—…</option><option>ì¦‰ì„íŒë§¤ì œì¡°ê°€ê³µì—…</option><option>ì‹í’ˆì†Œë¶„ì—…</option><option>ìœ í†µì „ë¬¸íŒë§¤ì—…</option><option>ì¶•ì‚°ë¬¼ê°€ê³µì—…</option><option>ì‹ìœ¡í¬ì¥ì²˜ë¦¬ì—…</option><option value="etc">âœï¸ ì§ì ‘ ì…ë ¥</option></select></div></div>
            </div>
            <div class="fg-row">
              <div class="fg"><label>ëŒ€í‘œì <span class="req">*</span></label><input placeholder="ì¸í—ˆê°€ ëŒ€í‘œì"></div>
              <div class="fg"><label>ì¸í—ˆê°€ë²ˆí˜¸ <span class="req">*</span></label><input placeholder="ì¸í—ˆê°€ë²ˆí˜¸"></div>
            </div>
            <div class="fg-row">
              <div class="fg"><label>ì˜ì—…ì†Œëª…ì¹­ <span class="req">*</span></label><input placeholder="ì˜ì—…ì†Œ ëª…ì¹­"></div>
              <div class="fg"><label>ì†Œì¬ì§€ <span class="req">*</span></label><input placeholder="ì†Œì¬ì§€"></div>
            </div>
            <div class="fg"><label>ì¸í—ˆê°€ ë¬¸ì„œ ì²¨ë¶€</label>
              <div style="display:flex;gap:8px;align-items:center">
                <div class="file-area" style="flex:1;padding:10px" onclick="toast('ğŸ“ íŒŒì¼ ì„ íƒ (PDF, JPG, PNG)')">ğŸ“ í´ë¦­í•˜ì—¬ íŒŒì¼ ì„ íƒ ë˜ëŠ” ë“œë˜ê·¸</div>
                <button class="btn btn-secondary btn-sm" disabled style="opacity:.5">ğŸ¤– OCR ì¸ì‹<br><span style="font-size:9px">(ì¶”í›„ êµ¬í˜„)</span></button>
              </div>
            </div>
          </div>
        </div>
        <button class="btn-add" onclick="toast('+ ì¸í—ˆê°€ ì •ë³´ ì¶”ê°€ë¨')">+ ì¸í—ˆê°€ ì •ë³´ ì¶”ê°€</button>

        <div class="sec-title"><span class="sec-num">4</span> ê³ ê°ì‚¬ ë‹´ë‹¹ì <span style="margin-left:auto;font-size:11px;color:#8892a4;font-weight:400">ì—¬ëŸ¬ ëª… ë“±ë¡ ê°€ëŠ¥</span></div>
        <div id="contactArea">
          <div class="sub-card">
            <div class="sub-card-hd"><div class="sub-card-title"><span class="sub-card-num">1</span> ë‹´ë‹¹ì</div></div>
            <div class="fg-row3">
              <div class="fg"><label>ì´ë¦„ <span class="req">*</span></label><input id="regCName" placeholder="ë‹´ë‹¹ì ì´ë¦„"></div>
              <div class="fg"><label>ì „í™”ë²ˆí˜¸ <span class="req">*</span></label><input placeholder="010-0000-0000" oninput="fmtPhone(this)"></div>
              <div class="fg"><label>ì´ë©”ì¼</label><input type="email" placeholder="email@example.com"></div>
            </div>
            <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin-top:6px">
              <button class="btn btn-check btn-sm" onclick="demoContactDup()">ğŸ” ì¤‘ë³µ í™•ì¸</button>
              <div class="check-result" id="cntChk"></div>
              <div style="margin-left:auto;display:flex;align-items:center;gap:6px;font-size:11px;color:#8892a4">
                ìì‚¬ ë‹´ë‹¹: <select style="padding:5px 8px;border:1px solid #e2e6ed;border-radius:6px;font-size:11px"><option>ì„ íƒ</option><option>ë°•ì£¼ì„</option><option selected>ì´ì£¼ì„</option><option>ê¹€ì‚¬ì›</option></select>
              </div>
            </div>
          </div>
        </div>
        <button class="btn-add" onclick="toast('+ ë‹´ë‹¹ì ì¶”ê°€ë¨')">+ ë‹´ë‹¹ì ì¶”ê°€</button>

        <div class="sec-title"><span class="sec-num">5</span> ì„¸ê¸ˆê³„ì‚°ì„œ ë‹´ë‹¹ì <button class="btn btn-check btn-sm" style="margin-left:auto" onclick="toast('ğŸ“‹ 1ë²ˆ ë‹´ë‹¹ì ì •ë³´ ë³µì‚¬ ì™„ë£Œ')">ğŸ“‹ 1ë²ˆ ë‹´ë‹¹ì ë³µì‚¬</button></div>
        <div class="fg-row3">
          <div class="fg"><label>ì´ë¦„ <span class="req">*</span></label><input placeholder="ë‹´ë‹¹ì ì´ë¦„"></div>
          <div class="fg"><label>ì „í™”ë²ˆí˜¸ <span class="req">*</span></label><input placeholder="010-0000-0000"></div>
          <div class="fg"><label>ì´ë©”ì¼ <span class="req">*</span></label><input type="email" placeholder="ì„¸ê¸ˆê³„ì‚°ì„œ ìˆ˜ì‹  ì´ë©”ì¼"></div>
        </div>

        <div class="sec-title"><span class="sec-num">6</span> ë©”ëª¨ / ë¹„ê³ </div>
        <div class="fg"><textarea placeholder="íŠ¹ì´ì‚¬í•­, ê³„ì•½ ì¡°ê±´, ì°¸ê³ ì‚¬í•­ ë“±..."></textarea></div>

        <div style="display:flex;justify-content:flex-end;gap:10px;margin-top:16px">
          <button class="btn btn-secondary" onclick="showPage('customerList')">ì·¨ì†Œ</button>
          <button class="btn btn-primary" onclick="toast('âœ… ê³ ê°ì‚¬ê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!');setTimeout(()=>showPage('customerList'),1500)">âœ… ê³ ê°ì‚¬ ë“±ë¡</button>
        </div>
      </div></div>
    </div>

    <!-- ===== ì—…ë¬´ì¼ì§€ - ëª©ë¡ ===== -->
    <div class="page" id="page-daily" style="display:none">
      <!-- ìš”ì•½ í†µê³„ -->
      <div class="stats">
        <div class="stat"><div class="stat-val" style="color:#1565c0">12</div><div class="stat-label">ì´ë²ˆ ì£¼ ì‘ì„±</div></div>
        <div class="stat"><div class="stat-val" style="color:#2e7d32">8</div><div class="stat-label">ë°©ë¬¸ ê±´ìˆ˜</div></div>
        <div class="stat"><div class="stat-val" style="color:#1a2332">9,680,000</div><div class="stat-label">ì´ë²ˆ ì£¼ ë§¤ì¶œí•©ê³„</div></div>
        <div class="stat"><div class="stat-val" style="color:#7b1fa2">2</div><div class="stat-label">ì‹ ê·œì˜ì—… í™œë™</div></div>
      </div>

      <div class="card">
        <div class="card-hd">
          <h3>ğŸ“ ì—…ë¬´ì¼ì§€</h3>
          <div class="right">
            <span style="font-size:11px;color:#8892a4;margin-right:8px">ì˜ì—…ë¶€ë§Œ ì‘ì„± Â· ë¶€ì„œì› ì¡°íšŒ ê°€ëŠ¥</span>
            <button class="btn btn-primary" onclick="showPage('dailyWrite')">+ ì—…ë¬´ì¼ì§€ ì‘ì„±</button>
          </div>
        </div>
        <!-- í•„í„° ì˜ì—­ -->
        <div style="padding:14px 20px;border-bottom:1px solid #eef0f4;display:flex;gap:10px;flex-wrap:wrap;align-items:center;background:#fafbfc">
          <div class="fg" style="margin:0;flex-shrink:0">
            <input type="date" value="2026-02-10" style="padding:7px 10px;border:1px solid #e2e6ed;border-radius:6px;font-size:12px">
          </div>
          <span style="color:#c8d6e5">~</span>
          <div class="fg" style="margin:0;flex-shrink:0">
            <input type="date" value="2026-02-13" style="padding:7px 10px;border:1px solid #e2e6ed;border-radius:6px;font-size:12px">
          </div>
          <select style="padding:7px 10px;border:1px solid #e2e6ed;border-radius:6px;font-size:12px;background:#fff;cursor:pointer">
            <option>ì „ì²´ ì‘ì„±ì</option>
            <option selected>ì´ì£¼ì„</option>
            <option>ê¹€ì˜ì—…</option>
            <option>ë°•ì² ìˆ˜</option>
          </select>
          <select style="padding:7px 10px;border:1px solid #e2e6ed;border-radius:6px;font-size:12px;background:#fff;cursor:pointer">
            <option>ì „ì²´ ì‹œë£Œìˆ˜ê±°</option>
            <option>ë°©ë¬¸</option>
            <option>íƒë°°Â·í€µ</option>
            <option>ë‚´ë°©</option>
          </select>
          <input placeholder="ì—…ì²´ëª… ê²€ìƒ‰..." style="padding:7px 10px;border:1px solid #e2e6ed;border-radius:6px;font-size:12px;width:160px">
          <button class="btn btn-secondary btn-sm" onclick="toast('ğŸ” ê²€ìƒ‰ ì™„ë£Œ')">ê²€ìƒ‰</button>
        </div>
        <!-- í…Œì´ë¸” -->
        <div class="card-bd" style="padding:0;overflow-x:auto">
          <table class="tbl">
            <thead><tr><th style="width:40px;text-align:center">ğŸ“</th><th>ë‚ ì§œ</th><th>ì‘ì„±ì</th><th>ì—…ì²´ëª…</th><th>ì‹œë£Œìˆ˜ê±°</th><th style="text-align:right">ë§¤ì¶œ(VATí¬í•¨)</th><th>íŠ¹ì´ì‚¬í•­</th><th>ì‹ ê·œì˜ì—…</th><th>ìµì¼ê³„íš</th><th style="width:60px"></th></tr></thead>
            <tbody>
              <tr onclick="showPage('dailyDetail')" style="cursor:pointer">
                <td class="center">ğŸ“„</td>
                <td><b>2026-02-13</b></td><td>ì´ì£¼ì„</td><td><b>CJì œì¼ì œë‹¹(ì£¼)</b></td>
                <td><span class="tag" style="background:#e3f2fd;color:#1565c0">ë°©ë¬¸</span> <span style="font-size:10px;color:#1565c0">ğŸš—</span></td>
                <td style="text-align:right;font-weight:600">2,200,000</td>
                <td style="max-width:180px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">ì‹ ì œí’ˆ ì¶œì‹œ ê´€ë ¨ ì¶”ê°€ ê²€ì‚¬ ìš”ì²­</td>
                <td>-</td>
                <td style="font-size:11px;color:#5f6b7a">ë†ì‹¬ íƒë°° ì ‘ìˆ˜ ì˜ˆì •</td>
                <td class="center"><span style="cursor:pointer;font-size:14px" title="ìƒì„¸ë³´ê¸°">ğŸ‘ï¸</span></td>
              </tr>
              <tr style="cursor:pointer" onclick="showPage('dailyDetail')">
                <td class="center">ğŸ“„</td>
                <td><b>2026-02-13</b></td><td>ì´ì£¼ì„</td><td><b>(ì£¼)ë†ì‹¬</b></td>
                <td><span class="tag" style="background:#e8f5e9;color:#2e7d32">íƒë°°Â·í€µ</span></td>
                <td style="text-align:right;font-weight:600">880,000</td>
                <td>-</td><td>-</td>
                <td style="font-size:11px;color:#5f6b7a">-</td>
                <td class="center"><span style="cursor:pointer;font-size:14px">ğŸ‘ï¸</span></td>
              </tr>
              <tr style="cursor:pointer" onclick="showPage('dailyDetail')">
                <td class="center">ğŸ“„</td>
                <td>2026-02-12</td><td>ì´ì£¼ì„</td><td><b>ë™ì›F&B(ì£¼)</b></td>
                <td><span class="tag" style="background:#e3f2fd;color:#1565c0">ë°©ë¬¸</span> <span style="font-size:10px;color:#1565c0">ğŸš—</span></td>
                <td style="text-align:right;font-weight:600">1,500,000</td>
                <td style="max-width:180px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">ê²½ìŸì‚¬ ê²¬ì  ë¹„êµ ìš”ì²­ â€” Aì‚¬ ê°€ê²© ë¹„êµ ìë£Œ ìš”ì²­</td>
                <td>-</td>
                <td style="font-size:11px;color:#5f6b7a">CJ ë°©ë¬¸ ì˜ˆì •</td>
                <td class="center"><span style="cursor:pointer;font-size:14px">ğŸ‘ï¸</span></td>
              </tr>
              <tr style="cursor:pointer" onclick="showPage('dailyDetail')">
                <td class="center">ğŸ“„</td>
                <td>2026-02-12</td><td>ì´ì£¼ì„</td><td><b>(ì‹ ê·œ) í•˜ë¦¼ê·¸ë£¹</b></td>
                <td><span class="tag" style="background:#f3e5f5;color:#7b1fa2">ë‚´ë°©</span></td>
                <td style="text-align:right;color:#8892a4">-</td>
                <td>-</td>
                <td style="color:#7b1fa2;font-weight:600">ì‹í’ˆì•ˆì „íŒ€ ë¯¸íŒ…</td>
                <td style="font-size:11px;color:#5f6b7a">ê²¬ì ì„œ ë°œì†¡</td>
                <td class="center"><span style="cursor:pointer;font-size:14px">ğŸ‘ï¸</span></td>
              </tr>
              <tr style="cursor:pointer" onclick="showPage('dailyDetail')">
                <td class="center">ğŸ“„</td>
                <td>2026-02-11</td><td>ì´ì£¼ì„</td><td><b>CJì œì¼ì œë‹¹(ì£¼)</b></td>
                <td><span class="tag" style="background:#e3f2fd;color:#1565c0">ë°©ë¬¸</span> <span style="font-size:10px;color:#1565c0">ğŸš—</span></td>
                <td style="text-align:right;font-weight:600">3,100,000</td>
                <td style="max-width:180px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">ë°˜ê¸° ê³„ì•½ ê°±ì‹  ë…¼ì˜</td>
                <td>-</td>
                <td style="font-size:11px;color:#5f6b7a">ë™ì›F&B ë°©ë¬¸</td>
                <td class="center"><span style="cursor:pointer;font-size:14px">ğŸ‘ï¸</span></td>
              </tr>
              <tr style="cursor:pointer" onclick="showPage('dailyDetail')">
                <td class="center">ğŸ“„</td>
                <td>2026-02-11</td><td>ê¹€ì˜ì—…</td><td><b>í’€ë¬´ì›ì‹í’ˆ(ì£¼)</b></td>
                <td><span class="tag" style="background:#e3f2fd;color:#1565c0">ë°©ë¬¸</span> <span style="font-size:10px;color:#1565c0">ğŸš—</span></td>
                <td style="text-align:right;font-weight:600">1,800,000</td>
                <td style="max-width:180px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">ë¯¸ìˆ˜ê¸ˆ ê±´ ìˆ˜ê¸ˆ í™œë™ ë³‘í–‰</td>
                <td>-</td>
                <td style="font-size:11px;color:#5f6b7a">ì„œìš¸ìœ í†µ ìˆ˜ê¸ˆ ì „í™”</td>
                <td class="center"><span style="cursor:pointer;font-size:14px">ğŸ‘ï¸</span></td>
              </tr>
              <tr style="cursor:pointer" onclick="showPage('dailyDetail')">
                <td class="center">ğŸ“„</td>
                <td>2026-02-10</td><td>ì´ì£¼ì„</td><td><b>ì˜¤ëšœê¸°(ì£¼)</b></td>
                <td><span class="tag" style="background:#e8f5e9;color:#2e7d32">íƒë°°Â·í€µ</span></td>
                <td style="text-align:right;font-weight:600">650,000</td>
                <td>-</td><td>-</td>
                <td style="font-size:11px;color:#5f6b7a">CJ ê³„ì•½ ê°±ì‹  ë…¼ì˜</td>
                <td class="center"><span style="cursor:pointer;font-size:14px">ğŸ‘ï¸</span></td>
              </tr>
            </tbody>
          </table>
        </div>
        <!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
        <div style="padding:12px 20px;display:flex;justify-content:space-between;align-items:center;border-top:1px solid #eef0f4">
          <span style="font-size:11px;color:#8892a4">ì´ 7ê±´ (1/1 í˜ì´ì§€)</span>
          <div style="display:flex;gap:4px">
            <button class="btn btn-secondary btn-sm" disabled>â† ì´ì „</button>
            <button class="btn btn-sm" style="background:#1a73e8;color:#fff;border:none;border-radius:6px;min-width:28px">1</button>
            <button class="btn btn-secondary btn-sm" disabled>ë‹¤ìŒ â†’</button>
          </div>
        </div>
      </div>
    </div>

    <!-- ===== ì—…ë¬´ì¼ì§€ - ì‘ì„± í¼ ===== -->
    <div class="page" id="page-dailyWrite" style="display:none">
      <div style="margin-bottom:16px"><button class="btn btn-secondary btn-sm" onclick="showPage('daily')">â† ëª©ë¡ìœ¼ë¡œ</button></div>
      <div class="card"><div class="card-bd" style="max-width:860px">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:16px">
          <h3 style="font-size:16px;font-weight:700;display:flex;align-items:center;gap:8px">ğŸ“ ì—…ë¬´ì¼ì§€ ì‘ì„±</h3>
          <span style="font-size:11px;color:#8892a4">ì‘ì„±ì: ì´ì£¼ì„ (ì˜ì—…ë¶€) Â· 2026-02-13</span>
        </div>

        <div class="sec-title"><span class="sec-num">1</span> ê¸°ë³¸ ì •ë³´</div>
        <div class="fg-row">
          <div class="fg"><label>ë‚ ì§œ <span class="req">*</span></label><input type="date" value="2026-02-13"></div>
          <div class="fg"><label>ì—…ì²´ëª… <span class="req">*</span></label>
            <div class="combo">
              <select id="dailyCompany" onchange="dailyCompanyChange(this)">
                <option>ì—…ì²´ ì„ íƒ...</option>
                <option>CJì œì¼ì œë‹¹(ì£¼)</option>
                <option>(ì£¼)ë†ì‹¬</option>
                <option>ë™ì›F&B(ì£¼)</option>
                <option>í’€ë¬´ì›ì‹í’ˆ(ì£¼)</option>
                <option>ì˜¤ëšœê¸°(ì£¼)</option>
                <option value="_new">âœï¸ ì‹ ê·œ ì—…ì²´ ì§ì ‘ ì…ë ¥</option>
              </select>
            </div>
            <input id="dailyCompanyNew" placeholder="ì‹ ê·œ ì—…ì²´ëª… ì…ë ¥" style="display:none;margin-top:6px;padding:9px 12px;border:1px solid #e2e6ed;border-radius:8px;font-size:13px;width:100%">
          </div>
        </div>
        <div class="fg-row">
          <div class="fg"><label>ì‹œë£Œìˆ˜ê±° ë°©ë²• <span class="req">*</span></label>
            <select id="dailySample" onchange="dailySampleChange(this)">
              <option value="">ì„ íƒ...</option>
              <option value="visit">ë°©ë¬¸</option>
              <option value="delivery">íƒë°°Â·í€µ</option>
              <option value="walkin">ë‚´ë°©</option>
            </select>
          </div>
          <div class="fg"><label>ë§¤ì¶œ (VAT í¬í•¨)</label><input type="text" placeholder="ìˆ«ìë§Œ ì…ë ¥ (ì˜ˆ: 2200000)" oninput="fmtMoney(this)"></div>
        </div>

        <!-- ë°©ë¬¸ ì‹œ ì°¨ëŸ‰ì¼ì§€ ì—°ë™ ì•ˆë‚´ -->
        <div id="dailyVehicleNotice" style="display:none;background:#e3f2fd;border:1px solid #bbdefb;border-radius:10px;padding:14px;margin:8px 0 16px;font-size:12px;color:#1565c0">
          <div style="display:flex;align-items:center;gap:8px;margin-bottom:10px">
            <span style="font-size:16px">ğŸš—</span>
            <b>ì°¨ëŸ‰ì¼ì§€ ìë™ ì—°ë™</b>
            <span style="font-size:10px;background:#bbdefb;padding:2px 8px;border-radius:4px;margin-left:auto">ì¹´ì¹´ì˜¤ëª¨ë¹Œë¦¬í‹° ê¸¸ì°¾ê¸° API</span>
          </div>

          <div class="fg-row" style="margin-bottom:8px">
            <div class="fg" style="margin:0"><label style="color:#1565c0">ì¶œë°œì§€ <span class="req">*</span></label>
              <select id="vStartType" onchange="calcRoutePreview()" style="border-color:#90caf9">
                <option value="office">ğŸ¢ íšŒì‚¬ (ê¸°ë³¸)</option>
                <option value="home">ğŸ  í˜„ì§€ì¶œê·¼ (ìíƒ)</option>
              </select>
            </div>
            <div class="fg" style="margin:0"><label style="color:#1565c0">ë°©ë¬¸ì§€ (ì—…ì²´ ì£¼ì†Œ ìë™)</label>
              <input id="vDestPreview" value="ì„œìš¸ ì¤‘êµ¬ ì„ì§€ë¡œ (CJì œì¼ì œë‹¹)" style="background:#e3f2fd;border-color:#90caf9" readonly>
            </div>
          </div>
          <div class="fg-row" style="margin-bottom:8px">
            <div class="fg" style="margin:0"><label style="color:#1565c0">ë„ì°©ì§€ <span class="req">*</span></label>
              <select id="vEndType" onchange="calcRoutePreview()" style="border-color:#90caf9">
                <option value="office">ğŸ¢ íšŒì‚¬ (ê¸°ë³¸)</option>
                <option value="home">ğŸ  ìíƒ (í‡´ê·¼)</option>
              </select>
            </div>
            <div class="fg" style="margin:0"><label style="color:#1565c0">ì˜ˆìƒ ì£¼í–‰ê±°ë¦¬</label>
              <div style="display:flex;align-items:center;gap:8px">
                <input id="vDistPreview" type="number" value="42" style="border-color:#90caf9;width:100px;text-align:right;font-weight:700;font-size:15px">
                <span style="font-weight:600">km</span>
                <span style="font-size:10px;color:#1565c0;background:#bbdefb;padding:2px 6px;border-radius:4px" id="vDistLabel">API ìë™ê³„ì‚°</span>
              </div>
              <div class="hint" style="color:#1565c0;margin-top:4px">ğŸ’¡ ìë™ ê³„ì‚° í›„ ìˆ˜ë™ ì¡°ì • ê°€ëŠ¥ (í‡´ê·¼ ê±°ë¦¬, ìš°íšŒ ë“±)</div>
            </div>
          </div>

          <!-- ê²½ìœ ì§€ ì¶”ê°€ -->
          <div id="vWaypointArea"></div>
          <button type="button" style="display:flex;align-items:center;gap:6px;padding:6px 12px;border:1px dashed #90caf9;border-radius:6px;background:transparent;color:#1565c0;font-size:11px;font-weight:600;cursor:pointer;margin-top:6px" onclick="addWaypoint()">+ ê²½ìœ ì§€ ì¶”ê°€</button>
        </div>

        <div class="sec-title"><span class="sec-num">2</span> ì—…ë¬´ ìƒì„¸</div>
        <div class="fg"><label>íŠ¹ì´ì‚¬í•­</label><textarea placeholder="ë°©ë¬¸ ë˜ëŠ” ì ‘ìˆ˜ ê´€ë ¨ íŠ¹ì´ì‚¬í•­ì„ ì‘ì„±í•˜ì„¸ìš”.&#10;ì˜ˆ: ì‹ ì œí’ˆ ì¶œì‹œ ê´€ë ¨ ì¶”ê°€ ê²€ì‚¬ ìš”ì²­, ë‹¨ê°€ í˜‘ì˜ í•„ìš” ë“±"></textarea></div>
        <div class="fg"><label>ê²½ìŸì‚¬ ë™í–¥</label><textarea placeholder="ê²½ìŸì‚¬ ê´€ë ¨ ì •ë³´ê°€ ìˆë‹¤ë©´ ì‘ì„±í•˜ì„¸ìš”.&#10;ì˜ˆ: Aê²€ì‚¬ê¸°ê´€ì—ì„œ 5% ì €ë ´í•œ ë‹¨ê°€ ì œì‹œ, Bê¸°ê´€ ì‹ ê·œ ì„œë¹„ìŠ¤ ì‹œì‘ ë“±" style="min-height:50px"></textarea></div>
        <div class="fg"><label>ê±´ì˜ì‚¬í•­</label><textarea placeholder="íšŒì‚¬ì— ê±´ì˜í•  ì‚¬í•­ì´ ìˆë‹¤ë©´ ì‘ì„±í•˜ì„¸ìš”.&#10;ì˜ˆ: ì‹ ê·œ ê²€ì‚¬ í•­ëª© ë„ì… í•„ìš”, ì¥ë¹„ ì¶”ê°€ ìš”ì²­ ë“±" style="min-height:50px"></textarea></div>

        <div class="sec-title"><span class="sec-num">3</span> ì˜ì—… í™œë™</div>
        <div class="fg"><label>ì‹ ê·œì˜ì—… í™œë™</label><textarea placeholder="ì‹ ê·œ ì˜ì—… ê´€ë ¨ í™œë™ì´ ìˆë‹¤ë©´ ì‘ì„±í•˜ì„¸ìš”.&#10;ì˜ˆ: í•˜ë¦¼ê·¸ë£¹ ì‹í’ˆì•ˆì „íŒ€ ë¯¸íŒ… â€” ì œì•ˆì„œ ì „ë‹¬, ê²¬ì ì„œ ë°œì†¡ ì˜ˆì •" style="min-height:50px"></textarea></div>
        <div class="fg"><label>ìµì¼ ê³„íš <span class="req">*</span></label><textarea placeholder="ë‹¤ìŒ ì˜ì—…ì¼ì— í•  ê³„íšì„ ì‘ì„±í•˜ì„¸ìš”.&#10;ì˜ˆ: ë†ì‹¬ íƒë°° ì ‘ìˆ˜ ì˜ˆì •, CJ ê³„ì•½ ê°±ì‹  ìµœì¢… í™•ì¸"></textarea></div>

        <div style="display:flex;justify-content:flex-end;gap:10px;margin-top:20px;padding-top:16px;border-top:1px solid #eef0f4">
          <button class="btn btn-secondary" onclick="showPage('daily')">ì·¨ì†Œ</button>
          <button class="btn btn-secondary" onclick="toast('ğŸ’¾ ì„ì‹œì €ì¥ ë˜ì—ˆìŠµë‹ˆë‹¤')">ì„ì‹œì €ì¥</button>
          <button class="btn btn-primary" onclick="dailySave()">âœ… ì €ì¥</button>
        </div>
      </div></div>
    </div>

    <!-- ===== ì—…ë¬´ì¼ì§€ - ìƒì„¸ ë³´ê¸° ===== -->
    <div class="page" id="page-dailyDetail" style="display:none">
      <div style="margin-bottom:16px;display:flex;gap:8px">
        <button class="btn btn-secondary btn-sm" onclick="showPage('daily')">â† ëª©ë¡ìœ¼ë¡œ</button>
        <div style="margin-left:auto;display:flex;gap:8px">
          <button class="btn btn-secondary btn-sm" onclick="toast('âœï¸ ìˆ˜ì • ëª¨ë“œë¡œ ì „í™˜')">âœï¸ ìˆ˜ì •</button>
          <button class="btn btn-danger btn-sm" onclick="if(confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?'))toast('ğŸ—‘ï¸ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤')">ğŸ—‘ï¸ ì‚­ì œ</button>
        </div>
      </div>

      <div class="card"><div class="card-bd">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:20px;padding-bottom:14px;border-bottom:1px solid #eef0f4">
          <div>
            <h3 style="font-size:16px;font-weight:700;margin-bottom:4px">ğŸ“ ì—…ë¬´ì¼ì§€ ìƒì„¸</h3>
            <span style="font-size:12px;color:#8892a4">2026-02-13 (ëª©) Â· ì´ì£¼ì„ (ì˜ì—…ë¶€)</span>
          </div>
          <div style="text-align:right">
            <div style="font-size:11px;color:#8892a4;margin-bottom:4px">ì‘ì„±ì¼ì‹œ</div>
            <div style="font-size:12px;color:#5f6b7a">2026-02-13 17:32</div>
          </div>
        </div>

        <!-- ê¸°ë³¸ ì •ë³´ ì¹´ë“œ -->
        <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-bottom:20px">
          <div style="background:#f8f9fb;border-radius:10px;padding:14px">
            <div style="font-size:10px;color:#8892a4;margin-bottom:4px">ì—…ì²´ëª…</div>
            <div style="font-size:14px;font-weight:700;color:#1a2332">CJì œì¼ì œë‹¹(ì£¼)</div>
          </div>
          <div style="background:#f8f9fb;border-radius:10px;padding:14px">
            <div style="font-size:10px;color:#8892a4;margin-bottom:4px">ì‹œë£Œìˆ˜ê±°</div>
            <div><span class="tag" style="background:#e3f2fd;color:#1565c0">ë°©ë¬¸</span> <span style="font-size:10px;color:#1565c0">ğŸš— ì°¨ëŸ‰ì¼ì§€ ì—°ë™</span></div>
          </div>
          <div style="background:#f8f9fb;border-radius:10px;padding:14px">
            <div style="font-size:10px;color:#8892a4;margin-bottom:4px">ë§¤ì¶œ (VAT í¬í•¨)</div>
            <div style="font-size:14px;font-weight:700;color:#2e7d32">â‚© 2,200,000</div>
          </div>
          <div style="background:#f8f9fb;border-radius:10px;padding:14px">
            <div style="font-size:10px;color:#8892a4;margin-bottom:4px">ë°©ë¬¸ ì§€ì—­</div>
            <div style="font-size:13px;font-weight:600;color:#1a2332">ì„œìš¸(ì¤‘êµ¬)</div>
          </div>
        </div>

        <!-- ìƒì„¸ ë‚´ìš© -->
        <div class="sec-title" style="margin-top:8px"><span class="sec-num">1</span> íŠ¹ì´ì‚¬í•­</div>
        <div style="background:#f8f9fb;border-radius:8px;padding:14px;margin-bottom:16px;font-size:13px;line-height:1.7;color:#333">
          ì‹ ì œí’ˆ ì¶œì‹œ ê´€ë ¨ ì¶”ê°€ ê²€ì‚¬ ìš”ì²­. 2ì›” ë§ê¹Œì§€ ë¯¸ìƒë¬¼ 5ì¢… + ì˜ì–‘ì„±ë¶„ ë¶„ì„ì´ í•„ìš”í•˜ë©°, ì‹œë£ŒëŠ” ì˜¤ëŠ˜ ìˆ˜ê±° ì™„ë£Œ. ë‹´ë‹¹ì(ì‹í’ˆì•ˆì „íŒ€ ê¹€ê³¼ì¥)ì™€ ë‚©ê¸° 2ì£¼ í™•ì¸.
        </div>

        <div class="sec-title"><span class="sec-num">2</span> ê²½ìŸì‚¬ ë™í–¥</div>
        <div style="background:#fff3e0;border:1px solid #ffe0b2;border-radius:8px;padding:14px;margin-bottom:16px;font-size:13px;line-height:1.7;color:#e65100">
          <b>âš ï¸ Aê²€ì‚¬ê¸°ê´€</b> â€” ë¯¸ìƒë¬¼ ê²€ì‚¬ ë‹¨ê°€ë¥¼ ì•½ 8% ì¸í•˜í•œ ê²ƒìœ¼ë¡œ íŒŒì•…ë¨. CJì¸¡ì—ì„œ ê°€ê²© ë¹„êµ ìë£Œë¥¼ ìš”ì²­í•¨. ëŒ€ì‘ í•„ìš”.
        </div>

        <div class="sec-title"><span class="sec-num">3</span> ê±´ì˜ì‚¬í•­</div>
        <div style="background:#f8f9fb;border-radius:8px;padding:14px;margin-bottom:16px;font-size:13px;line-height:1.7;color:#333">
          ê²½ìŸì‚¬ ë‹¨ê°€ ì¸í•˜ì— ëŒ€ì‘í•˜ê¸° ìœ„í•´ ëŒ€ëŸ‰ ê³„ì•½ í• ì¸ ì •ì±… ê²€í† ê°€ í•„ìš”í•©ë‹ˆë‹¤. ë°˜ê¸° ê³„ì•½ ê°±ì‹  ì‹œ í™œìš© ê°€ëŠ¥í•œ íŒ¨í‚¤ì§€ ë‹¨ê°€í‘œë¥¼ ì¬ë¬´ë¶€ì™€ í˜‘ì˜ ìš”ì²­ë“œë¦½ë‹ˆë‹¤.
        </div>

        <div class="sec-title"><span class="sec-num">4</span> ì‹ ê·œì˜ì—… í™œë™</div>
        <div style="background:#f8f9fb;border-radius:8px;padding:14px;margin-bottom:16px;font-size:13px;color:#8892a4;font-style:italic">
          í•´ë‹¹ ì—†ìŒ
        </div>

        <div class="sec-title"><span class="sec-num">5</span> ìµì¼ ê³„íš</div>
        <div style="background:#e3f2fd;border:1px solid #bbdefb;border-radius:8px;padding:14px;margin-bottom:16px;font-size:13px;line-height:1.7;color:#1565c0">
          <b>ğŸ“… 2026-02-14 (ê¸ˆ)</b><br>
          â€¢ ë†ì‹¬ íƒë°° ì ‘ìˆ˜ ì˜ˆì • (ì‹œë£Œ ë„ì°© í™•ì¸ í›„ ì ‘ìˆ˜)<br>
          â€¢ CJ íŒ¨í‚¤ì§€ ë‹¨ê°€í‘œ ì´ˆì•ˆ ì‘ì„± â†’ ì¬ë¬´ë¶€ ê²€í†  ìš”ì²­
        </div>

        <!-- ì—°ê²° ì •ë³´ -->
        <div style="border-top:1px solid #eef0f4;padding-top:16px;margin-top:16px">
          <div style="font-size:12px;font-weight:700;color:#1a2332;margin-bottom:10px">ğŸ”— ì—°ê²°ëœ ì •ë³´</div>
          <div style="display:flex;gap:10px;flex-wrap:wrap">
            <div style="background:#e3f2fd;border:1px solid #bbdefb;border-radius:8px;padding:10px 14px;font-size:12px;cursor:pointer;display:flex;align-items:center;gap:6px" onclick="showPage('vehicle')">
              ğŸš— <b>ì°¨ëŸ‰ì¼ì§€</b> â€” ì„œìš¸(ì¤‘êµ¬) ì™•ë³µ 42km
              <span style="color:#1565c0;font-size:10px">ë³´ê¸° â†’</span>
            </div>
            <div style="background:#f8f9fb;border:1px solid #e2e6ed;border-radius:8px;padding:10px 14px;font-size:12px;cursor:pointer;display:flex;align-items:center;gap:6px" onclick="showPage('customerList')">
              ğŸ¢ <b>CJì œì¼ì œë‹¹(ì£¼)</b> â€” ê³ ê°ì‚¬ ì •ë³´
              <span style="color:#5f6b7a;font-size:10px">ë³´ê¸° â†’</span>
            </div>
          </div>
        </div>
      </div></div>
    </div>

    <!-- ===== ì°¨ëŸ‰ì¼ì§€ ===== -->
    <div class="page" id="page-vehicle" style="display:none">
      <!-- ì„¤ì • ì¹´ë“œ -->
      <div class="card" style="margin-bottom:16px">
        <div class="card-hd">
          <h3>âš™ï¸ ì°¨ëŸ‰ì¼ì§€ ì„¤ì •</h3>
          <div class="right"><button class="btn btn-sm btn-secondary" onclick="toast('âœ… ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤')">ì„¤ì • ì €ì¥</button></div>
        </div>
        <div class="card-bd">
          <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:16px">
            <div class="fg" style="margin:0">
              <label>ğŸ¢ íšŒì‚¬ ì£¼ì†Œ (ê¸°ë³¸ ì¶œë°œì§€/ë„ì°©ì§€)</label>
              <input value="ê²½ê¸°ë„ í™”ì„±ì‹œ ë™íƒ„ëŒ€ë¡œ 123 ë°”ì´ì˜¤í‘¸ë“œë©" style="background:#f8f9fb;font-size:12px" readonly>
              <div class="hint">ê´€ë¦¬ì > ì‹œìŠ¤í…œ ì„¤ì •ì—ì„œ ë³€ê²½</div>
            </div>
            <div class="fg" style="margin:0">
              <label>ğŸ  ìíƒ ì£¼ì†Œ (í˜„ì§€ì¶œê·¼/í‡´ê·¼ìš©)</label>
              <input id="vHomeAddr" placeholder="ìíƒ ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”" style="font-size:12px" value="ì„œìš¸ ê°•ë‚¨êµ¬ ì—­ì‚¼ë™ 123">
              <div class="hint">ê°œì¸ ì„¤ì • Â· ê±°ë¦¬ ê³„ì‚°ì— ì‚¬ìš©</div>
            </div>
            <div class="fg" style="margin:0">
              <label>ğŸš— ì°¨ëŸ‰ ë²ˆí˜¸</label>
              <input value="12ê°€ 3456" style="font-size:12px">
              <div class="hint">ê¸°ë³¸ ì°¨ëŸ‰ Â· ì—…ë¬´ì¼ì§€ ì—°ë™ ì‹œ ìë™ ì…ë ¥</div>
            </div>
          </div>
          <div style="margin-top:10px;padding:8px 12px;background:#fff3e0;border-radius:8px;font-size:11px;color:#e65100;display:flex;align-items:center;gap:6px">
            <span>ğŸ“</span> ì£¼í–‰ê±°ë¦¬ëŠ” <b>ì¹´ì¹´ì˜¤ëª¨ë¹Œë¦¬í‹° ê¸¸ì°¾ê¸° API</b>ë¡œ ìë™ ê³„ì‚°ë©ë‹ˆë‹¤ (ë¬´ë£Œ ì¼ 10,000ê±´). ìë™ ê³„ì‚° í›„ ìˆ˜ë™ ì¡°ì •ë„ ê°€ëŠ¥í•©ë‹ˆë‹¤.
          </div>
        </div>
      </div>

      <!-- ëª©ë¡ -->
      <div class="card">
        <div class="card-hd">
          <h3>ğŸš— ì°¨ëŸ‰ì¼ì§€</h3>
          <div class="right">
            <span style="font-size:11px;color:#1565c0;background:#e3f2fd;padding:4px 10px;border-radius:6px">ğŸ”— ì—…ë¬´ì¼ì§€ ë°©ë¬¸ ê¸°ë¡ì—ì„œ ìë™ ìƒì„±</span>
          </div>
        </div>
        <!-- í•„í„° -->
        <div style="padding:12px 20px;border-bottom:1px solid #eef0f4;display:flex;gap:10px;flex-wrap:wrap;align-items:center;background:#fafbfc">
          <input type="date" value="2026-02-10" style="padding:7px 10px;border:1px solid #e2e6ed;border-radius:6px;font-size:12px">
          <span style="color:#c8d6e5">~</span>
          <input type="date" value="2026-02-13" style="padding:7px 10px;border:1px solid #e2e6ed;border-radius:6px;font-size:12px">
          <select style="padding:7px 10px;border:1px solid #e2e6ed;border-radius:6px;font-size:12px;background:#fff">
            <option>ì „ì²´ ìš´ì „ì</option><option selected>ì´ì£¼ì„</option><option>ê¹€ì˜ì—…</option>
          </select>
          <div style="margin-left:auto;display:flex;align-items:center;gap:12px;font-size:12px">
            <span style="color:#5f6b7a">í•©ê³„:</span>
            <span style="font-weight:700;color:#1a2332">1,002 km</span>
            <span style="color:#8892a4">|</span>
            <span style="color:#e65100;font-weight:600">ì£¼ìœ ë¹„ 165,000</span>
            <span style="color:#8892a4">|</span>
            <span style="color:#1565c0;font-weight:600">í†µí–‰ë£Œ 49,600</span>
          </div>
        </div>
        <div class="card-bd" style="padding:0;overflow-x:auto">
          <table class="tbl">
            <thead>
              <tr>
                <th>ë‚ ì§œ</th><th>ìš´ì „ì</th><th>ì°¨ëŸ‰</th>
                <th>ì¶œë°œì§€</th><th>ê²½ë¡œ</th><th>ë„ì°©ì§€</th>
                <th style="text-align:right">ì£¼í–‰(km)</th>
                <th style="text-align:center">ì¡°ì •</th>
                <th style="text-align:right">ì£¼ìœ ë¹„</th><th style="text-align:right">í†µí–‰ë£Œ</th>
                <th style="width:40px"></th>
              </tr>
            </thead>
            <tbody>
              <!-- 2/13 íšŒì‚¬â†’ì¤‘êµ¬â†’íšŒì‚¬ -->
              <tr>
                <td><b>2026-02-13</b></td><td>ì´ì£¼ì„</td><td>12ê°€ 3456</td>
                <td><span class="tag" style="background:#e3f2fd;color:#1565c0">ğŸ¢ íšŒì‚¬</span></td>
                <td>
                  <div class="route">
                    <div class="route-stop">ì„œìš¸(ì¤‘êµ¬)</div>
                  </div>
                </td>
                <td><span class="tag" style="background:#e3f2fd;color:#1565c0">ğŸ¢ íšŒì‚¬</span></td>
                <td style="text-align:right;font-weight:700">42</td>
                <td style="text-align:center"><span style="font-size:10px;color:#2e7d32;background:#e8f5e9;padding:1px 6px;border-radius:4px">API</span></td>
                <td style="text-align:right">-</td>
                <td style="text-align:right">4,800</td>
                <td class="center"><span style="cursor:pointer;font-size:12px" onclick="toast('âœï¸ ìˆ˜ì • ëª¨ë“œ')">âœï¸</span></td>
              </tr>
              <!-- 2/12 íšŒì‚¬â†’ê°•ë‚¨â†’ì–‘ì²œâ†’íšŒì‚¬ -->
              <tr>
                <td><b>2026-02-12</b></td><td>ì´ì£¼ì„</td><td>12ê°€ 3456</td>
                <td><span class="tag" style="background:#e3f2fd;color:#1565c0">ğŸ¢ íšŒì‚¬</span></td>
                <td>
                  <div class="route">
                    <div class="route-stop">ì„œìš¸(ê°•ë‚¨êµ¬)</div>
                    <span class="route-arrow">â†’</span>
                    <div class="route-stop">ì„œìš¸(ì–‘ì²œêµ¬)</div>
                  </div>
                </td>
                <td><span class="tag" style="background:#e3f2fd;color:#1565c0">ğŸ¢ íšŒì‚¬</span></td>
                <td style="text-align:right;font-weight:700">68</td>
                <td style="text-align:center"><span style="font-size:10px;color:#2e7d32;background:#e8f5e9;padding:1px 6px;border-radius:4px">API</span></td>
                <td style="text-align:right">45,000</td>
                <td style="text-align:right">6,400</td>
                <td class="center"><span style="cursor:pointer;font-size:12px" onclick="toast('âœï¸ ìˆ˜ì • ëª¨ë“œ')">âœï¸</span></td>
              </tr>
              <!-- 2/11 í˜„ì§€ì¶œê·¼â†’ì¤‘êµ¬â†’ì¸ì²œâ†’ë¶€ì‚°â†’ìíƒ (ìˆ˜ë™ ì¡°ì • ì˜ˆì‹œ) -->
              <tr style="background:#fffde7">
                <td><b>2026-02-11</b></td><td>ì´ì£¼ì„</td><td>12ê°€ 3456</td>
                <td><span class="tag" style="background:#f3e5f5;color:#7b1fa2">ğŸ  í˜„ì§€ì¶œê·¼</span></td>
                <td>
                  <div class="route">
                    <div class="route-stop">ì„œìš¸(ì¤‘êµ¬)</div>
                    <span class="route-arrow">â†’</span>
                    <div class="route-stop">ì¸ì²œ(ì—°ìˆ˜êµ¬)</div>
                    <span class="route-arrow">â†’</span>
                    <div class="route-stop">ë¶€ì‚°(í•´ìš´ëŒ€êµ¬)</div>
                  </div>
                </td>
                <td><span class="tag" style="background:#f3e5f5;color:#7b1fa2">ğŸ  ìíƒ</span></td>
                <td style="text-align:right;font-weight:700;color:#e65100">
                  <span style="text-decoration:line-through;color:#8892a4;font-weight:400;font-size:10px">878</span>
                  892
                </td>
                <td style="text-align:center"><span style="font-size:10px;color:#e65100;background:#fff3e0;padding:1px 6px;border-radius:4px">ìˆ˜ë™</span></td>
                <td style="text-align:right">120,000</td>
                <td style="text-align:right">38,400</td>
                <td class="center"><span style="cursor:pointer;font-size:12px" onclick="toast('âœï¸ ìˆ˜ì • ëª¨ë“œ')">âœï¸</span></td>
              </tr>
            </tbody>
          </table>
        </div>
        <!-- ë²”ë¡€ -->
        <div style="padding:10px 20px;border-top:1px solid #eef0f4;display:flex;gap:16px;flex-wrap:wrap;font-size:10px;color:#8892a4">
          <span><span class="tag" style="background:#e3f2fd;color:#1565c0;font-size:9px">ğŸ¢ íšŒì‚¬</span> íšŒì‚¬ ì¶œë°œ/ë„ì°©</span>
          <span><span class="tag" style="background:#f3e5f5;color:#7b1fa2;font-size:9px">ğŸ  í˜„ì§€ì¶œê·¼</span> ìíƒ ì¶œë°œ/ë„ì°©</span>
          <span><span style="background:#e8f5e9;padding:1px 6px;border-radius:4px;font-size:9px;color:#2e7d32">API</span> ì¹´ì¹´ì˜¤ ê¸¸ì°¾ê¸° ìë™ê³„ì‚°</span>
          <span><span style="background:#fff3e0;padding:1px 6px;border-radius:4px;font-size:9px;color:#e65100">ìˆ˜ë™</span> ìš´ì „ìê°€ ì§ì ‘ ì¡°ì •</span>
        </div>
      </div>
    </div>

    <!-- ===== ë¯¸ìˆ˜ê¸ˆ í™œë™ ë‚´ì—­ ===== -->
    <div class="page" id="page-collection" style="display:none">
      <div class="card">
        <div class="card-hd">
          <h3>ğŸ“ ë¯¸ìˆ˜ê¸ˆ í™œë™ ë‚´ì—­</h3>
          <div class="right">
            <select style="padding:7px 10px;border:1px solid #e2e6ed;border-radius:8px;font-size:12px">
              <option>í’€ë¬´ì›ì‹í’ˆ(ì£¼) â€” ğŸŸ  ì£¼í™©</option>
              <option>(ì£¼)ì˜¤ëšœê¸° â€” ğŸŸ¡ ë…¸ë‘</option>
              <option>(ì£¼)ì‚¼ì–‘ì‹í’ˆ â€” ğŸ”´ ë¹¨ê°•</option>
            </select>
            <button class="btn btn-primary">+ ìˆ˜ê¸ˆ í™œë™ ê¸°ë¡</button>
          </div>
        </div>
        <div class="card-bd">
          <div style="display:flex;gap:16px;margin-bottom:16px;flex-wrap:wrap">
            <div style="background:#fff3e0;border:1px solid #ffcc80;border-radius:10px;padding:12px 20px;flex:1;min-width:140px;text-align:center">
              <div style="font-size:10px;color:#e65100">ë¯¸ìˆ˜ê¸ˆì•¡</div>
              <div style="font-size:20px;font-weight:800;color:#e65100">4,500,000ì›</div>
            </div>
            <div style="background:#fce4ec;border:1px solid #ef9a9a;border-radius:10px;padding:12px 20px;flex:1;min-width:140px;text-align:center">
              <div style="font-size:10px;color:#c62828">ì—°ì²´ì¼</div>
              <div style="font-size:20px;font-weight:800;color:#c62828">68ì¼</div>
            </div>
            <div style="background:#e3f2fd;border:1px solid #90caf9;border-radius:10px;padding:12px 20px;flex:1;min-width:140px;text-align:center">
              <div style="font-size:10px;color:#1565c0">ìˆ˜ê¸ˆ ì‹œë„</div>
              <div style="font-size:20px;font-weight:800;color:#1565c0">5íšŒ</div>
            </div>
            <div style="background:#f3e5f5;border:1px solid #ce93d8;border-radius:10px;padding:12px 20px;flex:1;min-width:140px;text-align:center">
              <div style="font-size:10px;color:#7b1fa2">ì…ê¸ˆ ì•½ì†ì¼</div>
              <div style="font-size:20px;font-weight:800;color:#7b1fa2">02/20</div>
            </div>
          </div>

          <div class="timeline">
            <div class="tl-item sys">
              <div class="tl-date">2026-02-13 09:00 Â· ì‹œìŠ¤í…œ</div>
              <div class="tl-content">ğŸš¦ <strong>ì‹ í˜¸ë“± ë³€ê²½:</strong> ë…¸ë‘ â†’ <span style="color:#e65100;font-weight:700">ì£¼í™©</span> (ì—°ì²´ 68ì¼, ë¯¸ì—°ê²° 2íšŒ)</div>
            </div>
            <div class="tl-item">
              <div class="tl-date">2026-02-12 14:30 Â· ì´ì£¼ì„</div>
              <div class="tl-content">ì´ê·œì„± ê³¼ì¥ì—ê²Œ ì „í™” ì—°ê²° ì„±ê³µ. "ì´ë²ˆ ë‹¬ 20ì¼ê¹Œì§€ ì…ê¸ˆí•˜ê² ë‹¤"ê³  ì•½ì†.</div>
              <div class="tl-tags">
                <span class="tl-tag tl-tag-call">ğŸ“ ì „í™”</span>
                <span class="tl-tag tl-tag-connected">âœ… ì—°ê²°</span>
                <span class="tl-tag" style="background:#e8f5e9;color:#2e7d32">ğŸ“… ì•½ì†: 02/20</span>
              </div>
            </div>
            <div class="tl-item">
              <div class="tl-date">2026-02-10 11:15 Â· ì´ì£¼ì„</div>
              <div class="tl-content">ì „í™” ì—°ê²° ì•ˆë¨. ë¬¸ì ë°œì†¡ â€” "ë¯¸ìˆ˜ê¸ˆ í™•ì¸ ë¶€íƒë“œë¦½ë‹ˆë‹¤."</div>
              <div class="tl-tags">
                <span class="tl-tag tl-tag-call">ğŸ“ ì „í™”</span>
                <span class="tl-tag tl-tag-missed">âŒ ë¯¸ì—°ê²°</span>
                <span class="tl-tag tl-tag-sms">ğŸ’¬ ë¬¸ì ë°œì†¡</span>
              </div>
            </div>
            <div class="tl-item">
              <div class="tl-date">2026-02-05 16:00 Â· ì´ì£¼ì„</div>
              <div class="tl-content">ì´ê·œì„± ê³¼ì¥ ì „í™” ìˆ˜ì‹  ê±°ì ˆ.</div>
              <div class="tl-tags">
                <span class="tl-tag tl-tag-call">ğŸ“ ì „í™”</span>
                <span class="tl-tag tl-tag-refused">ğŸš« ìˆ˜ì‹ ê±°ì ˆ</span>
              </div>
            </div>
            <div class="tl-item">
              <div class="tl-date">2026-01-28 10:00 Â· ì´ì£¼ì„</div>
              <div class="tl-content">ì¹´ì¹´ì˜¤í†¡ ë©”ì‹œì§€ ë°œì†¡. ì½ìŒ í™•ì¸ë¨. íšŒì‹  ì—†ìŒ.</div>
              <div class="tl-tags">
                <span class="tl-tag" style="background:#fff9c4;color:#f57f17">ğŸ’¬ ì¹´ì¹´ì˜¤í†¡</span>
                <span class="tl-tag tl-tag-missed">íšŒì‹  ì—†ìŒ</span>
              </div>
            </div>
            <div class="tl-item">
              <div class="tl-date">2026-01-20 09:30 Â· ì´ì£¼ì„</div>
              <div class="tl-content">ì „í™” ì—°ê²°. ê¹€ë¶€ì¥ "ë‹¤ìŒ ë‹¬ ì´ˆ ì²˜ë¦¬í•˜ê² ë‹¤" ì‘ë‹µ. (ë¯¸ì´í–‰)</div>
              <div class="tl-tags">
                <span class="tl-tag tl-tag-call">ğŸ“ ì „í™”</span>
                <span class="tl-tag tl-tag-connected">âœ… ì—°ê²°</span>
                <span class="tl-tag" style="background:#fce4ec;color:#c62828">âŒ ì•½ì† ë¯¸ì´í–‰</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ===== ê²¬ì ì„œ ê´€ë¦¬ ===== -->
    <div class="page" id="page-estimate" style="display:none">
      <div class="card"><div class="card-bd" style="text-align:center;padding:60px">
        <div style="font-size:48px;margin-bottom:12px">â¸ï¸</div>
        <div style="font-size:16px;font-weight:700;color:#e65100;margin-bottom:8px">ì¶”í›„ ê²€í†  í•­ëª©</div>
        <div style="font-size:13px;color:#5f6b7a">í™ˆí˜ì´ì§€ ê¸°ì¡´ ê¸°ëŠ¥ í™œìš© ì˜ˆì •<br>ë‹¨ê°€ëŠ” ê²€ì‚¬í•­ëª© DB ìë™ ì—°ë™ ë°©ì‹ìœ¼ë¡œ êµ¬í˜„ ì˜ˆì •</div>
      </div></div>
    </div>

    <!-- ===== ê±°ë˜ëª…ì„¸í‘œ ê´€ë¦¬ ===== -->
    <div class="page" id="page-trade" style="display:none">
      <div class="card">
        <div class="card-hd"><h3>ğŸ“„ ê±°ë˜ëª…ì„¸í‘œ ê´€ë¦¬</h3><div class="right"><button class="btn btn-secondary btn-sm">ğŸ“… ì›”ë³„ ì¼ê´„ ë°œí–‰</button><button class="btn btn-primary btn-sm">+ ê±°ë˜ëª…ì„¸í‘œ ì‘ì„±</button></div></div>
        <div class="card-bd" style="padding:0;overflow-x:auto">
          <table class="tbl">
            <thead><tr><th>ë°œí–‰ì¼</th><th>ê±°ë˜ëª…ì„¸í‘œ ë²ˆí˜¸</th><th>ì—…ì²´ëª…</th><th>í•­ëª© ìˆ˜</th><th>ê¸ˆì•¡(í•©ê³„)</th><th>ìƒíƒœ</th><th>ë¹„ê³ </th></tr></thead>
            <tbody>
              <tr><td>2026-02-10</td><td>TM-2026-0213</td><td>CJì œì¼ì œë‹¹(ì£¼)</td><td>4ê±´</td><td style="text-align:right">2,200,000</td><td><span class="tag tag-approved">ë°œì†¡ì™„ë£Œ</span></td><td><button class="btn btn-secondary btn-sm">PDF</button> <button class="btn btn-secondary btn-sm">ğŸ“§</button></td></tr>
              <tr><td>2026-02-08</td><td>TM-2026-0198</td><td>(ì£¼)ë†ì‹¬</td><td>2ê±´</td><td style="text-align:right">880,000</td><td><span class="tag tag-approved">ë°œì†¡ì™„ë£Œ</span></td><td><button class="btn btn-secondary btn-sm">PDF</button></td></tr>
              <tr><td>2026-02-05</td><td>TM-2026-0185</td><td>ë™ì›F&B(ì£¼)</td><td>3ê±´</td><td style="text-align:right">1,500,000</td><td><span class="tag tag-pending">ëŒ€ê¸°</span></td><td><button class="btn btn-secondary btn-sm">PDF</button> <button class="btn btn-primary btn-sm">ğŸ“§ ë°œì†¡</button></td></tr>
            </tbody>
          </table>
        </div>
      </div>
      <div style="background:#fff3e0;border:1px solid #ffcc80;border-radius:10px;padding:12px 16px;font-size:12px;color:#e65100">
        âš ï¸ ì„¸ë¶€ êµ¬í˜„ì€ <strong>ì ‘ìˆ˜ê´€ë¦¬</strong> ì™„ì„± í›„ êµ¬ì²´í™” ì˜ˆì • â€” ì ‘ìˆ˜ ì™„ë£Œ ì‹œ ìë™ ìƒì„±
      </div>
    </div>

    <!-- ===== ê¸´ê¸‰ í˜‘ì¡° ìš”ì²­ ===== -->
    <div class="page" id="page-urgent" style="display:none">
      <div class="card"><div class="card-bd" style="text-align:center;padding:60px">
        <div style="font-size:48px;margin-bottom:12px">â¸ï¸</div>
        <div style="font-size:16px;font-weight:700;color:#e65100;margin-bottom:8px">ì¶”í›„ ê²€í†  í•­ëª©</div>
        <div style="font-size:13px;color:#5f6b7a">ê²€ì‚¬ ëª©ì ë³„ í‘œê¸° í•­ëª©ì´ ë‹¤ë¥´ë¯€ë¡œ ë°˜ì˜ í•„ìš”<br>ê¸°ëŠ¥ ë°©í–¥: ìš”ì²­ ë“±ë¡, í˜„í™© ì¡°íšŒ(ëŒ€ê¸°/ì²˜ë¦¬ì¤‘/ì™„ë£Œ), ë‹´ë‹¹ì ë°°ì •, ì™„ë£Œ ì•Œë¦¼</div>
      </div></div>
    </div>

    <!-- ===== ì„¸ê¸ˆê³„ì‚°ì„œë¯¸ë°œí–‰ ===== -->
    <div class="page" id="page-arManage" style="display:none">
      <div class="card"><div class="card-bd" style="text-align:center;padding:60px">
        <div style="font-size:48px;margin-bottom:12px">â¸ï¸</div>
        <div style="font-size:16px;font-weight:700;color:#e65100;margin-bottom:8px">ì¶”í›„ ê²€í†  í•­ëª©</div>
        <div style="font-size:13px;color:#5f6b7a">ì¬ë¬´ê´€ë¦¬ ì„¤ê³„ í›„ êµ¬ì²´í™” ì˜ˆì •</div>
      </div></div>
    </div>

    <!-- ===== ê³„ì‚°ì„œ ë°œí–‰ ìŠ¹ì¸ ===== -->
    <div class="page" id="page-invoice" style="display:none">
      <div class="stats">
        <div class="stat"><div class="stat-val">12</div><div class="stat-label">ì´ë²ˆ ë‹¬ ìš”ì²­</div></div>
        <div class="stat"><div class="stat-val" style="color:#e65100">3</div><div class="stat-label">ëŒ€ê¸°</div></div>
        <div class="stat"><div class="stat-val" style="color:#2e7d32">8</div><div class="stat-label">ìŠ¹ì¸</div></div>
        <div class="stat"><div class="stat-val" style="color:#e53935">1</div><div class="stat-label">ë°˜ë ¤</div></div>
      </div>
      <div class="card">
        <div class="card-hd"><h3>ğŸ§¾ ê³„ì‚°ì„œ ë°œí–‰ ìŠ¹ì¸ìš”ì²­</h3><div class="right"><button class="btn btn-primary">+ ìŠ¹ì¸ ìš”ì²­</button></div></div>
        <div class="card-bd">
          <div style="background:#f8f9fb;border:1px solid #eef0f4;border-radius:10px;padding:14px;margin-bottom:16px">
            <div style="font-size:12px;font-weight:700;margin-bottom:8px">ìŠ¹ì¸ íë¦„</div>
            <div class="approval-flow">
              <div class="af-step" style="background:#e3f2fd;color:#1565c0">ì˜ì—…ì‚¬ì›<br><small>ìš”ì²­</small></div>
              <span class="af-arr">â†’</span>
              <div class="af-step" style="background:#fff3e0;color:#e65100">ì¬ë¬´ë¶€<br><small>ê²€í† </small></div>
              <span class="af-arr">â†’</span>
              <div class="af-step" style="background:#e8f5e9;color:#2e7d32">ìŠ¹ì¸</div>
              <span class="af-arr">â†’</span>
              <div class="af-step" style="background:#f3e5f5;color:#7b1fa2">ì„¸ê¸ˆê³„ì‚°ì„œ<br><small>ìë™ ë°œí–‰</small></div>
            </div>
          </div>
          <table class="tbl">
            <thead><tr><th>ìš”ì²­ì¼</th><th>ì—…ì²´ëª…</th><th>ê¸ˆì•¡</th><th>ë°œí–‰ì‚¬ìœ </th><th>ìƒíƒœ</th><th>ì²˜ë¦¬ì</th><th>ì²˜ë¦¬ì¼</th></tr></thead>
            <tbody>
              <tr><td>2026-02-13</td><td>CJì œì¼ì œë‹¹(ì£¼)</td><td style="text-align:right">2,200,000</td><td>ì›” ì •ê¸° ê²€ì‚¬ ë¹„ìš©</td><td><span class="tag tag-pending">ëŒ€ê¸°</span></td><td>-</td><td>-</td></tr>
              <tr><td>2026-02-12</td><td>ë™ì›F&B(ì£¼)</td><td style="text-align:right">1,500,000</td><td>ê¸´ê¸‰ ê²€ì‚¬ ë¹„ìš©</td><td><span class="tag tag-pending">ëŒ€ê¸°</span></td><td>-</td><td>-</td></tr>
              <tr><td>2026-02-10</td><td>(ì£¼)ë†ì‹¬</td><td style="text-align:right">880,000</td><td>ì˜ì–‘ì„±ë¶„ ë¶„ì„ ë¹„ìš©</td><td><span class="tag tag-approved">ìŠ¹ì¸</span></td><td>ì¬ë¬´ë¶€ ê¹€ê³¼ì¥</td><td>2026-02-11</td></tr>
              <tr><td>2026-02-08</td><td>(ì£¼)ì˜¤ëšœê¸°</td><td style="text-align:right">650,000</td><td>ìœ í†µê¸°í•œ ì—°ì¥ ê²€ì‚¬</td><td><span class="tag tag-approved">ìŠ¹ì¸</span></td><td>ì¬ë¬´ë¶€ ê¹€ê³¼ì¥</td><td>2026-02-09</td></tr>
              <tr style="background:#fce4ec"><td>2026-02-05</td><td>í’€ë¬´ì›ì‹í’ˆ(ì£¼)</td><td style="text-align:right">4,500,000</td><td>ë¯¸ìˆ˜ê¸ˆ ì •ì‚° ìš”ì²­</td><td><span class="tag tag-rejected">ë°˜ë ¤</span></td><td>ì¬ë¬´ë¶€ ê¹€ê³¼ì¥</td><td>2026-02-06</td></tr>
              <tr><td colspan="7" style="background:#fce4ec;font-size:11px;color:#c62828;padding:6px 14px">â†³ ë°˜ë ¤ ì‚¬ìœ : ë¯¸ìˆ˜ê¸ˆ ì—…ì²´ â€” ìˆ˜ê¸ˆ í™œë™ ê¸°ë¡ í›„ ì¬ìš”ì²­ ë°”ëë‹ˆë‹¤.</td></tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- ===== API ìˆ˜ì§‘ ì„¤ì • ===== -->
    <div class="page" id="page-apiSettings" style="display:none">

      <!-- ìƒë‹¨ ìš”ì•½ -->
      <div class="stats">
        <div class="stat"><div class="stat-val" id="apiTotalCount">16</div><div class="stat-label">ì „ì²´ API</div></div>
        <div class="stat"><div class="stat-val" style="color:#2e7d32" id="apiActiveCount">0</div><div class="stat-label">ìˆ˜ì§‘ í™œì„±</div></div>
        <div class="stat"><div class="stat-val" style="color:#1a73e8" id="apiLastCollect">-</div><div class="stat-label">ìµœê·¼ ìˆ˜ì§‘</div></div>
        <div class="stat"><div class="stat-val" style="color:#e65100" id="apiNextCollect">03:00</div><div class="stat-label">ë‹¤ìŒ ìˆ˜ì§‘(KST)</div></div>
      </div>

      <!-- ìˆ˜ì§‘ ì‹œê°„ ì„¤ì • -->
      <div class="card" style="margin-bottom:16px">
        <div class="card-hd"><h3>ğŸ• ìˆ˜ì§‘ ìŠ¤ì¼€ì¤„ ì„¤ì •</h3></div>
        <div class="card-bd">
          <div style="display:flex;gap:24px;align-items:center;flex-wrap:wrap">
            <div style="display:flex;align-items:center;gap:8px">
              <label style="font-size:13px;font-weight:600;white-space:nowrap">ìˆ˜ì§‘ ì‹œê° (KST):</label>
              <input type="time" id="collectTime" value="03:00" style="padding:8px 12px;border:1px solid #dde2ea;border-radius:6px;font-size:14px;font-weight:600;width:120px">
            </div>
            <div style="display:flex;align-items:center;gap:8px">
              <label style="font-size:13px;font-weight:600;white-space:nowrap">ìˆ˜ì§‘ ë°©ì‹:</label>
              <select id="collectMode" style="padding:8px 12px;border:1px solid #dde2ea;border-radius:6px;font-size:13px">
                <option value="incremental">ì¦ë¶„ ìˆ˜ì§‘ (ë³€ê²½ë¶„ë§Œ)</option>
                <option value="full">ì „ì²´ ìˆ˜ì§‘ (ë§¤ì¼ ì „ì²´)</option>
              </select>
            </div>
            <div style="display:flex;align-items:center;gap:8px">
              <label style="font-size:13px;font-weight:600;white-space:nowrap">API ì„œë²„:</label>
              <input type="text" id="apiServerUrl" value="http://localhost:5050" placeholder="http://ì„œë²„IP:5050" style="padding:8px 12px;border:1px solid #dde2ea;border-radius:6px;font-size:12px;font-family:monospace;width:200px">
            </div>
          </div>
          <div style="margin-top:12px;display:flex;gap:8px">
            <button class="btn btn-primary" onclick="saveApiSettings()" style="padding:8px 20px">ğŸ’¾ ì„¤ì • ì €ì¥</button>
            <button class="btn btn-secondary" onclick="testApiConnection()" style="padding:8px 20px">ğŸ”Œ ì—°ê²° í…ŒìŠ¤íŠ¸</button>
            <button class="btn btn-secondary" onclick="checkAllApis(true)" style="padding:8px 16px">â˜‘ï¸ ì „ì²´ ì„ íƒ</button>
            <button class="btn btn-secondary" onclick="checkAllApis(false)" style="padding:8px 16px">â¬œ ì „ì²´ í•´ì œ</button>
          </div>
        </div>
      </div>

      <!-- API ì¹´í…Œê³ ë¦¬ 1: ì—…ì†Œ ì¸í—ˆê°€ -->
      <div class="card" style="margin-bottom:16px">
        <div class="card-hd" style="cursor:pointer" onclick="toggleApiGroup('grpBiz')">
          <h3>ğŸ­ ì—…ì†Œ ì¸í—ˆê°€ ëŒ€ì¥ <span style="font-size:12px;font-weight:400;color:#8892a4">(9ê°œ API)</span></h3>
          <div class="right"><span id="grpBizArrow" style="font-size:16px">â–¼</span></div>
        </div>
        <div class="card-bd" id="grpBiz">

          <div class="api-item" id="api-I1220">
            <div class="api-header">
              <label class="api-check"><input type="checkbox" checked onchange="updateApiCount()"><strong>I1220</strong> â€” ì‹í’ˆì œì¡°ê°€ê³µì—…</label>
              <span class="api-count">~30,279ê±´</span>
            </div>
            <div class="api-fields">
              <span class="api-tag" title="ì¸í—ˆê°€ë²ˆí˜¸">LCNS_NO</span>
              <span class="api-tag" title="ì—…ì†Œëª…">BSSH_NM</span>
              <span class="api-tag" title="ëŒ€í‘œìëª…">PRSDNT_NM</span>
              <span class="api-tag" title="ì—…ì¢…">INDUTY_NM</span>
              <span class="api-tag" title="í—ˆê°€ì¼ì">PRMS_DT</span>
              <span class="api-tag" title="ì „í™”ë²ˆí˜¸">TELNO</span>
              <span class="api-tag" title="ì£¼ì†Œ">LOCP_ADDR</span>
              <span class="api-tag" title="ê¸°ê´€ëª…">INSTT_NM</span>
            </div>
          </div>

          <div class="api-item" id="api-I2829">
            <div class="api-header">
              <label class="api-check"><input type="checkbox" checked onchange="updateApiCount()"><strong>I2829</strong> â€” ì¦‰ì„íŒë§¤ì œì¡°ê°€ê³µì—…</label>
              <span class="api-count">~97,696ê±´</span>
            </div>
            <div class="api-fields">
              <span class="api-tag">LCNS_NO</span><span class="api-tag">BSSH_NM</span><span class="api-tag">PRSDNT_NM</span><span class="api-tag">INDUTY_NM</span><span class="api-tag">PRMS_DT</span><span class="api-tag">LOCP_ADDR</span><span class="api-tag">INSTT_NM</span>
            </div>
          </div>

          <div class="api-item" id="api-I-0020">
            <div class="api-header">
              <label class="api-check"><input type="checkbox" checked onchange="updateApiCount()"><strong>I-0020</strong> â€” ê±´ê°•ê¸°ëŠ¥ì‹í’ˆ ì „ë¬¸/ë²¤ì²˜ì œì¡°ì—…</label>
              <span class="api-count">~551ê±´</span>
            </div>
            <div class="api-fields">
              <span class="api-tag">LCNS_NO</span><span class="api-tag">BSSH_NM</span><span class="api-tag">PRSDNT_NM</span><span class="api-tag">INDUTY_NM</span><span class="api-tag">PRMS_DT</span><span class="api-tag">TELNO</span><span class="api-tag">LOCP_ADDR</span>
            </div>
          </div>

          <div class="api-item" id="api-I1300">
            <div class="api-header">
              <label class="api-check"><input type="checkbox" checked onchange="updateApiCount()"><strong>I1300</strong> â€” ì¶•ì‚°ë¬¼ ê°€ê³µì—…</label>
              <span class="api-count">~4,233ê±´</span>
            </div>
            <div class="api-fields">
              <span class="api-tag">LCNS_NO</span><span class="api-tag">BSSH_NM</span><span class="api-tag">PRSDNT_NM</span><span class="api-tag">INDUTY_NM</span><span class="api-tag">PRMS_DT</span><span class="api-tag">LOCP_ADDR</span><span class="api-tag">INSTT_NM</span><span class="api-tag">TELNO</span>
            </div>
          </div>

          <div class="api-item" id="api-I1320">
            <div class="api-header">
              <label class="api-check"><input type="checkbox" checked onchange="updateApiCount()"><strong>I1320</strong> â€” ì¶•ì‚°ë¬¼ ì‹ìœ¡í¬ì¥ì²˜ë¦¬ì—…</label>
              <span class="api-count">í™•ì¸í•„ìš”</span>
            </div>
            <div class="api-fields">
              <span class="api-tag">LCNS_NO</span><span class="api-tag">BSSH_NM</span><span class="api-tag">PRSDNT_NM</span><span class="api-tag">INDUTY_NM</span><span class="api-tag">CLSBIZ_DVS_NM</span><span class="api-tag">PRMS_DT</span><span class="api-tag">LOCP_ADDR</span><span class="api-tag">INSTT_NM</span><span class="api-tag">TELNO</span>
            </div>
          </div>

          <div class="api-item" id="api-I2835">
            <div class="api-header">
              <label class="api-check"><input type="checkbox" checked onchange="updateApiCount()"><strong>I2835</strong> â€” ì‹ìœ¡ì¦‰ì„íŒë§¤ê°€ê³µì—…</label>
              <span class="api-count">í™•ì¸í•„ìš”</span>
            </div>
            <div class="api-fields">
              <span class="api-tag">LCNS_NO</span><span class="api-tag">BSSH_NM</span><span class="api-tag">PRSDNT_NM</span><span class="api-tag">INDUTY_NM</span><span class="api-tag">PRMS_DT</span><span class="api-tag">LOCP_ADDR</span><span class="api-tag">INSTT_NM</span>
            </div>
          </div>

          <div class="api-item" id="api-I2831">
            <div class="api-header">
              <label class="api-check"><input type="checkbox" checked onchange="updateApiCount()"><strong>I2831</strong> â€” ì‹í’ˆì†Œë¶„ì—…</label>
              <span class="api-count">í™•ì¸í•„ìš”</span>
            </div>
            <div class="api-fields">
              <span class="api-tag">LCNS_NO</span><span class="api-tag">BSSH_NM</span><span class="api-tag">PRSDNT_NM</span><span class="api-tag">INDUTY_NM</span><span class="api-tag">PRMS_DT</span><span class="api-tag">LOCP_ADDR</span><span class="api-tag">INSTT_NM</span>
            </div>
          </div>

          <div class="api-item" id="api-C001">
            <div class="api-header">
              <label class="api-check"><input type="checkbox" checked onchange="updateApiCount()"><strong>C001</strong> â€” ìˆ˜ì…ì‹í’ˆë“±ì˜ì—…ì‹ ê³ </label>
              <span class="api-count">í™•ì¸í•„ìš”</span>
            </div>
            <div class="api-fields">
              <span class="api-tag">LCNS_NO</span><span class="api-tag">BSSH_NM</span><span class="api-tag">PRSDNT_NM</span><span class="api-tag">INDUTY_NM</span><span class="api-tag">PRMS_DT</span><span class="api-tag">LOCP_ADDR</span><span class="api-tag">INSTT_NM</span><span class="api-tag">TELNO</span>
            </div>
          </div>

          <div class="api-item" id="api-I1260">
            <div class="api-header">
              <label class="api-check"><input type="checkbox" checked onchange="updateApiCount()"><strong>I1260</strong> â€” ì‹í’ˆë“±ìˆ˜ì…íŒë§¤ì—…</label>
              <span class="api-count">í™•ì¸í•„ìš”</span>
            </div>
            <div class="api-fields">
              <span class="api-tag">LCNS_NO</span><span class="api-tag">BSSH_NM</span><span class="api-tag">PRSDNT_NM</span><span class="api-tag">INDUTY_NM</span><span class="api-tag">PRMS_DT</span><span class="api-tag">TELNO</span><span class="api-tag">LOCP_ADDR</span><span class="api-tag">INSTT_NM</span>
            </div>
          </div>

        </div>
      </div>

      <!-- API ì¹´í…Œê³ ë¦¬ 2: í’ˆëª© ì œì¡° ë³´ê³  -->
      <div class="card" style="margin-bottom:16px">
        <div class="card-hd" style="cursor:pointer" onclick="toggleApiGroup('grpPrd')">
          <h3>ğŸ“¦ í’ˆëª© ì œì¡° ë³´ê³  <span style="font-size:12px;font-weight:400;color:#8892a4">(2ê°œ API)</span></h3>
          <div class="right"><span id="grpPrdArrow" style="font-size:16px">â–¼</span></div>
        </div>
        <div class="card-bd" id="grpPrd">

          <div class="api-item" id="api-I1250">
            <div class="api-header">
              <label class="api-check"><input type="checkbox" checked onchange="updateApiCount()"><strong>I1250</strong> â€” ì‹í’ˆ(ì²¨ê°€ë¬¼)í’ˆëª©ì œì¡°ë³´ê³ </label>
              <span class="api-count" style="color:#e65100">~1,043,828ê±´</span>
            </div>
            <div class="api-fields">
              <span class="api-tag">LCNS_NO</span><span class="api-tag">BSSH_NM</span><span class="api-tag">PRDLST_REPORT_NO</span><span class="api-tag">PRMS_DT</span><span class="api-tag">PRDLST_NM</span><span class="api-tag">PRDLST_DCNM</span><span class="api-tag">PRODUCTION</span><span class="api-tag">HIENG_LNTRT_DVS_NM</span><span class="api-tag">CHILD_CRTFC_YN</span><span class="api-tag">POG_DAYCNT</span><span class="api-tag">INDUTY_CD_NM</span><span class="api-tag">LAST_UPDT_DTM</span><span class="api-tag">USAGE</span><span class="api-tag">PRPOS</span><span class="api-tag">DISPOS</span><span class="api-tag">FRMLC_MTRQLT</span>
            </div>
          </div>

          <div class="api-item" id="api-I1310">
            <div class="api-header">
              <label class="api-check"><input type="checkbox" checked onchange="updateApiCount()"><strong>I1310</strong> â€” ì¶•ì‚°ë¬¼ í’ˆëª©ì œì¡°ì •ë³´</label>
              <span class="api-count">í™•ì¸í•„ìš”</span>
            </div>
            <div class="api-fields">
              <span class="api-tag">LCNS_NO</span><span class="api-tag">BSSH_NM</span><span class="api-tag">PRDLST_REPORT_NO</span><span class="api-tag">PRMS_DT</span><span class="api-tag">PRDLST_NM</span><span class="api-tag">PRDLST_DCNM</span><span class="api-tag">PRODUCTION</span><span class="api-tag">POG_DAYCNT</span><span class="api-tag">INDUTY_CD_NM</span><span class="api-tag">LAST_UPDT_DTM</span>
            </div>
          </div>

        </div>
      </div>

      <!-- API ì¹´í…Œê³ ë¦¬ 3: ì›ì¬ë£Œ -->
      <div class="card" style="margin-bottom:16px">
        <div class="card-hd" style="cursor:pointer" onclick="toggleApiGroup('grpMat')">
          <h3>ğŸ§ª ì›ì¬ë£Œ ì •ë³´ <span style="font-size:12px;font-weight:400;color:#8892a4">(3ê°œ API)</span></h3>
          <div class="right"><span id="grpMatArrow" style="font-size:16px">â–¼</span></div>
        </div>
        <div class="card-bd" id="grpMat">

          <div class="api-item" id="api-C002">
            <div class="api-header">
              <label class="api-check"><input type="checkbox" checked onchange="updateApiCount()"><strong>C002</strong> â€” ì‹í’ˆ(ì²¨ê°€ë¬¼)í’ˆëª©ì œì¡°ë³´ê³ (ì›ì¬ë£Œ)</label>
              <span class="api-count">í™•ì¸í•„ìš”</span>
            </div>
            <div class="api-fields">
              <span class="api-tag">LCNS_NO</span><span class="api-tag">BSSH_NM</span><span class="api-tag">PRDLST_REPORT_NO</span><span class="api-tag">PRMS_DT</span><span class="api-tag">PRDLST_NM</span><span class="api-tag">PRDLST_DCNM</span><span class="api-tag">RAWMTRL_NM</span><span class="api-tag">RAWMTRL_ORDNO</span><span class="api-tag">CHNG_DT</span>
            </div>
          </div>

          <div class="api-item" id="api-C003">
            <div class="api-header">
              <label class="api-check"><input type="checkbox" checked onchange="updateApiCount()"><strong>C003</strong> â€” ê±´ê°•ê¸°ëŠ¥ì‹í’ˆ í’ˆëª©ì œì¡°ì‹ ê³ (ì›ì¬ë£Œ)</label>
              <span class="api-count">~44,272ê±´</span>
            </div>
            <div class="api-fields">
              <span class="api-tag">LCNS_NO</span><span class="api-tag">BSSH_NM</span><span class="api-tag">PRDLST_REPORT_NO</span><span class="api-tag">PRDLST_NM</span><span class="api-tag">PRMS_DT</span><span class="api-tag">POG_DAYCNT</span><span class="api-tag">DISPOS</span><span class="api-tag">NTK_MTHD</span><span class="api-tag">PRIMARY_FNCLTY</span><span class="api-tag">IFTKN_ATNT_MATR_CN</span><span class="api-tag">CSTDY_MTHD</span><span class="api-tag">SHAP</span><span class="api-tag">STDR_STND</span><span class="api-tag">RAWMTRL_NM</span>
            </div>
          </div>

          <div class="api-item" id="api-C006">
            <div class="api-header">
              <label class="api-check"><input type="checkbox" checked onchange="updateApiCount()"><strong>C006</strong> â€” ì¶•ì‚°ë¬¼í’ˆëª©ì œì¡°ë³´ê³ (ì›ì¬ë£Œ)</label>
              <span class="api-count">í™•ì¸í•„ìš”</span>
            </div>
            <div class="api-fields">
              <span class="api-tag">BSSH_NM</span><span class="api-tag">PRDLST_REPORT_NO</span><span class="api-tag">PRMS_DT</span><span class="api-tag">PRDLST_NM</span><span class="api-tag">PRDLST_DCNM</span><span class="api-tag">RAWMTRL_NM</span><span class="api-tag">LCNS_NO</span><span class="api-tag">CHNG_DT</span><span class="api-tag">RAWMTRL_ORDNO</span>
            </div>
          </div>

        </div>
      </div>

      <!-- API ì¹´í…Œê³ ë¦¬ 4: ë³€ê²½ ì´ë ¥ -->
      <div class="card" style="margin-bottom:16px">
        <div class="card-hd" style="cursor:pointer" onclick="toggleApiGroup('grpChg')">
          <h3>ğŸ“ ì¸í—ˆê°€ ë³€ê²½ ì´ë ¥ <span style="font-size:12px;font-weight:400;color:#8892a4">(2ê°œ API)</span></h3>
          <div class="right"><span id="grpChgArrow" style="font-size:16px">â–¼</span></div>
        </div>
        <div class="card-bd" id="grpChg">

          <div class="api-item" id="api-I2859">
            <div class="api-header">
              <label class="api-check"><input type="checkbox" checked onchange="updateApiCount()"><strong>I2859</strong> â€” ì‹í’ˆì—…ì†Œ ì¸í—ˆê°€ ë³€ê²½ ì •ë³´</label>
              <span class="api-count">ë³€ê²½ë¶„</span>
            </div>
            <div class="api-fields">
              <span class="api-tag">BSSH_NM</span><span class="api-tag">INDUTY_CD_NM</span><span class="api-tag">LCNS_NO</span><span class="api-tag">TELNO</span><span class="api-tag">SITE_ADDR</span><span class="api-tag">CHNG_DT</span><span class="api-tag">CHNG_BF_CN</span><span class="api-tag">CHNG_AF_CN</span><span class="api-tag">CHNG_PRVNS</span>
            </div>
          </div>

          <div class="api-item" id="api-I2860">
            <div class="api-header">
              <label class="api-check"><input type="checkbox" checked onchange="updateApiCount()"><strong>I2860</strong> â€” ê±´ê°•ê¸°ëŠ¥ì‹í’ˆì—…ì†Œ ì¸í—ˆê°€ ë³€ê²½ ì •ë³´</label>
              <span class="api-count">ë³€ê²½ë¶„</span>
            </div>
            <div class="api-fields">
              <span class="api-tag">BSSH_NM</span><span class="api-tag">INDUTY_CD_NM</span><span class="api-tag">LCNS_NO</span><span class="api-tag">TELNO</span><span class="api-tag">SITE_ADDR</span><span class="api-tag">CHNG_DT</span><span class="api-tag">CHNG_BF_CN</span><span class="api-tag">CHNG_AF_CN</span><span class="api-tag">CHNG_PRVNS</span>
            </div>
          </div>

        </div>
      </div>

      <!-- ìˆ˜ì§‘ í˜„í™© -->
      <div class="card">
        <div class="card-hd"><h3>ğŸ“Š ìˆ˜ì§‘ í˜„í™©</h3><div class="right"><button class="btn btn-secondary btn-sm" onclick="loadCollectStatus()">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button></div></div>
        <div class="card-bd">
          <div id="collectStatusArea" style="font-size:12px;color:#8892a4;text-align:center;padding:20px">
            API ì„œë²„ ì—°ê²° í›„ ìˆ˜ì§‘ í˜„í™©ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
          </div>
        </div>
      </div>

    </div>

  </div>
</div>

<div class="toast" id="toastEl"></div>

<script>
const pageNames = {
  customerList:'ê³ ê°ì‚¬ ê´€ë¦¬', customerReg:'ê³ ê°ì‚¬ ê´€ë¦¬ > ì‹ ê·œ ë“±ë¡',
  bizSearch:'ì—…ì²´ì¡°íšŒ',
  daily:'ì—…ë¬´ì¼ì§€', dailyWrite:'ì—…ë¬´ì¼ì§€ > ì‘ì„±', dailyDetail:'ì—…ë¬´ì¼ì§€ > ìƒì„¸',
  vehicle:'ì°¨ëŸ‰ì¼ì§€', collection:'ë¯¸ìˆ˜ê¸ˆ í™œë™ ë‚´ì—­',
  estimate:'ê²¬ì ì„œ ê´€ë¦¬', trade:'ê±°ë˜ëª…ì„¸í‘œ ê´€ë¦¬', urgent:'ê¸´ê¸‰ í˜‘ì¡° ìš”ì²­',
  arManage:'ì„¸ê¸ˆê³„ì‚°ì„œë¯¸ë°œí–‰', invoice:'ê³„ì‚°ì„œ ë°œí–‰ ìŠ¹ì¸ìš”ì²­',
  apiSettings:'API ìˆ˜ì§‘ ì„¤ì •'
};
function showPage(id) {
  document.querySelectorAll('.page').forEach(p => p.style.display = 'none');
  document.getElementById('page-' + id).style.display = 'block';
  document.getElementById('topSub').textContent = pageNames[id] || '';
  // ì‚¬ì´ë“œë°” í•˜ìœ„ ë©”ë‰´ active ìƒíƒœ ì—…ë°ì´íŠ¸
  const salesGroup = document.querySelector('[data-id="sales"]')?.closest('.nav-group');
  if (salesGroup) {
    salesGroup.querySelectorAll('.nav-sub-item').forEach(el => el.classList.remove('active'));
    const navId = (id === 'customerReg') ? 'customerList' : (id === 'dailyWrite' || id === 'dailyDetail') ? 'daily' : id;
    const sideItem = salesGroup.querySelector('.nav-sub-item[data-page="' + navId + '"]');
    if (sideItem) sideItem.classList.add('active');
  }
  document.getElementById('contentArea').scrollTop = 0;
  if(id === 'bizSearch') setTimeout(initSidoMap, 150);
  if(id === 'apiSettings') setTimeout(updateApiCount, 100);
}
function closePopup(id) { document.getElementById(id).classList.remove('show'); }
function toast(msg) {
  const t = document.getElementById('toastEl');
  t.textContent = msg; t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 2500);
}
function fmtBiz(el) {
  let v = el.value.replace(/[^0-9]/g,'');
  if(v.length>10)v=v.slice(0,10);
  if(v.length>5)v=v.slice(0,3)+'-'+v.slice(3,5)+'-'+v.slice(5);
  else if(v.length>3)v=v.slice(0,3)+'-'+v.slice(3);
  el.value=v;
}
function fmtPhone(el) {
  let v = el.value.replace(/[^0-9]/g,'');
  if(v.length>11)v=v.slice(0,11);
  if(v.length>7)v=v.slice(0,3)+'-'+v.slice(3,7)+'-'+v.slice(7);
  else if(v.length>3)v=v.slice(0,3)+'-'+v.slice(3);
  el.value=v;
}
function demoCompanyDup() {
  const name = document.getElementById('regCompany').value.trim();
  if(!name){alert('íšŒì‚¬ëª…ì„ ì…ë ¥í•˜ì„¸ìš”.');return;}
  if(name.includes('í’€ë¬´ì›')){document.getElementById('companyDup').classList.add('show');}
  else{const el=document.getElementById('compChk');el.style.display='block';el.className='check-result check-ok';el.textContent='âœ… ì¤‘ë³µ ì—†ìŒ â€” ë“±ë¡ ê°€ëŠ¥';}
}
function demoContactDup() {
  const name = document.getElementById('regCName').value.trim();
  if(!name){alert('ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”.');return;}
  if(name==='ì´ê·œì„±'){document.getElementById('contactDup').classList.add('show');}
  else{const el=document.getElementById('cntChk');el.style.display='inline-block';el.className='check-result check-ok';el.textContent='âœ… ì¤‘ë³µ ì—†ìŒ';}
}
// â”€â”€ ì—…ë¬´ì¼ì§€ í•¨ìˆ˜ â”€â”€
function dailyCompanyChange(sel) {
  const newInput = document.getElementById('dailyCompanyNew');
  if (sel.value === '_new') {
    newInput.style.display = 'block';
    newInput.focus();
  } else {
    newInput.style.display = 'none';
  }
}
function dailySampleChange(sel) {
  const notice = document.getElementById('dailyVehicleNotice');
  if (sel.value === 'visit') {
    notice.style.display = 'block';
  } else {
    notice.style.display = 'none';
  }
}
function fmtMoney(el) {
  let v = el.value.replace(/[^0-9]/g, '');
  if (v) {
    el.value = Number(v).toLocaleString('ko-KR');
  }
}
function dailySave() {
  const company = document.getElementById('dailyCompany').value;
  const sample = document.getElementById('dailySample').value;
  if (!company || company === 'ì—…ì²´ ì„ íƒ...') { toast('âš ï¸ ì—…ì²´ë¥¼ ì„ íƒí•˜ì„¸ìš”.'); return; }
  if (!sample) { toast('âš ï¸ ì‹œë£Œìˆ˜ê±° ë°©ë²•ì„ ì„ íƒí•˜ì„¸ìš”.'); return; }
  toast('âœ… ì—…ë¬´ì¼ì§€ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
  if (sample === 'visit') {
    setTimeout(() => toast('ğŸš— ì°¨ëŸ‰ì¼ì§€ì— ìë™ ë°˜ì˜ë˜ì—ˆìŠµë‹ˆë‹¤.'), 1500);
  }
  setTimeout(() => showPage('daily'), 2500);
}

// â”€â”€ ì°¨ëŸ‰ì¼ì§€ ê²½ë¡œ ê³„ì‚° â”€â”€
var wpCount = 0;
function calcRoutePreview() {
  const startType = document.getElementById('vStartType').value;
  const endType = document.getElementById('vEndType').value;
  const distEl = document.getElementById('vDistPreview');
  const labelEl = document.getElementById('vDistLabel');
  // ë°ëª¨: ì¶œë°œ/ë„ì°© ì¡°í•©ì— ë”°ë¼ ë‹¤ë¥¸ ì˜ˆìƒ ê±°ë¦¬
  const demoDistMap = {
    'office-office': 42,
    'home-office': 38,
    'office-home': 45,
    'home-home': 52
  };
  const key = startType + '-' + endType;
  const dist = demoDistMap[key] || 42;
  distEl.value = dist;
  labelEl.textContent = 'API ìë™ê³„ì‚°';
  labelEl.style.background = '#bbdefb';
  labelEl.style.color = '#1565c0';
  toast('ğŸ“ ê²½ë¡œ ì¬ê³„ì‚°: ' + (startType==='office'?'íšŒì‚¬':'ìíƒ') + ' â†’ ë°©ë¬¸ì§€ â†’ ' + (endType==='office'?'íšŒì‚¬':'ìíƒ') + ' = ' + dist + 'km');
}
// km ìˆ˜ë™ ì¡°ì • ê°ì§€
document.addEventListener('input', function(e) {
  if (e.target && e.target.id === 'vDistPreview') {
    const labelEl = document.getElementById('vDistLabel');
    labelEl.textContent = 'ìˆ˜ë™ ì¡°ì •';
    labelEl.style.background = '#fff3e0';
    labelEl.style.color = '#e65100';
  }
});
function addWaypoint() {
  wpCount++;
  const area = document.getElementById('vWaypointArea');
  const div = document.createElement('div');
  div.style.cssText = 'display:flex;gap:8px;align-items:center;margin-top:8px';
  div.innerHTML = '<span style="font-size:11px;color:#1565c0;flex-shrink:0">ê²½ìœ ì§€ ' + wpCount + '</span>' +
    '<select style="flex:1;padding:7px 10px;border:1px solid #90caf9;border-radius:6px;font-size:12px;background:#fff">' +
    '<option>ì—…ì²´ ì„ íƒ...</option><option>CJì œì¼ì œë‹¹(ì£¼) â€” ì„œìš¸ ì¤‘êµ¬</option><option>(ì£¼)ë†ì‹¬ â€” ì„œìš¸ ë™ì‘êµ¬</option><option>ë™ì›F&B(ì£¼) â€” ì„œìš¸ ì„œì´ˆêµ¬</option><option>í’€ë¬´ì›ì‹í’ˆ(ì£¼) â€” ì„œìš¸ ê°•ë‚¨êµ¬</option>' +
    '</select>' +
    '<button onclick="this.parentElement.remove();calcRoutePreview()" style="background:none;border:1px solid #ef9a9a;color:#e53935;border-radius:6px;padding:4px 8px;cursor:pointer;font-size:11px">âœ•</button>';
  area.appendChild(div);
  toast('+ ê²½ìœ ì§€ ' + wpCount + ' ì¶”ê°€ë¨ (ì—¬ëŸ¬ ì—…ì²´ ë°©ë¬¸ ì‹œ)');
}

// â”€â”€ ì—…ì²´ì¡°íšŒ (ì§€ë„ ë“œë¦´ë‹¤ìš´ + ì¹´ì¹´ì˜¤ + ì‹ì•½ì²˜) â”€â”€
const KAKAO_REST_KEY = '8e5dab09aacd882449bd3865699a9d69';
const COMPANY_ORIGIN = {x:'127.0741', y:'37.2004'};
var bizMap2 = null, bizMarkers2 = [];
var bizState = {sido:'', sigungu:'', dong:''};

var regionData = {
  'ì„œìš¸':['ê°•ë‚¨êµ¬','ê°•ë™êµ¬','ê°•ë¶êµ¬','ê°•ì„œêµ¬','ê´€ì•…êµ¬','ê´‘ì§„êµ¬','êµ¬ë¡œêµ¬','ê¸ˆì²œêµ¬','ë…¸ì›êµ¬','ë„ë´‰êµ¬','ë™ëŒ€ë¬¸êµ¬','ë™ì‘êµ¬','ë§ˆí¬êµ¬','ì„œëŒ€ë¬¸êµ¬','ì„œì´ˆêµ¬','ì„±ë™êµ¬','ì„±ë¶êµ¬','ì†¡íŒŒêµ¬','ì–‘ì²œêµ¬','ì˜ë“±í¬êµ¬','ìš©ì‚°êµ¬','ì€í‰êµ¬','ì¢…ë¡œêµ¬','ì¤‘êµ¬','ì¤‘ë‘êµ¬'],
  'ë¶€ì‚°':['ê°•ì„œêµ¬','ê¸ˆì •êµ¬','ê¸°ì¥êµ°','ë‚¨êµ¬','ë™êµ¬','ë™ë˜êµ¬','ë¶€ì‚°ì§„êµ¬','ë¶êµ¬','ì‚¬ìƒêµ¬','ì‚¬í•˜êµ¬','ì„œêµ¬','ìˆ˜ì˜êµ¬','ì—°ì œêµ¬','ì˜ë„êµ¬','ì¤‘êµ¬','í•´ìš´ëŒ€êµ¬'],
  'ëŒ€êµ¬':['ë‚¨êµ¬','ë‹¬ì„œêµ¬','ë‹¬ì„±êµ°','ë™êµ¬','ë¶êµ¬','ì„œêµ¬','ìˆ˜ì„±êµ¬','ì¤‘êµ¬'],
  'ì¸ì²œ':['ê°•í™”êµ°','ê³„ì–‘êµ¬','ë‚¨ë™êµ¬','ë™êµ¬','ë¯¸ì¶”í™€êµ¬','ë¶€í‰êµ¬','ì„œêµ¬','ì—°ìˆ˜êµ¬','ì˜¹ì§„êµ°','ì¤‘êµ¬'],
  'ê´‘ì£¼':['ê´‘ì‚°êµ¬','ë‚¨êµ¬','ë™êµ¬','ë¶êµ¬','ì„œêµ¬'],
  'ëŒ€ì „':['ëŒ€ë•êµ¬','ë™êµ¬','ì„œêµ¬','ìœ ì„±êµ¬','ì¤‘êµ¬'],
  'ìš¸ì‚°':['ë‚¨êµ¬','ë™êµ¬','ë¶êµ¬','ìš¸ì£¼êµ°','ì¤‘êµ¬'],
  'ì„¸ì¢…':['ì„¸ì¢…ì‹œ'],
  'ê²½ê¸°':['ê°€í‰êµ°','ê³ ì–‘ì‹œ','ê³¼ì²œì‹œ','ê´‘ëª…ì‹œ','ê´‘ì£¼ì‹œ','êµ¬ë¦¬ì‹œ','êµ°í¬ì‹œ','ê¹€í¬ì‹œ','ë‚¨ì–‘ì£¼ì‹œ','ë™ë‘ì²œì‹œ','ë¶€ì²œì‹œ','ì„±ë‚¨ì‹œ','ìˆ˜ì›ì‹œ','ì‹œí¥ì‹œ','ì•ˆì‚°ì‹œ','ì•ˆì„±ì‹œ','ì•ˆì–‘ì‹œ','ì–‘ì£¼ì‹œ','ì–‘í‰êµ°','ì—¬ì£¼ì‹œ','ì—°ì²œêµ°','ì˜¤ì‚°ì‹œ','ìš©ì¸ì‹œ','ì˜ì™•ì‹œ','ì˜ì •ë¶€ì‹œ','ì´ì²œì‹œ','íŒŒì£¼ì‹œ','í‰íƒì‹œ','í¬ì²œì‹œ','í•˜ë‚¨ì‹œ','í™”ì„±ì‹œ'],
  'ê°•ì›':['ê°•ë¦‰ì‹œ','ê³ ì„±êµ°','ë™í•´ì‹œ','ì‚¼ì²™ì‹œ','ì†ì´ˆì‹œ','ì–‘êµ¬êµ°','ì–‘ì–‘êµ°','ì˜ì›”êµ°','ì›ì£¼ì‹œ','ì¸ì œêµ°','ì •ì„ êµ°','ì² ì›êµ°','ì¶˜ì²œì‹œ','íƒœë°±ì‹œ','í‰ì°½êµ°','í™ì²œêµ°','í™”ì²œêµ°','íš¡ì„±êµ°'],
  'ì¶©ë¶':['ê´´ì‚°êµ°','ë‹¨ì–‘êµ°','ë³´ì€êµ°','ì˜ë™êµ°','ì˜¥ì²œêµ°','ìŒì„±êµ°','ì œì²œì‹œ','ì¦í‰êµ°','ì§„ì²œêµ°','ì²­ì£¼ì‹œ','ì¶©ì£¼ì‹œ'],
  'ì¶©ë‚¨':['ê³„ë£¡ì‹œ','ê³µì£¼ì‹œ','ê¸ˆì‚°êµ°','ë…¼ì‚°ì‹œ','ë‹¹ì§„ì‹œ','ë³´ë ¹ì‹œ','ë¶€ì—¬êµ°','ì„œì‚°ì‹œ','ì„œì²œêµ°','ì•„ì‚°ì‹œ','ì˜ˆì‚°êµ°','ì²œì•ˆì‹œ','ì²­ì–‘êµ°','íƒœì•ˆêµ°','í™ì„±êµ°'],
  'ì „ë¶':['ê³ ì°½êµ°','êµ°ì‚°ì‹œ','ê¹€ì œì‹œ','ë‚¨ì›ì‹œ','ë¬´ì£¼êµ°','ë¶€ì•ˆêµ°','ìˆœì°½êµ°','ì™„ì£¼êµ°','ìµì‚°ì‹œ','ì„ì‹¤êµ°','ì¥ìˆ˜êµ°','ì „ì£¼ì‹œ','ì •ìì‹œ','ì§„ì•ˆêµ°'],
  'ì „ë‚¨':['ê°•ì§„êµ°','ê³ í¥êµ°','ê³¡ì„±êµ°','ê´‘ì–‘ì‹œ','êµ¬ë¡€êµ°','ë‚˜ì£¼ì‹œ','ë‹´ì–‘êµ°','ëª©í¬ì‹œ','ë¬´ì•ˆêµ°','ë³´ì„±êµ°','ìˆœì²œì‹œ','ì‹ ì•ˆêµ°','ì—¬ìˆ˜ì‹œ','ì˜ê´‘êµ°','ì˜ì•”êµ°','ì™„ë„êµ°','ì¥ì„±êµ°','ì¥í¥êµ°','ì§„ë„êµ°','í•¨í‰êµ°','í•´ë‚¨êµ°','í™”ìˆœêµ°'],
  'ê²½ë¶':['ê²½ì‚°ì‹œ','ê²½ì£¼ì‹œ','ê³ ë ¹êµ°','êµ¬ë¯¸ì‹œ','êµ°ìœ„êµ°','ê¹€ì²œì‹œ','ë¬¸ê²½ì‹œ','ë´‰í™”êµ°','ìƒì£¼ì‹œ','ì„±ì£¼êµ°','ì•ˆë™ì‹œ','ì˜ë•êµ°','ì˜ì–‘êµ°','ì˜ì£¼ì‹œ','ì˜ì²œì‹œ','ì˜ˆì²œêµ°','ìš¸ë¦‰êµ°','ìš¸ì§„êµ°','ì˜ì„±êµ°','ì²­ë„êµ°','ì²­ì†¡êµ°','ì¹ ê³¡êµ°','í¬í•­ì‹œ'],
  'ê²½ë‚¨':['ê±°ì œì‹œ','ê±°ì°½êµ°','ê³ ì„±êµ°','ê¹€í•´ì‹œ','ë‚¨í•´êµ°','ë°€ì–‘ì‹œ','ì‚¬ì²œì‹œ','ì‚°ì²­êµ°','ì–‘ì‚°ì‹œ','ì˜ë ¹êµ°','ì§„ì£¼ì‹œ','ì°½ë…•êµ°','ì°½ì›ì‹œ','í†µì˜ì‹œ','í•˜ë™êµ°','í•¨ì•ˆêµ°','í•¨ì–‘êµ°','í•©ì²œêµ°'],
  'ì œì£¼':['ì„œê·€í¬ì‹œ','ì œì£¼ì‹œ']
};

// â”€â”€ Leaflet ì§€ë„ (VWORLD/OSM + ì‹œë„/ì‹œêµ°êµ¬ GeoJSON) â”€â”€
var sidoMap = null, sidoGeoLayer = null, sgGeoData = null, dongGeoData = null;
var SIDO_GEO_URL = 'data/sido.json';
var SG_GEO_URL = 'data/sigungu.json';
var DONG_GEO_URL = 'data/dong.json';
var SIDO_NAME_MAP = {
  'ì„œìš¸íŠ¹ë³„ì‹œ':'ì„œìš¸','ë¶€ì‚°ê´‘ì—­ì‹œ':'ë¶€ì‚°','ëŒ€êµ¬ê´‘ì—­ì‹œ':'ëŒ€êµ¬','ì¸ì²œê´‘ì—­ì‹œ':'ì¸ì²œ',
  'ê´‘ì£¼ê´‘ì—­ì‹œ':'ê´‘ì£¼','ëŒ€ì „ê´‘ì—­ì‹œ':'ëŒ€ì „','ìš¸ì‚°ê´‘ì—­ì‹œ':'ìš¸ì‚°','ì„¸ì¢…íŠ¹ë³„ìì¹˜ì‹œ':'ì„¸ì¢…',
  'ê²½ê¸°ë„':'ê²½ê¸°','ê°•ì›ë„':'ê°•ì›','ì¶©ì²­ë¶ë„':'ì¶©ë¶','ì¶©ì²­ë‚¨ë„':'ì¶©ë‚¨',
  'ì „ë¼ë¶ë„':'ì „ë¶','ì „ë¼ë‚¨ë„':'ì „ë‚¨','ê²½ìƒë¶ë„':'ê²½ë¶','ê²½ìƒë‚¨ë„':'ê²½ë‚¨','ì œì£¼íŠ¹ë³„ìì¹˜ë„':'ì œì£¼'
};
var SIDO_COLORS = ['#1a73e8','#e53935','#43a047','#fb8c00','#8e24aa','#00897b','#f4511e','#6d4c41',
  '#3949ab','#c0ca33','#00acc1','#d81b60','#5e35b1','#039be5','#7cb342','#ff6f00','#546e7a'];

// â”€â”€ ì‹ì•½ì²˜ ì „ì²´ ë°ì´í„° (ì •ì  JSON) â”€â”€
var fssAllData = null;
var fssLoading = false;
var SIDO_ADDR = {'ì„œìš¸':'ì„œìš¸','ë¶€ì‚°':'ë¶€ì‚°','ëŒ€êµ¬':'ëŒ€êµ¬','ì¸ì²œ':'ì¸ì²œ','ê´‘ì£¼':'ê´‘ì£¼','ëŒ€ì „':'ëŒ€ì „','ìš¸ì‚°':'ìš¸ì‚°','ì„¸ì¢…':'ì„¸ì¢…',
  'ê²½ê¸°':'ê²½ê¸°ë„','ê°•ì›':'ê°•ì›ë„','ì¶©ë¶':'ì¶©ì²­ë¶ë„','ì¶©ë‚¨':'ì¶©ì²­ë‚¨ë„','ì „ë¶':'ì „ë¼ë¶ë„','ì „ë‚¨':'ì „ë¼ë‚¨ë„','ê²½ë¶':'ê²½ìƒë¶ë„','ê²½ë‚¨':'ê²½ìƒë‚¨ë„','ì œì£¼':'ì œì£¼'};

function loadFssData() {
  if(fssAllData || fssLoading) return;
  fssLoading = true;
  fetch('data/fss_all.json').then(function(r){
    if(!r.ok) throw new Error('íŒŒì¼ ì—†ìŒ');
    return r.json();
  }).then(function(data){
    fssAllData = data;
    fssLoading = false;
    console.log('ì‹ì•½ì²˜ ë°ì´í„° ë¡œë“œ:', fssAllData.length + 'ê±´');
    toast('ğŸ“Š ì‹ì•½ì²˜ ' + fssAllData.length.toLocaleString() + 'ê±´ ë¡œë“œ ì™„ë£Œ');
    updateSidoLabels();
  }).catch(function(e){
    fssLoading = false;
    console.error('fss_all.json ë¡œë“œ ì‹¤íŒ¨:', e);
    toast('âš ï¸ ì‹ì•½ì²˜ ë°ì´í„° íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤. download_fss.pyë¥¼ ì‹¤í–‰í•˜ì„¸ìš”.');
  });
}

function fssFilterSido(sido) {
  if(!fssAllData) return [];
  var key = SIDO_ADDR[sido] || sido;
  return fssAllData.filter(function(r){ return r.addr && r.addr.indexOf(key) >= 0; });
}
function fssFilterSg(sido, sg) {
  var list = fssFilterSido(sido);
  var sgClean = sg.replace(/ì‹œ$|êµ°$|êµ¬$/,'');
  return list.filter(function(r){ return r.addr.indexOf(sg) >= 0 || r.addr.indexOf(sgClean) >= 0; });
}
function fssFilterDong(sido, sg, dong) {
  var list = fssFilterSg(sido, sg);
  return list.filter(function(r){ return r.addr.indexOf(dong) >= 0; });
}

function updateSidoLabels() {
  if(!fssAllData || !sidoGeoLayer) return;
  sidoGeoLayer.eachLayer(function(layer){
    var fullName = layer.feature.properties.name || '';
    var shortName = SIDO_NAME_MAP[fullName] || fullName;
    var cnt = fssFilterSido(shortName).length;
    layer.unbindTooltip();
    layer.bindTooltip(shortName + '<br><b style="color:#e53935">' + cnt.toLocaleString() + '</b>', {permanent:true, direction:'center', className:'sido-label'});
  });
}

function initSidoMap() {
  if(sidoMap) { sidoMap.invalidateSize(); if(fssAllData) updateSidoLabels(); return; }
  var el = document.getElementById('koreaMap');
  if(!el || el.offsetHeight === 0) return;
  sidoMap = L.map('koreaMap', {zoomControl:true, attributionControl:false}).setView([36.0, 127.8], 7);
  // íƒ€ì¼ ë ˆì´ì–´
  applyMapTile();
  // ì‹ì•½ì²˜ ì „ì²´ ë°ì´í„° ë¡œë“œ
  loadFssData();
  // ì‹œë„ ê²½ê³„ GeoJSON ë¡œë“œ
  fetch(SIDO_GEO_URL).then(function(r){return r.json()}).then(function(geo){
    sidoGeoLayer = L.geoJSON(geo, {
      style: function(feature){
        var idx = geo.features.indexOf(feature) % SIDO_COLORS.length;
        return {color:'#fff', weight:2, fillColor:SIDO_COLORS[idx], fillOpacity:0.45};
      },
      onEachFeature: function(feature, layer){
        var fullName = feature.properties.name || '';
        var shortName = SIDO_NAME_MAP[fullName] || fullName;
        layer.bindTooltip(shortName, {permanent:true, direction:'center', className:'sido-label'});
        layer.on('mouseover', function(e){ e.target.setStyle({fillOpacity:0.75, weight:3}); });
        layer.on('mouseout', function(e){ sidoGeoLayer.resetStyle(e.target); });
        layer.on('click', function(){ selectSido(shortName); });
      }
    }).addTo(sidoMap);
    sidoMap.fitBounds(sidoGeoLayer.getBounds(), {padding:[10,10]});
  }).catch(function(e){ console.error('ì‹œë„ GeoJSON ë¡œë“œ ì‹¤íŒ¨:', e); });
  // ì‹œêµ°êµ¬ GeoJSON í”„ë¦¬ë¡œë“œ
  fetch(SG_GEO_URL).then(function(r){return r.json()}).then(function(geo){ sgGeoData = geo; });
  // ìë©´ë™ GeoJSON í”„ë¦¬ë¡œë“œ
  fetch(DONG_GEO_URL).then(function(r){return r.json()}).then(function(geo){ dongGeoData = geo; });
}

function applyMapTile() {
  if(!sidoMap) return;
  sidoMap.eachLayer(function(l){ if(l instanceof L.TileLayer) sidoMap.removeLayer(l); });
  var vkey = document.getElementById('vworldApiKey') ? document.getElementById('vworldApiKey').value.trim() : '';
  if(vkey) {
    L.tileLayer('https://api.vworld.kr/req/wmts/1.0.0/'+vkey+'/Base/{z}/{y}/{x}.png', {maxZoom:19, minZoom:5}).addTo(sidoMap);
  } else {
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {maxZoom:19, minZoom:5}).addTo(sidoMap);
  }
  if(sidoGeoLayer) sidoGeoLayer.bringToFront();
}

var sgMap = null, sgGeoLayer = null;
var SG_COLORS = ['#42a5f5','#66bb6a','#ffa726','#ef5350','#ab47bc','#26c6da','#8d6e63','#78909c',
  '#5c6bc0','#d4e157','#ec407a','#29b6f6','#9ccc65','#ffca28','#7e57c2','#26a69a'];
var SIDO_CODE_MAP = {
  'ì„œìš¸':'11','ë¶€ì‚°':'21','ëŒ€êµ¬':'22','ì¸ì²œ':'23','ê´‘ì£¼':'24','ëŒ€ì „':'25','ìš¸ì‚°':'26','ì„¸ì¢…':'29',
  'ê²½ê¸°':'31','ê°•ì›':'32','ì¶©ë¶':'33','ì¶©ë‚¨':'34','ì „ë¶':'35','ì „ë‚¨':'36','ê²½ë¶':'37','ê²½ë‚¨':'38','ì œì£¼':'39'
};

function selectSido(sido) {
  bizState = {sido:sido, sigungu:'', dong:''};
  var list = regionData[sido] || [];
  var html = '';
  list.forEach(function(g){
    html += '<div class="sg-btn" onclick="selectSigungu(\'' + g + '\')">' + g + '</div>';
  });
  document.getElementById('sigunguGrid').innerHTML = html;
  document.getElementById('step1Title').textContent = 'ğŸ™ï¸ ' + sido + ' > ì‹œ/êµ°/êµ¬ ì„ íƒ';
  document.getElementById('bizStep0').style.display = 'none';
  document.getElementById('bizStep1').style.display = 'block';
  document.getElementById('bizStep2').style.display = 'none';
  document.getElementById('bizStep3').style.display = 'none';
  updateBreadcrumb();
  toast('ğŸ“ ' + sido + ' ì„ íƒ');
  // ì‹œêµ°êµ¬ ì§€ë„ ìƒì„±/ì—…ë°ì´íŠ¸
  setTimeout(function(){ initSgMap(sido); }, 100);
}

function initSgMap(sido) {
  var el = document.getElementById('sgMap');
  if(!el) return;
  if(sgMap) { sgMap.remove(); sgMap = null; }
  sgMap = L.map('sgMap', {zoomControl:true, attributionControl:false}).setView([36.0, 127.8], 9);
  // íƒ€ì¼
  var vkey = document.getElementById('vworldApiKey') ? document.getElementById('vworldApiKey').value.trim() : '';
  if(vkey) {
    L.tileLayer('https://api.vworld.kr/req/wmts/1.0.0/'+vkey+'/Base/{z}/{y}/{x}.png', {maxZoom:19}).addTo(sgMap);
  } else {
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {maxZoom:19}).addTo(sgMap);
  }
  // ì‹œêµ°êµ¬ ê²½ê³„
  var sidoCode = SIDO_CODE_MAP[sido] || '';
  if(!sgGeoData || !sidoCode) return;
  var filtered = {
    type: 'FeatureCollection',
    features: sgGeoData.features.filter(function(f){ return f.properties.code.substring(0,2) === sidoCode; })
  };
  sgGeoLayer = L.geoJSON(filtered, {
    style: function(feature){
      var idx = filtered.features.indexOf(feature) % SG_COLORS.length;
      return {color:'#fff', weight:2, fillColor:SG_COLORS[idx], fillOpacity:0.45};
    },
    onEachFeature: function(feature, layer){
      var name = feature.properties.name || '';
      var cnt = fssAllData ? fssFilterSg(sido, name).length : 0;
      var label = name + (cnt ? '<br><b style="color:#e53935;font-size:9px">' + cnt.toLocaleString() + '</b>' : '');
      layer.bindTooltip(label, {permanent:true, direction:'center', className:'sg-label'});
      layer.on('mouseover', function(e){ e.target.setStyle({fillOpacity:0.75, weight:3}); });
      layer.on('mouseout', function(e){ sgGeoLayer.resetStyle(e.target); });
      layer.on('click', function(){
        var matched = matchSigungu(sido, name);
        if(matched) selectSigungu(matched);
      });
    }
  }).addTo(sgMap);
  if(filtered.features.length > 0) sgMap.fitBounds(sgGeoLayer.getBounds(), {padding:[15,15]});
}

function matchSigungu(sido, geoName) {
  var list = regionData[sido] || [];
  // ì •í™•íˆ ì¼ì¹˜
  for(var i=0; i<list.length; i++) {
    if(geoName === list[i] || geoName.indexOf(list[i]) >= 0 || list[i].indexOf(geoName) >= 0) return list[i];
  }
  // ì• 2ê¸€ì ë§¤ì¹­ (ìˆ˜ì›ì‹œì¥ì•ˆêµ¬ â†’ ìˆ˜ì›ì‹œ ë“±)
  for(var i=0; i<list.length; i++) {
    if(geoName.substring(0,2) === list[i].substring(0,2)) return list[i];
  }
  return geoName;
}

var dongMap = null, dongGeoLayer = null;
var DONG_COLORS = ['#4fc3f7','#81c784','#ffb74d','#e57373','#ba68c8','#4dd0e1','#a1887f','#90a4ae',
  '#7986cb','#dce775','#f06292','#4db6ac','#aed581','#ffd54f','#9575cd','#64b5f6'];

function selectSigungu(sg) {
  bizState.sigungu = sg;
  bizState.dong = '';
  document.getElementById('step2Title').textContent = 'ğŸ˜ï¸ ' + bizState.sido + ' ' + sg + ' > ì/ë©´/ë™ ì„ íƒ';
  document.getElementById('bizStep1').style.display = 'none';
  document.getElementById('bizStep2').style.display = 'block';
  document.getElementById('dongGrid').style.display = 'none';
  document.getElementById('dongLoading').style.display = 'block';
  updateBreadcrumb();
  // ìë©´ë™ ì§€ë„ + ëª©ë¡ ë¡œë“œ
  setTimeout(function(){ initDongMap(bizState.sido, sg); }, 100);
}

function findSgCode(sido, sgName) {
  if(!sgGeoData) return '';
  var sidoCode = SIDO_CODE_MAP[sido] || '';
  // ë§¤ì¹­ë˜ëŠ” ëª¨ë“  ì‹œêµ°êµ¬ ì½”ë“œ ìˆ˜ì§‘
  var matched = [];
  for(var i = 0; i < sgGeoData.features.length; i++) {
    var f = sgGeoData.features[i];
    var code = f.properties.code;
    if(code.substring(0,2) !== sidoCode) continue;
    var name = f.properties.name;
    // "ìˆ˜ì›ì‹œ" â†’ "ìˆ˜ì›ì‹œì¥ì•ˆêµ¬", "ìˆ˜ì›ì‹œê¶Œì„ êµ¬" ë“± ëª¨ë‘ ë§¤ì¹­
    if(name === sgName || name.indexOf(sgName) >= 0 || sgName.indexOf(name) >= 0
       || name.substring(0,2) === sgName.substring(0,2)) {
      matched.push(code);
    }
  }
  if(matched.length === 0) return sidoCode;
  if(matched.length === 1) return matched[0];
  // ë³µí•©ë„ì‹œ: ê³µí†µ prefix ê³„ì‚° (ìˆ˜ì›ì‹œ 31011,31012,31013,31014 â†’ "3101")
  var prefix = matched[0];
  for(var j = 1; j < matched.length; j++) {
    while(matched[j].substring(0, prefix.length) !== prefix && prefix.length > 2) {
      prefix = prefix.substring(0, prefix.length - 1);
    }
  }
  return prefix;
}

function initDongMap(sido, sg) {
  var el = document.getElementById('dongMap');
  if(!el) return;
  if(dongMap) { dongMap.remove(); dongMap = null; }
  dongMap = L.map('dongMap', {zoomControl:true, attributionControl:false}).setView([36.0, 127.8], 11);
  // íƒ€ì¼
  var vkey = document.getElementById('vworldApiKey') ? document.getElementById('vworldApiKey').value.trim() : '';
  if(vkey) {
    L.tileLayer('https://api.vworld.kr/req/wmts/1.0.0/'+vkey+'/Base/{z}/{y}/{x}.png', {maxZoom:19}).addTo(dongMap);
  } else {
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {maxZoom:19}).addTo(dongMap);
  }

  // ì‹œêµ°êµ¬ ì½”ë“œ ì°¾ê¸°
  var sgCode = findSgCode(sido, sg);
  var dongButtons = [];

  if(dongGeoData && sgCode.length >= 4) {
    // ì‹œêµ°êµ¬ì— í•˜ìœ„êµ¬ê°€ ìˆëŠ” ê²½ìš° (ì˜ˆ: ìˆ˜ì›ì‹œâ†’ì¥ì•ˆêµ¬,ê¶Œì„ êµ¬...) sgCode 5ìë¦¬ ì• 4ìë¦¬ë¡œ í•„í„°
    // ì¼ë°˜ ì‹œêµ°êµ¬ëŠ” 5ìë¦¬ ì „ì²´ë¡œ í•„í„°
    var prefix = sgCode;
    var filtered = {
      type: 'FeatureCollection',
      features: dongGeoData.features.filter(function(f){ return f.properties.code.substring(0, prefix.length) === prefix; })
    };
    // í•˜ìœ„êµ¬ í¬í•¨ ë§¤ì¹­ì´ ì•ˆ ë˜ë©´ ì• 3~4ìë¦¬ë¡œ ì¬ì‹œë„
    if(filtered.features.length === 0 && sgCode.length >= 3) {
      prefix = sgCode.substring(0, 4);
      filtered.features = dongGeoData.features.filter(function(f){ return f.properties.code.substring(0, 4) === prefix; });
    }
    if(filtered.features.length === 0 && sgCode.length >= 2) {
      prefix = sgCode.substring(0, 3);
      filtered.features = dongGeoData.features.filter(function(f){ return f.properties.code.substring(0, 3) === prefix; });
    }

    if(filtered.features.length > 0) {
      dongGeoLayer = L.geoJSON(filtered, {
        style: function(feature){
          var idx = filtered.features.indexOf(feature) % DONG_COLORS.length;
          return {color:'#fff', weight:1.5, fillColor:DONG_COLORS[idx], fillOpacity:0.4};
        },
        onEachFeature: function(feature, layer){
          var name = feature.properties.name || '';
          var cnt = fssAllData ? fssFilterDong(sido, sg, name).length : 0;
          var label = name + (cnt ? '<br><b style="color:#e53935;font-size:9px">' + cnt.toLocaleString() + '</b>' : '');
          layer.bindTooltip(label, {permanent:true, direction:'center', className:'sg-label'});
          layer.on('mouseover', function(e){ e.target.setStyle({fillOpacity:0.7, weight:2.5}); });
          layer.on('mouseout', function(e){ dongGeoLayer.resetStyle(e.target); });
          layer.on('click', function(){
            selectDong(name);
          });
        }
      }).addTo(dongMap);
      dongMap.fitBounds(dongGeoLayer.getBounds(), {padding:[15,15]});

      // GeoJSONì—ì„œ ë™ ëª©ë¡ ìƒì„±
      filtered.features.forEach(function(f){ dongButtons.push(f.properties.name); });
    }
  }

  // ë™ ë²„íŠ¼ ëª©ë¡ ë Œë”ë§
  if(dongButtons.length > 0) {
    dongButtons.sort();
    var html = '';
    dongButtons.forEach(function(d){
      html += '<div class="dong-btn" onclick="selectDong(\'' + d + '\')">' + d + '</div>';
    });
    document.getElementById('dongGrid').innerHTML = html;
  } else {
    // GeoJSONì— ì—†ìœ¼ë©´ ì¹´ì¹´ì˜¤ API í´ë°±
    loadDongList(sido, sg);
    return;
  }
  document.getElementById('dongGrid').style.display = 'flex';
  document.getElementById('dongLoading').style.display = 'none';
}

async function loadDongList(sido, sigungu) {
  try {
    var res = await fetch('https://dapi.kakao.com/v2/local/search/address.json?query=' + encodeURIComponent(sido + ' ' + sigungu) + '&size=30', {
      headers: {'Authorization': 'KakaoAK ' + KAKAO_REST_KEY}
    });
    var data = await res.json();
    var dongs = new Set();
    (data.documents||[]).forEach(function(d){
      var a = d.address || d.road_address;
      if(a){
        var r3 = a.region_3depth_name || a.region_3depth_h_name || '';
        if(r3) dongs.add(r3.split(' ')[0]);
      }
    });
    var dongArr = Array.from(dongs).sort();
    if(dongArr.length === 0){
      document.getElementById('dongGrid').innerHTML = '<div style="text-align:center;width:100%;padding:16px;color:#8892a4;font-size:12px">ì/ë©´/ë™ ìë™ ë¡œë“œ ë¶ˆê°€ â€” ì‹œ/êµ°/êµ¬ ì „ì²´ ê²€ìƒ‰ì„ ì´ìš©í•˜ì„¸ìš”.</div>';
    } else {
      var html = '';
      dongArr.forEach(function(d){
        html += '<div class="dong-btn" onclick="selectDong(\'' + d + '\')">' + d + '</div>';
      });
      document.getElementById('dongGrid').innerHTML = html;
    }
    document.getElementById('dongGrid').style.display = 'flex';
    document.getElementById('dongLoading').style.display = 'none';
  } catch(e) {
    document.getElementById('dongGrid').innerHTML = '<div style="text-align:center;width:100%;padding:16px;color:#e53935">ë¡œë“œ ì‹¤íŒ¨</div>';
    document.getElementById('dongGrid').style.display = 'flex';
    document.getElementById('dongLoading').style.display = 'none';
  }
}

function selectDong(dong) {
  bizState.dong = dong;
  updateBreadcrumb();
  // ì‹ì•½ì²˜ ë°ì´í„° í•„í„°ë§
  var rows = fssAllData ? fssFilterDong(bizState.sido, bizState.sigungu, dong) : [];
  showFssResults(rows);
}

function showFssResults(rows) {
  document.getElementById('bizStep0').style.display = 'none';
  document.getElementById('bizStep1').style.display = 'none';
  document.getElementById('bizStep2').style.display = 'none';
  document.getElementById('bizStep3').style.display = 'block';
  document.getElementById('bizFssCount').textContent = rows.length;
  if(rows.length === 0) {
    document.getElementById('fssTableBody').innerHTML = '<tr><td colspan="7" style="text-align:center;padding:30px;color:#8892a4;font-size:12px">í•´ë‹¹ ì§€ì—­ì— ë“±ë¡ëœ ì‹í’ˆì œì¡°ê°€ê³µì—…ì²´ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
    return;
  }
  var html = '';
  rows.forEach(function(r, i){
    var nm = r.nm || '-';
    var ceo = r.ceo || '-';
    var biz = r.biz || '-';
    var lic = r.lic || '-';
    var addr = r.addr || '-';
    var org = r.org || '';
    var tel = r.tel || '';
    html += '<tr>';
    html += '<td style="font-size:12px"><b>' + nm + '</b>' + (tel ? '<br><span style="font-size:10px;color:#8892a4">ğŸ“ ' + tel + '</span>' : '') + '</td>';
    html += '<td style="font-size:12px">' + ceo + '</td>';
    html += '<td><span style="font-size:11px">' + biz + '</span></td>';
    html += '<td style="font-size:10px;font-family:monospace">' + lic + '</td>';
    html += '<td style="font-size:11px;max-width:200px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap" title="' + addr + '">' + addr + '</td>';
    html += '<td><span style="font-size:11px;color:#1565c0">' + org + '</span></td>';
    html += '<td><button style="font-size:10px;padding:3px 10px;background:#2e7d32;color:#fff;border:none;border-radius:4px;cursor:pointer" onclick="bizReg(\'' + nm.replace(/'/g,"\\'") + '\',\'' + addr.replace(/'/g,"\\'") + '\')">+ ë“±ë¡</button></td>';
    html += '</tr>';
  });
  document.getElementById('fssTableBody').innerHTML = html;
  toast('ğŸ­ ì‹ì•½ì²˜ ' + rows.length + 'ê±´ ì¡°íšŒ');
}

function bizGoStep(n) {
  document.getElementById('bizStep0').style.display = n===0 ? 'block' : 'none';
  document.getElementById('bizStep1').style.display = n===1 ? 'block' : 'none';
  document.getElementById('bizStep2').style.display = n===2 ? 'block' : 'none';
  document.getElementById('bizStep3').style.display = 'none';
  if(n===0) { bizState = {sido:'', sigungu:'', dong:''}; setTimeout(function(){ if(sidoMap) sidoMap.invalidateSize(); }, 150); }
  if(n===1) { bizState.sigungu=''; bizState.dong=''; setTimeout(function(){ if(sgMap) sgMap.invalidateSize(); }, 150); }
  if(n===2) { bizState.dong=''; setTimeout(function(){ if(dongMap) dongMap.invalidateSize(); }, 150); }
  updateBreadcrumb();
}

function updateBreadcrumb() {
  var html = '<span style="color:#1a73e8;font-weight:600;cursor:pointer" onclick="bizGoStep(0)">ì „êµ­</span>';
  if(bizState.sido) html += ' <span style="color:#c8d6e5">â€º</span> <span style="color:#1a73e8;cursor:pointer" onclick="bizGoStep(1)">' + bizState.sido + '</span>';
  if(bizState.sigungu) html += ' <span style="color:#c8d6e5">â€º</span> <span style="color:#1a73e8;cursor:pointer" onclick="bizGoStep(2)">' + bizState.sigungu + '</span>';
  if(bizState.dong) html += ' <span style="color:#c8d6e5">â€º</span> <b style="color:#1a2332">' + bizState.dong + '</b>';
  document.getElementById('bizBreadcrumb').innerHTML = html;
}

function switchResTab(n) {
  document.getElementById('resPanel1').style.display = n===1 ? 'block' : 'none';
  document.getElementById('resPanel2').style.display = n===2 ? 'block' : 'none';
  ['resTab1','resTab2'].forEach(function(id,i){
    var el = document.getElementById(id);
    var active = (i+1)===n;
    el.style.background = active ? '#1a73e8' : '#fff';
    el.style.color = active ? '#fff' : '#5f6b7a';
    el.style.borderColor = active ? '#1a73e8' : '#e2e6ed';
  });
}

var lastKakaoNames = []; // ì¹´ì¹´ì˜¤ ê²€ìƒ‰ ê²°ê³¼ ì—…ì²´ëª… ì €ì¥

async function doRegionSearch() {
  var region = bizState.sido;
  if(bizState.sigungu) region += ' ' + bizState.sigungu;
  if(bizState.dong) region += ' ' + bizState.dong;
  if(!region) { toast('ì§€ì—­ì„ ì„ íƒí•˜ì„¸ìš”.'); return; }
  document.getElementById('bizStep0').style.display = 'none';
  document.getElementById('bizStep1').style.display = 'none';
  document.getElementById('bizStep2').style.display = 'none';
  document.getElementById('bizStep3').style.display = 'block';
  document.getElementById('bizResultList').innerHTML = '<div style="text-align:center;padding:30px;color:#8892a4">â³ í•´ë‹¹ ì§€ì—­ ì „ì²´ ì—…ì²´ ê²€ìƒ‰ ì¤‘...</div>';
  document.getElementById('fssTableBody').innerHTML = '<tr><td colspan="8" style="text-align:center;padding:30px;color:#8892a4">â³ ì‹ì•½ì²˜ ì¡°íšŒ ì¤‘...</td></tr>';
  document.getElementById('bizKakaoCount').textContent = '...';
  document.getElementById('bizFssCount').textContent = '...';
  // 1. ì¹´ì¹´ì˜¤ë§µ ì˜ì—­ ê¸°ë°˜ ê²€ìƒ‰ (ë‹¤ì¤‘ í‚¤ì›Œë“œ + í˜ì´ì§€ë„¤ì´ì…˜)
  await searchKakaoArea(region);
  // 2. ì¹´ì¹´ì˜¤ ê²°ê³¼ì˜ ì—…ì²´ëª…ìœ¼ë¡œ ì‹ì•½ì²˜ ê²€ìƒ‰
  await searchFss(region);
  initResultMap(region);
}

async function doBizQuickSearch() {
  var q = document.getElementById('bizQuickSearch').value.trim();
  if(!q) { toast('ì—…ì²´ëª…ì„ ì…ë ¥í•˜ì„¸ìš”.'); return; }
  bizState = {sido:'ê²€ìƒ‰', sigungu:q, dong:''};
  updateBreadcrumb();
  document.getElementById('bizStep0').style.display = 'none';
  document.getElementById('bizStep1').style.display = 'none';
  document.getElementById('bizStep2').style.display = 'none';
  document.getElementById('bizStep3').style.display = 'block';
  document.getElementById('bizResultList').innerHTML = '<div style="text-align:center;padding:30px;color:#8892a4">â³ ê²€ìƒ‰ ì¤‘...</div>';
  document.getElementById('fssTableBody').innerHTML = '<tr><td colspan="8" style="text-align:center;padding:30px;color:#8892a4">â³ ì¡°íšŒ ì¤‘...</td></tr>';
  document.getElementById('bizKakaoCount').textContent = '...';
  document.getElementById('bizFssCount').textContent = '...';
  await searchKakao(q);
  await searchFss(q);
  initResultMap(q);
}

async function searchKakao(query) {
  lastKakaoNames = [];
  try {
    var res = await fetch('https://dapi.kakao.com/v2/local/search/keyword.json?query=' + encodeURIComponent(query) + '&size=15', {
      headers: {'Authorization': 'KakaoAK ' + KAKAO_REST_KEY}
    });
    var data = await res.json();
    var docs = data.documents || [];
    document.getElementById('bizKakaoCount').textContent = docs.length;
    // ì—…ì²´ëª… ì €ì¥ (ì‹ì•½ì²˜ ê²€ìƒ‰ìš©)
    docs.forEach(function(d){ lastKakaoNames.push(d.place_name); });
    if(docs.length === 0) {
      document.getElementById('bizResultList').innerHTML = '<div style="text-align:center;padding:30px;color:#8892a4">ì¹´ì¹´ì˜¤ë§µ ê²°ê³¼ ì—†ìŒ</div>';
      return;
    }
    bizMarkers2.forEach(function(m){ m.setMap(null); });
    bizMarkers2 = [];
    var bounds = bizMap2 ? new kakao.maps.LatLngBounds() : null;
    var html = '';
    docs.forEach(function(d, i) {
      var addr = d.road_address_name || d.address_name || '-';
      var phone = d.phone || '-';
      var cat = d.category_name || '';
      if(bizMap2){
        var pos = new kakao.maps.LatLng(parseFloat(d.y), parseFloat(d.x));
        var marker = new kakao.maps.Marker({position:pos, map:bizMap2});
        bizMarkers2.push(marker);
        bounds.extend(pos);
      }
      html += '<div style="padding:12px 20px;border-bottom:1px solid #eef0f4;display:flex;gap:12px" onmouseover="this.style.background=\'#f8f9fb\'" onmouseout="this.style.background=\'transparent\'">';
      html += '<div style="width:28px;height:28px;background:#e3f2fd;border-radius:7px;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:700;color:#1565c0;flex-shrink:0">' + (i+1) + '</div>';
      html += '<div style="flex:1;min-width:0">';
      html += '<div style="display:flex;align-items:center;gap:6px;margin-bottom:2px"><b style="font-size:13px;color:#1a2332">' + d.place_name + '</b>';
      if(cat) html += '<span style="font-size:9px;background:#f1f3f5;padding:1px 5px;border-radius:3px;color:#8892a4">' + cat.split(' > ').pop() + '</span>';
      html += '</div>';
      html += '<div style="font-size:11px;color:#5f6b7a">ğŸ“ ' + addr + '  Â·  ğŸ“ ' + phone + '</div>';
      html += '<div style="display:flex;gap:5px;margin-top:5px">';
      html += '<span id="kD' + i + '" style="font-size:10px;color:#1565c0;background:#e3f2fd;padding:2px 7px;border-radius:4px;cursor:pointer" onclick="calcDist(\'' + d.x + '\',\'' + d.y + '\',\'kD' + i + '\')">ğŸ“ ê±°ë¦¬</span>';
      if(d.place_url) html += '<a href="' + d.place_url + '" target="_blank" style="font-size:10px;color:#e65100;background:#fff3e0;padding:2px 7px;border-radius:4px;text-decoration:none">ğŸ—ºï¸</a>';
      html += '<button style="font-size:10px;padding:2px 8px;background:#2e7d32;color:#fff;border:none;border-radius:4px;cursor:pointer" onclick="bizReg(\'' + d.place_name.replace(/'/g,"\\'") + '\',\'' + addr.replace(/'/g,"\\'") + '\')">+ ë“±ë¡</button>';
      html += '</div></div></div>';
    });
    document.getElementById('bizResultList').innerHTML = html;
    if(bizMap2 && bounds) bizMap2.setBounds(bounds);
  } catch(e) {
    document.getElementById('bizResultList').innerHTML = '<div style="text-align:center;padding:30px;color:#e53935">âŒ ' + e.message + '</div>';
    document.getElementById('bizKakaoCount').textContent = '0';
  }
}

async function searchFss(region) {
  var apiKey = document.getElementById('fssApiKey').value.trim();
  if(!apiKey) {
    document.getElementById('fssTableBody').innerHTML = '<tr><td colspan="8" style="text-align:center;padding:30px;color:#e65100">ğŸ”‘ ì‹ì•½ì²˜ API í‚¤ë¥¼ ì…ë ¥í•˜ë©´ ì¸í—ˆê°€ ì •ë³´ë„ ì¡°íšŒë©ë‹ˆë‹¤</td></tr>';
    document.getElementById('bizFssCount').textContent = '-';
    return;
  }
  var baseUrl = 'https://openapi.foodsafetykorea.go.kr/api/' + apiKey + '/I1220/json/1/100';
  var allRows = [];
  var searchNames = [];

  if(bizState.sido === 'ê²€ìƒ‰' && bizState.sigungu) {
    // ë¹ ë¥¸ê²€ìƒ‰: ì…ë ¥í•œ í‚¤ì›Œë“œë¡œ ì§ì ‘ ê²€ìƒ‰
    searchNames = [bizState.sigungu];
  } else {
    // ì§€ì—­ ë“œë¦´ë‹¤ìš´: ì¹´ì¹´ì˜¤ë§µ ê²°ê³¼ ì—…ì²´ëª…ìœ¼ë¡œ ê²€ìƒ‰ (ìµœëŒ€ 10ê°œ)
    if(lastKakaoNames.length === 0) {
      document.getElementById('fssTableBody').innerHTML = '<tr><td colspan="8" style="text-align:center;padding:20px;color:#8892a4;font-size:12px">ì¹´ì¹´ì˜¤ë§µ ê²°ê³¼ê°€ ì—†ì–´ ì‹ì•½ì²˜ ì¡°íšŒë¥¼ ê±´ë„ˆëœë‹ˆë‹¤.</td></tr>';
      document.getElementById('bizFssCount').textContent = '0';
      return;
    }
    // ì—…ì²´ëª…ì—ì„œ í•µì‹¬ ë‹¨ì–´ ì¶”ì¶œ (ê´„í˜¸/ë²•ì¸ ë“± ì œê±°)
    var uniqueNames = [];
    lastKakaoNames.forEach(function(n) {
      var clean = n.replace(/\(ì£¼\)|\(ìœ \)|ì£¼ì‹íšŒì‚¬|ë†ì—…íšŒì‚¬ë²•ì¸|ìœ í•œíšŒì‚¬/g, '').trim();
      if(clean && uniqueNames.indexOf(clean) === -1) uniqueNames.push(clean);
    });
    searchNames = uniqueNames.slice(0, 10);
  }

  // ê° ì—…ì²´ëª…ìœ¼ë¡œ ì‹ì•½ì²˜ ê²€ìƒ‰
  for(var i = 0; i < searchNames.length; i++) {
    try {
      var apiUrl = baseUrl + '/BSSH_NM=' + encodeURIComponent(searchNames[i]);
      var text = '';
      // CORS í”„ë¡ì‹œ
      try {
        var res = await fetch('https://api.allorigins.win/raw?url=' + encodeURIComponent(apiUrl));
        text = await res.text();
      } catch(e1) {
        try { var res2 = await fetch(apiUrl); text = await res2.text(); } catch(e2){ text = ''; }
      }
      if(!text || !text.startsWith('{')) continue;
      var data = JSON.parse(text);
      var key = Object.keys(data)[0];
      var rows = (data[key] && data[key].row) ? data[key].row : [];
      rows.forEach(function(r){ r._t = 'food'; });
      // ì¤‘ë³µ ì œê±° (ì¸í—ˆê°€ë²ˆí˜¸ ê¸°ì¤€)
      rows.forEach(function(r) {
        var dup = allRows.some(function(ar){ return ar.LCNS_NO === r.LCNS_NO; });
        if(!dup) allRows.push(r);
      });
    } catch(e){ console.log('FSS error:', searchNames[i], e.message); }
  }

  // ì§€ì—­ ë“œë¦´ë‹¤ìš´ì¸ ê²½ìš°: ê²€ìƒ‰ ì§€ì—­ ì£¼ì†Œë¡œ í•„í„°ë§
  if(bizState.sido !== 'ê²€ìƒ‰' && allRows.length > 0) {
    var SIDO_FULL = {'ì„œìš¸':'ì„œìš¸','ë¶€ì‚°':'ë¶€ì‚°','ëŒ€êµ¬':'ëŒ€êµ¬','ì¸ì²œ':'ì¸ì²œ','ê´‘ì£¼':'ê´‘ì£¼','ëŒ€ì „':'ëŒ€ì „','ìš¸ì‚°':'ìš¸ì‚°','ì„¸ì¢…':'ì„¸ì¢…',
      'ê²½ê¸°':'ê²½ê¸°ë„','ê°•ì›':'ê°•ì›ë„','ì¶©ë¶':'ì¶©ì²­ë¶ë„','ì¶©ë‚¨':'ì¶©ì²­ë‚¨ë„','ì „ë¶':'ì „ë¼ë¶ë„','ì „ë‚¨':'ì „ë¼ë‚¨ë„','ê²½ë¶':'ê²½ìƒë¶ë„','ê²½ë‚¨':'ê²½ìƒë‚¨ë„','ì œì£¼':'ì œì£¼'};
    var sidoKey = SIDO_FULL[bizState.sido] || bizState.sido;
    var sgKey = bizState.sigungu || '';
    allRows = allRows.filter(function(r) {
      var addr = (r.LOCP_ADDR || '').replace(/\s+/g, ' ');
      // ì‹œë„ ë§¤ì¹­
      if(addr.indexOf(sidoKey) < 0 && addr.indexOf(bizState.sido) < 0) return false;
      // ì‹œêµ°êµ¬ ë§¤ì¹­ (ìˆìœ¼ë©´)
      if(sgKey && addr.indexOf(sgKey) < 0) {
        // "íŒŒì£¼ì‹œ" â†’ "íŒŒì£¼" ë¡œë„ ë§¤ì¹­ ì‹œë„
        var sgShort = sgKey.replace(/ì‹œ$|êµ°$|êµ¬$/,'');
        if(addr.indexOf(sgShort) < 0) return false;
      }
      return true;
    });
  }

  document.getElementById('bizFssCount').textContent = allRows.length;
  if(allRows.length === 0) {
    document.getElementById('fssTableBody').innerHTML = '<tr><td colspan="8" style="text-align:center;padding:20px;color:#8892a4;font-size:12px">ì¸í—ˆê°€ ê²°ê³¼ ì—†ìŒ<br><span style="font-size:11px">CORS ì°¨ë‹¨ìœ¼ë¡œ ì¡°íšŒ ë¶ˆê°€ ì‹œ, ë¸Œë¼ìš°ì €ì—ì„œ ì§ì ‘ í™•ì¸:<br><a href="https://openapi.foodsafetykorea.go.kr/api/' + apiKey + '/I1220/json/1/5/BSSH_NM=' + encodeURIComponent(bizState.sigungu||bizState.sido||'') + '" target="_blank" style="color:#1565c0">ğŸ”— ì‹ì•½ì²˜ API ì§ì ‘ ì—´ê¸°</a></span></td></tr>';
    return;
  }
  var html = '';
  allRows.forEach(function(r, i){
    var nm = r.BSSH_NM || '-';
    var ceo = r.PRSDNT_NM || '-';
    var biz = r.INDUTY_NM || '-';
    var lic = r.LCNS_NO || '-';
    var addr = r.LOCP_ADDR || '-';
    var org = r.INSTT_NM || '';
    var tel = r.TELNO || '';
    html += '<tr>';
    html += '<td><b>' + nm + '</b>' + (tel ? '<br><span style="font-size:10px;color:#8892a4">ğŸ“ ' + tel + '</span>' : '') + '</td>';
    html += '<td>' + ceo + '</td>';
    html += '<td><span style="font-size:11px">' + biz + '</span></td>';
    html += '<td style="font-size:10px;font-family:monospace">' + lic + '</td>';
    html += '<td style="font-size:11px;max-width:180px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap" title="' + addr + '">' + addr + '</td>';
    html += '<td><span style="font-size:11px;color:#1565c0">' + org + '</span></td>';
    html += '<td><span id="fD' + i + '" style="font-size:10px;color:#1565c0;background:#e3f2fd;padding:2px 6px;border-radius:4px;cursor:pointer" onclick="calcAddrDist(\'' + addr.replace(/'/g,"\\'") + '\',\'fD' + i + '\')">ğŸ“</span></td>';
    html += '<td><button style="font-size:10px;padding:2px 8px;background:#2e7d32;color:#fff;border:none;border-radius:4px;cursor:pointer" onclick="bizReg(\'' + nm.replace(/'/g,"\\'") + '\',\'' + addr.replace(/'/g,"\\'") + '\')">+ ë“±ë¡</button></td>';
    html += '</tr>';
  });
  document.getElementById('fssTableBody').innerHTML = html;
  toast('ğŸ­ ì‹ì•½ì²˜ ' + allRows.length + 'ê±´ ì¡°íšŒ');
}

function initResultMap(query) {
  try {
    var el = document.getElementById('bizResultMap');
    if(!bizMap2) bizMap2 = new kakao.maps.Map(el, {center:new kakao.maps.LatLng(36.5,127.5), level:13});
    fetch('https://dapi.kakao.com/v2/local/search/address.json?query=' + encodeURIComponent(query.replace(' ì‹í’ˆ','')) + '&size=1', {
      headers:{'Authorization':'KakaoAK ' + KAKAO_REST_KEY}
    }).then(function(r){return r.json()}).then(function(data){
      if(data.documents && data.documents[0]){
        bizMap2.setCenter(new kakao.maps.LatLng(parseFloat(data.documents[0].y), parseFloat(data.documents[0].x)));
        bizMap2.setLevel(7);
      }
    });
  } catch(e){ document.getElementById('bizResultMap').innerHTML = '<div style="padding:40px;text-align:center;color:#8892a4">ì§€ë„ í‘œì‹œ ë¶ˆê°€</div>'; }
}

async function calcDist(x, y, elId) {
  var el = document.getElementById(elId); el.innerHTML = 'â³';
  try {
    var res = await fetch('https://apis-navi.kakaomobility.com/v1/directions?origin='+COMPANY_ORIGIN.x+','+COMPANY_ORIGIN.y+'&destination='+x+','+y, {
      headers:{'Authorization':'KakaoAK '+KAKAO_REST_KEY}
    });
    var d = await res.json(), r = d.routes[0];
    if(r.result_code===0){
      el.innerHTML = 'ğŸš— '+(r.summary.distance/1000).toFixed(0)+'km Â· '+Math.round(r.summary.duration/60)+'ë¶„';
      el.style.background='#e8f5e9'; el.style.color='#2e7d32';
    } else { el.innerHTML='ê²½ë¡œì—†ìŒ'; }
  } catch(e){ el.innerHTML='âŒ'; }
}

async function calcAddrDist(addr, elId) {
  var el = document.getElementById(elId); el.innerHTML = 'â³';
  try {
    var g = await fetch('https://dapi.kakao.com/v2/local/search/address.json?query='+encodeURIComponent(addr),{headers:{'Authorization':'KakaoAK '+KAKAO_REST_KEY}});
    var gd = await g.json();
    if(gd.documents && gd.documents[0]) calcDist(gd.documents[0].x, gd.documents[0].y, elId);
    else el.innerHTML='-';
  } catch(e){ el.innerHTML='âŒ'; }
}

function bizReg(name, addr) {
  showPage('customerReg');
  var c = document.getElementById('regCompany');
  if(c) c.value = name;
  toast('ğŸ“‹ "'+name+'" â†’ ê³ ê°ì‚¬ ë“±ë¡');
}

// â”€â”€ hash ê¸°ë°˜ í˜ì´ì§€ ë¼ìš°íŒ… â”€â”€
(function(){
  var h = location.hash.replace('#','');
  if (h && pageNames[h]) { showPage(h); }
})();

// â”€â”€ API ìˆ˜ì§‘ ì„¤ì • â”€â”€
var apiSettingsData = {
  collectTime: '03:00',
  collectMode: 'incremental',
  serverUrl: 'http://localhost:5050',
  activeApis: ['I1220','I2829','I-0020','I1300','I1320','I2835','I2831','C001','I1260',
               'I1250','I1310','C002','C003','C006','I2859','I2860']
};

// ì €ì¥ëœ ì„¤ì • ë¡œë“œ
(function loadSavedSettings(){
  try {
    var saved = JSON.parse(sessionStorage.getItem('apiSettings'));
    if(saved) {
      apiSettingsData = saved;
      // UI ë°˜ì˜
      setTimeout(function(){
        var timeEl = document.getElementById('collectTime');
        if(timeEl) timeEl.value = saved.collectTime || '03:00';
        var modeEl = document.getElementById('collectMode');
        if(modeEl) modeEl.value = saved.collectMode || 'incremental';
        var urlEl = document.getElementById('apiServerUrl');
        if(urlEl) urlEl.value = saved.serverUrl || 'http://localhost:5050';
        // ì²´í¬ë°•ìŠ¤ ë°˜ì˜
        document.querySelectorAll('#page-apiSettings .api-check input[type="checkbox"]').forEach(function(cb){
          var apiId = cb.closest('.api-item').id.replace('api-','');
          cb.checked = saved.activeApis.indexOf(apiId) >= 0;
        });
        updateApiCount();
      }, 100);
    }
  } catch(e){}
})();

function updateApiCount() {
  var checks = document.querySelectorAll('#page-apiSettings .api-check input[type="checkbox"]');
  var active = 0;
  checks.forEach(function(cb){ if(cb.checked) active++; });
  var el = document.getElementById('apiActiveCount');
  if(el) el.textContent = active;
  var nextEl = document.getElementById('apiNextCollect');
  var timeEl = document.getElementById('collectTime');
  if(nextEl && timeEl) nextEl.textContent = timeEl.value;
}

function toggleApiGroup(groupId) {
  var el = document.getElementById(groupId);
  var arrow = document.getElementById(groupId + 'Arrow');
  if(!el) return;
  if(el.style.display === 'none') {
    el.style.display = 'block';
    if(arrow) arrow.textContent = 'â–¼';
  } else {
    el.style.display = 'none';
    if(arrow) arrow.textContent = 'â–¶';
  }
}

function checkAllApis(checked) {
  document.querySelectorAll('#page-apiSettings .api-check input[type="checkbox"]').forEach(function(cb){
    cb.checked = checked;
  });
  updateApiCount();
}

function saveApiSettings() {
  var checks = document.querySelectorAll('#page-apiSettings .api-check input[type="checkbox"]');
  var activeApis = [];
  checks.forEach(function(cb){
    if(cb.checked) {
      var apiId = cb.closest('.api-item').id.replace('api-','');
      activeApis.push(apiId);
    }
  });

  apiSettingsData = {
    collectTime: document.getElementById('collectTime').value,
    collectMode: document.getElementById('collectMode').value,
    serverUrl: document.getElementById('apiServerUrl').value.trim(),
    activeApis: activeApis
  };

  // ì„¸ì…˜ ì €ì¥
  sessionStorage.setItem('apiSettings', JSON.stringify(apiSettingsData));

  // ì„œë²„ì— ì„¤ì • ì „ì†¡ ì‹œë„
  var url = apiSettingsData.serverUrl + '/api/settings';
  fetch(url, {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify(apiSettingsData)
  }).then(function(res){ return res.json(); })
    .then(function(data){
      if(data.success) {
        toast('âœ… ì„¤ì •ì´ ì„œë²„ì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤. ìˆ˜ì§‘ ì‹œê°: ' + apiSettingsData.collectTime + ' KST');
      } else {
        toast('âš ï¸ ë¡œì»¬ ì €ì¥ ì™„ë£Œ. ì„œë²„ ì €ì¥ì€ ì‹¤íŒ¨: ' + (data.error || ''));
      }
    })
    .catch(function(){
      toast('ğŸ’¾ ë¡œì»¬ ì €ì¥ ì™„ë£Œ. (ì„œë²„ ì—°ê²° ì‹œ ìë™ ë™ê¸°í™”ë©ë‹ˆë‹¤)');
    });

  updateApiCount();
}

function testApiConnection() {
  var url = document.getElementById('apiServerUrl').value.trim();
  if(!url) { toast('âš ï¸ API ì„œë²„ ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”.'); return; }

  document.getElementById('collectStatusArea').innerHTML =
    '<div style="padding:20px;text-align:center;color:#1a73e8">ğŸ”„ ì—°ê²° í…ŒìŠ¤íŠ¸ ì¤‘...</div>';

  fetch(url + '/api/status')
    .then(function(res){ return res.json(); })
    .then(function(data){
      if(data.success) {
        toast('âœ… API ì„œë²„ ì—°ê²° ì„±ê³µ!');
        renderCollectStatus(data);
      } else {
        toast('âŒ ì„œë²„ ì‘ë‹µ ì˜¤ë¥˜');
        document.getElementById('collectStatusArea').innerHTML =
          '<div style="color:#e53935;padding:20px;text-align:center">ì„œë²„ ì‘ë‹µ ì˜¤ë¥˜: ' + JSON.stringify(data) + '</div>';
      }
    })
    .catch(function(e){
      toast('âŒ ì„œë²„ ì—°ê²° ì‹¤íŒ¨: ' + e.message);
      document.getElementById('collectStatusArea').innerHTML =
        '<div style="color:#e53935;padding:20px;text-align:center">ì—°ê²° ì‹¤íŒ¨: ' + e.message +
        '<br><br><span style="font-size:11px;color:#8892a4">ì„œë²„ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸í•˜ì„¸ìš”.<br>' +
        'bioflseverì—ì„œ: <code>sudo systemctl status fss-api</code></span></div>';
    });
}

function loadCollectStatus() {
  var url = document.getElementById('apiServerUrl').value.trim();
  if(!url) { toast('âš ï¸ API ì„œë²„ ì£¼ì†Œë¥¼ ë¨¼ì € ì…ë ¥í•˜ì„¸ìš”.'); return; }
  testApiConnection();
}

function renderCollectStatus(data) {
  var html = '';

  // í…Œì´ë¸”ë³„ ìš”ì•½
  var tableNames = {
    'fss_businesses': 'ì—…ì†Œ ì¸í—ˆê°€',
    'fss_products': 'í’ˆëª© ì œì¡°',
    'fss_materials': 'ì›ì¬ë£Œ',
    'fss_changes': 'ë³€ê²½ ì´ë ¥'
  };

  html += '<div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:10px;margin-bottom:16px">';
  if(data.tables) {
    for(var tbl in data.tables) {
      var t = data.tables[tbl];
      var name = tableNames[tbl] || tbl;
      var cnt = t.count ? t.count.toLocaleString() : '0';
      var last = t.last_collected ? t.last_collected.substring(0,16) : '-';
      html += '<div style="padding:12px;background:#f8f9fb;border-radius:8px;border:1px solid #eef0f4">';
      html += '<div style="font-size:11px;color:#8892a4">' + name + '</div>';
      html += '<div style="font-size:20px;font-weight:700;color:#1a2332">' + cnt + '</div>';
      html += '<div style="font-size:10px;color:#b0b8c4">ìµœê·¼: ' + last + '</div>';
      html += '</div>';
    }
  }
  html += '</div>';

  // ìµœê·¼ ìˆ˜ì§‘ ë¡œê·¸
  if(data.recent_logs && data.recent_logs.length > 0) {
    html += '<div style="font-size:12px;font-weight:700;margin-bottom:8px;color:#1a2332">ìµœê·¼ ìˆ˜ì§‘ ì´ë ¥</div>';
    data.recent_logs.forEach(function(log){
      var dt = (log.started_at || '').substring(0,16);
      var dotClass = log.error_count > 0 ? 'err' : 'ok';
      html += '<div class="collect-row">';
      html += '<span class="collect-dot ' + dotClass + '"></span>';
      html += '<span style="color:#8892a4;min-width:100px">' + dt + '</span>';
      html += '<span style="font-weight:600;min-width:60px">' + log.api_source + '</span>';
      html += '<span style="flex:1">' + (log.api_name || '') + '</span>';
      html += '<span style="color:#1a73e8">' + (log.fetched_count||0).toLocaleString() + 'ê±´</span>';
      html += '<span style="color:#2e7d32;margin-left:8px">+' + (log.inserted_count||0) + '</span>';
      html += '<span style="color:#e65100;margin-left:4px">â†»' + (log.updated_count||0) + '</span>';
      if(log.error_count > 0) html += '<span style="color:#e53935;margin-left:4px">âœ—' + log.error_count + '</span>';
      html += '<span style="color:#b0b8c4;margin-left:8px">' + (log.duration_sec||0) + 'ì´ˆ</span>';
      html += '</div>';
    });

    // ìµœê·¼ ìˆ˜ì§‘ì¼ì‹œ ì—…ë°ì´íŠ¸
    var lastEl = document.getElementById('apiLastCollect');
    if(lastEl && data.recent_logs[0]) {
      lastEl.textContent = (data.recent_logs[0].started_at || '').substring(5,16);
    }
  } else {
    html += '<div style="text-align:center;color:#8892a4;padding:16px">ìˆ˜ì§‘ ì´ë ¥ì´ ì—†ìŠµë‹ˆë‹¤. ìµœì´ˆ ìˆ˜ì§‘ì„ ì‹¤í–‰í•˜ì„¸ìš”.</div>';
  }

  document.getElementById('collectStatusArea').innerHTML = html;
}

// í˜ì´ì§€ ì§„ì… ì‹œ ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸
(function(){
  setTimeout(updateApiCount, 200);
})();

</script>
<script>
// ì‚¬ì´ë“œë°” JS â†’ js/sidebar.jsë¡œ ì´ê´€ë¨
// í•´ì‹œ ê¸°ë°˜ ì„œë¸Œ í˜ì´ì§€ ì „í™˜ì€ sidebar.js renderSidebar í›„ ìë™ ì²˜ë¦¬
(function initSalesHash() {
  // sidebar.jsê°€ DOMContentLoadedì—ì„œ renderSidebarë¥¼ ì‹¤í–‰í•œ í›„,
  // í•´ì‹œê°€ ìˆìœ¼ë©´ showPage í˜¸ì¶œ
  function handleHash() {
    const hash = location.hash.replace('#', '');
    if (hash && typeof showPage === 'function') {
      showPage(hash);
    }
  }
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', function() { setTimeout(handleHash, 50); });
  } else {
    setTimeout(handleHash, 50);
  }
})();
// ====== END SALES HASH HANDLER ======
</script>
</body>
</html>
