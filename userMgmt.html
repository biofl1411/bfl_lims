<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BioFoodLab LIMS - ì‚¬ìš©ì ê´€ë¦¬</title>
<style>
:root{--primary:#2563eb;--success:#10b981;--gray-50:#f9fafb;--gray-100:#f3f4f6;--gray-200:#e5e7eb;--gray-600:#4b5563;--gray-900:#111827}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","Noto Sans KR",sans-serif;background:#f5f5f5;color:#1a1a1a}
.app-layout{display:flex;height:100vh}
/* ====== UNIFIED SIDEBAR STYLES ====== */
.sidebar{width:250px;background:#1a2332;color:white;position:fixed;left:0;top:0;bottom:0;z-index:1000;overflow-y:auto;overflow-x:hidden;display:flex;flex-direction:column;font-family:'Pretendard',-apple-system,BlinkMacSystemFont,"Segoe UI","Noto Sans KR",sans-serif}
.logo{padding:20px;display:flex;align-items:center;gap:12px;border-bottom:1px solid rgba(255,255,255,0.08);flex-shrink:0}
.logo-icon{width:40px;height:40px;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:20px}
.logo-text{display:flex;flex-direction:column}
.logo-title{font-size:18px;font-weight:700}
.logo-subtitle{font-size:11px;color:#94a3b8}
.sidebar-nav{flex:1;padding:8px 0;overflow-y:auto}
.nav-group{margin-bottom:2px}
.nav-parent{padding:10px 20px;display:flex;align-items:center;gap:10px;color:#8ea4c0;font-size:13px;font-weight:500;cursor:pointer;text-decoration:none;transition:all 0.15s;border:none;background:none;width:100%}
.nav-parent:hover{background:rgba(255,255,255,0.05);color:#c8d6e5}
.nav-parent.active{color:#4fc3f7;background:rgba(79,195,247,0.1);font-weight:600}
.nav-parent.disabled{color:#4a6785;cursor:default}
.nav-parent.disabled:hover{background:transparent;color:#4a6785}
.nav-icon{font-size:16px;width:22px;text-align:center;flex-shrink:0}
.nav-label{flex:1;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.nav-arrow{font-size:10px;color:#5a6a7e;transition:transform 0.2s;margin-left:auto}
.nav-group.expanded .nav-arrow{transform:rotate(180deg)}
.nav-submenu{list-style:none;max-height:0;overflow:hidden;transition:max-height 0.25s ease;margin-left:32px;border-left:2px solid rgba(79,195,247,0.15);padding-left:10px}
.nav-group.expanded .nav-submenu{max-height:500px}
.nav-sub-item{display:block;padding:7px 12px;font-size:12px;color:#6b7d93;text-decoration:none;border-radius:6px;cursor:pointer;transition:all 0.15s;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.nav-sub-item:hover{color:#8ea4c0;background:rgba(255,255,255,0.03)}
.nav-sub-item.active{color:#4fc3f7;font-weight:600;background:rgba(79,195,247,0.08)}
.nav-sub-item.disabled{color:#3d5068;cursor:default}
.nav-sub-item.disabled:hover{background:transparent;color:#3d5068}
/* ====== END UNIFIED SIDEBAR STYLES ====== */
.main-container{flex:1;margin-left:250px;display:flex;flex-direction:column;overflow:hidden}
.top-header{background:white;padding:16px 24px;border-bottom:1px solid #e5e7eb;display:flex;justify-content:space-between}
.breadcrumb{display:flex;align-items:center;gap:8px;font-size:14px;color:#64748b}
.breadcrumb-current{color:#1e293b;font-weight:600}
.main-content{flex:1;overflow-y:auto;padding:24px}
.stats-row{display:grid;grid-template-columns:repeat(4,1fr);gap:16px;margin-bottom:24px}
.stat-card{background:white;padding:20px;border-radius:12px;box-shadow:0 1px 3px rgba(0,0,0,0.1)}
.stat-value{font-size:28px;font-weight:700;margin-bottom:4px}
.stat-label{font-size:13px;color:#64748b}
.toolbar{background:white;padding:20px;border-radius:12px;margin-bottom:20px;box-shadow:0 1px 3px rgba(0,0,0,0.1);display:flex;justify-content:space-between;align-items:center;gap:16px}
.search-box{flex:1;max-width:400px}
.search-box input{width:100%;padding:10px 16px;border:1px solid #d1d5db;border-radius:8px;font-size:14px}
.filter-group{display:flex;gap:12px}
.filter-select{padding:10px 16px;border:1px solid #d1d5db;border-radius:8px;font-size:14px}
.btn{padding:10px 20px;border-radius:8px;font-size:14px;font-weight:500;cursor:pointer;border:none;display:inline-flex;align-items:center;gap:8px;transition:all .2s}
.btn-primary{background:var(--primary);color:white}
.btn-success{background:var(--success);color:white}
.btn-sm{padding:6px 12px;font-size:12px}
.table-container{background:white;border-radius:12px;box-shadow:0 1px 3px rgba(0,0,0,0.1);overflow:hidden}
table{width:100%;border-collapse:collapse}
thead{background:var(--gray-50);border-bottom:2px solid var(--gray-200)}
th{padding:12px 16px;text-align:left;font-size:13px;font-weight:600;color:var(--gray-600)}
tbody tr{border-bottom:1px solid var(--gray-100);transition:background .2s}
tbody tr:hover{background:var(--gray-50)}
td{padding:14px 16px;font-size:14px}
.badge{display:inline-block;padding:4px 10px;border-radius:12px;font-size:12px;font-weight:500}
.badge-primary{background:#dbeafe;color:var(--primary)}
.edit-input{padding:4px 8px;border:1px solid #d1d5db;border-radius:6px;font-size:13px}
th{cursor:pointer;user-select:none}
th:hover{background:var(--gray-100)}
th .sort-arrow{font-size:10px;margin-left:4px;color:#9ca3af}
.badge-success{background:#d1fae5;color:var(--success)}
.modal-overlay{display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.5);z-index:2000;align-items:center;justify-content:center}
.modal-overlay.active{display:flex}
.modal{background:white;border-radius:12px;width:90%;max-width:600px;max-height:80vh;overflow-y:auto}
.modal-header{padding:20px 24px;border-bottom:1px solid var(--gray-200);display:flex;justify-content:space-between}
.modal-title{font-size:18px;font-weight:700}
.modal-close{background:none;border:none;font-size:24px;cursor:pointer}
.modal-body{padding:24px}
.form-group{margin-bottom:20px}
.form-label{display:block;font-size:14px;font-weight:600;margin-bottom:8px;color:var(--gray-600)}
.form-input,.form-select{width:100%;padding:10px 12px;border:1px solid #d1d5db;border-radius:6px;font-size:14px}
.form-actions{display:flex;gap:12px;justify-content:flex-end;margin-top:24px}
</style>
</head>
<body>
<div class="app-layout">
<aside class="sidebar" id="sidebar"></aside>
<script src="js/sidebar.js?v=2"></script>
<div class="main-container">
<header class="top-header">
<div class="breadcrumb">
<span>ê´€ë¦¬ì</span>
<span>â€º</span>
<span class="breadcrumb-current">ì‚¬ìš©ì ê´€ë¦¬</span>
</div>
</header>
<main class="main-content">
<div class="stats-row">
<div class="stat-card">
<div class="stat-value" style="color:var(--primary)">56</div>
<div class="stat-label">ì „ì²´ ì‚¬ìš©ì</div>
</div>
<div class="stat-card">
<div class="stat-value" style="color:var(--success)">9</div>
<div class="stat-label">ë¶€ì„œ ìˆ˜</div>
</div>
<div class="stat-card">
<div class="stat-value">31</div>
<div class="stat-label">ì‹í’ˆì¶•ì‚°ë¶„ì„ì‹¤</div>
</div>
<div class="stat-card">
<div class="stat-value">6</div>
<div class="stat-label">ê³ ê°ì§€ì›íŒ€</div>
</div>
</div>
<div class="toolbar">
<div class="search-box">
<input type="text" id="searchInput" placeholder="ì´ë¦„, ì•„ì´ë””ë¡œ ê²€ìƒ‰..." onkeyup="filterUsers()">
</div>
<div class="filter-group">
<select id="deptFilter" class="filter-select" onchange="filterUsers()">
<option value="">ì „ì²´ ë¶€ì„œ</option>
</select>
<select id="posFilter" class="filter-select" onchange="filterUsers()">
<option value="">ì „ì²´ ì§ê¸‰</option>
</select>
<button class="btn btn-success" onclick="openAddModal()">â• ì‚¬ìš©ì ì¶”ê°€</button>
<button class="btn btn-outline" onclick="exportExcel()">ğŸ“¥ ì—‘ì…€ ë‚´ë³´ë‚´ê¸°</button>
</div>
</div>
<div class="table-container">
<table>
<thead>
<tr>
<th onclick="sortBy('no')">No<span class="sort-arrow" id="sort-no"></span></th>
<th onclick="sortBy('ì•„ì´ë””')">ì•„ì´ë””<span class="sort-arrow" id="sort-ì•„ì´ë””"></span></th>
<th onclick="sortBy('ë¶€ì„œëª…')">ë¶€ì„œ<span class="sort-arrow" id="sort-ë¶€ì„œëª…"></span></th>
<th onclick="sortBy('íŒ€ëª…')">íŒ€<span class="sort-arrow" id="sort-íŒ€ëª…"></span></th>
<th onclick="sortBy('ì ‘ìˆ˜ì')">ì ‘ìˆ˜ì<span class="sort-arrow" id="sort-ì ‘ìˆ˜ì"></span></th>
<th onclick="sortBy('ì§ê¸‰')">ì§ê¸‰<span class="sort-arrow" id="sort-ì§ê¸‰"></span></th>
<th onclick="sortBy('ì…ì‚¬ì¼')">ì…ì‚¬ì¼<span class="sort-arrow" id="sort-ì…ì‚¬ì¼"></span></th>
<th onclick="sortBy('í‡´ì‚¬ì¼')">í‡´ì‚¬ì¼<span class="sort-arrow" id="sort-í‡´ì‚¬ì¼"></span></th>
<th>ê´€ë¦¬</th>
</tr>
</thead>
<tbody id="userTable"></tbody>
</table>
</div>
</main>
</div>
</div>

<div class="modal-overlay" id="userModal">
<div class="modal">
<div class="modal-header">
<div class="modal-title">ì‚¬ìš©ì ì¶”ê°€</div>
<button class="modal-close" onclick="closeModal()">Ã—</button>
</div>
<div class="modal-body">
<div class="form-group">
<label class="form-label">ì•„ì´ë”” (ì´ë¦„)</label>
<input type="text" class="form-input" id="userId" placeholder="ì˜ˆ: í™ê¸¸ë™">
</div>
<div class="form-group">
<label class="form-label">ë¶€ì„œ</label>
<select class="form-select" id="userDept" onchange="updateTeamOptions()"></select>
</div>
<div class="form-group">
<label class="form-label">íŒ€</label>
<select class="form-select" id="userTeam">
<option value="">ì„ íƒ ì—†ìŒ</option>
</select>
</div>
<div class="form-group">
<label class="form-label">ì ‘ìˆ˜ì</label>
<input type="text" class="form-input" id="userReceiver" placeholder="ì ‘ìˆ˜ì ì´ë¦„">
</div>
<div class="form-group">
<label class="form-label">ì§ê¸‰</label>
<select class="form-select" id="userPos"></select>
</div>
<div class="form-group">
<label class="form-label">ì…ì‚¬ì¼</label>
<input type="date" class="form-input" id="userJoinDate">
</div>
<div class="form-group">
<label class="form-label">í‡´ì‚¬ì¼</label>
<input type="date" class="form-input" id="userLeaveDate">
</div>
<div class="form-actions">
<button class="btn btn-outline" onclick="closeModal()">ì·¨ì†Œ</button>
<button class="btn btn-primary" onclick="saveUser()">ì €ì¥</button>
</div>
</div>
</div>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-storage-compat.js"></script>
<script src="js/firebase-init.js"></script>
<script src="js/firestore-helpers.js"></script>

<script>
const USERS_DATA = [
  {
    "ë¶€ì„œëª…": "ì„ì›",
    "ì•„ì´ë””": "ì´ìš©í‘œ",
    "ì§ê¸‰": "ëŒ€í‘œì´ì‚¬"
  },
  {
    "ë¶€ì„œëª…": "ê´€ë¦¬íŒ€",
    "ì•„ì´ë””": "ê¹€ì˜ê¸°",
    "ì§ê¸‰": "ë¶€ì¥"
  },
  {
    "ë¶€ì„œëª…": "ê³ ê°ì§€ì›íŒ€",
    "ì•„ì´ë””": "í—ˆí˜„ë¯¸",
    "ì§ê¸‰": "ë¶€ì¥"
  },
  {
    "ë¶€ì„œëª…": "ì‹í’ˆì¶•ì‚°ë¶„ì„ì‹¤",
    "ì•„ì´ë””": "ê¹€ì§€ì˜",
    "ì§ê¸‰": "ê³¼ì¥"
  },
  {
    "ë¶€ì„œëª…": "ì‹í’ˆì¶•ì‚°ë¶„ì„ì‹¤",
    "ì•„ì´ë””": "ë¬¸ìœ ì§„",
    "ì§ê¸‰": "ëŒ€ë¦¬"
  },
  {
    "ë¶€ì„œëª…": "ì‹í’ˆì¶•ì‚°ë¶„ì„ì‹¤",
    "ì•„ì´ë””": "ìœ¤ì •í•œ",
    "ì§ê¸‰": "ì°¨ì¥"
  },
  {
    "ë¶€ì„œëª…": "ì‹í’ˆì¶•ì‚°ë¶„ì„ì‹¤",
    "ì•„ì´ë””": "ì†ìœ¤ì£¼",
    "ì§ê¸‰": "ë¶€ì¥"
  },
  {
    "ë¶€ì„œëª…": "í’ˆì§ˆë³´ì¦íŒ€",
    "ì•„ì´ë””": "ê¹€ì£¼í˜„",
    "ì§ê¸‰": "ë¶€ì¥"
  },
  {
    "ë¶€ì„œëª…": "ê³ ê°ì§€ì›íŒ€",
    "ì•„ì´ë””": "ì´ì€ê²½",
    "ì§ê¸‰": "ê³¼ì¥"
  },
  {
    "ë¶€ì„œëª…": "ê³ ê°ì§€ì›íŒ€",
    "ì•„ì´ë””": "ê¹€ìˆ˜ì •",
    "ì§ê¸‰": "ê³¼ì¥"
  },
  {
    "ë¶€ì„œëª…": "ê³ ê°ê´€ë¦¬",
    "ì•„ì´ë””": "ê¹€í¬ì„±",
    "ì§ê¸‰": "ë¶€ì¥"
  },
  {
    "ë¶€ì„œëª…": "ì‹í’ˆì¶•ì‚°ë¶„ì„ì‹¤",
    "ì•„ì´ë””": "ìµœì£¼ë¦¬",
    "ì§ê¸‰": "ëŒ€ë¦¬"
  },
  {
    "ë¶€ì„œëª…": "ì‹í’ˆì¶•ì‚°ë¶„ì„ì‹¤",
    "ì•„ì´ë””": "ê¹€ì§€ì€",
    "ì§ê¸‰": "ê³¼ì¥"
  },
  {
    "ë¶€ì„œëª…": "ì‹í’ˆì¶•ì‚°ë¶„ì„ì‹¤",
    "ì•„ì´ë””": "ê¹€ì‚¬ë¼",
    "ì§ê¸‰": "ê³¼ì¥"
  },
  {
    "ë¶€ì„œëª…": "ì‹í’ˆì¶•ì‚°ë¶„ì„ì‹¤",
    "ì•„ì´ë””": "ë¬¸íƒœì„±",
    "ì§ê¸‰": "ê³¼ì¥"
  },
  {
    "ë¶€ì„œëª…": "ì‹í’ˆì¶•ì‚°ë¶„ì„ì‹¤",
    "ì•„ì´ë””": "ì„œì„¸ì§„",
    "ì§ê¸‰": "ì°¨ì¥"
  },
  {
    "ë¶€ì„œëª…": "ê³ ê°ì§€ì›íŒ€",
    "ì•„ì´ë””": "ë°•ì‹ ì˜",
    "ì§ê¸‰": "ì°¨ì¥"
  },
  {
    "ë¶€ì„œëª…": "í’ˆì§ˆë³´ì¦íŒ€",
    "ì•„ì´ë””": "ê¹€ë¯¼ê·œ",
    "ì§ê¸‰": "ì°¨ì¥"
  },
  {
    "ë¶€ì„œëª…": "ì‹í’ˆì¶•ì‚°ë¶„ì„ì‹¤",
    "ì•„ì´ë””": "ì¥ë¯¼ê²½",
    "ì§ê¸‰": "ëŒ€ë¦¬"
  },
  {
    "ë¶€ì„œëª…": "ì‹í’ˆì¶•ì‚°ë¶„ì„ì‹¤",
    "ì•„ì´ë””": "ê¹€ë¯¼ì˜",
    "ì§ê¸‰": "ê³¼ì¥"
  },
  {
    "ë¶€ì„œëª…": "ì‹í’ˆì¶•ì‚°ë¶„ì„ì‹¤",
    "ì•„ì´ë””": "ì´ì¢…í›ˆ",
    "ì§ê¸‰": "ì£¼ì„"
  },
  {
    "ë¶€ì„œëª…": "ê²½ì˜ì§€ì›ì‹¤",
    "ì•„ì´ë””": "ê¹€ì„±í˜¸",
    "ì§ê¸‰": "ì „ë¬´ì´ì‚¬"
  },
  {
    "ë¶€ì„œëª…": "ê²½ì˜ì§€ì›ì‹¤",
    "ì•„ì´ë””": "ê¹€ìœ ë¹ˆ",
    "ì§ê¸‰": "ì£¼ì„"
  },
  {
    "ë¶€ì„œëª…": "ë§ˆì¼€íŒ…ì‚¬ì—…ë¶€",
    "ì•„ì´ë””": "ì¡°í˜„ì •",
    "ì§ê¸‰": "ì£¼ì„"
  },
  {
    "ë¶€ì„œëª…": "ê³ ê°ê´€ë¦¬",
    "ì•„ì´ë””": "ì¡°ë´‰í˜„",
    "ì§ê¸‰": "ëŒ€ë¦¬"
  },
  {
    "ë¶€ì„œëª…": "ë§ˆì¼€íŒ…ì‚¬ì—…ë¶€",
    "ì•„ì´ë””": "ì´ìŠ¬ê¸°",
    "ì§ê¸‰": "ëŒ€ë¦¬"
  },
  {
    "ë¶€ì„œëª…": "ê³ ê°ê´€ë¦¬",
    "ì•„ì´ë””": "ì—„ìƒí ",
    "ì§ê¸‰": "ë¶€ì¥"
  },
  {
    "ë¶€ì„œëª…": "ê³ ê°ì§€ì›íŒ€",
    "ì•„ì´ë””": "ë¥˜í•˜ëŠ˜",
    "ì§ê¸‰": "ëŒ€ë¦¬"
  },
  {
    "ë¶€ì„œëª…": "ì‹í’ˆì¶•ì‚°ë¶„ì„ì‹¤",
    "ì•„ì´ë””": "ì´ì§„ì•„",
    "ì§ê¸‰": "ì‚¬ì›"
  },
  {
    "ë¶€ì„œëª…": "ì‹í’ˆì¶•ì‚°ë¶„ì„ì‹¤",
    "ì•„ì´ë””": "ì§„ë¯¸ì •",
    "ì§ê¸‰": "ì‚¬ì›"
  },
  {
    "ë¶€ì„œëª…": "ì‹í’ˆì¶•ì‚°ë¶„ì„ì‹¤",
    "ì•„ì´ë””": "ê¹€ì„ í™”",
    "ì§ê¸‰": "ì‚¬ì›"
  },
  {
    "ë¶€ì„œëª…": "ê³ ê°ê´€ë¦¬",
    "ì•„ì´ë””": "ì˜¤ì„¸ì¤‘",
    "ì§ê¸‰": "ëŒ€ë¦¬"
  },
  {
    "ë¶€ì„œëª…": "ì‹í’ˆì¶•ì‚°ë¶„ì„ì‹¤",
    "ì•„ì´ë””": "ì—¼í•˜ë¦¼",
    "ì§ê¸‰": "ëŒ€ë¦¬"
  },
  {
    "ë¶€ì„œëª…": "ì‹í’ˆì¶•ì‚°ë¶„ì„ì‹¤",
    "ì•„ì´ë””": "ë°±ì§€ì—°",
    "ì§ê¸‰": "ì£¼ì„"
  },
  {
    "ë¶€ì„œëª…": "ì‹í’ˆì¶•ì‚°ë¶„ì„ì‹¤",
    "ì•„ì´ë””": "ë°•ì§€ìˆ˜",
    "ì§ê¸‰": "ì£¼ì„"
  },
  {
    "ë¶€ì„œëª…": "ì‹í’ˆì¶•ì‚°ë¶„ì„ì‹¤",
    "ì•„ì´ë””": "ì†¡ì§€ì€",
    "ì§ê¸‰": "ì£¼ì„"
  },
  {
    "ë¶€ì„œëª…": "ê³ ê°ê´€ë¦¬",
    "ì•„ì´ë””": "ì¥ë™ì£¼",
    "ì§ê¸‰": "ì£¼ì„"
  },
  {
    "ë¶€ì„œëª…": "ì‹í’ˆì¶•ì‚°ë¶„ì„ì‹¤",
    "ì•„ì´ë””": "ì‹ ê²½ì„",
    "ì§ê¸‰": "ëŒ€ë¦¬"
  },
  {
    "ë¶€ì„œëª…": "í’ˆì§ˆë³´ì¦íŒ€",
    "ì•„ì´ë””": "ê¹€ì •í•œ",
    "ì§ê¸‰": "ì°¨ì¥"
  },
  {
    "ë¶€ì„œëª…": "ì‹í’ˆì¶•ì‚°ë¶„ì„ì‹¤",
    "ì•„ì´ë””": "ê¹€í˜„ì •",
    "ì§ê¸‰": "ì£¼ì„"
  },
  {
    "ë¶€ì„œëª…": "ì‹í’ˆì¶•ì‚°ë¶„ì„ì‹¤",
    "ì•„ì´ë””": "ì„œì§„ì˜",
    "ì§ê¸‰": "ì‚¬ì›"
  },
  {
    "ë¶€ì„œëª…": "ê³ ê°ì§€ì›íŒ€",
    "ì•„ì´ë””": "ì´ì§„í¬",
    "ì§ê¸‰": "ì‚¬ì›"
  },
  {
    "ë¶€ì„œëª…": "ê³ ê°ê´€ë¦¬",
    "ì•„ì´ë””": "ì˜¤ì„í˜„",
    "ì§ê¸‰": "ì£¼ì„"
  },
  {
    "ë¶€ì„œëª…": "ê²½ì˜ì§€ì›ì‹¤",
    "ì•„ì´ë””": "ì´ì£¼í•˜",
    "ì§ê¸‰": "ì°¨ì¥"
  },
  {
    "ë¶€ì„œëª…": "ì‹í’ˆì¶•ì‚°ë¶„ì„ì‹¤",
    "ì•„ì´ë””": "ë°•ì‹œì€",
    "ì§ê¸‰": "ì‚¬ì›"
  },
  {
    "ë¶€ì„œëª…": "ì‹í’ˆì¶•ì‚°ë¶„ì„ì‹¤",
    "ì•„ì´ë””": "ì•ˆì¤€ì´",
    "ì§ê¸‰": "ì‚¬ì›"
  },
  {
    "ë¶€ì„œëª…": "í’ˆì§ˆë³´ì¦íŒ€",
    "ì•„ì´ë””": "ê°•ì€ì• ",
    "ì§ê¸‰": "ì‚¬ì›"
  },
  {
    "ë¶€ì„œëª…": "ì‹í’ˆì¶•ì‚°ë¶„ì„ì‹¤",
    "ì•„ì´ë””": "í•˜ì£¼ì‹ ",
    "ì§ê¸‰": "ê³¼ì¥"
  },
  {
    "ë¶€ì„œëª…": "ë§ˆì¼€íŒ…íŒ€",
    "ì•„ì´ë””": "ê¹€ë„í¬",
    "ì§ê¸‰": "ëŒ€ë¦¬"
  },
  {
    "ë¶€ì„œëª…": "ì‹í’ˆì¶•ì‚°ë¶„ì„ì‹¤",
    "ì•„ì´ë””": "íƒœí˜ì§„",
    "ì§ê¸‰": "ì‚¬ì›"
  },
  {
    "ë¶€ì„œëª…": "ì‹í’ˆì¶•ì‚°ë¶„ì„ì‹¤",
    "ì•„ì´ë””": "ê¹€ê³ ì€",
    "ì§ê¸‰": "ì‚¬ì›"
  },
  {
    "ë¶€ì„œëª…": "ì‹í’ˆì¶•ì‚°ë¶„ì„ì‹¤",
    "ì•„ì´ë””": "ê¹€ë²”ì¤€",
    "ì§ê¸‰": "ëŒ€ë¦¬"
  },
  {
    "ë¶€ì„œëª…": "ì‹í’ˆì¶•ì‚°ë¶„ì„ì‹¤",
    "ì•„ì´ë””": "ê¶Œí˜œì›",
    "ì§ê¸‰": "ì‚¬ì›"
  },
  {
    "ë¶€ì„œëª…": "ë§ˆì¼€íŒ…íŒ€",
    "ì•„ì´ë””": "ì†¡ì„±í˜„",
    "ì§ê¸‰": "ì‚¬ì›"
  },
  {
    "ë¶€ì„œëª…": "ì‹í’ˆì¶•ì‚°ë¶„ì„ì‹¤",
    "ì•„ì´ë””": "ê¹€ë¬¸ê¸°",
    "ì§ê¸‰": "ì‚¬ì›"
  },
  {
    "ë¶€ì„œëª…": "ì‹í’ˆì¶•ì‚°ë¶„ì„ì‹¤",
    "ì•„ì´ë””": "ì§€í˜„ì •",
    "ì§ê¸‰": "ì‚¬ì›"
  }
];
// Firestoreì—ì„œ ì‚¬ìš©ì ë°ì´í„° ë¡œë“œ
var _usersLoaded = false;
function loadUsersFromDefault() {
  return USERS_DATA.map(function(u) { return Object.assign({ íŒ€ëª…: '', ì ‘ìˆ˜ì: '', ì…ì‚¬ì¼: '', í‡´ì‚¬ì¼: '' }, u); });
}

async function loadUsersFromFirestore() {
  try {
    var fsUsers = await fsGetUsers();
    if (fsUsers && fsUsers.length > 0) {
      _usersLoaded = true;
      return fsUsers.map(function(u) {
        return {
          _id: u.id || '',
          ë¶€ì„œëª…: u.department || u.ë¶€ì„œëª… || '',
          ì•„ì´ë””: u.name || u.ì•„ì´ë”” || '',
          ì§ê¸‰: u.position || u.ì§ê¸‰ || '',
          íŒ€ëª…: u.team || u.íŒ€ëª… || '',
          ì ‘ìˆ˜ì: u.receiver || u.ì ‘ìˆ˜ì || '',
          ì…ì‚¬ì¼: u.joinDate || u.ì…ì‚¬ì¼ || '',
          í‡´ì‚¬ì¼: u.leaveDate || u.í‡´ì‚¬ì¼ || ''
        };
      });
    }
  } catch(e) { console.warn('Firestore ì‚¬ìš©ì ë¡œë“œ ì‹¤íŒ¨:', e.message); }
  // Firestoreì— ë°ì´í„° ì—†ìœ¼ë©´ ê¸°ë³¸ê°’
  return loadUsersFromDefault();
}

async function saveUsersToStorage() {
  // Firestoreì— ì „ì²´ ì‚¬ìš©ì ì €ì¥
  try {
    for (var i = 0; i < users.length; i++) {
      var u = users[i];
      var data = {
        name: u.ì•„ì´ë””,
        department: u.ë¶€ì„œëª…,
        position: u.ì§ê¸‰,
        team: u.íŒ€ëª… || '',
        receiver: u.ì ‘ìˆ˜ì || '',
        joinDate: u.ì…ì‚¬ì¼ || '',
        leaveDate: u.í‡´ì‚¬ì¼ || '',
        isActive: !u.í‡´ì‚¬ì¼
      };
      if (u._id) {
        data.id = u._id;
      }
      var docId = await fsSaveUser(data);
      if (!u._id) u._id = docId;
    }
  } catch(e) {
    console.error('ì‚¬ìš©ì ì €ì¥ ì‹¤íŒ¨:', e);
    alert('ì €ì¥ ì‹¤íŒ¨: ' + e.message);
  }
}

async function saveOneUser(u) {
  var data = {
    name: u.ì•„ì´ë””,
    department: u.ë¶€ì„œëª…,
    position: u.ì§ê¸‰,
    team: u.íŒ€ëª… || '',
    receiver: u.ì ‘ìˆ˜ì || '',
    joinDate: u.ì…ì‚¬ì¼ || '',
    leaveDate: u.í‡´ì‚¬ì¼ || '',
    isActive: !u.í‡´ì‚¬ì¼
  };
  if (u._id) data.id = u._id;
  var docId = await fsSaveUser(data);
  if (!u._id) u._id = docId;
  return docId;
}

// ì´ˆê¸°í™” ì‹œ ê¸°ë³¸ê°’ìœ¼ë¡œ ì‹œì‘ (Firebase ì¤€ë¹„ í›„ Firestore ë°ì´í„°ë¡œ êµì²´)
let users = loadUsersFromDefault();

// íŒ€ ëª©ë¡ (ë¶€ì„œë³„)
const TEAM_OPTIONS = {
  'ì§€ì‚¬': ['ì¶©ì²­ì§€ì‚¬', 'ê²½ë¶ì§€ì‚¬', 'ê²½ê¸°ì§€ì‚¬', 'ì„œìš¸ì§€ì‚¬', 'ì „ë¶ì§€ì‚¬'],
  'ê³ ê°ê´€ë¦¬': ['ì„œìš¸ì„¼í„°', 'ê²½ë¶ì„¼í„°'],
  'ê³ ê°ì§€ì›íŒ€': ['ê³ ê°ì§€ì›íŒ€'],
  'ì‹í’ˆì¶•ì‚°ë¶„ì„ì‹¤': ['ì‹í’ˆì¶•ì‚°ë¶„ì„ì‹¤'],
  'í’ˆì§ˆë³´ì¦íŒ€': ['í’ˆì§ˆë³´ì¦íŒ€'],
  'ê´€ë¦¬íŒ€': ['ê´€ë¦¬íŒ€'],
  'ê²½ì˜ì§€ì›ì‹¤': ['ê²½ì˜ì§€ì›ì‹¤'],
  'ë§ˆì¼€íŒ…ì‚¬ì—…ë¶€': ['ë§ˆì¼€íŒ…ì‚¬ì—…ë¶€'],
  'ë§ˆì¼€íŒ…íŒ€': ['ë§ˆì¼€íŒ…íŒ€'],
  'ì„ì›': ['ì„ì›']
};

// ì´ˆê¸°í™” â€” ë¨¼ì € ê¸°ë³¸ê°’ìœ¼ë¡œ ë Œë”, Firebase ì¤€ë¹„ë˜ë©´ Firestore ë°ì´í„°ë¡œ êµì²´
document.addEventListener('DOMContentLoaded', function() {
  populateFilters();
  renderUsers();
  updateStats();
});

var _firebaseInitDone = false;
window.addEventListener('firebase-ready', async function() {
  if (_firebaseInitDone) return;
  _firebaseInitDone = true;
  console.log('[userMgmt] Firebase ì¤€ë¹„ ì™„ë£Œ, Firestoreì—ì„œ ì‚¬ìš©ì ë¡œë“œ');
  var fsUsers = await loadUsersFromFirestore();
  if (_usersLoaded && fsUsers.length > 0) {
    users = fsUsers;
    populateFilters();
    renderUsers();
    updateStats();
    console.log('[userMgmt] Firestore ì‚¬ìš©ì ' + users.length + 'ëª… ë¡œë“œ ì™„ë£Œ');
  } else if (!_usersLoaded) {
    // Firestoreì— ë°ì´í„° ì—†ìŒ â†’ ê¸°ë³¸ USERS_DATAë¥¼ Firestoreì— ì¼ê´„ ì €ì¥
    console.log('[userMgmt] Firestoreì— ì‚¬ìš©ì ì—†ìŒ, ê¸°ë³¸ ë°ì´í„° ì—…ë¡œë“œ ì¤‘...');
    await saveUsersToStorage();
    console.log('[userMgmt] ê¸°ë³¸ ì‚¬ìš©ì ' + users.length + 'ëª… Firestore ì—…ë¡œë“œ ì™„ë£Œ');
  }
});

function updateStats() {
  var statCards = document.querySelectorAll('.stat-value');
  if (statCards[0]) statCards[0].textContent = users.length;
  var allDepts = {};
  users.forEach(function(u) { allDepts[u.ë¶€ì„œëª…] = true; });
  if (statCards[1]) statCards[1].textContent = Object.keys(allDepts).length;
  var labCount = users.filter(function(u) { return u.ë¶€ì„œëª… === 'ì‹í’ˆì¶•ì‚°ë¶„ì„ì‹¤'; }).length;
  if (statCards[2]) statCards[2].textContent = labCount;
  var csCount = users.filter(function(u) { return u.ë¶€ì„œëª… === 'ê³ ê°ì§€ì›íŒ€'; }).length;
  if (statCards[3]) statCards[3].textContent = csCount;
}

function populateFilters() {
  const allDepts = [...new Set(users.map(u => u.ë¶€ì„œëª…))];
  // 'ì§€ì‚¬' ë¶€ì„œê°€ ë°ì´í„°ì— ì—†ì–´ë„ ì¶”ê°€
  if (!allDepts.includes('ì§€ì‚¬')) allDepts.push('ì§€ì‚¬');
  const depts = allDepts.sort();
  const allPositions = [...new Set(users.map(u => u.ì§ê¸‰))];
  if (!allPositions.includes('ì§€ì‚¬')) allPositions.push('ì§€ì‚¬');
  const positions = allPositions.sort();

  const deptFilter = document.getElementById('deptFilter');
  const posFilter = document.getElementById('posFilter');
  const userDept = document.getElementById('userDept');
  const userPos = document.getElementById('userPos');

  // í•„í„° ë“œë¡­ë‹¤ìš´ (ê¸°ì¡´ ì˜µì…˜ ì´ˆê¸°í™” í›„ ì¬ìƒì„±)
  deptFilter.innerHTML = '<option value="">ì „ì²´ ë¶€ì„œ</option>';
  posFilter.innerHTML = '<option value="">ì „ì²´ ì§ê¸‰</option>';
  userDept.innerHTML = '<option value="">ë¶€ì„œ ì„ íƒ</option>';
  userPos.innerHTML = '<option value="">ì§ê¸‰ ì„ íƒ</option>';

  depts.forEach(d => {
    deptFilter.innerHTML += `<option value="${d}">${d}</option>`;
    userDept.innerHTML += `<option value="${d}">${d}</option>`;
  });

  positions.forEach(p => {
    posFilter.innerHTML += `<option value="${p}">${p}</option>`;
    userPos.innerHTML += `<option value="${p}">${p}</option>`;
  });
}

function updateTeamOptions() {
  const dept = document.getElementById('userDept').value;
  const teamSelect = document.getElementById('userTeam');
  teamSelect.innerHTML = '<option value="">ì„ íƒ ì—†ìŒ</option>';
  const teams = TEAM_OPTIONS[dept] || [];
  teams.forEach(t => {
    teamSelect.innerHTML += `<option value="${t}">${t}</option>`;
  });
}

function renderUsers() {
  const tbody = document.getElementById('userTable');
  const search = document.getElementById('searchInput').value.toLowerCase();
  const dept = document.getElementById('deptFilter').value;
  const pos = document.getElementById('posFilter').value;
  
  let filtered = users.filter(u => {
    const matchSearch = !search || u.ì•„ì´ë””.toLowerCase().includes(search);
    const matchDept = !dept || u.ë¶€ì„œëª… === dept;
    const matchPos = !pos || u.ì§ê¸‰ === pos;
    return matchSearch && matchDept && matchPos;
  });
  
  tbody.innerHTML = filtered.map((u, i) => {
    const editing = editingUserId === u.ì•„ì´ë””;
    if (editing) {
      return `<tr style="background:#fffbeb">
        <td>${i + 1}</td>
        <td><strong>${u.ì•„ì´ë””}</strong></td>
        <td><input type="text" class="edit-input" id="edit-dept" value="${u.ë¶€ì„œëª…}" style="width:100px"></td>
        <td><input type="text" class="edit-input" id="edit-team" value="${u.íŒ€ëª… || ''}" style="width:80px"></td>
        <td><input type="text" class="edit-input" id="edit-receiver" value="${u.ì ‘ìˆ˜ì || ''}" style="width:80px"></td>
        <td><input type="text" class="edit-input" id="edit-pos" value="${u.ì§ê¸‰}" style="width:70px"></td>
        <td><input type="date" class="edit-input" id="edit-join" value="${u.ì…ì‚¬ì¼ || ''}"></td>
        <td><input type="date" class="edit-input" id="edit-leave" value="${u.í‡´ì‚¬ì¼ || ''}"></td>
        <td>
          <button class="btn btn-sm btn-primary" onclick="saveEditUser('${u.ì•„ì´ë””}')">ì €ì¥</button>
          <button class="btn btn-sm btn-outline" onclick="cancelEdit()">ì·¨ì†Œ</button>
        </td>
      </tr>`;
    }
    return `<tr>
      <td>${i + 1}</td>
      <td><strong>${u.ì•„ì´ë””}</strong></td>
      <td><span class="badge badge-primary">${u.ë¶€ì„œëª…}</span></td>
      <td>${u.íŒ€ëª… || '-'}</td>
      <td>${u.ì ‘ìˆ˜ì || '-'}</td>
      <td>${u.ì§ê¸‰}</td>
      <td>${u.ì…ì‚¬ì¼ || '-'}</td>
      <td style="color:${u.í‡´ì‚¬ì¼ ? '#ef4444' : 'inherit'}">${u.í‡´ì‚¬ì¼ || '-'}</td>
      <td>
        <button class="btn btn-sm btn-outline" onclick="editUser('${u.ì•„ì´ë””}')">ìˆ˜ì •</button>
        <button class="btn btn-sm btn-outline" onclick="resetPassword('${u.ì•„ì´ë””}')" style="color:#f97316;border-color:#f97316">ğŸ”‘ PWì´ˆê¸°í™”</button>
      </td>
    </tr>`;
  }).join('');
}

function filterUsers() {
  renderUsers();
}

function openAddModal() {
  // í¼ ì´ˆê¸°í™”
  document.getElementById('userId').value = '';
  document.getElementById('userDept').value = '';
  document.getElementById('userTeam').innerHTML = '<option value="">ì„ íƒ ì—†ìŒ</option>';
  document.getElementById('userReceiver').value = '';
  document.getElementById('userPos').value = '';
  document.getElementById('userJoinDate').value = '';
  document.getElementById('userLeaveDate').value = '';
  document.getElementById('userModal').classList.add('active');
}

function closeModal() {
  document.getElementById('userModal').classList.remove('active');
}

async function saveUser() {
  const id = document.getElementById('userId').value.trim();
  const dept = document.getElementById('userDept').value;
  const team = document.getElementById('userTeam').value;
  const receiver = document.getElementById('userReceiver').value.trim();
  const pos = document.getElementById('userPos').value;
  const joinDate = document.getElementById('userJoinDate').value;
  const leaveDate = document.getElementById('userLeaveDate').value;

  if (!id) { alert('ì•„ì´ë””(ì´ë¦„)ë¥¼ ì…ë ¥í•˜ì„¸ìš”.'); return; }
  if (!dept) { alert('ë¶€ì„œë¥¼ ì„ íƒí•˜ì„¸ìš”.'); return; }
  if (!pos) { alert('ì§ê¸‰ì„ ì„ íƒí•˜ì„¸ìš”.'); return; }

  // ì¤‘ë³µ ì²´í¬
  if (users.find(u => u.ì•„ì´ë”” === id)) {
    alert(`"${id}"ëŠ” ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì•„ì´ë””ì…ë‹ˆë‹¤.`);
    return;
  }

  var newUser = {
    ë¶€ì„œëª…: dept,
    ì•„ì´ë””: id,
    ì§ê¸‰: pos,
    íŒ€ëª…: team,
    ì ‘ìˆ˜ì: receiver,
    ì…ì‚¬ì¼: joinDate,
    í‡´ì‚¬ì¼: leaveDate
  };

  try {
    await saveOneUser(newUser);
    users.push(newUser);
    closeModal();
    populateFilters();
    if (currentSort.key) {
      applySortAndRender();
    } else {
      renderUsers();
    }
    updateStats();
    alert(`"${id}" ì‚¬ìš©ìê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.`);
  } catch(e) {
    alert('ì €ì¥ ì‹¤íŒ¨: ' + e.message);
  }
}

let editingUserId = null;
let currentSort = { key: null, asc: true };

function sortBy(key) {
  if (currentSort.key === key) {
    currentSort.asc = !currentSort.asc;
  } else {
    currentSort.key = key;
    currentSort.asc = true;
  }
  applySortAndRender();
}

function applySortAndRender() {
  if (currentSort.key && currentSort.key !== 'no') {
    users.sort((a, b) => {
      const va = (a[currentSort.key] || '').toString();
      const vb = (b[currentSort.key] || '').toString();
      return currentSort.asc ? va.localeCompare(vb, 'ko') : vb.localeCompare(va, 'ko');
    });
  } else if (currentSort.key === 'no') {
    if (!currentSort.asc) users.reverse();
  }
  updateSortArrows();
  renderUsers();
}

function updateSortArrows() {
  document.querySelectorAll('.sort-arrow').forEach(el => el.textContent = '');
  if (currentSort.key) {
    const el = document.getElementById('sort-' + currentSort.key);
    if (el) el.textContent = currentSort.asc ? ' â–²' : ' â–¼';
  }
}

async function resetSort() {
  currentSort = { key: null, asc: true };
  users = await loadUsersFromFirestore();
  updateSortArrows();
  renderUsers();
}

function editUser(id) {
  editingUserId = id;
  renderUsers();
}

async function saveEditUser(id) {
  const u = users.find(u => u.ì•„ì´ë”” === id);
  if (!u) return;
  u.ë¶€ì„œëª… = document.getElementById('edit-dept').value;
  u.íŒ€ëª… = document.getElementById('edit-team').value;
  u.ì ‘ìˆ˜ì = document.getElementById('edit-receiver').value;
  u.ì§ê¸‰ = document.getElementById('edit-pos').value;
  u.ì…ì‚¬ì¼ = document.getElementById('edit-join').value;
  u.í‡´ì‚¬ì¼ = document.getElementById('edit-leave').value;
  editingUserId = null;
  try {
    await saveOneUser(u);
  } catch(e) { console.error('ìˆ˜ì • ì €ì¥ ì‹¤íŒ¨:', e); }
  populateFilters();
  if (currentSort.key) {
    applySortAndRender();
  } else {
    renderUsers();
  }
}

function cancelEdit() {
  editingUserId = null;
  renderUsers();
}

function resetPassword(id) {
  if (confirm(`${id}ì˜ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì´ˆê¸° ë¹„ë°€ë²ˆí˜¸: bfl1234`)) {
    alert(`${id}ì˜ ë¹„ë°€ë²ˆí˜¸ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.\nì´ˆê¸° ë¹„ë°€ë²ˆí˜¸: bfl1234`);
  }
}

function exportExcel() {
  const header = ['No', 'ì•„ì´ë””', 'ë¶€ì„œ', 'íŒ€', 'ì ‘ìˆ˜ì', 'ì§ê¸‰', 'ì…ì‚¬ì¼', 'í‡´ì‚¬ì¼'];
  const rows = users.map((u, i) => [
    i + 1, u.ì•„ì´ë””, u.ë¶€ì„œëª…, u.íŒ€ëª… || '', u.ì ‘ìˆ˜ì || '', u.ì§ê¸‰, u.ì…ì‚¬ì¼ || '', u.í‡´ì‚¬ì¼ || ''
  ]);
  let csv = '\uFEFF' + header.join(',') + '\n';
  rows.forEach(r => {
    csv += r.map(v => `"${v}"`).join(',') + '\n';
  });
  const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
  const link = document.createElement('a');
  link.href = URL.createObjectURL(blob);
  link.download = `ì‚¬ìš©ìëª©ë¡_${new Date().toISOString().split('T')[0]}.csv`;
  link.click();
  URL.revokeObjectURL(link.href);
}

</script>
<!-- ì‚¬ì´ë“œë°” JS â†’ js/sidebar.jsë¡œ ì´ê´€ë¨ -->
</body>
</html>
