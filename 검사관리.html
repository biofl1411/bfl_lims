<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BioFoodLab - ê²€ì‚¬ ê´€ë¦¬</title>
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
@import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');
:root{--bg:#f6f5f1;--card:#fff;--sb:#1b1f2e;--pri:#4361ee;--pri-l:#eef0ff;--mint:#2ec4b6;--mint-l:#e6f9f6;--coral:#ff6b6b;--coral-l:#fff0f0;--amber:#ffc857;--amber-l:#fff8e7;--violet:#7c5cfc;--violet-l:#f3efff;--sky:#4cc9f0;--green:#06d6a0;--green-l:#e5faf3;--txt:#2d2d3a;--sub:#8b8da0;--bdr:#ededef;--r:14px;--rs:8px;--sh:0 2px 12px rgba(0,0,0,.06);--shl:0 8px 30px rgba(0,0,0,.08)}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Pretendard','Outfit',sans-serif;background:var(--bg);color:var(--txt);display:flex;min-height:100vh}

/* SIDEBAR */
.sidebar{width:260px;background:var(--sb);color:#fff;flex-shrink:0;display:flex;flex-direction:column;position:sticky;top:0;height:100vh}
.logo{padding:24px 22px;display:flex;align-items:center;gap:12px}
.logo-icon{width:40px;height:40px;background:linear-gradient(135deg,var(--mint),var(--pri));border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:20px}
.logo h1{font-family:'Outfit';font-size:17px;font-weight:700}
.logo p{font-size:10px;color:rgba(255,255,255,.4);margin-top:2px}
.nav-section{padding:8px 14px}
.nav-label{font-size:10px;font-weight:700;color:rgba(255,255,255,.25);letter-spacing:1.5px;padding:12px 10px 6px}
.nav-item{display:flex;align-items:center;gap:11px;padding:10px 12px;border-radius:10px;font-size:13px;font-weight:500;color:rgba(255,255,255,.55);cursor:pointer;transition:all .25s;margin-bottom:2px}
.nav-item:hover{background:rgba(255,255,255,.08);color:rgba(255,255,255,.85);transform:translateX(2px)}
.nav-item.active{background:linear-gradient(135deg,rgba(67,97,238,.3),rgba(46,196,182,.2));color:#fff;font-weight:600}
.nav-item .ni{font-size:17px;width:22px;text-align:center}
.sidebar-footer{margin-top:auto;padding:16px 20px;border-top:1px solid rgba(255,255,255,.06)}
.sidebar-footer a{color:rgba(255,255,255,.35);font-size:11px;text-decoration:none;display:flex;align-items:center;gap:6px;transition:color .2s}
.sidebar-footer a:hover{color:rgba(255,255,255,.7)}

/* MAIN */
.main{flex:1;display:flex;flex-direction:column;min-width:0}
.topbar{background:var(--card);padding:16px 32px;display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid var(--bdr);position:sticky;top:0;z-index:50}
.crumb{font-size:13px;color:var(--sub)}.crumb b{color:var(--txt);font-weight:700}
.avatar{width:34px;height:34px;border-radius:50%;background:linear-gradient(135deg,var(--coral),var(--amber));display:flex;align-items:center;justify-content:center;font-size:13px;font-weight:700;color:#fff}
.content{flex:1;padding:28px 32px;overflow-y:auto}
.page-head{margin-bottom:24px}
.page-head h2{font-family:'Outfit';font-size:26px;font-weight:800;background:linear-gradient(135deg,var(--pri),var(--mint));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.page-head p{font-size:13px;color:var(--sub);margin-top:4px}

/* STATS */
.stats-row{display:flex;gap:12px;margin-bottom:20px;flex-wrap:wrap}
.stat-chip{background:var(--card);border-radius:12px;padding:14px 20px;box-shadow:var(--sh);display:flex;align-items:center;gap:12px;flex:1;min-width:160px}
.sc-icon{width:40px;height:40px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:20px}
.sc-num{font-family:'Outfit';font-size:22px;font-weight:800}
.sc-label{font-size:11px;color:var(--sub)}

/* TABS */
.tabs{display:flex;gap:6px;margin-bottom:24px;flex-wrap:wrap}
.tab{padding:9px 20px;font-size:13px;font-weight:600;border-radius:50px;cursor:pointer;transition:all .3s;border:2px solid transparent;background:var(--card);color:var(--sub);box-shadow:var(--sh)}
.tab:hover{transform:translateY(-2px);box-shadow:var(--shl);color:var(--txt)}
.tab.active{color:#fff;transform:translateY(-2px);box-shadow:var(--shl)}
.tab[data-c="b"].active{background:linear-gradient(135deg,#4361ee,#3a56d4)}
.tab[data-c="m"].active{background:linear-gradient(135deg,#2ec4b6,#20a89c)}
.tab[data-c="v"].active{background:linear-gradient(135deg,#7c5cfc,#6a4ce0)}
.tab[data-c="c"].active{background:linear-gradient(135deg,#ff6b6b,#e05555)}
.tab[data-c="a"].active{background:linear-gradient(135deg,#f0a500,#d49000)}

/* PANELS */
.panel{display:none;animation:fu .4s ease}.panel.active{display:block}
@keyframes fu{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:none}}

/* TOOLBAR */
.toolbar{display:flex;justify-content:space-between;align-items:center;margin-bottom:18px;flex-wrap:wrap;gap:12px}
.search-box{display:flex;align-items:center;gap:8px;background:var(--card);border:2px solid var(--bdr);border-radius:50px;padding:6px 16px;min-width:280px;transition:border .2s}
.search-box:focus-within{border-color:var(--pri)}
.search-box input{border:none;outline:none;font-size:13px;font-family:inherit;background:transparent;flex:1}
.filter-pills{display:flex;gap:6px;flex-wrap:wrap}
.pill{padding:6px 14px;border-radius:50px;font-size:11px;font-weight:600;cursor:pointer;transition:all .2s;border:1.5px solid var(--bdr);background:var(--card);color:var(--sub)}
.pill:hover{border-color:var(--pri);color:var(--pri)}
.pill.on{background:var(--pri);color:#fff;border-color:var(--pri)}

/* â”€â”€ PURPOSE CARDS â”€â”€ */
.section-label{font-size:12px;font-weight:700;color:var(--sub);letter-spacing:1px;margin:20px 0 12px;display:flex;align-items:center;gap:8px}
.section-label::after{content:'';flex:1;height:1px;background:var(--bdr)}
.card-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:14px}
.p-card{background:var(--card);border-radius:var(--r);padding:0;box-shadow:var(--sh);transition:all .3s;cursor:pointer;border:2px solid transparent;position:relative;overflow:hidden}
.p-card:hover{transform:translateY(-3px);box-shadow:var(--shl);border-color:var(--pri-l)}
.p-card-top{height:5px}
.p-card-top.on{background:linear-gradient(90deg,var(--green),var(--mint))}
.p-card-top.off{background:linear-gradient(90deg,#ddd,#ccc)}
.p-card-body{padding:16px 20px}
.p-card-head{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:8px}
.p-card-code{font-family:'Outfit';font-size:13px;font-weight:700;color:#fff;background:var(--pri);width:32px;height:32px;border-radius:8px;display:flex;align-items:center;justify-content:center}
.p-card-status{font-size:11px;font-weight:600;display:flex;align-items:center;gap:4px}
.p-card-status .dot{width:8px;height:8px;border-radius:50%}
.dot-on{background:var(--green);box-shadow:0 0 6px rgba(6,214,160,.4)}
.dot-off{background:#ccc}
.p-card-name{font-size:15px;font-weight:700;margin-bottom:6px}
.p-card-receipt{display:flex;align-items:center;gap:8px;background:var(--bg);border-radius:10px;padding:10px 14px}
.p-card-receipt .rcpt-label{font-size:10px;font-weight:700;color:var(--sub);letter-spacing:.5px}
.p-card-receipt .rcpt-num{font-family:'Outfit',monospace;font-size:16px;font-weight:700;color:var(--pri);letter-spacing:1.5px}
.p-card-receipt .rcpt-none{font-size:12px;color:#ccc;font-style:italic}
.p-card-footer{display:flex;justify-content:space-between;align-items:center;margin-top:12px}
.p-card-items{font-size:12px;color:var(--sub)}
.p-card-items span{font-weight:700;color:var(--pri)}
.p-card-arrow{font-size:16px;color:var(--sub);transition:transform .2s}
.p-card:hover .p-card-arrow{transform:translateX(4px);color:var(--pri)}

/* â”€â”€ DETAIL VIEW â”€â”€ */
.detail-view{display:none;animation:fu .35s ease}
.detail-view.show{display:block}
.detail-back{display:inline-flex;align-items:center;gap:6px;font-size:13px;font-weight:600;color:var(--sub);cursor:pointer;margin-bottom:20px;transition:color .2s;padding:6px 14px;border-radius:50px;background:var(--card);box-shadow:var(--sh)}
.detail-back:hover{color:var(--pri)}
.detail-header{display:flex;align-items:center;gap:16px;margin-bottom:24px}
.detail-header .dh-code{font-family:'Outfit';font-size:28px;font-weight:800;color:#fff;background:linear-gradient(135deg,var(--pri),var(--violet));width:56px;height:56px;border-radius:14px;display:flex;align-items:center;justify-content:center}
.detail-header .dh-name{font-size:20px;font-weight:800}
.detail-header .dh-status{font-size:12px;padding:4px 12px;border-radius:50px;font-weight:600}
.dh-on{background:var(--green-l);color:var(--green)}
.dh-off{background:#f0f0f0;color:#aaa}
.detail-grid{display:grid;grid-template-columns:1fr 1fr;gap:20px}
.d-card{background:var(--card);border-radius:var(--r);padding:24px;box-shadow:var(--sh)}
.d-card h4{font-family:'Outfit';font-size:15px;font-weight:800;margin-bottom:16px;display:flex;align-items:center;gap:8px}

/* receipt builder in detail */
.seg-builder{display:flex;align-items:center;gap:6px;flex-wrap:wrap;margin:16px 0}
.seg-block{background:var(--bg);border:2px solid var(--bdr);border-radius:10px;padding:12px;min-width:100px;text-align:center;transition:all .3s}
.seg-block:hover{border-color:var(--pri)}
.seg-block label{font-size:9px;font-weight:700;color:var(--sub);display:block;margin-bottom:5px;letter-spacing:.5px}
.seg-block select,.seg-block input[type=text]{width:100%;border:1px solid var(--bdr);border-radius:6px;padding:5px 6px;font-size:12px;font-family:inherit;outline:none;text-align:center}
.seg-block select:focus,.seg-block input:focus{border-color:var(--pri)}
.seg-sep{font-family:'Outfit';font-size:24px;font-weight:800;color:var(--pri)}
.preview-hero{background:linear-gradient(135deg,#1b1f2e,#2a2f45);border-radius:var(--r);padding:28px;text-align:center;color:#fff;margin:16px 0}
.ph-label{font-size:10px;color:rgba(255,255,255,.4);letter-spacing:2px;margin-bottom:6px}
.ph-number{font-family:'Outfit',monospace;font-size:32px;font-weight:800;letter-spacing:3px;background:linear-gradient(135deg,var(--mint),var(--sky));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.ph-desc{font-size:11px;color:rgba(255,255,255,.3);margin-top:6px}
.example-list{font-family:'Outfit',monospace;font-size:14px;font-weight:600;color:var(--pri);line-height:2.2;padding:12px 16px;background:var(--bg);border-radius:10px;margin-top:10px}

/* FORM */
.fg{margin-bottom:14px}
.fg label{display:block;font-size:11px;font-weight:700;color:var(--sub);margin-bottom:5px;letter-spacing:.3px}
.fg input,.fg select,.fg textarea{width:100%;padding:10px 14px;border:2px solid var(--bdr);border-radius:10px;font-size:13px;font-family:inherit;outline:none;transition:border .2s;background:var(--card)}
.fg input:focus,.fg select:focus,.fg textarea:focus{border-color:var(--pri);box-shadow:0 0 0 4px rgba(67,97,238,.08)}
.fg textarea{resize:vertical;min-height:60px}
.fg-row{display:flex;gap:12px}.fg-row .fg{flex:1}
.fg-inline{display:flex;align-items:center;gap:8px}
.switch{position:relative;width:44px;height:24px}.switch input{opacity:0;width:0;height:0}
.switch .slider{position:absolute;inset:0;background:#ddd;border-radius:50px;cursor:pointer;transition:.3s}
.switch .slider::before{content:'';position:absolute;width:18px;height:18px;left:3px;top:3px;background:#fff;border-radius:50%;transition:.3s}
.switch input:checked+.slider{background:var(--green)}.switch input:checked+.slider::before{transform:translateX(20px)}

/* BUTTONS */
.btn{padding:10px 22px;border:none;border-radius:10px;font-size:13px;font-weight:700;cursor:pointer;transition:all .25s;font-family:inherit}
.btn-primary{background:linear-gradient(135deg,var(--pri),var(--violet));color:#fff;box-shadow:0 4px 14px rgba(67,97,238,.25)}
.btn-primary:hover{transform:translateY(-1px);box-shadow:0 6px 20px rgba(67,97,238,.35)}
.btn-ghost{background:transparent;color:var(--sub)}.btn-ghost:hover{background:var(--bg);color:var(--txt)}
.btn-sm{padding:6px 14px;font-size:11px;border-radius:8px}
.btn-danger-outline{background:transparent;color:var(--coral);border:1.5px solid var(--coral-l)}.btn-danger-outline:hover{background:var(--coral);color:#fff}

/* BADGES / TAGS */
.badge{display:inline-flex;align-items:center;gap:4px;padding:4px 10px;border-radius:50px;font-size:11px;font-weight:600}
.b-micro{background:#e8f0fe;color:#4361ee}.b-metal{background:#fde8e8;color:#e74c3c}.b-chem{background:#fff3e0;color:#e67e22}.b-preserv{background:#f3efff;color:#7c5cfc}.b-nutri{background:#e5faf3;color:#06d6a0}
.tag{display:inline-flex;align-items:center;gap:4px;padding:3px 10px;border-radius:50px;font-size:11px;font-weight:500}
.tag-mint{background:var(--mint-l);color:var(--mint)}.tag-coral{background:var(--coral-l);color:var(--coral)}.tag-amber{background:var(--amber-l);color:#b8860b}.tag-violet{background:var(--violet-l);color:var(--violet)}

/* MODERN TABLE */
.modern-table{width:100%;border-collapse:separate;border-spacing:0 6px}
.modern-table th{font-size:11px;font-weight:700;color:var(--sub);letter-spacing:.5px;padding:8px 14px;text-align:left}
.modern-table td{background:var(--card);padding:12px 14px;font-size:13px}
.modern-table tr td:first-child{border-radius:var(--rs) 0 0 var(--rs)}
.modern-table tr td:last-child{border-radius:0 var(--rs) var(--rs) 0}
.modern-table tr{transition:transform .2s}
.modern-table tr:hover{transform:translateX(4px)}
.modern-table tr:hover td{box-shadow:var(--sh)}

/* TREE */
.tree-wrap{display:grid;gap:10px}
.tree-card{background:var(--card);border-radius:var(--r);overflow:hidden;box-shadow:var(--sh);transition:all .3s}.tree-card:hover{box-shadow:var(--shl)}
.tree-top{display:flex;align-items:center;gap:12px;padding:16px 20px;cursor:pointer;transition:background .2s}
.tree-top:hover{background:rgba(67,97,238,.03)}
.t-arrow{font-size:10px;color:var(--sub);transition:transform .25s}.tree-top.open .t-arrow{transform:rotate(90deg)}
.t-icon{width:36px;height:36px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:18px}
.t-name{flex:1;font-size:14px;font-weight:700}
.t-count{font-size:12px;font-weight:700;color:var(--pri);background:var(--pri-l);padding:3px 10px;border-radius:50px}
.tree-body{display:none;padding:0 20px 16px 68px}.tree-body.show{display:block;animation:fu .3s ease}
.tree-child{display:flex;align-items:center;justify-content:space-between;padding:7px 12px;border-radius:8px;font-size:12px;margin-bottom:3px;border-left:3px solid var(--bdr);transition:all .2s}
.tree-child:hover{background:var(--pri-l);border-left-color:var(--pri)}
.tree-tags{display:flex;gap:5px;flex-wrap:wrap;margin-left:auto;padding-left:12px}

/* CHECK LIST */
.ck-list{max-height:220px;overflow-y:auto;border:2px solid var(--bdr);border-radius:12px;padding:8px}
.ck-item{display:flex;align-items:center;gap:10px;padding:7px 10px;border-radius:8px;cursor:pointer;font-size:13px;transition:background .15s}
.ck-item:hover{background:var(--pri-l)}
.ck-item input[type=checkbox]{width:18px;height:18px;accent-color:var(--pri);cursor:pointer}

/* TOAST */
.toast{position:fixed;top:24px;right:24px;padding:14px 22px;border-radius:12px;color:#fff;font-size:13px;font-weight:600;z-index:300;opacity:0;transform:translateY(-10px);transition:all .35s;box-shadow:0 6px 20px rgba(0,0,0,.15)}
.toast.show{opacity:1;transform:none}
.toast-ok{background:linear-gradient(135deg,var(--green),var(--mint))}
.toast-info{background:linear-gradient(135deg,var(--pri),var(--violet))}

/* FAB */
.fab{position:fixed;bottom:32px;right:32px;width:56px;height:56px;border-radius:50%;border:none;background:linear-gradient(135deg,var(--pri),var(--violet));color:#fff;font-size:26px;cursor:pointer;box-shadow:0 6px 20px rgba(67,97,238,.35);transition:all .3s;z-index:100;display:flex;align-items:center;justify-content:center}
.fab:hover{transform:scale(1.1) rotate(90deg);box-shadow:0 8px 30px rgba(67,97,238,.5)}

/* MODAL */
.modal-overlay{display:none;position:fixed;inset:0;background:rgba(27,31,46,.55);backdrop-filter:blur(4px);z-index:200;justify-content:center;align-items:center}
.modal-overlay.show{display:flex}
.modal{background:var(--card);border-radius:20px;width:560px;max-width:92vw;max-height:88vh;overflow-y:auto;box-shadow:0 24px 80px rgba(0,0,0,.2);animation:mi .35s ease}
.modal-wide{width:700px}
@keyframes mi{from{opacity:0;transform:scale(.92) translateY(20px)}to{opacity:1;transform:none}}
.modal-head{padding:24px 28px 0;display:flex;justify-content:space-between;align-items:center}
.modal-head h3{font-family:'Outfit';font-size:20px;font-weight:800}
.modal-x{width:32px;height:32px;border:none;background:var(--bg);border-radius:50%;font-size:16px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s}
.modal-x:hover{background:var(--coral-l);color:var(--coral)}
.modal-body{padding:20px 28px 28px}
.modal-foot{padding:16px 28px 24px;display:flex;justify-content:flex-end;gap:8px}

.hist-tbl{width:100%;font-size:12px;border-collapse:collapse}
.hist-tbl th{text-align:left;font-size:10px;font-weight:700;color:var(--sub);padding:6px 10px;border-bottom:2px solid var(--bdr)}
.hist-tbl td{padding:8px 10px;border-bottom:1px solid var(--bdr)}

.ic-btn{width:30px;height:30px;border:none;border-radius:8px;cursor:pointer;font-size:13px;transition:all .2s;display:flex;align-items:center;justify-content:center}
.ic-btn-edit{background:var(--pri-l);color:var(--pri)}.ic-btn-edit:hover{background:var(--pri);color:#fff}
.ic-btn-del{background:var(--coral-l);color:var(--coral)}.ic-btn-del:hover{background:var(--coral);color:#fff}

@media(max-width:900px){.detail-grid{grid-template-columns:1fr}}
@media(max-width:768px){.sidebar{display:none}.content{padding:16px}.card-grid{grid-template-columns:1fr}}
</style>
</head>
<body>

<aside class="sidebar">
  <div class="logo"><div class="logo-icon">ğŸ”¬</div><div><h1>BioFoodLab</h1><p>LIMS Â· í†µí•©ê´€ë¦¬</p></div></div>
  <div class="nav-section">
    <div class="nav-label">ì ‘ìˆ˜ ê´€ë¦¬</div>
    <div class="nav-item"><span class="ni">ğŸ¢</span>ì—…ì²´ë“±ë¡Â·ìˆ˜ì •</div>
    <div class="nav-item"><span class="ni">ğŸ“‹</span>ì‹œë£Œ ì ‘ìˆ˜</div>
    <div class="nav-item"><span class="ni">ğŸ“Š</span>ì ‘ìˆ˜ í˜„í™©</div>
    <div class="nav-item"><span class="ni">ğŸ“’</span>ì ‘ìˆ˜ëŒ€ì¥</div>
    <div class="nav-item active"><span class="ni">âš™ï¸</span>ê²€ì‚¬ ê´€ë¦¬</div>
    <div class="nav-item"><span class="ni">ğŸ“…</span>ì¼ì •ê´€ë¦¬</div>
    <div class="nav-item"><span class="ni">ğŸ›ï¸</span>ì§€ë¶€ê´€ë¦¬</div>
    <div class="nav-item"><span class="ni">ğŸ“ˆ</span>ì‹¤ì ë³´ê³ </div>
    <div class="nav-item"><span class="ni">ğŸ”—</span>LIMS ì—°ë™</div>
  </div>
  <div class="sidebar-footer"><a href="index.html">â† ë©”ì¸ ëŒ€ì‹œë³´ë“œ</a></div>
</aside>

<div class="main">
  <div class="topbar"><div><span class="crumb">ì ‘ìˆ˜ ê´€ë¦¬ â€º <b>ê²€ì‚¬ ê´€ë¦¬</b></span></div><div style="display:flex;align-items:center;gap:14px"><span style="font-size:12px;color:var(--sub)">ê³ ê°ì§€ì›íŒ€</span><div class="avatar">í™</div></div></div>

  <div class="content">
    <div class="page-head"><h2>ê²€ì‚¬ ê´€ë¦¬</h2><p>ê²€ì‚¬ ëª©ì , ì‹í’ˆ ìœ í˜•, í•­ëª©, í•­ëª© ê·¸ë£¹ì„ í•œ ê³³ì—ì„œ ì„¤ì •í•©ë‹ˆë‹¤</p></div>

    <div class="stats-row">
      <div class="stat-chip"><div class="sc-icon" style="background:var(--amber-l)">ğŸ·ï¸</div><div><div class="sc-num" id="stat-field-cnt" style="color:#d49000">2</div><div class="sc-label">ê²€ì‚¬ ë¶„ì•¼</div></div></div>
      <div class="stat-chip"><div class="sc-icon" style="background:var(--pri-l)">ğŸ¯</div><div><div class="sc-num" style="color:var(--pri)">29</div><div class="sc-label">ê²€ì‚¬ ëª©ì </div></div></div>
      <div class="stat-chip"><div class="sc-icon" style="background:var(--mint-l)">ğŸ±</div><div><div class="sc-num" style="color:var(--mint)">48</div><div class="sc-label">ì‹í’ˆ ìœ í˜•</div></div></div>
      <div class="stat-chip"><div class="sc-icon" style="background:var(--violet-l)">ğŸ§ª</div><div><div class="sc-num" style="color:var(--violet)">156</div><div class="sc-label">ê²€ì‚¬ í•­ëª©</div></div></div>
      <div class="stat-chip"><div class="sc-icon" style="background:var(--coral-l)">ğŸ“¦</div><div><div class="sc-num" style="color:var(--coral)">12</div><div class="sc-label">í•­ëª© ê·¸ë£¹</div></div></div>
    </div>

    <div class="tabs">
      <div class="tab active" data-c="a" onclick="showTab(0)">ğŸ·ï¸ ê²€ì‚¬ ë¶„ì•¼</div>
      <div class="tab" data-c="b" onclick="showTab(1)">ğŸ¯ ê²€ì‚¬ ëª©ì </div>
      <div class="tab" data-c="m" onclick="showTab(2)">ğŸ± ì‹í’ˆ ìœ í˜•</div>
      <div class="tab" data-c="v" onclick="showTab(3)">ğŸ§ª ê²€ì‚¬ í•­ëª©</div>
      <div class="tab" data-c="c" onclick="showTab(4)">ğŸ“¦ í•­ëª© ê·¸ë£¹</div>
    </div>

    <!-- â•â•â• TAB 0: ê²€ì‚¬ ë¶„ì•¼ â•â•â• -->
    <div class="panel active" id="p0">
      <div class="d-card">
        <h4>ğŸ·ï¸ ë“±ë¡ëœ ë¶„ì•¼</h4>
        <p style="font-size:12px;color:var(--sub);margin-bottom:16px">ê²€ì‚¬ ë¶„ì•¼ë¥¼ ë“±ë¡í•˜ë©´ ê° ê²€ì‚¬ ëª©ì ì—ì„œ ì†Œì† ë¶„ì•¼ë¥¼ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì¹´ë“œë¥¼ í´ë¦­í•˜ë©´ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
        <div id="field-card-list"></div>
        <button class="btn btn-primary btn-sm" style="margin-top:14px;width:100%" onclick="openFieldAdd()">+ ìƒˆ ë¶„ì•¼ ì¶”ê°€</button>
      </div>
    </div>

    <!-- â•â•â• TAB 1: ê²€ì‚¬ ëª©ì  (LIST + DETAIL) â•â•â• -->
    <div class="panel" id="p1">
      <!-- LIST VIEW -->
      <div id="purpose-list">
        <div class="toolbar">
          <div class="search-box"><span>ğŸ”</span><input type="text" placeholder="ê²€ì‚¬ ëª©ì  ê²€ìƒ‰..." id="sp" oninput="fp()"></div>
          <div class="filter-pills">
            <div class="pill on" onclick="tp(this,'all')">ì „ì²´</div>
            <div class="pill" onclick="tp(this,'on')">ğŸŸ¢ ì‚¬ìš©</div>
            <div class="pill" onclick="tp(this,'off')">ğŸ”˜ ë¯¸ì •</div>
          </div>
        </div>
        <div id="purpose-container"></div>
      </div>

      <!-- DETAIL VIEW (hidden by default) -->
      <div class="detail-view" id="purpose-detail">
        <div class="detail-back" onclick="closeDetail()">â† ê²€ì‚¬ ëª©ì  ëª©ë¡ìœ¼ë¡œ</div>
        <div class="detail-header" id="detail-header"></div>
        <div class="detail-grid">
          <!-- Left: ê¸°ë³¸ ì •ë³´ -->
          <div class="d-card">
            <h4>ğŸ“ ê¸°ë³¸ ì •ë³´</h4>
            <div class="fg"><label>ëª…ì¹­</label><input type="text" id="d-name"></div>
            <div class="fg-row">
              <div class="fg"><label>ì½”ë“œ</label><input type="text" id="d-code" style="text-align:center;background:var(--bg)" readonly></div>
              <div class="fg"><label>ì •ë ¬ìˆœì„œ</label><input type="number" id="d-order" style="text-align:center"></div>
            </div>
            <div class="fg"><label>ì‚¬ìš©ì—¬ë¶€</label>
              <div class="fg-inline" style="margin-top:4px">
                <label class="switch"><input type="checkbox" id="d-active" checked><span class="slider"></span></label>
                <span id="d-active-label" style="font-size:13px;font-weight:600;color:var(--green)">ì‚¬ìš©</span>
              </div>
            </div>
            <div class="fg"><label>ë¹„ê³ </label><textarea id="d-memo" placeholder="ë¹„ê³  ì…ë ¥"></textarea></div>
            <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:8px">
              <button class="btn btn-danger-outline btn-sm" onclick="deletePurpose()">ì‚­ì œ</button>
              <button class="btn btn-sm" onclick="copyPurpose()" style="background:var(--bg);color:var(--pri);border:1.5px solid var(--pri-l)">ğŸ“‹ ë³µì‚¬</button>
              <button class="btn btn-primary btn-sm" onclick="saveDetail()">ì €ì¥</button>
            </div>
          </div>
          <!-- Right: ì ‘ìˆ˜ë²ˆí˜¸ ë¶„ì•¼ êµ¬ë¶„ -->
          <div class="d-card">
            <h4>ğŸ”¢ ì ‘ìˆ˜ë²ˆí˜¸ ë¶„ì•¼ êµ¬ë¶„</h4>
            <p style="font-size:12px;color:var(--sub);margin-bottom:14px">ì ‘ìˆ˜ë²ˆí˜¸ì— ë¶„ì•¼ë¥¼ ì–´ë–»ê²Œ ë°˜ì˜í• ì§€ ì„¤ì •í•©ë‹ˆë‹¤</p>

            <div class="fg"><label>ë¶„ì•¼ êµ¬ë¶„ ì ìš©</label>
              <div class="fg-inline" style="margin-top:4px">
                <label class="switch"><input type="checkbox" id="d-field-use" onchange="toggleFieldMode()"><span class="slider"></span></label>
                <span id="d-field-use-label" style="font-size:13px;font-weight:600;color:#aaa">ë¯¸ì ìš©</span>
              </div>
            </div>

            <div id="field-mode-area" style="display:none;margin-top:12px">
              <div class="fg"><label>êµ¬ë¶„ ë°©ì‹</label>
                <div style="display:flex;flex-direction:column;gap:10px;margin-top:8px">

                  <label class="field-opt" style="display:flex;gap:14px;padding:16px 18px;background:var(--bg);border-radius:12px;cursor:pointer;border:2px solid var(--bdr);transition:all .2s;align-items:center">
                    <input type="radio" name="field-mode" value="code" checked style="flex-shrink:0;width:18px;height:18px;accent-color:var(--pri)" onchange="updateFieldMode()">
                    <div style="flex:1;min-width:0">
                      <div style="font-size:14px;font-weight:800;color:var(--txt)">ëª©ì ì½”ë“œë¡œ êµ¬ë¶„</div>
                      <div style="font-size:12px;color:var(--sub);margin-top:4px;line-height:1.5">ë¶„ì•¼ë§ˆë‹¤ ë‹¤ë¥¸ ëª©ì ì½”ë“œë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤</div>
                      <div id="fm-example-code" style="display:flex;gap:8px;margin-top:8px;flex-wrap:wrap"></div>
                    </div>
                  </label>

                  <label class="field-opt" style="display:flex;gap:14px;padding:16px 18px;background:var(--bg);border-radius:12px;cursor:pointer;border:2px solid var(--bdr);transition:all .2s;align-items:center">
                    <input type="radio" name="field-mode" value="segment" style="flex-shrink:0;width:18px;height:18px;accent-color:var(--pri)" onchange="updateFieldMode()">
                    <div style="flex:1;min-width:0">
                      <div style="font-size:14px;font-weight:800;color:var(--txt)">ë¶„ì•¼ì½”ë“œë¥¼ ë³„ë„ êµ¬ë¶„ì— ì¶”ê°€</div>
                      <div style="font-size:12px;color:var(--sub);margin-top:4px;line-height:1.5">ì ‘ìˆ˜ë²ˆí˜¸ ì•ì— ë¶„ì•¼ì½”ë“œê°€ ì¶”ê°€ë©ë‹ˆë‹¤</div>
                      <div id="fm-example-seg" style="display:flex;gap:8px;margin-top:8px;flex-wrap:wrap"></div>
                    </div>
                  </label>

                  <label class="field-opt" style="display:flex;gap:14px;padding:16px 18px;background:var(--bg);border-radius:12px;cursor:pointer;border:2px solid var(--bdr);transition:all .2s;align-items:center">
                    <input type="radio" name="field-mode" value="serial" style="flex-shrink:0;width:18px;height:18px;accent-color:var(--pri)" onchange="updateFieldMode()">
                    <div style="flex:1;min-width:0">
                      <div style="font-size:14px;font-weight:800;color:var(--txt)">ë¶„ì•¼ë³„ ë³„ë„ ì¼ë ¨ë²ˆí˜¸</div>
                      <div style="font-size:12px;color:var(--sub);margin-top:4px;line-height:1.5">ê°™ì€ í˜•ì‹ì´ì§€ë§Œ ì¼ë ¨ë²ˆí˜¸ê°€ ë¶„ì•¼ë³„ë¡œ ë”°ë¡œ ì¦ê°€í•©ë‹ˆë‹¤</div>
                      <div id="fm-example-serial" style="display:flex;gap:8px;margin-top:8px;flex-wrap:wrap"></div>
                    </div>
                  </label>

                </div>
              </div>

              <div id="field-code-area" style="margin-top:14px">
                <div style="font-size:12px;font-weight:700;color:var(--txt);margin-bottom:8px">ë¶„ì•¼ë³„ ì½”ë“œ ì„¤ì •</div>
                <div id="field-code-list"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- ì†Œì† ë¶„ì•¼ ì„ íƒ (ì „ì²´ ë„ˆë¹„) -->
        <div class="d-card" style="margin-top:20px">
          <h4>ğŸ·ï¸ ì†Œì† ë¶„ì•¼</h4>
          <p style="font-size:12px;color:var(--sub);margin-bottom:12px">ì´ ê²€ì‚¬ ëª©ì ì´ ì ìš©ë˜ëŠ” ë¶„ì•¼ë¥¼ ì„ íƒí•©ë‹ˆë‹¤ (í´ë¦­í•˜ì—¬ ON/OFF)</p>
          <div id="field-chips" style="display:flex;gap:10px;flex-wrap:wrap"></div>
        </div>

        <!-- ì ‘ìˆ˜ë²ˆí˜¸ êµ¬ì„± (ì „ì²´ ë„ˆë¹„) -->
        <div class="d-card" style="margin-top:20px">
          <h4>ğŸ”¢ ì ‘ìˆ˜ë²ˆí˜¸ êµ¬ì„±</h4>
          <p style="font-size:12px;color:var(--sub);margin-bottom:12px">ì´ ê²€ì‚¬ ëª©ì ìœ¼ë¡œ ì ‘ìˆ˜í•  ë•Œ ë¶€ì—¬ë˜ëŠ” ì ‘ìˆ˜ë²ˆí˜¸ í˜•ì‹ì„ ì„¤ì •í•©ë‹ˆë‹¤</p>
          <div class="fg-row">
            <div class="fg"><label>êµ¬ë¶„ ìˆ˜</label><select id="d-seg-cnt" onchange="dInitSeg()"><option value="2">2êµ¬ë¶„</option><option value="3">3êµ¬ë¶„</option><option value="4" selected>4êµ¬ë¶„</option><option value="5">5êµ¬ë¶„</option></select></div>
            <div class="fg"><label>êµ¬ë¶„ì</label><select id="d-seg-sep" onchange="dUpdatePrev()"><option value="-">í•˜ì´í”ˆ (-)</option><option value="/">ìŠ¬ë˜ì‹œ (/)</option><option value=".">ë§ˆì¹¨í‘œ (.)</option></select></div>
          </div>
          <div id="d-seg-area"></div>
          <div class="fg" style="margin-top:8px"><label>ì´ˆê¸°í™” ì£¼ê¸°</label><select id="d-reset" onchange="updateResetDesc()"><option value="year">ë§¤ë…„ ì´ˆê¸°í™”</option><option value="month">ë§¤ì›” ì´ˆê¸°í™”</option><option value="none">ì´ˆê¸°í™” ì•ˆ í•¨</option></select></div>
          <div id="reset-desc" style="margin-top:6px;padding:10px 14px;background:var(--pri-l);border-radius:10px;font-size:12px;color:var(--pri)">ğŸ“… ë§¤ë…„ 1ì›” 1ì¼ì— ì¼ë ¨ë²ˆí˜¸ê°€ 0001ë¶€í„° ë‹¤ì‹œ ì‹œì‘ë©ë‹ˆë‹¤</div>

          <!-- ë¯¸ë¦¬ë³´ê¸°: ë¶„ì•¼ë³„ë¡œ ë‚˜ë€íˆ -->
          <div id="preview-area">
            <div class="preview-hero">
              <div class="ph-label">ë¯¸ë¦¬ë³´ê¸°</div>
              <div class="ph-number" id="d-pn">QC-26-02-0001</div>
              <div class="ph-desc" id="d-pd">ëª©ì ì½”ë“œ âˆ’ ë…„ë„ âˆ’ ì›” âˆ’ ì¼ë ¨ë²ˆí˜¸</div>
            </div>
          </div>
          <div id="preview-field-area" style="display:none"></div>

          <div class="example-list" id="d-pl"></div>
          <div style="margin-top:10px;padding:10px 14px;background:var(--green-l);border-radius:10px;font-size:12px;color:#0a8967">ğŸ’¡ <b>ë…„ë„Â·ì›”Â·ì¼</b>ì€ ì„œë²„ ë‚ ì§œ ê¸°ì¤€ìœ¼ë¡œ ìë™ ë³€ê²½ë©ë‹ˆë‹¤. <b>ì¼ë ¨ë²ˆí˜¸</b>ëŠ” ì ‘ìˆ˜í•  ë•Œë§ˆë‹¤ ìë™ìœ¼ë¡œ 1ì”© ì¦ê°€í•©ë‹ˆë‹¤.</div>
          <div style="display:flex;justify-content:flex-end;margin-top:12px">
            <button class="btn btn-primary btn-sm" onclick="toast('ì ‘ìˆ˜ë²ˆí˜¸ í˜•ì‹ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤ âœ¨','ok')">ì ‘ìˆ˜ë²ˆí˜¸ ì €ì¥</button>
          </div>
        </div>
      </div>
    </div>

    <!-- â•â•â• TAB 1: ì‹í’ˆ ìœ í˜• â•â•â• -->
    <div class="panel" id="p2">
      <div class="toolbar"><div class="search-box"><span>ğŸ”</span><input type="text" placeholder="ì‹í’ˆ ìœ í˜• ê²€ìƒ‰..."></div><div class="filter-pills"><div class="pill on">ì „ì²´</div><div class="pill">ğŸª ê³¼ìë¥˜</div><div class="pill">ğŸ¥¤ ìŒë£Œë¥˜</div><div class="pill">ğŸœ ë©´ë¥˜</div><div class="pill">ğŸ¥© ì‹ìœ¡ê°€ê³µ</div><div class="pill">ğŸ¥› ìœ ê°€ê³µ</div><div class="pill">ğŸ’Š ê±´ê¸°ì‹</div></div></div>
      <table class="modern-table"><thead><tr><th>ì‹í’ˆ ìœ í˜•</th><th>ì¹´í…Œê³ ë¦¬</th><th>ì—°ê²° ê·¸ë£¹</th><th>í•­ëª© ìˆ˜</th><th></th></tr></thead><tbody>
        <tr><td><strong>ë¹„ìŠ¤í‚·</strong></td><td><span class="badge b-chem">ğŸª ê³¼ìë¥˜</span></td><td><span class="tag tag-mint">ë¯¸ìƒë¬¼ ê¸°ë³¸</span> <span class="tag tag-coral">ì¤‘ê¸ˆì†</span></td><td style="font-weight:700;color:var(--pri)">18</td><td><button class="ic-btn ic-btn-edit" onclick="openModal('mf')">âœ</button></td></tr>
        <tr><td><strong>ìº”ë””ë¥˜</strong></td><td><span class="badge b-chem">ğŸª ê³¼ìë¥˜</span></td><td><span class="tag tag-mint">ë¯¸ìƒë¬¼ ê¸°ë³¸</span></td><td style="font-weight:700;color:var(--pri)">12</td><td><button class="ic-btn ic-btn-edit" onclick="openModal('mf')">âœ</button></td></tr>
        <tr><td><strong>ê³¼Â·ì±„ì£¼ìŠ¤</strong></td><td><span class="badge b-nutri">ğŸ¥¤ ìŒë£Œë¥˜</span></td><td><span class="tag tag-mint">ë¯¸ìƒë¬¼ ê¸°ë³¸</span> <span class="tag tag-violet">ë³´ì¡´ë£Œ</span></td><td style="font-weight:700;color:var(--pri)">22</td><td><button class="ic-btn ic-btn-edit" onclick="openModal('mf')">âœ</button></td></tr>
        <tr><td><strong>íƒ„ì‚°ìŒë£Œ</strong></td><td><span class="badge b-nutri">ğŸ¥¤ ìŒë£Œë¥˜</span></td><td><span class="tag tag-mint">ë¯¸ìƒë¬¼ ê¸°ë³¸</span></td><td style="font-weight:700;color:var(--pri)">16</td><td><button class="ic-btn ic-btn-edit" onclick="openModal('mf')">âœ</button></td></tr>
        <tr><td><strong>ìœ íƒ•ë©´ë¥˜</strong></td><td><span class="badge b-preserv">ğŸœ ë©´ë¥˜</span></td><td><span class="tag tag-mint">ë¯¸ìƒë¬¼ ê¸°ë³¸</span> <span class="tag tag-amber">ì‚°ê°€Â·ê³¼ì‚°í™”</span></td><td style="font-weight:700;color:var(--pri)">20</td><td><button class="ic-btn ic-btn-edit" onclick="openModal('mf')">âœ</button></td></tr>
        <tr><td><strong>í–„ë¥˜</strong></td><td><span class="badge b-metal">ğŸ¥© ì‹ìœ¡ê°€ê³µ</span></td><td><span class="tag tag-mint">ë¯¸ìƒë¬¼ ê¸°ë³¸</span> <span class="tag tag-violet">ë³´ì¡´ë£Œ</span> <span class="tag tag-coral">ì¤‘ê¸ˆì†</span></td><td style="font-weight:700;color:var(--pri)">24</td><td><button class="ic-btn ic-btn-edit" onclick="openModal('mf')">âœ</button></td></tr>
        <tr><td><strong>ì†Œì‹œì§€</strong></td><td><span class="badge b-metal">ğŸ¥© ì‹ìœ¡ê°€ê³µ</span></td><td><span class="tag tag-mint">ë¯¸ìƒë¬¼ ê¸°ë³¸</span> <span class="tag tag-violet">ë³´ì¡´ë£Œ</span></td><td style="font-weight:700;color:var(--pri)">20</td><td><button class="ic-btn ic-btn-edit" onclick="openModal('mf')">âœ</button></td></tr>
      </tbody></table>
    </div>

    <!-- â•â•â• TAB 2: ê²€ì‚¬ í•­ëª© â•â•â• -->
    <div class="panel" id="p3">
      <div class="toolbar"><div class="search-box"><span>ğŸ”</span><input type="text" placeholder="í•­ëª©ëª… ê²€ìƒ‰..."></div><div class="filter-pills"><div class="pill on">ì „ì²´</div><div class="pill">ğŸ¦  ë¯¸ìƒë¬¼</div><div class="pill">âš ï¸ ì¤‘ê¸ˆì†</div><div class="pill">âš—ï¸ ì´í™”í•™</div><div class="pill">ğŸ§´ ë³´ì¡´ë£Œ</div><div class="pill">ğŸ¥— ì˜ì–‘ì„±ë¶„</div><div class="pill">ğŸŒ¿ ì”ë¥˜ë†ì•½</div></div></div>
      <table class="modern-table"><thead><tr><th>í•­ëª©ëª…</th><th>ì˜ë¬¸ëª…</th><th>ë¶„ë¥˜</th><th>ë‹¨ìœ„</th><th>ì‹œí—˜ë²•</th><th>ê¸°ì¤€Â·ê·œê²©</th><th>ë°°ì •</th><th></th></tr></thead><tbody>
        <tr><td><strong>ì¼ë°˜ì„¸ê· ìˆ˜</strong></td><td style="color:var(--sub)">Total Plate Count</td><td><span class="badge b-micro">ğŸ¦  ë¯¸ìƒë¬¼</span></td><td>CFU/g</td><td>ê±´ì¡°í•„ë¦„ë²•</td><td><a href="#" onclick="openModal('ms');return false" style="color:var(--pri);font-weight:600">3ê°œ ëª©ì  â†’</a></td><td><span style="color:var(--green);font-weight:700">â—</span></td><td><button class="ic-btn ic-btn-edit" onclick="openModal('mi')">âœ</button></td></tr>
        <tr><td><strong>ëŒ€ì¥ê· êµ°</strong></td><td style="color:var(--sub)">Coliform</td><td><span class="badge b-micro">ğŸ¦  ë¯¸ìƒë¬¼</span></td><td>CFU/g</td><td>ê±´ì¡°í•„ë¦„ë²•</td><td><a href="#" onclick="openModal('ms');return false" style="color:var(--pri);font-weight:600">3ê°œ ëª©ì  â†’</a></td><td><span style="color:var(--green);font-weight:700">â—</span></td><td><button class="ic-btn ic-btn-edit" onclick="openModal('mi')">âœ</button></td></tr>
        <tr><td><strong>ëŒ€ì¥ê· </strong></td><td style="color:var(--sub)">E. coli</td><td><span class="badge b-micro">ğŸ¦  ë¯¸ìƒë¬¼</span></td><td>CFU/g</td><td>ê±´ì¡°í•„ë¦„ë²•</td><td><a href="#" onclick="openModal('ms');return false" style="color:var(--pri);font-weight:600">2ê°œ ëª©ì  â†’</a></td><td><span style="color:var(--green);font-weight:700">â—</span></td><td><button class="ic-btn ic-btn-edit" onclick="openModal('mi')">âœ</button></td></tr>
        <tr><td><strong>ë‚© (Pb)</strong></td><td style="color:var(--sub)">Lead</td><td><span class="badge b-metal">âš ï¸ ì¤‘ê¸ˆì†</span></td><td>mg/kg</td><td>ICP-MS</td><td><a href="#" onclick="openModal('ms');return false" style="color:var(--pri);font-weight:600">4ê°œ ëª©ì  â†’</a></td><td><span style="color:var(--green);font-weight:700">â—</span></td><td><button class="ic-btn ic-btn-edit" onclick="openModal('mi')">âœ</button></td></tr>
        <tr><td><strong>ì¹´ë“œë®´ (Cd)</strong></td><td style="color:var(--sub)">Cadmium</td><td><span class="badge b-metal">âš ï¸ ì¤‘ê¸ˆì†</span></td><td>mg/kg</td><td>ICP-MS</td><td><a href="#" onclick="openModal('ms');return false" style="color:var(--pri);font-weight:600">4ê°œ ëª©ì  â†’</a></td><td><span style="color:var(--green);font-weight:700">â—</span></td><td><button class="ic-btn ic-btn-edit" onclick="openModal('mi')">âœ</button></td></tr>
        <tr><td><strong>ì†Œë¥´ë¹ˆì‚°</strong></td><td style="color:var(--sub)">Sorbic Acid</td><td><span class="badge b-preserv">ğŸ§´ ë³´ì¡´ë£Œ</span></td><td>g/kg</td><td>HPLC</td><td><a href="#" onclick="openModal('ms');return false" style="color:var(--pri);font-weight:600">3ê°œ ëª©ì  â†’</a></td><td><span style="color:var(--green);font-weight:700">â—</span></td><td><button class="ic-btn ic-btn-edit" onclick="openModal('mi')">âœ</button></td></tr>
        <tr><td><strong>ì—´ëŸ‰</strong></td><td style="color:var(--sub)">Calories</td><td><span class="badge b-nutri">ğŸ¥— ì˜ì–‘ì„±ë¶„</span></td><td>kcal</td><td>ê³„ì‚°ë²•</td><td><a href="#" onclick="openModal('ms');return false" style="color:var(--pri);font-weight:600">1ê°œ ëª©ì  â†’</a></td><td><span style="color:var(--green);font-weight:700">â—</span></td><td><button class="ic-btn ic-btn-edit" onclick="openModal('mi')">âœ</button></td></tr>
      </tbody></table>
    </div>

    <!-- â•â•â• TAB 3: í•­ëª© ê·¸ë£¹ â•â•â• -->
    <div class="panel" id="p4">
      <div class="toolbar"><div class="search-box"><span>ğŸ”</span><input type="text" placeholder="ê·¸ë£¹ëª… ê²€ìƒ‰..."></div></div>
      <div class="tree-wrap">
        <div class="tree-card"><div class="tree-top" onclick="tt(this)"><span class="t-arrow">â–¶</span><div class="t-icon" style="background:var(--pri-l)">ğŸ¦ </div><span class="t-name">ë¯¸ìƒë¬¼ ê¸°ë³¸</span><span class="t-count">4ê°œ</span><div class="tree-tags"><span class="tag tag-mint">ê³¼ìë¥˜</span><span class="tag tag-mint">ìŒë£Œë¥˜</span><span class="tag tag-mint">ë©´ë¥˜</span><span class="tag tag-mint">ì‹ìœ¡ê°€ê³µ</span></div><button class="ic-btn ic-btn-edit" style="margin-left:8px" onclick="event.stopPropagation();openModal('mg')">âœ</button></div><div class="tree-body"><div class="tree-child"><span>ğŸ¦  ì¼ë°˜ì„¸ê· ìˆ˜</span><span style="color:var(--sub)">CFU/g</span></div><div class="tree-child"><span>ğŸ¦  ëŒ€ì¥ê· êµ°</span><span style="color:var(--sub)">CFU/g</span></div><div class="tree-child"><span>ğŸ¦  ëŒ€ì¥ê· </span><span style="color:var(--sub)">CFU/g</span></div><div class="tree-child"><span>ğŸ¦  ì‚´ëª¨ë„¬ë¼</span><span style="color:var(--sub)">ë¶ˆê²€ì¶œ</span></div></div></div>
        <div class="tree-card"><div class="tree-top" onclick="tt(this)"><span class="t-arrow">â–¶</span><div class="t-icon" style="background:var(--coral-l)">âš ï¸</div><span class="t-name">ì¤‘ê¸ˆì†</span><span class="t-count">4ê°œ</span><div class="tree-tags"><span class="tag tag-mint">ê³¼ìë¥˜</span><span class="tag tag-mint">ì‹ìœ¡ê°€ê³µ</span></div><button class="ic-btn ic-btn-edit" style="margin-left:8px" onclick="event.stopPropagation();openModal('mg')">âœ</button></div><div class="tree-body"><div class="tree-child"><span>âš ï¸ ë‚© (Pb)</span><span style="color:var(--sub)">mg/kg</span></div><div class="tree-child"><span>âš ï¸ ì¹´ë“œë®´ (Cd)</span><span style="color:var(--sub)">mg/kg</span></div><div class="tree-child"><span>âš ï¸ ë¹„ì†Œ (As)</span><span style="color:var(--sub)">mg/kg</span></div><div class="tree-child"><span>âš ï¸ ìˆ˜ì€ (Hg)</span><span style="color:var(--sub)">mg/kg</span></div></div></div>
        <div class="tree-card"><div class="tree-top" onclick="tt(this)"><span class="t-arrow">â–¶</span><div class="t-icon" style="background:var(--violet-l)">ğŸ§´</div><span class="t-name">ë³´ì¡´ë£Œ</span><span class="t-count">5ê°œ</span><div class="tree-tags"><span class="tag tag-mint">ìŒë£Œë¥˜</span><span class="tag tag-mint">ì‹ìœ¡ê°€ê³µ</span></div><button class="ic-btn ic-btn-edit" style="margin-left:8px" onclick="event.stopPropagation();openModal('mg')">âœ</button></div><div class="tree-body"><div class="tree-child"><span>ğŸ§´ ì†Œë¥´ë¹ˆì‚°</span><span style="color:var(--sub)">g/kg</span></div><div class="tree-child"><span>ğŸ§´ ì•ˆì‹í–¥ì‚°</span><span style="color:var(--sub)">g/kg</span></div><div class="tree-child"><span>ğŸ§´ í”„ë¡œí”¼ì˜¨ì‚°</span><span style="color:var(--sub)">g/kg</span></div><div class="tree-child"><span>ğŸ§´ íŒŒë¼ì˜¥ì‹œì•ˆì‹í–¥ì‚°</span><span style="color:var(--sub)">g/kg</span></div><div class="tree-child"><span>ğŸ§´ ë””íˆë“œë¡œì´ˆì‚°</span><span style="color:var(--sub)">g/kg</span></div></div></div>
        <div class="tree-card"><div class="tree-top" onclick="tt(this)"><span class="t-arrow">â–¶</span><div class="t-icon" style="background:var(--amber-l)">âš—ï¸</div><span class="t-name">ì‚°ê°€Â·ê³¼ì‚°í™”ë¬¼ê°€</span><span class="t-count">2ê°œ</span><div class="tree-tags"><span class="tag tag-mint">ë©´ë¥˜</span></div><button class="ic-btn ic-btn-edit" style="margin-left:8px" onclick="event.stopPropagation();openModal('mg')">âœ</button></div><div class="tree-body"><div class="tree-child"><span>âš—ï¸ ì‚°ê°€</span><span style="color:var(--sub)">mg KOH/g</span></div><div class="tree-child"><span>âš—ï¸ ê³¼ì‚°í™”ë¬¼ê°€</span><span style="color:var(--sub)">meq/kg</span></div></div></div>
        <div class="tree-card"><div class="tree-top" onclick="tt(this)"><span class="t-arrow">â–¶</span><div class="t-icon" style="background:var(--green-l)">ğŸ¥—</div><span class="t-name">ì˜ì–‘ì„±ë¶„ 9ì¢…</span><span class="t-count">9ê°œ</span><div class="tree-tags"><span class="tag tag-amber">ì°¸ê³ ìš©(ì˜ì–‘ì„±ë¶„) ì „ìš©</span></div><button class="ic-btn ic-btn-edit" style="margin-left:8px" onclick="event.stopPropagation();openModal('mg')">âœ</button></div><div class="tree-body"><div class="tree-child"><span>ì—´ëŸ‰</span><span style="color:var(--sub)">kcal</span></div><div class="tree-child"><span>íƒ„ìˆ˜í™”ë¬¼</span><span style="color:var(--sub)">g</span></div><div class="tree-child"><span>ë‹¹ë¥˜</span><span style="color:var(--sub)">g</span></div><div class="tree-child"><span>ë‹¨ë°±ì§ˆ</span><span style="color:var(--sub)">g</span></div><div class="tree-child"><span>ì§€ë°©</span><span style="color:var(--sub)">g</span></div><div class="tree-child"><span>í¬í™”ì§€ë°©</span><span style="color:var(--sub)">g</span></div><div class="tree-child"><span>íŠ¸ëœìŠ¤ì§€ë°©</span><span style="color:var(--sub)">g</span></div><div class="tree-child"><span>ì½œë ˆìŠ¤í…Œë¡¤</span><span style="color:var(--sub)">mg</span></div><div class="tree-child"><span>ë‚˜íŠ¸ë¥¨</span><span style="color:var(--sub)">mg</span></div></div></div>
      </div>
    </div>

  </div>
</div>

<button class="fab" id="fb" onclick="fabAction()">+</button>

<!-- MODALS (ì‹í’ˆìœ í˜•, ê²€ì‚¬í•­ëª©, ê¸°ì¤€ê·œê²©, í•­ëª©ê·¸ë£¹) -->
<div class="modal-overlay" id="mf"><div class="modal"><div class="modal-head"><h3>ğŸ± ì‹í’ˆ ìœ í˜•</h3><button class="modal-x" onclick="closeModal('mf')">âœ•</button></div><div class="modal-body"><div class="fg-row"><div class="fg"><label>ì¹´í…Œê³ ë¦¬ *</label><select><option>ê³¼ìë¥˜Â·ë¹µë¥˜Â·ë–¡ë¥˜</option><option>ìŒë£Œë¥˜</option><option>ë©´ë¥˜</option><option>ì‹ìœ¡ê°€ê³µí’ˆ</option><option>ìœ ê°€ê³µí’ˆ</option><option>ìˆ˜ì‚°ê°€ê³µí’ˆ</option><option>ê±´ê°•ê¸°ëŠ¥ì‹í’ˆ</option></select></div><div class="fg" style="flex:0 0 100px"><label>ì½”ë“œ</label><input type="text" placeholder="BIS" style="text-align:center"></div></div><div class="fg"><label>ì‹í’ˆ ìœ í˜•ëª… *</label><input type="text" placeholder="ì˜ˆ: ë¹„ìŠ¤í‚·"></div><div class="fg"><label>ì—°ê²°í•  í•­ëª© ê·¸ë£¹</label><div class="ck-list"><label class="ck-item"><input type="checkbox" checked> ğŸ¦  ë¯¸ìƒë¬¼ ê¸°ë³¸ (4ê°œ)</label><label class="ck-item"><input type="checkbox" checked> âš ï¸ ì¤‘ê¸ˆì† (4ê°œ)</label><label class="ck-item"><input type="checkbox"> ğŸ§´ ë³´ì¡´ë£Œ (5ê°œ)</label><label class="ck-item"><input type="checkbox"> âš—ï¸ ì‚°ê°€Â·ê³¼ì‚°í™”ë¬¼ê°€ (2ê°œ)</label><label class="ck-item"><input type="checkbox"> ğŸ¥— ì˜ì–‘ì„±ë¶„ 9ì¢… (9ê°œ)</label></div></div></div><div class="modal-foot"><button class="btn btn-ghost" onclick="closeModal('mf')">ì·¨ì†Œ</button><button class="btn btn-primary" onclick="closeModal('mf');toast('ì‹í’ˆ ìœ í˜•ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤ âœ¨','ok')">ì €ì¥</button></div></div></div>

<div class="modal-overlay" id="mi"><div class="modal modal-wide"><div class="modal-head"><h3>ğŸ§ª ê²€ì‚¬ í•­ëª©</h3><button class="modal-x" onclick="closeModal('mi')">âœ•</button></div><div class="modal-body"><div class="fg-row"><div class="fg"><label>í•­ëª©ëª… (êµ­ë¬¸) *</label><input type="text" value="ì¼ë°˜ì„¸ê· ìˆ˜"></div><div class="fg"><label>ì˜ë¬¸ëª…</label><input type="text" value="Total Plate Count"></div></div><div class="fg-row"><div class="fg"><label>ë¶„ë¥˜ *</label><select><option>ë¯¸ìƒë¬¼</option><option>ì¤‘ê¸ˆì†</option><option>ì´í™”í•™</option><option>ë³´ì¡´ë£Œ</option><option>ì˜ì–‘ì„±ë¶„</option><option>ì”ë¥˜ë†ì•½</option></select></div><div class="fg"><label>ë‹¨ìœ„ *</label><input type="text" value="CFU/g"></div><div class="fg"><label>ì‹œí—˜ë²•</label><input type="text" value="ê±´ì¡°í•„ë¦„ë²•"></div></div><div style="border-top:2px solid var(--bdr);margin-top:12px;padding-top:16px"><div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px"><span style="font-size:13px;font-weight:800">ê²€ì‚¬ ëª©ì ë³„ ê¸°ì¤€Â·ê·œê²©</span><button class="btn btn-ghost btn-sm" onclick="asr()">+ ì¶”ê°€</button></div><table class="modern-table" style="border-spacing:0 4px"><thead><tr><th>ê²€ì‚¬ ëª©ì </th><th>ê¸°ì¤€</th><th>ê·œê²©</th><th>íŒì •</th><th></th></tr></thead><tbody id="st"><tr><td><select style="font-size:12px;padding:6px 10px;border:1.5px solid var(--bdr);border-radius:8px;width:100%"><option>ìê°€í’ˆì§ˆìœ„íƒê²€ì‚¬ìš©</option><option>ì°¸ê³ ìš©(ê¸°ì¤€ê·œê²©ì™¸)</option><option>ì°¸ê³ ìš©(ìœ í†µê¸°í•œì„¤ì •)</option><option>ì°¸ê³ ìš©(ì˜ì–‘ì„±ë¶„)</option><option>ì°¸ê³ ìš©(ì™¸ë¶€ì˜ë¢°)</option><option>ì •ë„ê´€ë¦¬</option><option>ì—°êµ¬ìš©ì—­</option></select></td><td><input type="text" value="n=5, c=1, m=10000, M=100000" style="font-size:12px;padding:6px 10px;border:1.5px solid var(--bdr);border-radius:8px"></td><td><input type="text" value="100,000 ì´í•˜" style="font-size:12px;padding:6px 10px;border:1.5px solid var(--bdr);border-radius:8px"></td><td><select style="font-size:12px;padding:6px 10px;border:1.5px solid var(--bdr);border-radius:8px"><option>ì´í•˜</option><option>ë¯¸ë§Œ</option><option>ë¶ˆê²€ì¶œ</option></select></td><td><button class="ic-btn ic-btn-del" onclick="this.closest('tr').remove()">âœ•</button></td></tr></tbody></table></div><div style="margin-top:12px;padding:10px 14px;background:var(--amber-l);border-radius:10px;font-size:12px;color:#b8860b">ğŸ’¡ ì €ì¥ëœ í•­ëª©ì€ <strong>ì‹œí—˜ ê²°ì¬ â€º í•­ëª©ë°°ì •</strong>ì—ì„œ ë‹´ë‹¹ìì—ê²Œ ë°°ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</div></div><div class="modal-foot"><button class="btn btn-ghost" onclick="closeModal('mi')">ì·¨ì†Œ</button><button class="btn btn-primary" onclick="closeModal('mi');toast('ê²€ì‚¬ í•­ëª©ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤ âœ¨','ok')">ì €ì¥</button></div></div></div>

<div class="modal-overlay" id="ms"><div class="modal"><div class="modal-head"><h3>ğŸ“‹ ì¼ë°˜ì„¸ê· ìˆ˜ â€” ê¸°ì¤€Â·ê·œê²©</h3><button class="modal-x" onclick="closeModal('ms')">âœ•</button></div><div class="modal-body"><table class="modern-table" style="border-spacing:0 4px"><thead><tr><th>ê²€ì‚¬ ëª©ì </th><th>ê¸°ì¤€</th><th>ê·œê²©</th><th>íŒì •</th></tr></thead><tbody><tr><td><span class="badge b-micro">ìê°€í’ˆì§ˆìœ„íƒê²€ì‚¬ìš©</span></td><td>n=5, c=1, m=10,000, M=100,000</td><td>100,000 ì´í•˜</td><td>ì´í•˜</td></tr><tr><td><span class="badge b-micro">ì°¸ê³ ìš©(ê¸°ì¤€ê·œê²©ì™¸)</span></td><td>n=5, c=1, m=10,000, M=100,000</td><td>100,000 ì´í•˜</td><td>ì´í•˜</td></tr><tr><td><span class="badge b-micro">ì°¸ê³ ìš©(ì™¸ë¶€ì˜ë¢°)</span></td><td>n=5, c=0, m=0</td><td>ë¶ˆê²€ì¶œ</td><td>ë¶ˆê²€ì¶œ</td></tr></tbody></table><div style="margin-top:10px;font-size:12px;color:var(--sub)">â€» ê°™ì€ í•­ëª©ì´ë¼ë„ ê²€ì‚¬ ëª©ì ì— ë”°ë¼ ê¸°ì¤€ì´ ë‹¬ë¼ì§‘ë‹ˆë‹¤.</div></div><div class="modal-foot"><button class="btn btn-ghost" onclick="closeModal('ms')">ë‹«ê¸°</button></div></div></div>

<div class="modal-overlay" id="mg"><div class="modal modal-wide"><div class="modal-head"><h3>ğŸ“¦ í•­ëª© ê·¸ë£¹</h3><button class="modal-x" onclick="closeModal('mg')">âœ•</button></div><div class="modal-body"><div class="fg"><label>ê·¸ë£¹ëª… *</label><input type="text" value="ë¯¸ìƒë¬¼ ê¸°ë³¸"></div><div class="fg"><label>í¬í•¨í•  ê²€ì‚¬ í•­ëª©</label><div class="ck-list"><label class="ck-item"><input type="checkbox" checked> ğŸ¦  ì¼ë°˜ì„¸ê· ìˆ˜ (CFU/g)</label><label class="ck-item"><input type="checkbox" checked> ğŸ¦  ëŒ€ì¥ê· êµ° (CFU/g)</label><label class="ck-item"><input type="checkbox" checked> ğŸ¦  ëŒ€ì¥ê·  (CFU/g)</label><label class="ck-item"><input type="checkbox" checked> ğŸ¦  ì‚´ëª¨ë„¬ë¼ (ë¶ˆê²€ì¶œ)</label><label class="ck-item"><input type="checkbox"> ğŸ¦  í™©ìƒ‰í¬ë„ìƒêµ¬ê· </label><label class="ck-item"><input type="checkbox"> âš ï¸ ë‚© (mg/kg)</label><label class="ck-item"><input type="checkbox"> ğŸ§´ ì†Œë¥´ë¹ˆì‚° (g/kg)</label></div></div><div class="fg"><label>ì—°ê²°í•  ì‹í’ˆ ìœ í˜•</label><div class="ck-list" style="max-height:140px"><label class="ck-item"><input type="checkbox" checked> ğŸª ë¹„ìŠ¤í‚·</label><label class="ck-item"><input type="checkbox" checked> ğŸª ìº”ë””ë¥˜</label><label class="ck-item"><input type="checkbox" checked> ğŸ¥¤ ê³¼Â·ì±„ì£¼ìŠ¤</label><label class="ck-item"><input type="checkbox" checked> ğŸ¥¤ íƒ„ì‚°ìŒë£Œ</label><label class="ck-item"><input type="checkbox" checked> ğŸœ ìœ íƒ•ë©´ë¥˜</label><label class="ck-item"><input type="checkbox" checked> ğŸ¥© í–„ë¥˜</label><label class="ck-item"><input type="checkbox" checked> ğŸ¥© ì†Œì‹œì§€</label></div></div></div><div class="modal-foot"><button class="btn btn-ghost" onclick="closeModal('mg')">ì·¨ì†Œ</button><button class="btn btn-primary" onclick="closeModal('mg');toast('í•­ëª© ê·¸ë£¹ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤ âœ¨','ok')">ì €ì¥</button></div></div></div>

<!-- ë¶„ì•¼ ì¶”ê°€/ìˆ˜ì • ëª¨ë‹¬ -->
<div class="modal-overlay" id="mfield"><div class="modal" style="width:460px"><div class="modal-head"><h3 id="mf-title">ğŸ·ï¸ ë¶„ì•¼ ì¶”ê°€</h3><button class="modal-x" onclick="closeModal('mfield')">âœ•</button></div><div class="modal-body">
  <div id="mf-preview" style="display:flex;align-items:center;gap:14px;padding:16px 18px;background:var(--bg);border-radius:12px;margin-bottom:16px;border-left:4px solid var(--pri)">
    <div id="mf-prev-icon" style="width:50px;height:50px;border-radius:12px;background:rgba(67,97,238,.1);display:flex;align-items:center;justify-content:center;font-size:22px;font-weight:800;font-family:'Outfit';color:var(--pri)">?</div>
    <div style="flex:1"><div id="mf-prev-name" style="font-size:16px;font-weight:800">ìƒˆ ë¶„ì•¼</div><div id="mf-prev-desc" style="font-size:11px;color:var(--sub);margin-top:2px">ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”</div></div>
  </div>
  <div class="fg"><label>ë¶„ì•¼ëª… *</label><input type="text" id="mf-name" placeholder="ì˜ˆ: í™˜ê²½" oninput="updateFieldPreview()"></div>
  <div class="fg-row"><div class="fg"><label>ë¶„ì•¼ ì½”ë“œ *</label><input type="text" id="mf-code" placeholder="ì˜ˆ: E" style="text-align:center;font-family:'Outfit',monospace;font-weight:800;font-size:16px" maxlength="5" oninput="updateFieldPreview()"></div><div class="fg"><label>ìƒ‰ìƒ</label><select id="mf-color" onchange="updateFieldPreview()"><option value="#4361ee">ğŸ”µ íŒŒë‘</option><option value="#2ec4b6">ğŸŸ¢ ë¯¼íŠ¸</option><option value="#ff6b6b">ğŸ”´ ì½”ë„</option><option value="#ffc857">ğŸŸ¡ ì•°ë²„</option><option value="#7c5cfc">ğŸŸ£ ë°”ì´ì˜¬ë ›</option><option value="#06d6a0">ğŸŸ¢ ê·¸ë¦°</option><option value="#f72585">ğŸŒ¸ ë¡œì¦ˆ</option><option value="#4cc9f0">ğŸ”µ ìŠ¤ì¹´ì´</option></select></div></div>
  <div class="fg"><label>ì„¤ëª…</label><input type="text" id="mf-desc" placeholder="ë¶„ì•¼ ì„¤ëª… (ì„ íƒ)" oninput="updateFieldPreview()"></div>
</div><div class="modal-foot"><button class="btn btn-ghost" onclick="closeModal('mfield')">ì·¨ì†Œ</button><button class="btn btn-primary" id="mf-submit" onclick="saveField()">ì¶”ê°€</button></div></div></div>

<div class="toast" id="te"></div>

<!-- ì‚­ì œ í™•ì¸ ëª¨ë‹¬ -->
<div class="modal-overlay" id="mdel"><div class="modal" style="width:400px;text-align:center">
  <div style="padding:32px 24px 0">
    <div style="width:64px;height:64px;border-radius:50%;background:var(--coral-l);display:flex;align-items:center;justify-content:center;font-size:28px;margin:0 auto 16px">ğŸ—‘ï¸</div>
    <h3 style="font-size:18px;font-weight:800;margin-bottom:8px">ì‚­ì œ í™•ì¸</h3>
    <p id="del-msg" style="font-size:14px;color:var(--sub);line-height:1.6"></p>
    <div style="margin-top:14px;padding:12px 16px;background:var(--coral-l);border-radius:10px;font-size:12px;color:var(--coral);text-align:left">
      âš ï¸ ì‚­ì œëœ ê²€ì‚¬ ëª©ì ì€ ë³µêµ¬í•  ìˆ˜ ì—†ìœ¼ë©°, ì—°ê²°ëœ ì ‘ìˆ˜ë²ˆí˜¸ í˜•ì‹ë„ í•¨ê»˜ ì‚­ì œë©ë‹ˆë‹¤.
    </div>
  </div>
  <div class="modal-foot" style="justify-content:center;gap:10px;padding:20px 24px">
    <button class="btn btn-ghost" onclick="closeModal('mdel')" style="flex:1">ì·¨ì†Œ</button>
    <button class="btn btn-sm" onclick="confirmDelete()" style="flex:1;background:var(--coral);color:#fff;padding:12px 22px;font-size:14px">ì‚­ì œ</button>
  </div>
</div></div>

<script>
// â•â• DATA â•â•
// ë¶„ì•¼ ë°ì´í„°
const FIELDS=[
  {id:'F',name:'ì‹í’ˆ',code:'F',color:'#4361ee',desc:'ì‹í’ˆ ê²€ì‚¬ ë¶„ì•¼'},
  {id:'L',name:'ì¶•ì‚°',code:'L',color:'#ff6b6b',desc:'ì¶•ì‚°ë¬¼ ê²€ì‚¬ ë¶„ì•¼'},
];

const P=[
  {c:1,n:'ìê°€í’ˆì§ˆìœ„íƒê²€ì‚¬ìš©',i:42,o:1,rcpt:'QC-26-02-0001',rcptDesc:'ëª©ì ì½”ë“œ-ë…„ë„-ì›”-ì¼ë ¨ë²ˆí˜¸',prefix:'QC',fields:['F','L'],fieldUse:false,fieldMode:'code',fieldCodes:{F:'QC',L:'LQC'}},
  {c:2,n:'ì°¸ê³ ìš©(ê¸°ì¤€ê·œê²©ì™¸)',i:38,o:1,rcpt:'RE-26-02-0001',rcptDesc:'ëª©ì ì½”ë“œ-ë…„ë„-ì›”-ì¼ë ¨ë²ˆí˜¸',prefix:'RE',fields:['F'],fieldUse:false,fieldMode:'code',fieldCodes:{F:'RE'}},
  {c:4,n:'ì°¸ê³ ìš©(ìœ í†µê¸°í•œì„¤ì •)',i:28,o:1,rcpt:'SL-26-02-0001',rcptDesc:'ëª©ì ì½”ë“œ-ë…„ë„-ì›”-ì¼ë ¨ë²ˆí˜¸',prefix:'SL',fields:['F'],fieldUse:false,fieldMode:'code',fieldCodes:{F:'SL'}},
  {c:6,n:'ì°¸ê³ ìš©(ì˜ì–‘ì„±ë¶„)',i:14,o:1,rcpt:'NU-26-02-0001',rcptDesc:'ëª©ì ì½”ë“œ-ë…„ë„-ì›”-ì¼ë ¨ë²ˆí˜¸',prefix:'NU',fields:['F'],fieldUse:false,fieldMode:'code',fieldCodes:{F:'NU'}},
  {c:10,n:'ì •ë„ê´€ë¦¬',i:8,o:1,rcpt:'QA-26-0001',rcptDesc:'ëª©ì ì½”ë“œ-ë…„ë„-ì¼ë ¨ë²ˆí˜¸',prefix:'QA',fields:['F','L'],fieldUse:false,fieldMode:'code',fieldCodes:{F:'QA',L:'LQA'}},
  {c:11,n:'ì ‘ìˆ˜ì·¨ì†Œ',i:0,o:1,rcpt:'CX-26-0001',rcptDesc:'ëª©ì ì½”ë“œ-ë…„ë„-ì¼ë ¨ë²ˆí˜¸',prefix:'CX',fields:['F','L'],fieldUse:false,fieldMode:'code',fieldCodes:{}},
  {c:12,n:'ì°¸ê³ ìš©(ì™¸ë¶€ì˜ë¢°)',i:35,o:1,rcpt:'EX-26-02-0001',rcptDesc:'ëª©ì ì½”ë“œ-ë…„ë„-ì›”-ì¼ë ¨ë²ˆí˜¸',prefix:'EX',fields:['F'],fieldUse:false,fieldMode:'code',fieldCodes:{F:'EX'}},
  {c:13,n:'ë°©ì‚¬ëŠ¥(HPGe)',i:4,o:1,rcpt:'RA-26-02-0001',rcptDesc:'ëª©ì ì½”ë“œ-ë…„ë„-ì›”-ì¼ë ¨ë²ˆí˜¸',prefix:'RA',fields:['F'],fieldUse:false,fieldMode:'code',fieldCodes:{F:'RA'}},
  {c:14,n:'Allergen(ELISA)',i:6,o:1,rcpt:'AE-26-02-0001',rcptDesc:'ëª©ì ì½”ë“œ-ë…„ë„-ì›”-ì¼ë ¨ë²ˆí˜¸',prefix:'AE',fields:['F'],fieldUse:false,fieldMode:'code',fieldCodes:{F:'AE'}},
  {c:15,n:'Halal food(RT_PCR)',i:5,o:1,rcpt:'HL-26-02-0001',rcptDesc:'ëª©ì ì½”ë“œ-ë…„ë„-ì›”-ì¼ë ¨ë²ˆí˜¸',prefix:'HL',fields:['F'],fieldUse:false,fieldMode:'code',fieldCodes:{F:'HL'}},
  {c:16,n:'Vegan food(RT-PCR)',i:5,o:1,rcpt:'VG-26-02-0001',rcptDesc:'ëª©ì ì½”ë“œ-ë…„ë„-ì›”-ì¼ë ¨ë²ˆí˜¸',prefix:'VG',fields:['F'],fieldUse:false,fieldMode:'code',fieldCodes:{F:'VG'}},
  {c:17,n:'ë¬¼ì§ˆê²€ì‚¬',i:10,o:1,rcpt:'MT-26-02-0001',rcptDesc:'ëª©ì ì½”ë“œ-ë…„ë„-ì›”-ì¼ë ¨ë²ˆí˜¸',prefix:'MT',fields:['F'],fieldUse:false,fieldMode:'code',fieldCodes:{F:'MT'}},
  {c:18,n:'Allergen(RT-PCR)',i:6,o:1,rcpt:'AR-26-02-0001',rcptDesc:'ëª©ì ì½”ë“œ-ë…„ë„-ì›”-ì¼ë ¨ë²ˆí˜¸',prefix:'AR',fields:['F'],fieldUse:false,fieldMode:'code',fieldCodes:{F:'AR'}},
  {c:116,n:'ì—°êµ¬ìš©ì—­',i:20,o:1,rcpt:'RD-26-02-0001',rcptDesc:'ëª©ì ì½”ë“œ-ë…„ë„-ì›”-ì¼ë ¨ë²ˆí˜¸',prefix:'RD',fields:['F','L'],fieldUse:false,fieldMode:'code',fieldCodes:{F:'RD',L:'LRD'}},
  {c:117,n:'í‘œì‹œê¸°ì¤€',i:8,o:1,rcpt:'LB-26-02-0001',rcptDesc:'ëª©ì ì½”ë“œ-ë…„ë„-ì›”-ì¼ë ¨ë²ˆí˜¸',prefix:'LB',fields:['F'],fieldUse:false,fieldMode:'code',fieldCodes:{F:'LB'}},
  {c:118,n:'IGC',i:6,o:1,rcpt:'IG-26-02-0001',rcptDesc:'ëª©ì ì½”ë“œ-ë…„ë„-ì›”-ì¼ë ¨ë²ˆí˜¸',prefix:'IG',fields:['F'],fieldUse:false,fieldMode:'code',fieldCodes:{F:'IG'}},
  {c:119,n:'ì”ë¥˜ë†ì•½(ì¸ì¦ìš©)',i:12,o:1,rcpt:'PC-26-02-0001',rcptDesc:'ëª©ì ì½”ë“œ-ë…„ë„-ì›”-ì¼ë ¨ë²ˆí˜¸',prefix:'PC',fields:['F'],fieldUse:false,fieldMode:'code',fieldCodes:{F:'PC'}},
  {c:120,n:'ì”ë¥˜ë†ì•½(ì°¸ê³ ìš©)',i:12,o:1,rcpt:'PR-26-02-0001',rcptDesc:'ëª©ì ì½”ë“œ-ë…„ë„-ì›”-ì¼ë ¨ë²ˆí˜¸',prefix:'PR',fields:['F'],fieldUse:false,fieldMode:'code',fieldCodes:{F:'PR'}},
  {c:121,n:'í•­ìƒë¬¼ì§ˆ(ì¸ì¦ìš©)',i:8,o:1,rcpt:'AC-26-02-0001',rcptDesc:'ëª©ì ì½”ë“œ-ë…„ë„-ì›”-ì¼ë ¨ë²ˆí˜¸',prefix:'AC',fields:['L'],fieldUse:false,fieldMode:'code',fieldCodes:{L:'AC'}},
  {c:122,n:'í•­ìƒë¬¼ì§ˆ(ì°¸ê³ ìš©)',i:8,o:1,rcpt:'AT-26-02-0001',rcptDesc:'ëª©ì ì½”ë“œ-ë…„ë„-ì›”-ì¼ë ¨ë²ˆí˜¸',prefix:'AT',fields:['L'],fieldUse:false,fieldMode:'code',fieldCodes:{L:'AT'}},
  {c:123,n:'ì°¸ê³ ìš©(ì†Œë¹„ê¸°í•œì„¤ì •)',i:28,o:1,rcpt:'SE-26-02-0001',rcptDesc:'ëª©ì ì½”ë“œ-ë…„ë„-ì›”-ì¼ë ¨ë²ˆí˜¸',prefix:'SE',fields:['F'],fieldUse:false,fieldMode:'code',fieldCodes:{F:'SE'}},
  // ë¯¸ì • (ë¯¸ì‚¬ìš©)
  {c:3,n:'ì°¸ê³ ìš©(ìœ„ìƒì•ˆì „ê¾¸ëŸ¬ë¯¸)',i:15,o:0,rcpt:'',prefix:'',fields:['F'],fieldUse:false,fieldMode:'code',fieldCodes:{}},
  {c:5,n:'ì°¸ê³ ìš©(HACCPëª¨ë‹ˆí„°ë§)',i:20,o:0,rcpt:'',prefix:'',fields:['F'],fieldUse:false,fieldMode:'code',fieldCodes:{}},
  {c:7,n:'ì œì¶œìš©',i:30,o:0,rcpt:'',prefix:'',fields:['F'],fieldUse:false,fieldMode:'code',fieldCodes:{}},
  {c:8,n:'ì¹œí™˜ê²½ì¸ì¦ìš©',i:12,o:0,rcpt:'',prefix:'',fields:['F'],fieldUse:false,fieldMode:'code',fieldCodes:{}},
  {c:9,n:'GAPì¸ì¦ìš©',i:10,o:0,rcpt:'',prefix:'',fields:['F'],fieldUse:false,fieldMode:'code',fieldCodes:{}},
  {c:114,n:'ì°¸ê³ ìš©(í’ˆëª©ì œì¡°ë³´ê³ ì„œì‹ ê³ ì œí’ˆ)',i:32,o:0,rcpt:'',prefix:'',fields:['F'],fieldUse:false,fieldMode:'code',fieldCodes:{}},
  {c:115,n:'ì°¸ê³ ìš©(í’ˆëª©ì œì¡°ë³´ê³ ì„œì‹ ê³ ì œí’ˆ-ê¸°ì¤€ê·œê²©)',i:32,o:0,rcpt:'',prefix:'',fields:['F'],fieldUse:false,fieldMode:'code',fieldCodes:{}},
];

// â•â• RENDER PURPOSES â•â•
function rp(f='all',s=''){
  const ct=document.getElementById('purpose-container');
  const onItems=P.filter(p=>p.o);
  const offItems=P.filter(p=>!p.o);
  let html='';

  function matchFilter(p){
    if(f==='on'&&!p.o)return false;
    if(f==='off'&&p.o)return false;
    if(s&&!p.n.toLowerCase().includes(s.toLowerCase()))return false;
    return true;
  }

  // ì‚¬ìš© ì„¹ì…˜
  const onFiltered=onItems.filter(matchFilter);
  if(onFiltered.length&&f!=='off'){
    html+=`<div class="section-label">ğŸŸ¢ ì‚¬ìš© ì¤‘ (${onFiltered.length})</div>`;
    html+='<div class="card-grid">';
    onFiltered.forEach((p,idx)=>{
      const ftags=(p.fields||[]).map(id=>{const f=FIELDS.find(x=>x.id===id);return f?`<span style="display:inline-flex;align-items:center;gap:3px;padding:2px 8px;border-radius:50px;font-size:10px;font-weight:600;background:${f.color}18;color:${f.color}"><span style="width:6px;height:6px;border-radius:50%;background:${f.color}"></span>${f.name}</span>`:''}).join(' ');
      html+=`<div class="p-card" onclick="openDetail(${P.indexOf(p)})">
        <div class="p-card-top on"></div>
        <div class="p-card-body">
          <div class="p-card-head">
            <div class="p-card-code">${String(idx+1).padStart(2,'0')}</div>
            <div class="p-card-status"><span class="dot dot-on"></span> ì‚¬ìš©</div>
          </div>
          <div class="p-card-name">${p.n}</div>
          <div style="margin-bottom:8px">${ftags}</div>
          <div class="p-card-receipt">
            <div style="flex:1"><div class="rcpt-label">ì ‘ìˆ˜ë²ˆí˜¸</div><div class="rcpt-num">${p.rcpt||'ë¯¸ì„¤ì •'}</div></div>
          </div>
          <div class="p-card-footer">
            <div class="p-card-items">ğŸ§ª ì—°ê²° í•­ëª© <span>${p.i}ê°œ</span></div>
            <div class="p-card-arrow">â†’</div>
          </div>
        </div>
      </div>`;
    });
    html+='</div>';
  }

  // ë¯¸ì • ì„¹ì…˜
  const offFiltered=offItems.filter(matchFilter);
  if(offFiltered.length&&f!=='on'){
    html+=`<div class="section-label">ğŸ”˜ ë¯¸ì • (${offFiltered.length})</div>`;
    html+='<div class="card-grid">';
    offFiltered.forEach(p=>{
      html+=`<div class="p-card" onclick="openDetail(${P.indexOf(p)})">
        <div class="p-card-top off"></div>
        <div class="p-card-body">
          <div class="p-card-head">
            <div class="p-card-code" style="background:#ccc">${String(p.c).padStart(2,'0')}</div>
            <div class="p-card-status" style="color:#aaa"><span class="dot dot-off"></span> ë¯¸ì •</div>
          </div>
          <div class="p-card-name" style="color:#999">${p.n}</div>
          <div class="p-card-receipt">
            <div style="flex:1"><div class="rcpt-label">ì ‘ìˆ˜ë²ˆí˜¸</div><div class="rcpt-none">ë¯¸ì„¤ì •</div></div>
          </div>
          <div class="p-card-footer">
            <div class="p-card-items" style="color:#bbb">ğŸ§ª ì—°ê²° í•­ëª© <span style="color:#aaa">${p.i}ê°œ</span></div>
            <div class="p-card-arrow">â†’</div>
          </div>
        </div>
      </div>`;
    });
    html+='</div>';
  }
  ct.innerHTML=html;
}

let cf='all';
function tp(e,f){e.parentElement.querySelectorAll('.pill').forEach(p=>p.classList.remove('on'));e.classList.add('on');cf=f;fp()}
function fp(){rp(cf,document.getElementById('sp').value)}

// â•â• DETAIL VIEW â•â•
let curIdx=0;
function openDetail(idx){
  curIdx=idx;
  const p=P[idx];
  document.getElementById('purpose-list').style.display='none';
  const dv=document.getElementById('purpose-detail');
  dv.classList.add('show');
  document.getElementById('fb').style.display='none';

  // header
  document.getElementById('detail-header').innerHTML=`
    <div class="dh-code">${String(p.c).padStart(2,'0')}</div>
    <div><div class="dh-name">${p.n}</div>
    <span class="dh-status ${p.o?'dh-on':'dh-off'}">${p.o?'ğŸŸ¢ ì‚¬ìš©':'ğŸ”˜ ë¯¸ì •'}</span></div>`;

  // form
  document.getElementById('d-name').value=p.n;
  document.getElementById('d-code').value=p.c;
  document.getElementById('d-order').value=p.c;
  document.getElementById('d-active').checked=p.o;
  document.getElementById('d-active-label').textContent=p.o?'ì‚¬ìš©':'ë¯¸ì •';
  document.getElementById('d-active-label').style.color=p.o?'var(--green)':'#aaa';

  // receipt number init
  dCurrentPrefix=p.prefix||String(p.c);
  dInitSeg();

  // field init
  renderFieldChips(p);
  document.getElementById('d-field-use').checked=p.fieldUse||false;
  toggleFieldMode();
  if(p.fieldMode){
    const radio=document.querySelector(`input[name="field-mode"][value="${p.fieldMode}"]`);
    if(radio)radio.checked=true;
  }
  updateFieldMode();
  renderFieldModeExamples();
}

function closeDetail(){
  document.getElementById('purpose-detail').classList.remove('show');
  document.getElementById('purpose-list').style.display='block';
  document.getElementById('fb').style.display='flex';
}

function saveDetail(){
  const p=P[curIdx];
  p.n=document.getElementById('d-name').value;
  p.o=document.getElementById('d-active').checked?1:0;
  rp(cf,document.getElementById('sp').value);
  closeDetail();
  toast('ê²€ì‚¬ ëª©ì ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤ âœ¨','ok');
}

function deletePurpose(){
  const p=P[curIdx];
  document.getElementById('del-msg').innerHTML=`<b>"${p.n}"</b> ê²€ì‚¬ ëª©ì ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`;
  openModal('mdel');
}

function confirmDelete(){
  P.splice(curIdx,1);
  closeModal('mdel');
  rp(cf,document.getElementById('sp').value);
  closeDetail();
  toast('ê²€ì‚¬ ëª©ì ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤','info');
}

function copyPurpose(){
  const src=P[curIdx];
  const maxC=Math.max(...P.map(p=>p.c))+1;
  const copy={
    c:maxC,
    n:src.n+' (ë³µì‚¬)',
    i:src.i,
    o:0,
    rcpt:src.rcpt,
    rcptDesc:src.rcptDesc,
    prefix:src.prefix,
    fields:[...(src.fields||[])],
    fieldUse:src.fieldUse,
    fieldMode:src.fieldMode,
    fieldCodes:{...(src.fieldCodes||{})}
  };
  P.push(copy);
  rp(cf,document.getElementById('sp').value);
  closeDetail();
  toast(`"${src.n}" â†’ ë³µì‚¬ë³¸ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤ âœ¨`,'ok');
  // ë³µì‚¬ë³¸ ìƒì„¸ ì—´ê¸°
  setTimeout(()=>openDetail(P.length-1),300);
}

// switch toggle label
document.getElementById('d-active').addEventListener('change',function(){
  document.getElementById('d-active-label').textContent=this.checked?'ì‚¬ìš©':'ë¯¸ì •';
  document.getElementById('d-active-label').style.color=this.checked?'var(--green)':'#aaa';
});

// â•â• DETAIL RECEIPT NUMBER â•â•
var dCurrentPrefix='QC';
var dSg=[{l:'ëª©ì ì½”ë“œ',t:'fixed',v:'QC'},{l:'ë…„ë„',t:'year',v:'2'},{l:'ì›”',t:'month',v:'2'},{l:'ì¼ë ¨ë²ˆí˜¸',t:'serial',v:'4'}];

function dInitSeg(){
  const c=+document.getElementById('d-seg-cnt').value;
  const pf=dCurrentPrefix||'QC';
  if(c===2)dSg=[{l:'ëª©ì ì½”ë“œ',t:'fixed',v:pf},{l:'ì¼ë ¨ë²ˆí˜¸',t:'serial',v:'4'}];
  else if(c===3)dSg=[{l:'ëª©ì ì½”ë“œ',t:'fixed',v:pf},{l:'ë…„ë„',t:'year',v:'2'},{l:'ì¼ë ¨ë²ˆí˜¸',t:'serial',v:'4'}];
  else if(c===5)dSg=[{l:'ëª©ì ì½”ë“œ',t:'fixed',v:pf},{l:'ë…„ë„',t:'year',v:'2'},{l:'ì›”',t:'month',v:''},{l:'ì¼',t:'day',v:''},{l:'ì¼ë ¨ë²ˆí˜¸',t:'serial',v:'4'}];
  else dSg=[{l:'ëª©ì ì½”ë“œ',t:'fixed',v:pf},{l:'ë…„ë„',t:'year',v:'2'},{l:'ì›”',t:'month',v:''},{l:'ì¼ë ¨ë²ˆí˜¸',t:'serial',v:'4'}];
  renderSegUI();
}

function renderSegUI(){
  const a=document.getElementById('d-seg-area');
  if(!a)return;
  const now=new Date(),y2=String(now.getFullYear()).slice(-2),y4=String(now.getFullYear()),m=String(now.getMonth()+1).padStart(2,'0'),dy=String(now.getDate()).padStart(2,'0');
  const sep=document.getElementById('d-seg-sep')?document.getElementById('d-seg-sep').value:'-';

  // === ë¹„ì£¼ì–¼ ë¸”ë¡ ë¯¸ë¦¬ë³´ê¸° ===
  let blocks='<div class="seg-builder">';
  dSg.forEach((s,i)=>{
    if(i>0)blocks+=`<span class="seg-sep">${sep}</span>`;
    let displayVal='??';
    if(s.t==='fixed')displayVal=s.v||'??';
    else if(s.t==='year')displayVal=s.v==='4'?y4:y2;
    else if(s.t==='month')displayVal=m;
    else if(s.t==='day')displayVal=dy;
    else if(s.t==='serial'){const dd=parseInt(s.v)||4;displayVal='1'.padStart(dd,'0')}
    else if(s.t==='branch')displayVal=s.v||'HQ';
    else if(s.t==='field'){const p=P[curIdx];const fc=(p&&p.fields||[]).map(id=>{const f=FIELDS.find(x=>x.id===id);return f?f.code:'?'});displayVal=fc[0]||'?'}
    blocks+=`<div class="seg-block" onclick="document.getElementById('seg-edit-${i}').scrollIntoView({behavior:'smooth',block:'center'})">
      <label>êµ¬ë¶„ ${i+1}</label>
      <div style="font-family:'Outfit',monospace;font-size:16px;font-weight:800;color:var(--pri);margin-top:4px">${displayVal}</div>
      <div style="font-size:9px;color:var(--sub);margin-top:3px">${s.l}</div>
    </div>`;
  });
  blocks+='</div>';

  // === í¸ì§‘ í¼ ===
  let form='<div style="margin-top:14px">';
  dSg.forEach((s,i)=>{
    let valHtml='';
    if(s.t==='fixed'){
      valHtml=`<input type="text" value="${s.v}" style="font-size:12px;text-align:center" placeholder="ì˜ˆ: QC" onchange="dSg[${i}].v=this.value;renderSegUI()">`;
    } else if(s.t==='year'){
      if(s.v!=='2'&&s.v!=='4')s.v='2';
      valHtml=`<select style="font-size:12px" onchange="dSg[${i}].v=this.value;renderSegUI()">
        <option value="2" ${s.v==='2'?'selected':''}>2ìë¦¬ (${y2})</option>
        <option value="4" ${s.v==='4'?'selected':''}>4ìë¦¬ (${y4})</option></select>`;
    } else if(s.t==='month'){
      valHtml=`<div style="font-size:12px;text-align:center;padding:8px;background:var(--bg);border-radius:8px;color:var(--sub);font-weight:600">ìë™ (${m})</div>`;
    } else if(s.t==='day'){
      valHtml=`<div style="font-size:12px;text-align:center;padding:8px;background:var(--bg);border-radius:8px;color:var(--sub);font-weight:600">ìë™ (${dy})</div>`;
    } else if(s.t==='serial'){
      if(!['3','4','5'].includes(s.v))s.v='4';
      valHtml=`<select style="font-size:12px" onchange="dSg[${i}].v=this.value;renderSegUI()">
        <option value="3" ${s.v==='3'?'selected':''}>3ìë¦¬ (001)</option>
        <option value="4" ${s.v==='4'?'selected':''}>4ìë¦¬ (0001)</option>
        <option value="5" ${s.v==='5'?'selected':''}>5ìë¦¬ (00001)</option></select>`;
    } else if(s.t==='branch'){
      valHtml=`<input type="text" value="${s.v||'HQ'}" style="font-size:12px;text-align:center" placeholder="ì˜ˆ: HQ" onchange="dSg[${i}].v=this.value;renderSegUI()">`;
    } else if(s.t==='field'){
      const p=P[curIdx];
      const fNames=(p&&p.fields||[]).map(id=>{const f=FIELDS.find(x=>x.id===id);return f?f.code:'?'}).join('/');
      valHtml=`<div style="font-size:12px;text-align:center;padding:8px;background:var(--bg);border-radius:8px;color:var(--sub);font-weight:600">ìë™ (${fNames||'ë¯¸ì„¤ì •'})</div>`;
    }
    const valLabel=s.t==='fixed'||s.t==='branch'?'ê°’':s.t==='month'||s.t==='day'||s.t==='field'?'ë¯¸ë¦¬ë³´ê¸°':'ì„¤ì •';

    form+=`<div id="seg-edit-${i}" style="display:flex;align-items:center;gap:10px;padding:10px 14px;background:${i%2===0?'var(--bg)':'var(--card)'};border-radius:10px;margin-bottom:4px;border-left:3px solid var(--pri)">
      <div style="flex:0 0 60px;text-align:center">
        <div style="font-size:10px;font-weight:700;color:var(--sub)">êµ¬ë¶„ ${i+1}</div>
        <input type="text" value="${s.l}" style="font-size:11px;text-align:center;border:none;background:transparent;font-weight:600;width:60px;padding:2px" onchange="dSg[${i}].l=this.value;renderSegUI()">
      </div>
      <div style="flex:1">
        <select style="font-size:12px;width:100%;padding:6px 8px;border:1.5px solid var(--bdr);border-radius:8px" onchange="changeSegType(${i},this.value)">
          <option value="fixed" ${s.t==='fixed'?'selected':''}>ê³ ì • ë¬¸ì</option>
          <option value="field" ${s.t==='field'?'selected':''}>ë¶„ì•¼ì½”ë“œ (ìë™)</option>
          <option value="year" ${s.t==='year'?'selected':''}>ë…„ë„ (ìë™)</option>
          <option value="month" ${s.t==='month'?'selected':''}>ì›” (ìë™)</option>
          <option value="day" ${s.t==='day'?'selected':''}>ì¼ (ìë™)</option>
          <option value="serial" ${s.t==='serial'?'selected':''}>ì¼ë ¨ë²ˆí˜¸ (ìë™ì¦ê°€)</option>
          <option value="branch" ${s.t==='branch'?'selected':''}>ì§€ë¶€ ì½”ë“œ</option>
        </select>
      </div>
      <div style="flex:0 0 110px"><div style="font-size:9px;font-weight:700;color:var(--sub);margin-bottom:2px">${valLabel}</div>${valHtml}</div>
    </div>`;
  });
  form+='</div>';

  a.innerHTML=blocks+form;
  dUpdatePrev();
}

function changeSegType(idx,newType){
  const defaults={fixed:{l:'ê³ ì •ë¬¸ì',v:''},year:{l:'ë…„ë„',v:'2'},month:{l:'ì›”',v:''},day:{l:'ì¼',v:''},serial:{l:'ì¼ë ¨ë²ˆí˜¸',v:'4'},branch:{l:'ì§€ë¶€ì½”ë“œ',v:'HQ'},field:{l:'ë¶„ì•¼ì½”ë“œ',v:''}};
  dSg[idx].t=newType;
  dSg[idx].v=defaults[newType].v;
  if(!dSg[idx].l||['ê³ ì •ë¬¸ì','ë…„ë„','ì›”','ì¼','ì¼ë ¨ë²ˆí˜¸','ì§€ë¶€ì½”ë“œ','ëª©ì ì½”ë“œ','ë¶„ì•¼ì½”ë“œ'].includes(dSg[idx].l)){
    dSg[idx].l=defaults[newType].l;
  }
  renderSegUI();
}

function dUpdatePrev(){
  const sep=document.getElementById('d-seg-sep')?document.getElementById('d-seg-sep').value:'-';
  const now=new Date(),y=String(now.getFullYear()).slice(-2),y4=String(now.getFullYear()),m=String(now.getMonth()+1).padStart(2,'0'),d=String(now.getDate()).padStart(2,'0');
  const p=P[curIdx];

  function buildParts(overridePrefix,fieldObj){
    let parts=[],descs=[];
    dSg.forEach(s=>{
      if(s.t==='fixed'){parts.push(overridePrefix||s.v||'??');descs.push(s.l)}
      else if(s.t==='field'){parts.push(fieldObj?fieldObj.code:'?');descs.push(s.l)}
      else if(s.t==='year'){parts.push(s.v==='4'?y4:y);descs.push(s.l)}
      else if(s.t==='month'){parts.push(m);descs.push(s.l)}
      else if(s.t==='day'){parts.push(d);descs.push(s.l)}
      else if(s.t==='serial'){const dd=parseInt(s.v)||4;parts.push('1'.padStart(dd,'0'));descs.push(s.l)}
      else if(s.t==='branch'){parts.push(s.v||'HQ');descs.push(s.l)}
    });
    return {parts,descs};
  }

  // base preview (no field override)
  const base=buildParts(null,null);
  document.getElementById('d-pn').textContent=base.parts.join(sep);
  document.getElementById('d-pd').textContent=base.descs.join(' âˆ’ ');

  // example list
  let l='';
  for(let i=1;i<=5;i++){let pp=[...base.parts];const si=dSg.findIndex(s=>s.t==='serial');if(si>=0){const dd=parseInt(dSg[si].v)||4;pp[si]=String(i).padStart(dd,'0')}l+=pp.join(sep)+'<br>'}
  document.getElementById('d-pl').innerHTML=l;

  // field-based previews
  const prevArea=document.getElementById('preview-area');
  const fieldPrevArea=document.getElementById('preview-field-area');
  const hasFieldSeg=dSg.some(s=>s.t==='field');
  const activeFields=(p&&p.fields||[]).map(id=>FIELDS.find(f=>f.id===id)).filter(Boolean);

  if(p&&activeFields.length>1&&(p.fieldUse||hasFieldSeg)){
    prevArea.style.display='none';
    fieldPrevArea.style.display='block';
    let fh='<div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:12px;margin:16px 0">';
    activeFields.forEach(f=>{
      let num='';
      if(hasFieldSeg){
        // êµ¬ë¶„ì— ë¶„ì•¼ì½”ë“œ ìœ í˜•ì´ ìˆìœ¼ë©´ í•´ë‹¹ êµ¬ë¶„ì— ë¶„ì•¼ì½”ë“œ ëŒ€ì…
        const r=buildParts(null,f);
        num=r.parts.join(sep);
      } else if(p.fieldMode==='code'){
        const code=p.fieldCodes&&p.fieldCodes[f.id]?p.fieldCodes[f.id]:p.prefix;
        const r=buildParts(code,null);
        num=r.parts.join(sep);
      } else if(p.fieldMode==='segment'){
        const fcode=p.fieldCodes&&p.fieldCodes[f.id]?p.fieldCodes[f.id]:f.code;
        num=fcode+sep+base.parts.join(sep);
      } else {
        num=base.parts.join(sep);
      }
      fh+=`<div style="background:linear-gradient(135deg,#1b1f2e,#2a2f45);border-radius:12px;padding:20px;text-align:center;border-left:4px solid ${f.color}">
        <div style="font-size:10px;color:rgba(255,255,255,.4);letter-spacing:1px;margin-bottom:4px">${f.name}</div>
        <div style="font-family:'Outfit',monospace;font-size:22px;font-weight:800;letter-spacing:2px;color:${f.color}">${num}</div>
        <div style="font-size:10px;color:rgba(255,255,255,.25);margin-top:4px">${p.fieldMode==='serial'&&!hasFieldSeg?'ë³„ë„ ì¼ë ¨ë²ˆí˜¸ ê´€ë¦¬':''}</div>
      </div>`;
    });
    fh+='</div>';
    fieldPrevArea.innerHTML=fh;
  } else {
    prevArea.style.display='block';
    fieldPrevArea.style.display='none';
  }

  // update card data
  if(p){p.rcpt=base.parts.join(sep);p.rcptDesc=base.descs.join('-');}
}

// â•â• TABS â•â•
let currentTab=0;
function showTab(i){
  currentTab=i;
  document.querySelectorAll('.tab').forEach((t,j)=>t.classList.toggle('active',j===i));
  document.querySelectorAll('.panel').forEach((p,j)=>p.classList.toggle('active',j===i));
  // close detail if switching tabs
  closeDetail();
  document.getElementById('fb').style.display='flex';
}

// â•â• FAB â•â•
const fabModals=['','','mf','mi','mg'];
function fabAction(){
  if(currentTab===0){
    openFieldAdd();
  } else if(currentTab===1){
    toast('ìƒˆ ê²€ì‚¬ ëª©ì ì„ ì¶”ê°€í•©ë‹ˆë‹¤','info');
  } else {
    openModal(fabModals[currentTab]);
  }
}

// â•â• MODAL â•â•
function openModal(id){document.getElementById(id).classList.add('show')}
function closeModal(id){document.getElementById(id).classList.remove('show')}
document.querySelectorAll('.modal-overlay').forEach(el=>{el.addEventListener('click',e=>{if(e.target===el)el.classList.remove('show')})});

// â•â• TOAST â•â•
function toast(m,t='info'){const e=document.getElementById('te');e.textContent=m;e.className='toast toast-'+t+' show';setTimeout(()=>e.classList.remove('show'),3200)}

// â•â• TREE â•â•
function tt(el){el.classList.toggle('open');el.nextElementSibling.classList.toggle('show')}

// â•â• ADD STD ROW â•â•
function asr(){const tr=document.createElement('tr');tr.innerHTML=`<td><select style="font-size:12px;padding:6px 10px;border:1.5px solid var(--bdr);border-radius:8px;width:100%"><option>ìê°€í’ˆì§ˆìœ„íƒê²€ì‚¬ìš©</option><option>ì°¸ê³ ìš©(ê¸°ì¤€ê·œê²©ì™¸)</option><option>ì°¸ê³ ìš©(ìœ í†µê¸°í•œì„¤ì •)</option><option>ì°¸ê³ ìš©(ì˜ì–‘ì„±ë¶„)</option><option>ì°¸ê³ ìš©(ì™¸ë¶€ì˜ë¢°)</option><option>ì •ë„ê´€ë¦¬</option><option>ì—°êµ¬ìš©ì—­</option></select></td><td><input type="text" placeholder="ê¸°ì¤€" style="font-size:12px;padding:6px 10px;border:1.5px solid var(--bdr);border-radius:8px"></td><td><input type="text" placeholder="ê·œê²©" style="font-size:12px;padding:6px 10px;border:1.5px solid var(--bdr);border-radius:8px"></td><td><select style="font-size:12px;padding:6px 10px;border:1.5px solid var(--bdr);border-radius:8px"><option>ì´í•˜</option><option>ë¯¸ë§Œ</option><option>ë¶ˆê²€ì¶œ</option></select></td><td><button class="ic-btn ic-btn-del" onclick="this.closest('tr').remove()">âœ•</button></td>`;document.getElementById('st').appendChild(tr)}

function updateResetDesc(){
  const v=document.getElementById('d-reset').value;
  const el=document.getElementById('reset-desc');
  if(v==='year'){el.innerHTML='ğŸ“… ë§¤ë…„ 1ì›” 1ì¼ì— ì¼ë ¨ë²ˆí˜¸ê°€ <b>0001</b>ë¶€í„° ë‹¤ì‹œ ì‹œì‘ë©ë‹ˆë‹¤';el.style.background='var(--pri-l)';el.style.color='var(--pri)'}
  else if(v==='month'){el.innerHTML='ğŸ“… ë§¤ì›” 1ì¼ì— ì¼ë ¨ë²ˆí˜¸ê°€ <b>0001</b>ë¶€í„° ë‹¤ì‹œ ì‹œì‘ë©ë‹ˆë‹¤';el.style.background='var(--mint-l)';el.style.color='var(--mint)'}
  else{el.innerHTML='ğŸ“… ì¼ë ¨ë²ˆí˜¸ê°€ ê³„ì† ì¦ê°€í•©ë‹ˆë‹¤ (ì´ˆê¸°í™” ì—†ìŒ)';el.style.background='var(--amber-l)';el.style.color='#b8860b'}
}

// â•â• FIELD (ë¶„ì•¼) MANAGEMENT â•â•

// --- TAB 0: ë¶„ì•¼ íƒ­ í•¨ìˆ˜ë“¤ ---
function renderFieldCardList(){
  const el=document.getElementById('field-card-list');
  if(!el)return;
  let h='';
  FIELDS.forEach((f,i)=>{
    const cnt=P.filter(p=>p.o&&(p.fields||[]).includes(f.id)).length;
    h+=`<div onclick="openFieldEdit('${f.id}')" style="display:flex;align-items:center;gap:14px;padding:16px 18px;background:var(--bg);border-radius:12px;margin-bottom:10px;border-left:4px solid ${f.color};transition:all .2s;cursor:pointer" onmouseover="this.style.background='var(--pri-l)'" onmouseout="this.style.background='var(--bg)'">
      <div style="width:46px;height:46px;border-radius:12px;background:${f.color}15;display:flex;align-items:center;justify-content:center;font-size:22px;font-weight:800;font-family:'Outfit';color:${f.color}">${f.code}</div>
      <div style="flex:1">
        <div style="font-size:15px;font-weight:800">${f.name}</div>
        <div style="font-size:11px;color:var(--sub);margin-top:2px">${f.desc||'ë¶„ì•¼ ì„¤ëª… ì—†ìŒ'}</div>
      </div>
      <div style="text-align:center">
        <div style="font-family:'Outfit';font-size:22px;font-weight:800;color:${f.color}">${cnt}</div>
        <div style="font-size:10px;color:var(--sub)">ê²€ì‚¬ ëª©ì </div>
      </div>
      <button class="ic-btn ic-btn-del" onclick="event.stopPropagation();deleteField('${f.id}')" title="ì‚­ì œ" style="margin-left:4px">âœ•</button>
    </div>`;
  });
  el.innerHTML=h;
  const statEl=document.getElementById('stat-field-cnt');
  if(statEl)statEl.textContent=FIELDS.length;
}

function deleteField(fid){
  const f=FIELDS.find(x=>x.id===fid);
  if(!f)return;
  if(!confirm(`"${f.name}" ë¶„ì•¼ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`))return;
  FIELDS.splice(FIELDS.indexOf(f),1);
  P.forEach(p=>{if(p.fields){p.fields=p.fields.filter(id=>id!==fid)}});
  renderFieldCardList();
  if(curIdx>=0&&P[curIdx]){
    renderFieldChips(P[curIdx]);
    renderFieldModeExamples();
  }
  toast(`${f.name} ë¶„ì•¼ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤`,'info');
}

// --- TAB 1: ê²€ì‚¬ ëª©ì  ìƒì„¸ ë¶„ì•¼ í•¨ìˆ˜ë“¤ ---
function renderFieldChips(p){
  const el=document.getElementById('field-chips');
  if(!el)return;
  let h='';
  FIELDS.forEach(f=>{
    const checked=(p.fields||[]).includes(f.id);
    h+=`<div onclick="toggleFieldChip('${f.id}')" style="display:inline-flex;align-items:center;gap:8px;padding:10px 18px;border-radius:50px;cursor:pointer;transition:all .2s;font-size:14px;font-weight:700;border:2px solid ${checked?f.color:'var(--bdr)'};background:${checked?f.color+'15':'var(--card)'};color:${checked?f.color:'#bbb'}">
      <span style="width:12px;height:12px;border-radius:50%;background:${f.color};opacity:${checked?1:.3}"></span>${f.name}</div>`;
  });
  el.innerHTML=h;
}

function toggleFieldChip(fid){
  const p=P[curIdx];
  if(!p.fields)p.fields=[];
  const idx=p.fields.indexOf(fid);
  if(idx>=0)p.fields.splice(idx,1);
  else p.fields.push(fid);
  renderFieldChips(p);
  updateFieldMode();
  dUpdatePrev();
}

function toggleFieldMode(){
  const on=document.getElementById('d-field-use').checked;
  const p=P[curIdx];
  if(p)p.fieldUse=on;
  document.getElementById('d-field-use-label').textContent=on?'ì ìš© â€” ë¶„ì•¼ë³„ ì ‘ìˆ˜ë²ˆí˜¸ êµ¬ë¶„':'ë¯¸ì ìš©';
  document.getElementById('d-field-use-label').style.color=on?'var(--pri)':'#aaa';
  document.getElementById('field-mode-area').style.display=on?'block':'none';
  if(on){renderFieldModeExamples();updateFieldMode();}
  dUpdatePrev();
}

function updateFieldMode(){
  const p=P[curIdx];
  if(!p)return;
  const mode=document.querySelector('input[name="field-mode"]:checked');
  p.fieldMode=mode?mode.value:'code';

  document.querySelectorAll('.field-opt').forEach(el=>{
    const r=el.querySelector('input[type=radio]');
    if(r.checked){
      el.style.borderColor='var(--pri)';
      el.style.background='var(--pri-l)';
      el.style.boxShadow='0 2px 8px rgba(67,97,238,.12)';
    } else {
      el.style.borderColor='var(--bdr)';
      el.style.background='var(--bg)';
      el.style.boxShadow='none';
    }
  });

  const codeArea=document.getElementById('field-code-area');
  if(p.fieldMode==='code'){
    codeArea.style.display='block';
    renderFieldCodes(p,'code');
  } else if(p.fieldMode==='segment'){
    codeArea.style.display='block';
    renderFieldCodes(p,'segment');
  } else {
    codeArea.style.display='none';
  }
  renderFieldModeExamples();
  dUpdatePrev();
}

function renderFieldModeExamples(){
  const p=P[curIdx];
  if(!p)return;
  const pf=p.prefix||'QC';
  function makeTag(f,text){
    return `<span style="font-family:'Outfit',monospace;font-size:12px;font-weight:700;padding:4px 10px;border-radius:6px;background:${f.color}12;color:${f.color}">${f.name} ${text}</span>`;
  }
  let codeH='',segH='',serialH='';
  FIELDS.forEach(f=>{
    const fc=p.fieldCodes&&p.fieldCodes[f.id]?p.fieldCodes[f.id]:pf;
    codeH+=makeTag(f,`${fc}-26-0001`);
    segH+=makeTag(f,`<b>${f.code}</b>-${pf}-26-0001`);
    serialH+=makeTag(f,`${pf}-26-<b>0001</b>~`);
  });
  const el1=document.getElementById('fm-example-code');
  const el2=document.getElementById('fm-example-seg');
  const el3=document.getElementById('fm-example-serial');
  if(el1)el1.innerHTML=codeH;
  if(el2)el2.innerHTML=segH;
  if(el3)el3.innerHTML=serialH;
}

function renderFieldCodes(p,mode){
  const el=document.getElementById('field-code-list');
  if(!el)return;
  const activeFields=(p.fields||[]).map(id=>FIELDS.find(f=>f.id===id)).filter(Boolean);
  if(!activeFields.length){
    el.innerHTML='<div style="font-size:12px;color:#bbb;padding:10px 14px;background:var(--bg);border-radius:10px;text-align:center">ì†Œì† ë¶„ì•¼ë¥¼ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”</div>';
    return;
  }
  let h='';
  activeFields.forEach(f=>{
    const codeVal=p.fieldCodes&&p.fieldCodes[f.id]?p.fieldCodes[f.id]:(mode==='segment'?f.code:p.prefix);
    h+=`<div style="display:flex;align-items:center;gap:12px;padding:10px 14px;background:var(--card);border-radius:10px;margin-bottom:6px;border:1.5px solid var(--bdr)">
      <span style="width:12px;height:12px;border-radius:50%;background:${f.color};flex-shrink:0"></span>
      <span style="font-size:13px;font-weight:700;flex:1">${f.name}</span>
      <span style="font-size:11px;font-weight:600;color:var(--sub)">${mode==='code'?'ëª©ì ì½”ë“œ':'ë¶„ì•¼ì½”ë“œ'}</span>
      <input type="text" value="${codeVal}" style="width:72px;text-align:center;padding:7px 8px;border:2px solid var(--bdr);border-radius:8px;font-size:14px;font-weight:800;font-family:'Outfit',monospace;outline:none;transition:border .2s"
        onfocus="this.style.borderColor='var(--pri)'" onblur="this.style.borderColor='var(--bdr)'"
        onchange="P[curIdx].fieldCodes=P[curIdx].fieldCodes||{};P[curIdx].fieldCodes['${f.id}']=this.value;dUpdatePrev();renderFieldModeExamples()">
    </div>`;
  });
  el.innerHTML=h;
}

var editingFieldId=null; // null=ì¶”ê°€ëª¨ë“œ, ê°’=ìˆ˜ì •ëª¨ë“œ

function openFieldAdd(){
  editingFieldId=null;
  document.getElementById('mf-title').textContent='ğŸ·ï¸ ë¶„ì•¼ ì¶”ê°€';
  document.getElementById('mf-submit').textContent='ì¶”ê°€';
  document.getElementById('mf-name').value='';
  document.getElementById('mf-code').value='';
  document.getElementById('mf-code').removeAttribute('readonly');
  document.getElementById('mf-code').style.opacity='1';
  document.getElementById('mf-desc').value='';
  document.getElementById('mf-color').value='#4361ee';
  updateFieldPreview();
  openModal('mfield');
}

function openFieldEdit(fid){
  const f=FIELDS.find(x=>x.id===fid);
  if(!f)return;
  editingFieldId=fid;
  document.getElementById('mf-title').textContent='ğŸ·ï¸ ë¶„ì•¼ ìˆ˜ì •';
  document.getElementById('mf-submit').textContent='ì €ì¥';
  document.getElementById('mf-name').value=f.name;
  document.getElementById('mf-code').value=f.code;
  document.getElementById('mf-code').removeAttribute('readonly');
  document.getElementById('mf-code').style.opacity='1';
  document.getElementById('mf-desc').value=f.desc||'';
  document.getElementById('mf-color').value=f.color;
  updateFieldPreview();
  openModal('mfield');
}

function updateFieldPreview(){
  const name=document.getElementById('mf-name').value.trim()||'ìƒˆ ë¶„ì•¼';
  const code=document.getElementById('mf-code').value.trim().toUpperCase()||'?';
  const color=document.getElementById('mf-color').value;
  const desc=document.getElementById('mf-desc').value.trim()||'ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”';
  const prev=document.getElementById('mf-preview');
  prev.style.borderLeftColor=color;
  document.getElementById('mf-prev-icon').style.background=color+'15';
  document.getElementById('mf-prev-icon').style.color=color;
  document.getElementById('mf-prev-icon').textContent=code;
  document.getElementById('mf-prev-name').textContent=name;
  document.getElementById('mf-prev-desc').textContent=desc;
}

function saveField(){
  const name=document.getElementById('mf-name').value.trim();
  const code=document.getElementById('mf-code').value.trim().toUpperCase();
  const color=document.getElementById('mf-color').value;
  const desc=document.getElementById('mf-desc').value.trim();
  if(!name||!code){toast('ë¶„ì•¼ëª…ê³¼ ì½”ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”','info');return;}

  if(editingFieldId){
    const f=FIELDS.find(x=>x.id===editingFieldId);
    if(!f)return;
    const oldId=editingFieldId;
    const newId=code;

    if(oldId!==newId){
      if(FIELDS.find(x=>x.id===newId&&x!==f)){toast('ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì½”ë“œì…ë‹ˆë‹¤','info');return;}
      P.forEach(p=>{
        if(p.fields){
          const idx=p.fields.indexOf(oldId);
          if(idx>=0)p.fields[idx]=newId;
        }
        if(p.fieldCodes&&p.fieldCodes[oldId]){
          p.fieldCodes[newId]=p.fieldCodes[oldId];
          delete p.fieldCodes[oldId];
        }
      });
      f.id=newId;
    }
    f.name=name;
    f.code=code;
    f.color=color;
    f.desc=desc;
    closeModal('mfield');
    renderFieldCardList();
    // ê²€ì‚¬ ëª©ì  ìƒì„¸ê°€ ì—´ë ¤ìˆìœ¼ë©´ ë¶„ì•¼ ê´€ë ¨ UIë„ ê°±ì‹ 
    if(curIdx>=0&&P[curIdx]){
      renderFieldChips(P[curIdx]);
      renderFieldModeExamples();
      const m=document.querySelector('input[name="field-mode"]:checked');
      if(m&&P[curIdx].fieldUse)updateFieldMode();
    }
    toast(`${name} ë¶„ì•¼ê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤ âœ¨`,'ok');
  } else {
    if(FIELDS.find(f=>f.id===code)){toast('ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì½”ë“œì…ë‹ˆë‹¤','info');return;}
    FIELDS.push({id:code,name:name,code:code,color:color,desc:desc});
    closeModal('mfield');
    renderFieldCardList();
    if(curIdx>=0&&P[curIdx])renderFieldChips(P[curIdx]);
    toast(`${name} ë¶„ì•¼ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤ âœ¨`,'ok');
  }
}

// â•â• INIT â•â•
rp();
renderFieldCardList();
</script>
</body>
</html>
